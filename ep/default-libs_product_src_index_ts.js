"use strict";(self.webpackChunkicom=self.webpackChunkicom||[]).push([["default-libs_product_src_index_ts"],{1367:(X,C,a)=>{a.r(C),a.d(C,{IcomLibsProductAddEditComponent:()=>H,IcomLibsProductListComponent:()=>I});var S=a(1670),t=a(1699),d=a(8849),f=a(8399),T=a(7313),h=a(8619),y=a(1498),g=a(5942),n=a(9736),D=a(3839),U=a(8641),A=a(7090),P=a(9404),L=a(7505),M=a(6677),G=a(4447),x=a(9717),w=a(8883),z=a(424),b=a(7253);let I=(()=>{class r{constructor(e){this.modalService=e,this.form=new d.cw({}),this.model={},this.inventoryService=(0,t.f3M)(g.k),this.productService=(0,t.f3M)(g.k),this.IComMessageService=(0,t.f3M)(x.Q),this.fields=[{fieldGroupClassName:"flex flex-col",className:"basis-1/2",fieldGroup:[{key:"name",type:"input",className:"basis-4/12",props:{label:"Name",placeholder:"Enter Name",type:"string"},expressions:{"props.":"formState.disabled"}},{key:"gen_code_type",type:"select-custom",className:"basis-4/12 ",props:{label:"Gen Code Type",placeholder:"Select Gen Code Type",viewValue:"name",labelProp:"name",valueProp:"code",options:this.productService.getOptionType("PRODUCT_GENCODE_TYPE").pipe((0,n.U)(s=>s?.data))},expressions:{hide:"!formState.hidden"}},{key:"sku",type:"input",className:"basis-4/12",props:{label:"Sku",placeholder:"Enter Sku",type:"string"},expressions:{hide:"!formState.hidden"}}]},{fieldGroupClassName:"flex flex-col",className:"basis-1/2",fieldGroup:[{key:"brand",type:"input",className:"basis-4/12",props:{label:"Brand Name",placeholder:"Enter Brand Name",type:"string"},expressions:{hide:"!formState.hidden"}},{key:"status",type:"select-custom",className:"basis-4/12 ",props:{label:"Status",viewValue:"name",labelProp:"name",placeholder:"Select Status",valueProp:"int_value",options:this.productService.getOptionType("PRODUCT_STATUS").pipe((0,n.U)(s=>s?.data))},expressions:{hide:"!formState.hidden"}},{key:"type",type:"select-custom",className:"basis-4/12 ",templateOptions:{label:"Type",placeholder:"Select Type",viewValue:"name",labelProp:"name",valueProp:"code",options:this.productService.getOptionType("PRODUCT_TYPE").pipe((0,n.U)(s=>s?.data))},expressions:{hide:"!formState.hidden"}}]}],this.router=(0,t.f3M)(G.F0),this.permissionService=(0,t.f3M)(z.$A),this.cdr=(0,t.f3M)(t.sBO),this.loadData=s=>this.inventoryService.searchProduct(s),this.functionParse=s=>s?.map(o=>({...o,...o.creator_info})),this.columns=[]}ngOnInit(){var e=this;return(0,S.Z)(function*(){e.columns=[{title:"Id",type:"text",key:"id"},{title:"\u1ea2nh \u0111\u1ea1i di\u1ec7n",key:"medias[0].url",type:"image"},{title:"SKU",key:"sku",type:"text"},{title:"T\xean s\u1ea3n ph\u1ea9m",key:"name",type:"text"},{title:"S\u1ed1 l\u01b0\u1ee3ng",key:"quantity_available",type:"text"},{title:"Th\u01b0\u01a1ng hi\u1ec7u",key:"brand.name",type:"text"},{title:"Lo\u1ea1i",key:"type",pipe:"array",type:"text",pipeArgs:[]},{title:"Gen Code Type",key:"gen_code_type",pipe:"array",type:"text",pipeArgs:[]},{title:"Th\u1eddi gian b\u1eaft \u0111\u1ea7u",key:"start_time",type:"text",pipe:"time"},{title:"Th\u1eddi gian k\u1ebft th\xfac",key:"end_time",type:"text",pipe:"time"},{title:"Tr\u1ea1ng th\xe1i",key:"status",pipe:"array",type:"text",pipeArgs:[]},{title:"Thao t\xe1c",key:"actions",type:"action",actions:[{name:"Xem",callback:e.viewItem.bind(e),condition:s=>e.permissionService.getPermission("view")},{name:"S\u1eeda",callback:e.editItem.bind(e),condition:s=>!!e.permissionService.getPermission("edit")&&"COMPLETED"!==s.status}]}],(0,D.a)([e.productService.getOptionType("PRODUCT_TYPE"),e.productService.getOptionType("PRODUCT_GENCODE_TYPE"),e.productService.getOptionType("PRODUCT_STATUS")]).subscribe(s=>{const[o,i,l]=s,O=e.columns.find(c=>"type"===c.key);O&&(O.pipeArgs=e.pipeParseStatus(o)),e.columns=[...e.columns];const N=e.columns.find(c=>"gen_code_type"===c.key);N&&(N.pipeArgs=e.pipeParseStatus(i)),e.columns=[...e.columns];const k=e.columns.find(c=>"status"===c.key);k&&(k.pipeArgs=e.pipeParseStatus(l)),e.columns=[...e.columns],e.cdr.detectChanges()})})()}pipeParseStatus(e){return e.data.map(s=>({...s,id:s.code,value:s.name||s.string_value}))}editItem(e){this.router.navigateByUrl(`inventory/transfer/detail?id=${e.id}&mode=edit`)}viewItem(e){this.router.navigateByUrl(`inventory/transfer/detail?id=${e.id}&mode=view`)}handlerAdd(){this.router.navigateByUrl("inventory/transfer/detail?mode=add")}handlerFunctionControl(e){this.eventFunctionControl=e}showModal(){this.isVisible=!0}handleOk(){this.addEditComp.handlerSave(void 0,{success:s=>{this.isVisible=!1,this.router.navigate(["/product/voucher/detail",s])},isLoading:()=>{this.isOkLoading=!0},loadDone:()=>{this.isOkLoading=!1,this.loadPage({offset:0})}})}loadPage(e){throw new Error("Method not implemented.")}handleCancel(){this.isVisible=!1}handlerViewDetail(e,s){e.stopPropagation();const o=this.router.serializeUrl(this.router.createUrlTree([`/product/voucher/detail/${s.id}`]));window.open(o,"_blank")}static#e=this.\u0275fac=function(s){return new(s||r)(t.Y36(P.Sf))};static#t=this.\u0275cmp=t.Xpm({type:r,selectors:[["icom-libs-product-list"]],standalone:!0,features:[t.jDz],decls:3,vars:6,consts:[[1,"flex","w-full","h-full","flex-col"],["nz-row","",1,"w-full","pr-4","h-full",2,"justify-content","end","padding-right","8px"],[1,"w-full","h-full",3,"columns","loadFn","fields","model","form","functionParse","icomAdd","icomFunctionControl"]],template:function(s,o){1&s&&(t.TgZ(0,"div",0)(1,"div",1)(2,"icom-libs-core-components-table",2),t.NdJ("icomAdd",function(){return o.showModal()})("icomFunctionControl",function(l){return o.handlerFunctionControl(l)}),t.qZA()()()),2&s&&(t.xp6(2),t.Q6J("columns",o.columns)("loadFn",o.loadData)("fields",o.fields)("model",o.model)("form",o.form)("functionParse",o.functionParse))},dependencies:[T.u,d.UX,f.X0,h.sL,y.U5,b.SK,U.ZJ,A.PV,P.Qp,M.LV,d.u5,L.b1,w.d],encapsulation:2,changeDetection:0})}return r})();var v=a(5043),m=a(3317),_=a(5616),E=a(1236),R=a(6575),u=a(7178),F=a(292),Y=a(479),Z=a(5920);function B(r,p){if(1&r){const e=t.EpF();t.TgZ(0,"div",5)(1,"button",6),t.NdJ("click",function(o){t.CHM(e);const i=t.oxw(2);return t.KtG(i.handlerSave(o))}),t._uU(2," Submit "),t.qZA(),t.TgZ(3,"button",7),t.NdJ("click",function(o){t.CHM(e);const i=t.oxw(2);return t.KtG(i.handlerCancel(o))}),t._uU(4,"Cancel"),t.qZA()()}if(2&r){const e=t.oxw(2);t.xp6(1),t.Q6J("nzType","primary")("nzLoading",e.isLoading)}}function J(r,p){if(1&r){const e=t.EpF();t.TgZ(0,"div",5)(1,"button",6),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(2);return t.KtG(o.toggleDisabled())}),t._uU(2," Edit "),t.qZA()()}if(2&r){const e=t.oxw(2);t.xp6(1),t.Q6J("nzType","primary")("nzLoading",e.isLoading)}}function Q(r,p){if(1&r&&(t.TgZ(0,"div",3),t.YNc(1,B,5,2,"div",4),t.YNc(2,J,3,2,"div",4),t.qZA()),2&r){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",!(null!=e.options&&null!=e.options.formState&&e.options.formState.disabled)),t.xp6(1),t.Q6J("ngIf",null==e.options||null==e.options.formState?null:e.options.formState.disabled)}}let H=(()=>{class r{constructor(){this.form=new d.cw({}),this.options={formState:{disabled:!0}},this.fields=[],this.icomSave=new t.vpe,this.productService=(0,t.f3M)(g.k),this.iComMessageService=(0,t.f3M)(x.Q),this.destroyRef=(0,t.f3M)(t.ktI),this.changeDetectorRef=(0,t.f3M)(t.sBO),this.model={}}ngOnInit(){this.fields=((r,p)=>[{key:"name",type:"input",props:{label:"Name",placeholder:"Enter Name",type:"string",required:!0},expressions:{"props.disabled":"formState.disabled"}},{key:"gen_code_type",type:"select-custom",className:"w-[500px]",props:{label:"Gen Code Type",placeholder:"Select Gen Code Type",viewValue:"name",labelProp:"name",valueProp:"code",required:!0,options:r.getOptionType("PRODUCT_GENCODE_TYPE").pipe((0,n.U)(e=>e?.data))},expressions:{"props.disabled":"formState.disabled"}},{key:"code",type:"input",className:"basis-1/2",props:{label:"Code",placeholder:"Enter Code",type:"string",required:!0},expressions:{"props.disabled":e=>"GENCODE_TYPE_FROM_3RD_PARTY"===e.model?.gen_code_type||p.disabled}},{key:"unlimit",defaultValue:!0,type:"checkbox",props:{label:"Unlimit"},expressions:{"props.disabled":e=>"GENCODE_TYPE_PRE_GENERATED"===e.model?.gen_code_type||p.disabled},hooks:{onChanges:e=>{const s=e.parent.get("gen_code_type").formControl;s&&s.valueChanges.pipe((0,v.O)(s.value),(0,m.x)(),(0,n.U)(o=>"GENCODE_TYPE_AUTO_ONE_BY_ONE"===o||"GENCODE_TYPE_FROM_3RD_PARTY"===o?(e.props.disabled=!1,void(e.model.unlimit=!0)):(e.props.disabled=!0,void(e.model.unlimit=!1)))).subscribe()}}},{key:"belong_to_merchant",type:"checkbox",props:{label:"Select Merchant"},expressions:{"props.disabled":"formState.disabled"}},{fieldGroupClassName:"flex row items-center",key:"",fieldGroup:[{key:"type",type:"select-custom",className:"basis-1/2",expressions:{"props.disabled":"formState.disabled"},props:{label:"Type",placeholder:"Select Type",viewValue:"name",labelProp:"name",required:!0,valueProp:"code",options:r.getOptionType("PRODUCT_TYPE").pipe((0,n.U)(e=>e?.data))}},{key:"status",type:"select-custom",className:"basis-1/2 ml-4",expressions:{"props.disabled":"formState.disabled"},props:{label:"Status",viewValue:"name",labelProp:"name",search:!0,placeholder:"Select Status",valueProp:"int_value",required:!0,options:r.getOptionType("PRODUCT_STATUS").pipe((0,n.U)(e=>e?.data))}}]},{fieldGroupClassName:"flex row items-center",key:"",fieldGroup:[{key:"start_time",className:"w-[300px]",type:"date",props:{required:!0,label:"Start Time",ShowTime:!0,format:"dd-MM-yyyy HH:mm"},expressions:{"props.disabled":"formState.disabled"}},{key:"end_time",className:"w-[300px]",type:"date",props:{label:"End Time",ShowTime:!0,format:"dd-MM-yyyy HH:mm"},expressions:{"props.disabled":"formState.disabled"}}]},{className:"section-label",template:'<hr class="my-4"/>'},{fieldGroupClassName:"flex row items-center",key:"",fieldGroup:[{key:"category_ids",type:"select-custom",className:"basis-1/2",props:{label:"Category",placeholder:"Select Category",viewValue:"name",labelProp:"name",valueProp:"id",multiple:!0,options:r.getCategoryForSelect().pipe((0,n.U)(e=>e?.data?.items))},expressions:{"props.disabled":"formState.disabled"}},{key:"group_ids",type:"select-custom",className:"basis-1/2 ml-4",props:{label:"Group",placeholder:"Select Group",viewValue:"name",multiple:!0,labelProp:"name",valueProp:"id",required:!0,options:r.getGroupForSelect().pipe((0,n.U)(e=>e?.data?.items))},expressions:{"props.disabled":"formState.disabled"}}]},{fieldGroupClassName:"flex row items-center",key:"",fieldGroup:[{key:"catalog_ids",type:"select-custom",className:"basis-1/2",props:{label:"Catalog",placeholder:"Select Catalog",viewValue:"name",labelProp:"name",valueProp:"id",options:r.getCatalogForSelect().pipe((0,n.U)(e=>e?.data?.items))},expressions:{"props.disabled":"formState.disabled"}},{key:"catalog_show_order",type:"input",defaultValue:0,className:"basis-1/2 ml-4",props:{label:"Catalog show order",placeholder:"Enter Catalog show order",type:"number",min:0,required:!0},expressions:{"props.disabled":"formState.disabled"}},{key:"show_order",type:"input",defaultValue:0,className:"basis-1/2 ml-4",props:{label:"Order",placeholder:"Enter Order",type:"number",min:0,required:!0},expressions:{"props.disabled":"formState.disabled"}}]},{key:"import_mode",type:"select-custom",props:{label:"Import mode",placeholder:"Select Import mode*",viewValue:"name",labelProp:"name",valueProp:"code",required:!0,options:r.getOptionType("IMPORT_MODE").pipe((0,n.U)(e=>e?.data))},expressions:{"props.disabled":"formState.disabled"}},{className:"section-label",template:'<hr class="my-4"/>'},{key:"organization_id",type:"select-custom",props:{label:"Organization",placeholder:"Select Organization*",required:!0,valueProp:"id",labelProp:"name",options:r.getOrg().pipe((0,n.U)(e=>e?.data))},expressions:{"props.disabled":"formState.disabled"}},{key:"brand_id",type:"select-custom",props:{label:"Brand",options:[],required:!0,placeholder:"Select Brand",valueProp:"id",labelProp:"name"},expressions:{"props.disabled":"formState.disabled"},hooks:{onInit:e=>{const s=e.parent.get("organization_id").formControl;e.props.options=s.valueChanges.pipe((0,v.O)(s.value),(0,m.x)(),(0,_.b)(o=>o?r.getBrandByOrg(o).pipe((0,n.U)(i=>(i?.data?.find(l=>e?.model?.brand_id===l.id)||(e.formControl.setValue(null),e.parent.get("store_ids").formControl?.setValue(null)),i?.data||[]))):(e.parent.get("store_ids").formControl?.setValue(null),e.parent.get("brand_id").formControl?.setValue(null),[])))}}},{key:"store_ids",type:"select-custom",props:{label:"Store",placeholder:"Select Store",viewValue:"name",labelProp:"name",valueProp:"id",multiple:!0},expressions:{"props.disabled":"formState.disabled"},hooks:{onInit:e=>{const s=e.parent.get("brand_id").formControl;e.props.options=s.valueChanges.pipe((0,v.O)(s.value),(0,m.x)(),(0,_.b)(o=>o?r.getStoreByBrand(o).pipe((0,n.U)(i=>(i?.data?.find(l=>e?.model?.store_ids?.includes(l.id))||e.formControl.setValue([]),i?.data||[]))):(e.formControl.setValue([]),[])))}}}])(this.productService,this.options.formState),this.model&&this.model.catalog_ids&&this.model.catalog_ids?.length&&(this.model.catalog_ids=this.model.catalog_ids[0]),this.modelOrigin=(0,u.cloneDeep)(this.model),this.isAdd&&this.toggleDisabled(),setTimeout(()=>{this.form.controls.gen_code_type?.valueChanges.pipe((0,m.x)(),(0,n.U)(()=>{this.form.reset(this.model)})).subscribe()},200)}handlerSave(e,s){var o=this;return(0,S.Z)(function*(){if(e?.stopPropagation(),e?.preventDefault(),o.form.valid)try{if(o.model?.start_time&&o.model?.end_time&&F(o.model?.end_time).isBefore(o.model?.start_time))return void o.iComMessageService.showAlertMessageError("Th\u1eddi gian k\u1ebft th\xfac  kh\xf4ng \u0111\u01b0\u1ee3c nh\u1ecf h\u01a1n th\u1eddi gian b\u1eaft \u0111\u1ea7u.");o.form.markAsTouched(),o.form.submitted=!0,s&&s.isLoading&&s.isLoading();const i=(0,u.cloneDeep)(o.model);if(i&&i.catalog_ids&&(i.catalog_ids=[i.catalog_ids]),o.isLoading=!0,o.isAdd){const l=yield(0,E.n)(o.productService.createProduct(i));s&&s.success&&s.success(l?.data?.id),o.iComMessageService.showAlertMessageDone("Create product success")}else yield(0,E.n)(o.productService.updateProduct(o.model?.id||0,i)),s&&s.success&&s.success(),o.iComMessageService.showAlertMessageDone("Edit product success"),o.modelOrigin=(0,u.cloneDeep)(o.model),o.toggleDisabled()}catch(i){s&&s.loadDone&&s.loadDone(),o.iComMessageService.showAlertMessageError(i?.error?.error_message||"Create product fail")}finally{s&&s.loadDone&&s.loadDone(),o.isLoading=!1,o.changeDetectorRef.detectChanges()}else Object.keys(o.form.controls).forEach(i=>{o.form.controls[i].touched=!0})})()}toggleDisabled(){this.options.formState.disabled=!this.options.formState.disabled}handlerCancel(e){e.stopPropagation(),this.toggleDisabled(),this.model=(0,u.cloneDeep)(this.modelOrigin)}static#e=this.\u0275fac=function(s){return new(s||r)};static#t=this.\u0275cmp=t.Xpm({type:r,selectors:[["icom-libs-product-add_edit"]],inputs:{model:"model",isAdd:"isAdd"},outputs:{icomSave:"icomSave"},standalone:!0,features:[t.jDz],decls:3,vars:7,consts:[["nz-form","",1,"pb-4","bg-white","border","rounded-md","h-full","flex","flex-col",3,"formGroup","nzLayout"],[1,"overflow-auto","px-4","pt-4",3,"model","fields","options","form"],["nz-row","","class","p-4 border",4,"ngIf"],["nz-row","",1,"p-4","border"],["nz-col","","class","search-area flex",4,"ngIf"],["nz-col","",1,"search-area","flex"],["nz-button","",3,"nzType","nzLoading","click"],["nz-button","",1,"ml-4",3,"click"]],template:function(s,o){1&s&&(t.TgZ(0,"form",0),t._UZ(1,"formly-form",1),t.YNc(2,Q,3,2,"div",2),t.qZA()),2&s&&(t.Q6J("formGroup",o.form)("nzLayout","vertical"),t.xp6(1),t.Q6J("model",o.model)("fields",o.fields)("options",o.options)("form",o.form),t.xp6(1),t.Q6J("ngIf",o.model&&o.model.id))},dependencies:[T.u,d.UX,d._Y,d.JL,d.sg,f.X0,f.T7,h.sL,h.ix,Y.w,Z.dQ,R.O5,y.U5,b.t3,b.SK,y.Lr],encapsulation:2,changeDetection:0})}return r})()}}]);
//# sourceMappingURL=default-libs_product_src_index_ts.js.map