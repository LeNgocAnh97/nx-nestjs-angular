"use strict";(self.webpackChunkicom=self.webpackChunkicom||[]).push([[286],{4286:(S,c,o)=>{o.r(c),o.d(c,{IcomLibCustomerListComponent:()=>M});var f=o(5861),t=o(5879),p=o(6223),y=o(4729),v=o(4843),a=o(6814),g=o(2787),x=o(708),C=o(9717),m=o(8111),d=o(8581),u=o(3304),b=o(1221);function T(s,D){if(1&s){const e=t.EpF();t.TgZ(0,"icom-libs-core-components-table",3),t.NdJ("icomFunctionControl",function(r){t.CHM(e);const i=t.oxw();return t.KtG(i.handlerFunctionControl(r))}),t.qZA()}if(2&s){const e=t.oxw();t.Q6J("columns",e.columns)("loadFn",e.loadData)("fields",e.fields)("model",e.model)("form",e.form)("ignoreButtonAdd",!0)("functionParse",e.functionParse)}}let M=(()=>{class s{constructor(e,n){var r=this;this.datePipe=e,this.modalService=n,this.form=new p.cw({}),this.iComLibsServicesProjectAdminUserService=(0,t.f3M)(y.lF),this.iComMessageService=(0,t.f3M)(C.Q),this.router=(0,t.f3M)(g.F0),this.loadData=i=>((0,m.xh)(i,"last_login_start,last_login_end"),this.iComLibsServicesProjectAdminUserService.getListDevices(i)),this.functionParse=i=>i?.map(l=>({...l,...l.creator_info})),this.functionExportFile=function(){var i=(0,f.Z)(function*(l,h){(0,m.cT)(`${d.N.apiGatewayUrl}${d.N.suffixAdmin}/v2.0/export/activity_logs`,"MauFileExportLichSuThaoTac",r.iComMessageService,l,!1,!0,h)});return function(l,h){return i.apply(this,arguments)}}(),this.columns=[],this.fields=[]}ngOnInit(){const e=u().format("YYYY-MM-DD"),n=u(e).subtract(3,"month").format("YYYY-MM-DD");this.model={last_login_start:n,last_login_end:e},this.fields=[{className:"flex flex-col",fieldGroupClassName:"flex w-full justify-between",fieldGroup:[{key:"search",type:"search-input",className:"basis-6/12",props:{type:"text",placeholder:"T\xecm ki\u1ebfm theo s\u1ed1 \u0111i\u1ec7n tho\u1ea1i, t\xean thi\u1ebft b\u1ecb, hardware model, IP"}},{key:"date_range",className:"basis-6/12",type:"icom-range-picker",props:{label:"Th\u1eddi gian \u0111\u0103ng nh\u1eadp",nzShowTime:!0,format:"dd-MM-yyyy HH:mm"}}]}],this.columns=[{title:"STT",type:"index",width:"80px"},{title:"S\u1ed1 \u0111i\u1ec7n tho\u1ea1i",key:"username",type:"text"},{title:"T\xean Thi\u1ebft b\u1ecb",key:"app_name",type:"text"},{title:"Hardware Model",key:"model",type:"text"},{title:"UUID",key:"device_key",type:"text"},{title:"IP",key:"ip_address",type:"text"},{title:"Ph\u01b0\u01a1ng th\u1ee9c \u0111\u0103ng nh\u1eadp",key:"login_method",type:"text"},{title:"Ho\u1ea1t \u0111\u1ed9ng l\u1ea7n cu\u1ed1i",key:"last_login",type:"text"},{title:"\u0110\u1ecba \u0111i\u1ec3m",key:"location",type:"text"},{title:"Lo\u1ea1i thi\u1ebft b\u1ecb",key:"is_current",pipe:"array",type:"text",pipeArgs:[{value:"Thi\u1ebft b\u1ecb hi\u1ec7n t\u1ea1i",id:!0,class:"text-green-500"},{value:"-",id:!1}]},{key:"action",type:"button",buttonText:"Xo\xe1",buttonType:"danger",callback:this.deleteItem.bind(this)}]}deleteItem(e){this.modalService.confirm({nzTitle:`B\u1ea1n c\xf3 ch\u1eafc ch\u1eafn mu\u1ed1n xo\xe1 thi\u1ebft b\u1ecb ${e?.app_name} ?`,nzOkText:"\u0110\u1ed3ng \xfd",nzOkType:"primary",nzOkDanger:!0,nzMaskClosable:!1,nzClosable:!1,nzOnOk:this.processDeleteSection.bind(this,e),nzCancelText:"H\u1ee7y b\u1ecf"},"error")}processDeleteSection(e){return(0,x.n)(this.iComLibsServicesProjectAdminUserService.removeDevice(e.device_key||"")).then(()=>{this.iComMessageService.showAlertMessageDone("X\xf3a thi\u1ebft b\u1ecb th\xe0nh c\xf4ng."),this.eventFunctionControl.reset()}).catch(n=>{this.iComMessageService.showAlertMessageError(n?.error?.error_message)})}handlerFunctionControl(e){this.eventFunctionControl=e}static#t=this.\u0275fac=function(n){return new(n||s)(t.Y36(a.uU),t.Y36(b.Sf))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["icom-libs-admin-user-history"]],standalone:!0,features:[t._Bn([a.JJ,a.uU]),t.jDz],decls:3,vars:1,consts:[[1,"flex","w-full","h-full","flex-col"],["nz-row","",1,"w-full","pr-4","h-full",2,"justify-content","end","padding-right","8px"],[3,"columns","loadFn","fields","model","form","ignoreButtonAdd","functionParse","icomFunctionControl",4,"ngIf"],[3,"columns","loadFn","fields","model","form","ignoreButtonAdd","functionParse","icomFunctionControl"]],template:function(n,r){1&n&&(t.TgZ(0,"div",0)(1,"div",1),t.YNc(2,T,1,7,"icom-libs-core-components-table",2),t.qZA()()),2&n&&(t.xp6(2),t.Q6J("ngIf",r.loadData))},dependencies:[v.d,a.O5],encapsulation:2,changeDetection:0})}return s})()}}]);