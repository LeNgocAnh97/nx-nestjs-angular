"use strict";(self.webpackChunkicom=self.webpackChunkicom||[]).push([[571],{3571:(B,Q,l)=>{l.r(Q),l.d(Q,{IcomLibsProductDetailComponent:()=>ct});var _=l(5861),e=l(5879),p=l(6223),b=l(5545),P=l(19),S=l(9364),h=l(2840),v=l(3599),x=l(6814),J=l(8083),N=l(6254),Y=l(2574),k=l(9382),D=l(551),I=l(4729),F=l(9927),z=l(3304),U=l(2962),O=l(6987);let Z=(()=>{class i{ngOnInit(){console.log(this.product),this.product.created_at&&(this.product.created_at_format=z(this.product.created_at).format("DD/MM/YYYY HH:mm"),this.product.updated_at_format=z(this.product.updated_at).format("DD/MM/YYYY HH:mm"))}static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["icom-libs-product-detail-history"]],inputs:{product:"product"},standalone:!0,features:[e.jDz],decls:20,vars:6,consts:[["nzTitle","History",2,"width","300px"],[2,"color","#8b8b8b"],["nzType","vertical"]],template:function(o,n){1&o&&(e.TgZ(0,"nz-card",0)(1,"p")(2,"span",1),e._uU(3,"Creator:\xa0"),e.qZA(),e._uU(4),e.qZA(),e._UZ(5,"nz-divider",2),e.TgZ(6,"p")(7,"span",1),e._uU(8,"Create Time:\xa0"),e.qZA(),e._uU(9),e.qZA(),e._UZ(10,"nz-divider",2),e.TgZ(11,"p")(12,"span",1),e._uU(13,"Updater:\xa0"),e.qZA(),e._uU(14),e.qZA(),e._UZ(15,"nz-divider",2),e.TgZ(16,"p")(17,"span",1),e._uU(18,"Update Time:\xa0"),e.qZA(),e._uU(19),e.qZA()()),2&o&&(e.xp6(4),e.AsE(" [",null==n.product||null==n.product.creator_info?null:n.product.creator_info.customer_id,"] ",null==n.product||null==n.product.creator_info?null:n.product.creator_info.full_name," "),e.xp6(5),e.hij(" ",(null==n.product?null:n.product.created_at_format)||(null==n.product?null:n.product.created_at),""),e.xp6(5),e.AsE(" [",null==n.product||null==n.product.updater_info?null:n.product.updater_info.customer_id,"] ",null==n.product||null==n.product.updater_info?null:n.product.updater_info.full_name,""),e.xp6(5),e.hij(" ",(null==n.product?null:n.product.updated_at_format)||(null==n.product?null:n.product.updated_at),""))},dependencies:[U.vh,U.bd,O.S,O.g],encapsulation:2})}return i})();function G(i,c){if(1&i&&e._UZ(0,"icom-libs-product-detail-history",3),2&i){const t=e.oxw();e.Q6J("product",t.product)}}let R=(()=>{class i{constructor(){this.icomSave=new e.vpe,this.productService=(0,e.f3M)(I.k)}ngOnInit(){this.product&&(this.product.date_range=[z(this.product.start_time).toDate(),z(this.product.end_time).toDate()])}handlerSave(t){this.icomSave.emit(t)}static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["icom-libs-product-detail-general"]],inputs:{product:"product"},outputs:{icomSave:"icomSave"},standalone:!0,features:[e.jDz],decls:3,vars:2,consts:[[1,"flex","w-full","h-full","justify-between"],[1,"w-full","mr-4",3,"model","icomSave"],[3,"product",4,"ngIf"],[3,"product"]],template:function(o,n){1&o&&(e.TgZ(0,"div",0)(1,"icom-libs-product-add_edit",1),e.NdJ("icomSave",function(g){return n.handlerSave(g)}),e.qZA(),e.YNc(2,G,1,1,"icom-libs-product-detail-history",2),e.qZA()),2&o&&(e.xp6(1),e.Q6J("model",n.product),e.xp6(1),e.Q6J("ngIf",n.product))},dependencies:[F.B,Z,x.O5],encapsulation:2})}return i})();var L=l(9717),A=l(6990),M=l(7398),f=l(708),y=l(2669),u=l(7786),C=l(855),r=l(1958);function d(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",9)(1,"button",10),e.NdJ("click",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.handlerSave(n))}),e._uU(2," Submit "),e.qZA(),e.TgZ(3,"button",11),e.NdJ("click",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.handlerCancel(n))}),e._uU(4," Cancel "),e.qZA()()}if(2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("action","edit")("nzLoading",t.isLoading)("nzType","primary"),e.xp6(2),e.Q6J("action","edit")}}function a(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",9)(1,"button",12),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.toggleDisabled())}),e._uU(2," Edit "),e.qZA()()}2&i&&(e.xp6(1),e.Q6J("action","edit")("nzType","primary"))}function m(i,c){if(1&i&&e._UZ(0,"icom-libs-product-detail-history",13),2&i){const t=e.oxw(2);e.Q6J("product",t.model)}}function T(i,c){if(1&i&&(e.TgZ(0,"div",2)(1,"div",3)(2,"form",4),e._UZ(3,"formly-form",5),e.TgZ(4,"div",6),e.YNc(5,d,5,4,"div",7),e.YNc(6,a,3,2,"div",7),e.qZA()()(),e.YNc(7,m,1,1,"icom-libs-product-detail-history",8),e.qZA()),2&i){const t=e.oxw();e.xp6(2),e.Q6J("formGroup",t.form),e.xp6(1),e.Q6J("model",t.model)("fields",t.fields)("options",t.options)("form",t.form),e.xp6(2),e.Q6J("ngIf",!(null!=t.options&&null!=t.options.formState&&t.options.formState.disabled)),e.xp6(1),e.Q6J("ngIf",null==t.options||null==t.options.formState?null:t.options.formState.disabled),e.xp6(1),e.Q6J("ngIf",null==t.model?null:t.model.id)}}function w(i,c){1&i&&e._UZ(0,"nz-spin",14),2&i&&e.Q6J("nzSize","large")}let q=(()=>{class i{constructor(){this.form=new p.cw({}),this.options={formState:{disabled:!0}},this.fields=[],this.productService=(0,e.f3M)(I.k),this.IComMessageService=(0,e.f3M)(L.Q),this.cdr=(0,e.f3M)(e.sBO),this.model={subpool_id:0,pool_id:8},this.fields=[{key:"payment_method",type:"select-custom",props:{label:"Payment Method",classInclude:"w-[300px]",placeholder:"Select Payment Method",viewValue:"name",labelProp:"name",valueProp:"code",required:!0,options:this.productService.getOptionType("PAYMENT_METHOD").pipe((0,M.U)(t=>t?.data))},expressions:{"props.disabled":"formState.disabled"}},{key:"sale_price",type:"input",className:"",props:{label:"Sale price",required:!0,type:"number"},validators:["iniMin0"],expressions:{"props.disabled":"formState.disabled"}},{key:"purchase_cost",type:"input",className:"basis-6/12 ml-4",props:{label:"Purchase cost",required:!0,type:"number"},validators:["iniMin0"],expressions:{"props.disabled":"formState.disabled"}},{key:"pool_id",className:"basis-4/12",type:"select-custom",props:{placeholder:"Select Pool",label:"Pool",viewValue:"id",labelProp:"id",valueProp:"id",classInclude:"w-[300px]",required:!0,options:[{id:8,name:"Pool"}]},expressions:{"props.disabled":"formState.disabled"}},{key:"subpool_id",type:"select-custom",className:"basis-4/12 ml-4",props:{label:"Sub Pool",placeholder:"Select Sub Pool",viewValue:"id",required:!0,classInclude:"w-[300px]",labelProp:"id",valueProp:"id",options:[{id:0,name:"Sub Pool"}]},expressions:{"props.disabled":"formState.disabled"}}]}ngOnInit(){var t=this;return(0,_.Z)(function*(){try{t.loadingIndicator=!0,t.model=yield(0,f.n)(t.productService.getProductPrice(t.product?.id)),t.modelOrigin=(0,A.cloneDeep)(t.model)}catch(o){t.IComMessageService.showAlertMessageError(o?.error?.error_message)}finally{t.loadingIndicator=!1,t.cdr.detectChanges()}})()}handlerSave(t){var o=this;return(0,_.Z)(function*(){t.stopPropagation(),t.preventDefault();try{if(!o.form.valid)return void Object.keys(o.form.controls).forEach(s=>{o.form.controls[s].touched=!0});o.isLoading=!0,o.cdr.detectChanges(),o.form.markAsTouched(),o.form.submitted=!0;const n={...o.model};if(n.id)return yield(0,f.n)(o.productService.updateProductPrice(n)),o.IComMessageService.showAlertMessageDone("Edit product price success"),o.modelOrigin=(0,A.cloneDeep)(o.model),void o.toggleDisabled();yield(0,f.n)(o.productService.createProductPrice(n)),o.modelOrigin=(0,A.cloneDeep)(o.model),o.IComMessageService.showAlertMessageError("Edit product price success")}catch(n){o.IComMessageService.showAlertMessageError(n?.error?.error_message)}finally{o.isLoading=!1,o.cdr.detectChanges()}})()}handlerCancel(t){t.stopPropagation(),t.preventDefault(),this.toggleDisabled(),this.form.reset(this.modelOrigin)}toggleDisabled(){this.options.formState.disabled=!this.options.formState.disabled}static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["icom-libs-product-detail-price"]],inputs:{product:"product"},standalone:!0,features:[e.jDz],decls:2,vars:2,consts:[["class","w-full h-full flex",4,"ngIf"],["class","w-full h-full flex justify-center items-center","nzSimple","",3,"nzSize",4,"ngIf"],[1,"w-full","h-full","flex"],[1,"flex","w-full","h-full","flex-col","pt-4","bg-white","border","rounded-md"],["nz-form","",3,"formGroup"],[3,"model","fields","options","form"],["nz-row","",1,"p-4","border"],["nz-col","","class","search-area flex",4,"ngIf"],["class","ml-4",3,"product",4,"ngIf"],["nz-col","",1,"search-area","flex"],["icomLibsHasPermissionDirective","","nz-button","",3,"action","nzLoading","nzType","click"],["icomLibsHasPermissionDirective","","nz-button","",1,"ml-4",3,"action","click"],["icomLibsHasPermissionDirective","","nz-button","",3,"action","nzType","click"],[1,"ml-4",3,"product"],["nzSimple","",1,"w-full","h-full","flex","justify-center","items-center",3,"nzSize"]],template:function(o,n){1&o&&(e.YNc(0,T,8,8,"div",0),e.YNc(1,w,1,1,"nz-spin",1)),2&o&&(e.Q6J("ngIf",!n.loadingIndicator),e.xp6(1),e.Q6J("ngIf",n.loadingIndicator))},dependencies:[P.u,p.UX,p._Y,p.JL,p.sg,b.X0,b.T7,h.sL,h.ix,C.w,r.dQ,x.O5,Z,y.j,y.W,u.E],encapsulation:2})}return i})();function X(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",9)(1,"button",10),e.NdJ("click",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.handlerSave(n))}),e._uU(2," Submit "),e.qZA(),e.TgZ(3,"button",11),e.NdJ("click",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.handlerCancel(n))}),e._uU(4," Cancel "),e.qZA()()}if(2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("action","edit")("nzLoading",t.isLoading)("nzType","primary"),e.xp6(2),e.Q6J("action","edit")}}function K(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",9)(1,"button",12),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.toggleDisabled())}),e._uU(2," Edit "),e.qZA()()}2&i&&(e.xp6(1),e.Q6J("action","edit")("nzType","primary"))}function W(i,c){if(1&i&&e._UZ(0,"icom-libs-product-detail-history",13),2&i){const t=e.oxw(2);e.Q6J("product",t.model)}}function $(i,c){if(1&i&&(e.TgZ(0,"div",2)(1,"div",3)(2,"form",4),e._UZ(3,"formly-form",5),e.TgZ(4,"div",6),e.YNc(5,X,5,4,"div",7),e.YNc(6,K,3,2,"div",7),e.qZA()()(),e.YNc(7,W,1,1,"icom-libs-product-detail-history",8),e.qZA()),2&i){const t=e.oxw();e.xp6(2),e.Q6J("formGroup",t.form),e.xp6(1),e.Q6J("model",t.model)("fields",t.fields)("options",t.options)("form",t.form),e.xp6(2),e.Q6J("ngIf",!(null!=t.options&&null!=t.options.formState&&t.options.formState.disabled)),e.xp6(1),e.Q6J("ngIf",null==t.options||null==t.options.formState?null:t.options.formState.disabled),e.xp6(1),e.Q6J("ngIf",null==t.model?null:t.model.id)}}function ee(i,c){1&i&&e._UZ(0,"nz-spin",14),2&i&&e.Q6J("nzSize","large")}let te=(()=>{class i{constructor(){this.form=new p.cw({}),this.fields=[],this.options={formState:{disabled:!0}},this.productService=(0,e.f3M)(I.k),this.IComMessageService=(0,e.f3M)(L.Q),this.changeDetectorRef=(0,e.f3M)(e.sBO),this.model={},this.fields=[{key:"voucher_type",type:"select-custom",templateOptions:{label:"Voucher Type",placeholder:"Select Voucher Type",classInclude:"w-[300px]",viewValue:"name",labelProp:"name",valueProp:"code",required:!0,options:this.productService.getOptionType("VOUCHER_TYPE").pipe((0,M.U)(t=>t?.data))},expressions:{"props.disabled":"formState.disabled"}},{key:"voucher_value",type:"input",className:"",expressions:{"props.disabled":"formState.disabled"},props:{label:"Voucher Value",type:"number",min:0}},{key:"expiry_policy",className:"basis-4/12",type:"select-custom",props:{placeholder:"Select Expiry policy",label:"Expiry policy",viewValue:"name",classInclude:"w-[300px]",labelProp:"name",valueProp:"code",required:!0,options:this.productService.getOptionType("VOUCHER_PROPERTY_EXPIRY_POLICY").pipe((0,M.U)(t=>t?.data))},expressions:{"props.disabled":"formState.disabled"}},{key:"expiry_date",type:"date",props:{label:"Expiry date",ShowTime:!0,required:!0,format:"dd-MM-yyyy HH:mm"},expressions:{"props.disabled":"formState.disabled"},hideExpression:t=>!t?.expiry_policy||"EXPIRY_DATE_FP"!==t?.expiry_policy},{key:"expiry_param",type:"input",className:"basis-6/12 ml-4",props:{label:"Expiry param",required:!0,type:"number"},hideExpression:t=>!t?.expiry_policy||"EXPIRY_DATE_NE"===t?.expiry_policy||"EXPIRY_DATE_SDED"===t?.expiry_policy||"EXPIRY_DATE_FP"===t?.expiry_policy,expressions:{"props.disabled":"formState.disabled"}}]}ngOnInit(){var t=this;return(0,_.Z)(function*(){try{t.loadingIndicator=!0,t.model=yield(0,f.n)(t.productService.getProductProperties(t.product?.id)),t.modelOrigin=(0,A.cloneDeep)(t.model)}catch(o){t.IComMessageService.showAlertMessageError(o?.error?.error_message)}finally{t.loadingIndicator=!1,t.changeDetectorRef.detectChanges()}})()}handlerSave(t){var o=this;return(0,_.Z)(function*(){t.stopPropagation(),t.preventDefault();try{if(!o.form.valid)return void Object.keys(o.form.controls).forEach(s=>{o.form.controls[s].touched=!0});o.form.markAsTouched(),o.form.submitted=!0;const n={...o.model};if(o.isLoading=!0,o.changeDetectorRef.detectChanges(),n.id)return yield(0,f.n)(o.productService.updateProductProperties(n)),o.toggleDisabled(),o.IComMessageService.showAlertMessageDone("Edit product properties success"),o.isLoading=!1,void o.changeDetectorRef.detectChanges();delete n.id,yield(0,f.n)(o.productService.createProductProperties(n)),o.isLoading=!1,o.changeDetectorRef.detectChanges(),o.IComMessageService.showAlertMessageDone("Add product properties success")}catch(n){o.IComMessageService.showAlertMessageError(n?.error?.error_message)}finally{o.isLoading=!1,o.changeDetectorRef.detectChanges()}})()}handlerCancel(t){t.stopPropagation(),t.preventDefault(),this.toggleDisabled(),this.form.reset(this.modelOrigin)}toggleDisabled(){this.options.formState.disabled=!this.options.formState.disabled}static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["icom-libs-product-detail-properties"]],inputs:{product:"product"},standalone:!0,features:[e.jDz],decls:2,vars:2,consts:[["class","w-full h-full flex",4,"ngIf"],["class","w-full h-full flex justify-center items-center","nzSimple","",3,"nzSize",4,"ngIf"],[1,"w-full","h-full","flex"],[1,"flex","w-full","h-full","flex-col","pt-4","bg-white","border","rounded-md"],["nz-form","",3,"formGroup"],[3,"model","fields","options","form"],["nz-row","",1,"p-4","border"],["nz-col","","class","search-area flex",4,"ngIf"],["class","ml-4",3,"product",4,"ngIf"],["nz-col","",1,"search-area","flex"],["icomLibsHasPermissionDirective","","nz-button","",3,"action","nzLoading","nzType","click"],["icomLibsHasPermissionDirective","","nz-button","",1,"ml-4",3,"action","click"],["icomLibsHasPermissionDirective","","nz-button","",3,"action","nzType","click"],[1,"ml-4",3,"product"],["nzSimple","",1,"w-full","h-full","flex","justify-center","items-center",3,"nzSize"]],template:function(o,n){1&o&&(e.YNc(0,$,8,8,"div",0),e.YNc(1,ee,1,1,"nz-spin",1)),2&o&&(e.Q6J("ngIf",!n.loadingIndicator),e.xp6(1),e.Q6J("ngIf",n.loadingIndicator))},dependencies:[P.u,p.UX,p._Y,p.JL,p.sg,b.X0,b.T7,h.sL,h.ix,C.w,r.dQ,x.O5,Z,y.j,y.W,u.E],encapsulation:2})}return i})();const oe=(i,c)=>[{prop:"",cellTemplate:i,sortable:!1,width:40},{prop:"",cellTemplate:c,sortable:!1,width:40},{prop:"language",width:200,sortable:!1},{prop:"name",width:300,sortable:!1},{prop:"description",width:300,sortable:!1}];var j=l(1221),H=l(2787);const ne=["statusRef"],re=["removeRef"];function se(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",10)(1,"button",11),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.handlerAdd())}),e._uU(2," Add New "),e.qZA()()}2&i&&(e.xp6(1),e.Q6J("nzType","primary")("action","edit"))}function le(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",17)(1,"button",18),e.NdJ("click",function(n){e.CHM(t);const s=e.oxw(3);return e.KtG(s.handlerSave(n))}),e._uU(2," Save "),e.qZA(),e.TgZ(3,"button",19),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(3);return e.KtG(n.handlerCancel())}),e._uU(4," Cancel "),e.qZA()()}if(2&i){const t=e.oxw(3);e.xp6(1),e.Q6J("nzType","primary")("nzLoading",t.isLoading)("action","edit"),e.xp6(2),e.Q6J("action","edit")}}function ae(i,c){if(1&i&&(e.ynx(0),e.TgZ(1,"form",12,13),e._UZ(3,"formly-form",14),e.qZA(),e.TgZ(4,"div",15),e.YNc(5,le,5,4,"div",16),e.qZA(),e.BQk()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("formGroup",t.form),e.xp6(2),e.Q6J("model",t.modelForm)("fields",t.fields)("form",t.form),e.xp6(2),e.Q6J("ngIf",!(null!=t.options&&null!=t.options.formState&&t.options.formState.disabled))}}const ce=function(){return[]};function de(i,c){if(1&i&&(e.TgZ(0,"div",20),e._UZ(1,"ngx-datatable",21),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("rows",t.rows)("columns",t.configTable.columns||e.DdM(7,ce))("headerHeight",t.configTable.headerHeight||50)("columnMode","standard")("rowHeight",t.configTable.rowHeight||50)("scrollbarH",!0)("loadingIndicator",t.loadingIndicator)}}function pe(i,c){if(1&i&&e._UZ(0,"icom-libs-product-detail-history",22),2&i){const t=e.oxw(2);e.Q6J("product",t.modelForm)}}function ue(i,c){if(1&i&&(e.TgZ(0,"div",4)(1,"div",5),e.YNc(2,se,3,2,"div",6),e.YNc(3,ae,6,5,"ng-container",7),e.YNc(4,de,2,8,"div",8),e.qZA(),e.YNc(5,pe,1,1,"icom-libs-product-detail-history",9),e.qZA()),2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",!t.isAddNew),e.xp6(1),e.Q6J("ngIf",t.isAddNew),e.xp6(1),e.Q6J("ngIf",!t.isAddNew),e.xp6(1),e.Q6J("ngIf",null==t.modelForm?null:t.modelForm.id)}}function me(i,c){1&i&&e._UZ(0,"nz-spin",23),2&i&&e.Q6J("nzSize","large")}function fe(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",24),e.NdJ("click",function(n){const g=e.CHM(t).row,E=e.oxw();return e.KtG(E.handlerEdit(n,g))}),e._UZ(1,"i",25),e.qZA()}2&i&&(e.xp6(1),e.Q6J("action","edit"))}function ge(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",26),e.NdJ("click",function(n){const g=e.CHM(t).row,E=e.oxw();return e.KtG(E.handlerRemove(n,g))}),e._UZ(1,"span",27),e.qZA()}2&i&&e.Q6J("action","edit")}let _e=(()=>{class i{constructor(t){this.router=t,this.form=new p.cw({}),this.options={},this.fields=[],this.productService=(0,e.f3M)(I.k),this.modalService=(0,e.f3M)(j.Sf),this.IComMessageService=(0,e.f3M)(L.Q),this.cdr=(0,e.f3M)(e.sBO),this.modelForm={}}ngOnInit(){this.fields=[{key:"name",type:"input",props:{label:"Name",placeholder:"Enter Name",type:"string",required:!0}},{key:"description",type:"input",props:{label:"Description",placeholder:"Enter Description",type:"string",required:!0}},{key:"language",type:"select-custom",templateOptions:{label:"Language",placeholder:"Select Language",viewValue:"name",labelProp:"name",required:!0,valueProp:"code",options:[{code:"vi",name:"Vietnamese"},{code:"en",name:"English"}]}},{key:"detail",type:"quill-editor",props:{label:"Detail",placeholder:"Enter Content",type:"string",required:!0}},{key:"term_and_condition",type:"quill-editor",props:{label:"Term and condition",placeholder:"Enter Content",type:"string",required:!0}}],this.configTable={loadingIndicator:!0,columns:oe(this.statusRef,this.removeRef),headerHeight:50,rowHeight:"auto",pageLimit:10},this.loadPage()}loadPage(){var t=this;return(0,_.Z)(function*(){try{t.loadingIndicator=!0;const o=yield(0,f.n)(t.productService.getProductLanguage(t.product?.id||""));if(o&&o.data&&o.data){const n=[...o.data.items||[]];t.rows=n}}catch(o){console.log(o)}finally{t.loadingIndicator=!1,t.cdr.detectChanges()}})()}handlerAdd(){this.isAddNew=!this.isAddNew}handlerCancel(){this.isAddNew=!1,this.modelForm={}}handlerSave(t){var o=this;return(0,_.Z)(function*(){t.stopPropagation(),t.preventDefault();try{if(!o.form.valid)return void Object.keys(o.form.controls).forEach(s=>{o.form.controls[s].touched=!0});o.form.markAsTouched(),o.form.submitted=!0;const n={product_id:o.product?.id,...o.modelForm};if(o.isLoading=!0,o.cdr.detectChanges(),!n.id)return delete n.id,o.rows?.some(g=>g.language==n.language)?void o.IComMessageService.showAlertMessageError("Record exist in table"):void o.productService.addLanguageProduct(n).subscribe(()=>{o.IComMessageService.showAlertMessageDone("Add language success"),o.handlerCancel(),o.loadPage()});yield(0,f.n)(o.productService.updateLanguageProduct(o.modelForm)),o.IComMessageService.showAlertMessageDone("Edit language success"),o.handlerCancel(),o.loadPage()}catch(n){o.IComMessageService.showAlertMessageError(n?.error?.error_message)}finally{o.isLoading=!1,o.cdr.detectChanges()}})()}handlerEdit(t,o){t.stopPropagation(),this.modelForm=o,this.isAddNew=!0}handlerRemove(t,o){t.stopPropagation(),this.modalService.confirm({nzTitle:"Are you sure delete this product?",nzContent:`<b style="color: red;">${o.name}</b>`,nzOkText:"Delete",nzOkType:"primary",nzOkDanger:!0,nzMaskClosable:!1,nzClosable:!1,nzOnOk:this.processDelete.bind(this,o),nzCancelText:"Cancel"},"error")}processDelete(t){return(0,f.n)(this.productService.deleteProductLanguage(t.id||"")).then(()=>{this.IComMessageService.showAlertMessageDone("Delete language success"),this.loadPage()}).catch(o=>{this.IComMessageService.showAlertMessageError(o?.error?.error_message)})}static#e=this.\u0275fac=function(o){return new(o||i)(e.Y36(H.F0))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["icom-libs-product-detail-language"]],viewQuery:function(o,n){if(1&o&&(e.Gf(ne,7),e.Gf(re,7)),2&o){let s;e.iGM(s=e.CRH())&&(n.statusRef=s.first),e.iGM(s=e.CRH())&&(n.removeRef=s.first)}},inputs:{fields:"fields",rows:"rows",product:"product"},standalone:!0,features:[e.jDz],decls:6,vars:2,consts:[["class","w-full h-full flex",4,"ngIf"],["class","w-full h-full flex justify-center items-center","nzSimple","",3,"nzSize",4,"ngIf"],["statusRef",""],["removeRef",""],[1,"w-full","h-full","flex"],[1,"mb-4","w-full","h-full","flex","flex-col","bg-white","border","rounded-md"],["class","flex justify-end p-4",4,"ngIf"],[4,"ngIf"],["class","w-full h-full",4,"ngIf"],["class","ml-4",3,"product",4,"ngIf"],[1,"flex","justify-end","p-4"],["nz-button","","icomLibsHasPermissionDirective","",1,"flex","items-center",3,"nzType","action","click"],[1,"overflow-auto","px-4","pt-4",3,"formGroup"],["myForm",""],[3,"model","fields","form"],["nz-row","",1,"p-4","border"],["nz-col","","class","search-area flex",4,"ngIf"],["nz-col","",1,"search-area","flex"],["nz-button","","icomLibsHasPermissionDirective","",3,"nzType","nzLoading","action","click"],["nz-button","","icomLibsHasPermissionDirective","",1,"ml-4",3,"action","click"],[1,"w-full","h-full"],[1,"material","expandable","striped","w-full","h-full",3,"rows","columns","headerHeight","columnMode","rowHeight","scrollbarH","loadingIndicator"],[1,"ml-4",3,"product"],["nzSimple","",1,"w-full","h-full","flex","justify-center","items-center",3,"nzSize"],[1,"name-container","cursor-pointer",3,"click"],["nz-icon","","nzType","edit","nzTheme","twotone","icomLibsHasPermissionDirective","",1,"cursor-pointer",3,"action"],["icomLibsHasPermissionDirective","",1,"name-container","cursor-pointer",3,"action","click"],["nz-icon","","nzType","delete","nzTheme","twotone"]],template:function(o,n){1&o&&(e.YNc(0,ue,6,4,"div",0),e.YNc(1,me,1,1,"nz-spin",1),e.YNc(2,fe,2,1,"ng-template",null,2,e.W1O),e.YNc(4,ge,2,1,"ng-template",null,3,e.W1O)),2&o&&(e.Q6J("ngIf",!n.loadingIndicator),e.xp6(1),e.Q6J("ngIf",n.loadingIndicator))},dependencies:[P.u,p.UX,p._Y,p.JL,p.sg,b.X0,b.T7,h.sL,h.ix,C.w,r.dQ,S.xD,S.nE,x.O5,D.PV,D.Ls,Z,y.j,y.W,u.E],encapsulation:2})}return i})();var he=l(5592);const be=(i,c,t)=>[{prop:"",cellTemplate:i,sortable:!1,width:40},{prop:"",cellTemplate:c,sortable:!1,width:40},{prop:"banner",sortable:!1,cellTemplate:t,width:200},{prop:"name",sortable:!1,width:300},{prop:"type",sortable:!1,width:300}];var V=l(1394),ye=l(3460);const xe=["statusRef"],Ce=["removeRef"],Te=["avatarRef"];function Ie(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",11)(1,"button",12),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.handlerAdd())}),e._uU(2,"Add New "),e.qZA()()}2&i&&(e.xp6(1),e.Q6J("action","edit")("nzType","primary"))}function ze(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"nz-upload",21),e.NdJ("nzFileListChange",function(n){e.CHM(t);const s=e.oxw(3);return e.KtG(s.fileList=n)}),e.ynx(1),e.TgZ(2,"p",22),e._UZ(3,"span",23),e.qZA(),e.TgZ(4,"p",24),e._uU(5,"Upload Image"),e.qZA(),e.TgZ(6,"p",25),e._uU(7,"Size can't exceed 2 MB"),e.qZA(),e.BQk(),e.qZA()}if(2&i){const t=e.oxw(3);e.Q6J("nzMultiple",!1)("nzFileList",t.fileList)("nzBeforeUpload",t.beforeUpload)}}function Pe(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",26)(1,"button",27),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(3);return e.KtG(n.handlerSave())}),e._uU(2," Save "),e.qZA(),e.TgZ(3,"button",28),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(3);return e.KtG(n.handlerCancel())}),e._UZ(4,"i",29),e._uU(5," Cancel "),e.qZA()()}if(2&i){const t=e.oxw(3);e.xp6(1),e.Q6J("nzLoading",t.isLoading)("nzType","primary")("action","edit"),e.xp6(2),e.Q6J("action","edit")}}function we(i,c){if(1&i&&(e.TgZ(0,"div",13)(1,"div",14)(2,"form",15,16),e._UZ(4,"formly-form",17),e.qZA()(),e.YNc(5,ze,8,3,"nz-upload",18),e.TgZ(6,"div",19),e.YNc(7,Pe,6,4,"div",20),e.qZA()()),2&i){const t=e.oxw(2);e.xp6(2),e.Q6J("formGroup",t.form),e.xp6(2),e.Q6J("model",t.modelForm)("fields",t.fields)("form",t.form),e.xp6(1),e.Q6J("ngIf",t.isAddNew),e.xp6(2),e.Q6J("ngIf",!(null!=t.options&&null!=t.options.formState&&t.options.formState.disabled))}}const Se=function(){return[]};function De(i,c){if(1&i&&(e.TgZ(0,"div",30),e._UZ(1,"ngx-datatable",31),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("rows",t.rows)("columns",t.configTable.columns||e.DdM(7,Se))("headerHeight",t.configTable.headerHeight||50)("columnMode","standard")("rowHeight","auto")("scrollbarH",!0)("loadingIndicator",t.loadingIndicator)}}function Le(i,c){if(1&i&&e._UZ(0,"icom-libs-product-detail-history",32),2&i){const t=e.oxw(2);e.Q6J("product",t.modelForm)}}function Me(i,c){if(1&i&&(e.TgZ(0,"div",5)(1,"div",6),e.YNc(2,Ie,3,2,"div",7),e.YNc(3,we,8,6,"div",8),e.YNc(4,De,2,8,"div",9),e.qZA(),e.YNc(5,Le,1,1,"icom-libs-product-detail-history",10),e.qZA()),2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",!t.isAddNew),e.xp6(1),e.Q6J("ngIf",t.isAddNew),e.xp6(1),e.Q6J("ngIf",!t.isAddNew),e.xp6(1),e.Q6J("ngIf",null==t.modelForm?null:t.modelForm.id)}}function Ze(i,c){1&i&&e._UZ(0,"nz-spin",33),2&i&&e.Q6J("nzSize","large")}function Ae(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",34),e.NdJ("click",function(n){const g=e.CHM(t).row,E=e.oxw();return e.KtG(E.handlerEdit(n,g))}),e._UZ(1,"i",35),e.qZA()}2&i&&e.Q6J("action","edit")}function Ne(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",34),e.NdJ("click",function(n){const g=e.CHM(t).row,E=e.oxw();return e.KtG(E.handlerRemove(n,g))}),e._UZ(1,"span",36),e.qZA()}2&i&&e.Q6J("action","edit")}function Ee(i,c){if(1&i&&(e.TgZ(0,"div",37),e._UZ(1,"img",38),e.qZA()),2&i){const t=c.row;e.xp6(1),e.Q6J("src",t.url,e.LSH)}}let Je=(()=>{class i{constructor(t){this.msg=t,this.form=new p.cw({}),this.options={},this.fileList=[],this.fields=[],this.productService=(0,e.f3M)(I.k),this.modalService=(0,e.f3M)(j.Sf),this.IComMessageService=(0,e.f3M)(L.Q),this.cdr=(0,e.f3M)(e.sBO),this.beforeUpload=o=>new he.y(n=>{const s="image/jpeg"===o.type||"image/png"===o.type;if(!s)return this.msg.error("You can only upload JPG file!"),void n.complete();const g=(o?.size||1)/1024/1024<2;return g?this.fileList&&this.fileList.length?(this.msg.error("Only Post One File"),void n.complete()):(n.next(s&&g),void n.complete()):(this.msg.error("Image must smaller than 2MB!"),void n.complete())}),this.modelForm={}}ngOnInit(){this.fields=(i=>[{key:"name",type:"input",props:{label:"Name",placeholder:"Enter Name",type:"string",required:!0}},{key:"type",type:"select-custom",templateOptions:{label:"Type",placeholder:"Select Type",viewValue:"name",labelProp:"name",required:!0,valueProp:"code",classInclude:"w-[300px]",options:this.productService.getOptionType("MEDIA_TYPE").pipe((0,M.U)(c=>c?.data))}}])(),this.configTable={loadingIndicator:!0,columns:be(this.statusRef,this.removeRef,this.avatarRef),headerHeight:50,rowHeight:"auto",pageLimit:10},this.loadPage()}loadPage(){var t=this;return(0,_.Z)(function*(){try{t.loadingIndicator=!0;const o=yield(0,f.n)(t.productService.getProductMedia(t.product?.id||""));if(o&&o.data&&o.data){const n=[...o.data.items||[]];t.rows=n,console.log(t.rows);let s=t.rows?.find(g=>"MEDIA_TYPE_BANNER_16_9"===g.type);if(s||(s=t.rows?.find(g=>"MEDIA_TYPE_BANNER_1_1"===g.type)),!s||!t.product)return;t.product.medias=[s]}}catch(o){console.log(o)}finally{t.loadingIndicator=!1,t.cdr.detectChanges()}})()}handlerAdd(){this.isAddNew=!this.isAddNew,this.modelForm={},this.cdr.detectChanges()}handlerCancel(){this.isAddNew=!1,this.modelForm={},this.fileList=[],this.cdr.detectChanges()}handlerSave(){var t=this;return(0,_.Z)(function*(){try{if(!t.form.valid)return void Object.keys(t.form.controls).forEach(o=>{t.form.controls[o].touched=!0});t.form.markAsTouched(),t.form.submitted=!0,t.processUpload()}catch(o){t.IComMessageService.showAlertMessageError(o?.error?.error_message||"Upload Media Failed")}finally{t.isLoading=!1,t.cdr.detectChanges()}})()}processUpload(){var t=this;return(0,_.Z)(function*(){const o=new FormData;t.fileList[0]?.originFileObj&&o.append("image",t.fileList[0].originFileObj);const n={product_id:t.product?.id,...t.modelForm};t.isLoading=!0,t.cdr.detectChanges();let s=null;try{if(t.fileList[0]?.originFileObj&&(s=yield(0,f.n)(t.productService.uploadMediaProduct(o))),!n.id)return delete n.id,n.url=s.data?.path||"",yield(0,f.n)(t.productService.addMediaProduct(n)),t.IComMessageService.showAlertMessageDone("Add media success"),t.handlerCancel(),void t.loadPage();n.url=s?.data?.path||n?.url,yield(0,f.n)(t.productService.updateMediaProduct(n)),t.IComMessageService.showAlertMessageDone("Edit media success"),t.handlerCancel(),t.loadPage()}catch(g){t.IComMessageService.showAlertMessageError(g?.error?.error_message||"Upload media fail")}})()}handlerEdit(t,o){t.stopPropagation(),this.modelForm=o,this.fileList=[{uid:"-1",name:"Img",status:"done",url:this.modelForm.url,thumbUrl:this.modelForm.url}],this.isAddNew=!0,this.cdr.detectChanges()}handlerRemove(t,o){t.stopPropagation(),this.modalService.confirm({nzTitle:"Are you sure delete this media?",nzContent:`<b style="color: red;">${o.name}</b>`,nzOkText:"Delete",nzOkType:"primary",nzOkDanger:!0,nzMaskClosable:!1,nzClosable:!1,nzOnOk:this.processDelete.bind(this,o),nzCancelText:"Cancel"},"error")}processDelete(t){return(0,f.n)(this.productService.deleteProductMedia(t.id||"")).then(()=>{this.IComMessageService.showAlertMessageDone("Delete media success"),this.loadPage()}).catch(o=>{this.IComMessageService.showAlertMessageError(o?.error?.error_message||"Delete Fail")})}static#e=this.\u0275fac=function(o){return new(o||i)(e.Y36(ye.dD))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["icom-libs-product-detail-media"]],viewQuery:function(o,n){if(1&o&&(e.Gf(xe,7),e.Gf(Ce,7),e.Gf(Te,7)),2&o){let s;e.iGM(s=e.CRH())&&(n.statusRef=s.first),e.iGM(s=e.CRH())&&(n.removeRef=s.first),e.iGM(s=e.CRH())&&(n.avatarRef=s.first)}},inputs:{fields:"fields",rows:"rows",product:"product"},standalone:!0,features:[e.jDz],decls:8,vars:2,consts:[["class","w-full h-full flex",4,"ngIf"],["class","w-full h-full flex justify-center items-center","nzSimple","",3,"nzSize",4,"ngIf"],["statusRef",""],["removeRef",""],["avatarRef",""],[1,"w-full","h-full","flex"],[1,"mb-4","w-full","h-full","flex","flex-col","pr-4","pt-4","bg-white","border","rounded-md","overflow-hidden"],["class","flex flex-end pl-4",4,"ngIf"],["class","flex w-full h-full flex-col",4,"ngIf"],["class","w-full h-full mt-4",4,"ngIf"],["class","ml-4",3,"product",4,"ngIf"],[1,"flex","flex-end","pl-4"],["icomLibsHasPermissionDirective","","nz-button","",1,"!flex","!items-center",3,"action","nzType","click"],[1,"flex","w-full","h-full","flex-col"],[1,""],[1,"mt-4",3,"formGroup"],["myForm",""],[3,"model","fields","form"],["class","ml-4 h-full basis-1/2 upload-list-inline flex flex-col","nzType","drag","nzListType","picture",3,"nzMultiple","nzFileList","nzBeforeUpload","nzFileListChange",4,"ngIf"],["nz-row","",1,"p-4","border"],["nz-col","","class","search-area flex",4,"ngIf"],["nzType","drag","nzListType","picture",1,"ml-4","h-full","basis-1/2","upload-list-inline","flex","flex-col",3,"nzMultiple","nzFileList","nzBeforeUpload","nzFileListChange"],[1,"ant-upload-drag-icon"],["nz-icon","","nzType","inbox"],[1,"ant-upload-text"],[1,"ant-upload-hint"],["nz-col","",1,"search-area","flex"],["nz-button","","icomLibsHasPermissionDirective","",1,"!flex","!items-center",3,"nzLoading","nzType","action","click"],["nz-button","","icomLibsHasPermissionDirective","",1,"ml-4","!flex","!items-center",3,"action","click"],["nz-icon","","nzTheme","outline","nzType","close-circle"],[1,"w-full","h-full","mt-4"],[1,"material","expandable","striped","w-full","h-full",3,"rows","columns","headerHeight","columnMode","rowHeight","scrollbarH","loadingIndicator"],[1,"ml-4",3,"product"],["nzSimple","",1,"w-full","h-full","flex","justify-center","items-center",3,"nzSize"],["icomLibsHasPermissionDirective","",1,"name-container","cursor-pointer",3,"action","click"],["nz-icon","","nzType","edit","nzTheme","twotone",1,"cursor-pointer"],["nz-icon","","nzType","delete","nzTheme","twotone"],[1,"name-container","cursor-pointer"],["width","200","height","100",3,"src"]],template:function(o,n){1&o&&(e.YNc(0,Me,6,4,"div",0),e.YNc(1,Ze,1,1,"nz-spin",1),e.YNc(2,Ae,2,1,"ng-template",null,2,e.W1O),e.YNc(4,Ne,2,1,"ng-template",null,3,e.W1O),e.YNc(6,Ee,2,1,"ng-template",null,4,e.W1O)),2&o&&(e.Q6J("ngIf",!n.loadingIndicator),e.xp6(1),e.Q6J("ngIf",n.loadingIndicator))},dependencies:[P.u,p.UX,p._Y,p.JL,p.sg,b.X0,b.T7,h.sL,h.ix,C.w,r.dQ,S.xD,S.nE,x.O5,D.PV,D.Ls,V.cS,V.FY,Z,y.j,y.W,u.E],encapsulation:2})}return i})();const Qe=["statusRef"],Oe=["removeRef"];function He(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",6),e._UZ(1,"formly-form",7),e.TgZ(2,"div",8)(3,"div",9)(4,"button",10),e.NdJ("click",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.handlerSave(n))}),e._uU(5," Submit "),e.qZA()()()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("model",t.model)("fields",t.fields)("options",t.options)("form",t.form),e.xp6(3),e.Q6J("nzType","primary")("nzLoading",t.isLoading)}}const Ye=function(){return[]};let Fe=(()=>{class i{constructor(t){this.router=t,this.form=new p.cw({}),this.options={},this.fields=[],this.productService=(0,e.f3M)(I.k),this.iComLibsServicesInventoryService=(0,e.f3M)(I.NH),this.modalService=(0,e.f3M)(j.Sf),this.IComMessageService=(0,e.f3M)(L.Q),this.cdr=(0,e.f3M)(e.sBO),this.model={}}ngOnInit(){this.fields=(i=>[{key:"inventory_id",type:"select-custom",templateOptions:{label:"Inventory",placeholder:"Select Inventory",viewValue:"name",labelProp:"name",required:!0,valueProp:"id",options:this.iComLibsServicesInventoryService.searchInventory().pipe((0,M.U)(c=>c?.data?.items))}}])(),this.configTable={loadingIndicator:!0,columns:[{prop:"name",sortable:!1},{prop:"type",sortable:!1},{prop:"sold_stock",sortable:!1,name:"Quantity Sold"},{prop:"in_stock",sortable:!1,name:"Quantity Available"},{prop:"total_stock",sortable:!1,name:"Quantity Total"}],headerHeight:50,rowHeight:"auto",pageLimit:10},this.loadPage()}loadPage(){var t=this;return(0,_.Z)(function*(){try{t.loadingIndicator=!0;const o=yield(0,f.n)(t.productService.getProductInventories(t.product?.id||""));if(o&&o.data&&o.data){const n=[...o.data.items||[]];t.rows=n}}catch(o){console.log(o)}finally{t.loadingIndicator=!1,t.cdr.detectChanges()}})()}handlerClickAddProductToInventory(){this.isAddNew=!this.isAddNew}handlerCancel(){this.isAddNew=!1,this.model={}}handlerSave(t){var o=this;return(0,_.Z)(function*(){t.stopPropagation();try{if(!o.form.valid)return void Object.keys(o.form.controls).forEach(s=>{o.form.controls[s].touched=!0});o.form.markAsTouched(),o.form.submitted=!0,o.isLoading=!0;const n={...o.model,product_id:o.product?.id};yield(0,f.n)(o.productService.getInventoryProducts(n)),o.IComMessageService.showAlertMessageDone("Add product to inventory success"),o.handlerCancel(),o.loadPage()}catch(n){o.IComMessageService.showAlertMessageError(n?.error?.error_message)}finally{o.isLoading=!1,o.cdr.detectChanges()}})()}static#e=this.\u0275fac=function(o){return new(o||i)(e.Y36(H.F0))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["icom-libs-product-detail-inventory"]],viewQuery:function(o,n){if(1&o&&(e.Gf(Qe,7),e.Gf(Oe,7)),2&o){let s;e.iGM(s=e.CRH())&&(n.statusRef=s.first),e.iGM(s=e.CRH())&&(n.removeRef=s.first)}},inputs:{fields:"fields",rows:"rows",product:"product"},standalone:!0,features:[e.jDz],decls:7,vars:10,consts:[[1,"mb-4","w-full","h-full","flex","flex-col","!p-4","bg-white","border","rounded-md"],[1,""],["nz-button","",1,"!flex","!items-center",3,"nzType","click"],["class","w-full mt-4 bg-white ",4,"ngIf"],[1,"w-full","h-full","mt-4"],[1,"material","expandable","striped","w-full","h-full",3,"rows","columns","headerHeight","columnMode","rowHeight","scrollbarH","loadingIndicator"],[1,"w-full","mt-4","bg-white"],[3,"model","fields","options","form"],["nz-row",""],["nz-col","",1,"search-area","flex"],["nz-button","",3,"nzType","nzLoading","click"]],template:function(o,n){1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"button",2),e.NdJ("click",function(){return n.handlerClickAddProductToInventory()}),e._uU(3," Add Product To Inventory "),e.qZA()(),e.YNc(4,He,6,6,"div",3),e.TgZ(5,"div",4),e._UZ(6,"ngx-datatable",5),e.qZA()()),2&o&&(e.xp6(2),e.Q6J("nzType","primary"),e.xp6(2),e.Q6J("ngIf",n.isAddNew),e.xp6(2),e.Q6J("rows",n.rows)("columns",n.configTable.columns||e.DdM(9,Ye))("headerHeight",n.configTable.headerHeight||50)("columnMode","force")("rowHeight",n.configTable.rowHeight||50)("scrollbarH",!0)("loadingIndicator",n.loadingIndicator))},dependencies:[P.u,p.UX,b.X0,b.T7,h.sL,h.ix,C.w,r.dQ,S.xD,S.nE,x.O5,D.PV],encapsulation:2,changeDetection:0})}return i})();var Ge=l(8111);function Re(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",9)(1,"button",10),e.NdJ("click",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.handlerSave(n))}),e._uU(2," Submit "),e.qZA(),e.TgZ(3,"button",11),e.NdJ("click",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.handlerCancel(n))}),e._uU(4," Cancel "),e.qZA()()}if(2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("nzType","primary")("nzLoading",t.isLoading)("action","edit"),e.xp6(2),e.Q6J("action","edit")}}function qe(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",9)(1,"button",12),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.toggleDisabled())}),e._uU(2," Edit "),e.qZA()()}2&i&&(e.xp6(1),e.Q6J("nzType","primary")("action","edit"))}function je(i,c){if(1&i&&e._UZ(0,"icom-libs-product-detail-history",13),2&i){const t=e.oxw(2);e.Q6J("product",t.model)}}function Ve(i,c){if(1&i&&(e.TgZ(0,"div",2)(1,"div",3)(2,"form",4),e._UZ(3,"formly-form",5),e.TgZ(4,"div",6),e.YNc(5,Re,5,4,"div",7),e.YNc(6,qe,3,2,"div",7),e.qZA()()(),e.YNc(7,je,1,1,"icom-libs-product-detail-history",8),e.qZA()),2&i){const t=e.oxw();e.xp6(2),e.Q6J("formGroup",t.form),e.xp6(1),e.Q6J("model",t.model)("fields",t.fields)("options",t.options)("form",t.form),e.xp6(2),e.Q6J("ngIf",!(null!=t.options&&null!=t.options.formState&&t.options.formState.disabled)),e.xp6(1),e.Q6J("ngIf",null==t.options||null==t.options.formState?null:t.options.formState.disabled),e.xp6(1),e.Q6J("ngIf",null==t.model?null:t.model.id)}}function Be(i,c){1&i&&e._UZ(0,"nz-spin",14),2&i&&e.Q6J("nzSize","large")}let Xe=(()=>{class i{constructor(){this.form=new p.cw({}),this.options={formState:{disabled:!0}},this.fields=[],this.productService=(0,e.f3M)(I.k),this.IComMessageService=(0,e.f3M)(L.Q),this.cdr=(0,e.f3M)(e.sBO),this.model={},this.fields=[{validators:{validation:[{name:"fieldMatch",options:{errorPath:"value"}}]},fieldGroup:[{key:"type",type:"select-custom",props:{label:"Payment Type",placeholder:"Select Type",viewValue:"name",classInclude:"w-[300px]",labelProp:"name",valueProp:"code",required:!0,options:this.productService.getOptionType("PRODUCT_DISCOUNT_TYPE").pipe((0,M.U)(t=>t?.data))},expressions:{"props.disabled":"formState.disabled"}}]},{key:"value",type:"input",className:"",props:{label:"Value",required:!0,type:"number"},expressions:{"props.disabled":"formState.disabled"}},{key:"status",className:"basis-4/12",type:"Status",props:{placeholder:"Select Status",label:"Pool",viewValue:"name",labelProp:"name",valueProp:"id",required:!0,options:this.productService.getOptionType("PRODUCT_DISCOUNT_STATUS").pipe((0,M.U)(t=>t?.data))},expressions:{"props.disabled":"formState.disabled"}},{key:"date_range",type:"icom-range-picker",props:{required:!0,className:"mt-4",label:"Valid",nzShowTime:!0,format:"dd-MM-yyyy HH:mm"},expressions:{"props.disabled":"formState.disabled"}},{key:"minimum_order_value",type:"input",className:"",props:{label:"Minimum order value",required:!0,type:"number"},expressions:{"props.disabled":"formState.disabled"}},{key:"maximum_discount_amount",type:"input",className:"",props:{label:"Maximum discount amount",required:!0,type:"number"},expressions:{"props.disabled":"formState.disabled"}}]}ngOnInit(){var t=this;return(0,_.Z)(function*(){try{if(t.loadingIndicator=!0,t.cdr.detectChanges(),t.model=yield(0,f.n)(t.productService.getProductDiscount(t.product?.id)),t.modelOrigin=(0,A.cloneDeep)(t.model),!t.model.valid_from||!t.model.valid_until)return;t.model.date_range=[z(t.model.valid_from).toDate(),z(t.model.valid_until).toDate()]}catch(o){t.IComMessageService.showAlertMessageError(o?.error?.error_message)}finally{t.loadingIndicator=!1,t.cdr.detectChanges()}})()}handlerSave(t){var o=this;return(0,_.Z)(function*(){if(t.stopPropagation(),t.preventDefault(),o.form.valid)try{o.form.markAsTouched(),o.form.submitted=!0;const n={...o.model};if(o.isLoading=!0,o.cdr.detectChanges(),(0,Ge.NT)(n,"valid_from,valid_until"),n.id)return yield(0,f.n)(o.productService.updateProductDiscount(n)),o.IComMessageService.showAlertMessageDone("Edit product discount success"),void o.toggleDisabled();delete n.id,yield(0,f.n)(o.productService.createProductDiscount(n)),o.IComMessageService.showAlertMessageError("Edit product discount success")}catch(n){o.IComMessageService.showAlertMessageError(n?.error?.error_message)}finally{o.isLoading=!1,o.cdr.detectChanges()}else Object.keys(o.form.controls).forEach(n=>{o.form.controls[n].touched=!0})})()}handlerCancel(t){t.stopPropagation(),t.preventDefault(),this.toggleDisabled(),this.form.reset(this.modelOrigin)}toggleDisabled(){this.options.formState.disabled=!this.options.formState.disabled}static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["icom-libs-product-detail-discount"]],inputs:{product:"product"},standalone:!0,features:[e.jDz],decls:2,vars:2,consts:[["class","w-full h-full flex",4,"ngIf"],["class","w-full h-full flex justify-center items-center","nzSimple","",3,"nzSize",4,"ngIf"],[1,"w-full","h-full","flex"],[1,"flex","w-full","h-full","flex-col","pt-4","bg-white","border","rounded-md"],["nz-form","",3,"formGroup"],[3,"model","fields","options","form"],["nz-row","",1,"p-4","border"],["nz-col","","class","search-area flex",4,"ngIf"],["class","ml-4",3,"product",4,"ngIf"],["nz-col","",1,"search-area","flex"],["nz-button","","icomLibsHasPermissionDirective","",3,"nzType","nzLoading","action","click"],["nz-button","","icomLibsHasPermissionDirective","",1,"ml-4",3,"action","click"],["nz-button","","icomLibsHasPermissionDirective","",3,"nzType","action","click"],[1,"ml-4",3,"product"],["nzSimple","",1,"w-full","h-full","flex","justify-center","items-center",3,"nzSize"]],template:function(o,n){1&o&&(e.YNc(0,Ve,8,8,"div",0),e.YNc(1,Be,1,1,"nz-spin",1)),2&o&&(e.Q6J("ngIf",!n.loadingIndicator),e.xp6(1),e.Q6J("ngIf",n.loadingIndicator))},dependencies:[P.u,p.UX,p._Y,p.JL,p.sg,b.X0,b.T7,h.sL,h.ix,C.w,r.dQ,x.O5,Z,y.j,y.W,u.E],encapsulation:2})}return i})();var Ke=l(6991);function We(i,c){if(1&i&&(e.TgZ(0,"nz-page-header-title"),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Oqu(t.product.name||"")}}function $e(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"icom-libs-product-detail-general",16),e.NdJ("icomSave",function(n){e.CHM(t);const s=e.oxw(2);return e.KtG(s.handlerIcomSave(n))}),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("product",t.productTemp)}}function et(i,c){if(1&i&&e._UZ(0,"icom-libs-product-detail-language",17),2&i){const t=e.oxw(2);e.Q6J("product",t.product)}}function tt(i,c){if(1&i&&e._UZ(0,"icom-libs-product-detail-price",17),2&i){const t=e.oxw(2);e.Q6J("product",t.product)}}function ot(i,c){if(1&i&&e._UZ(0,"icom-libs-product-detail-properties",17),2&i){const t=e.oxw(2);e.Q6J("product",t.product)}}function it(i,c){if(1&i&&e._UZ(0,"icom-libs-product-detail-media",17),2&i){const t=e.oxw(2);e.Q6J("product",t.product)}}function nt(i,c){if(1&i&&e._UZ(0,"icom-libs-product-detail-inventory",17),2&i){const t=e.oxw(2);e.Q6J("product",t.product)}}function rt(i,c){if(1&i&&e._UZ(0,"icom-libs-inventory-items-list",18),2&i){const t=e.oxw(2);e.Q6J("inventoryId",-1)("productId",t.product.id||0)}}function st(i,c){if(1&i&&e._UZ(0,"icom-libs-product-detail-discount",17),2&i){const t=e.oxw(2);e.Q6J("product",t.product)}}function lt(i,c){1&i&&(e.TgZ(0,"nz-page-header-content",4)(1,"div",5)(2,"nz-tabset",6)(3,"nz-tab",7),e.YNc(4,$e,1,1,"ng-template",8),e.qZA(),e.TgZ(5,"nz-tab",9),e.YNc(6,et,1,1,"ng-template",8),e.qZA(),e.TgZ(7,"nz-tab",10),e.YNc(8,tt,1,1,"ng-template",8),e.qZA(),e.TgZ(9,"nz-tab",11),e.YNc(10,ot,1,1,"ng-template",8),e.qZA(),e.TgZ(11,"nz-tab",12),e.YNc(12,it,1,1,"ng-template",8),e.qZA(),e.TgZ(13,"nz-tab",13),e.YNc(14,nt,1,1,"ng-template",8),e.qZA(),e.TgZ(15,"nz-tab",14),e.YNc(16,rt,1,2,"ng-template",8),e.qZA(),e.TgZ(17,"nz-tab",15),e.YNc(18,st,1,1,"ng-template",8),e.qZA()()()()),2&i&&(e.xp6(2),e.Q6J("nzSelectedIndex",0))}function at(i,c){1&i&&(e.TgZ(0,"div",19),e._UZ(1,"nz-spin",20),e.qZA())}let ct=(()=>{class i{constructor(t,o){this.route=t,this.router=o,this.productId="",this.productService=(0,e.f3M)(I.k),this.cdr=(0,e.f3M)(e.sBO),this.location=(0,e.f3M)(x.Ye),this.backClicked=new e.vpe,this.saveClicked=new e.vpe,this.handleRouterChange()}handleRouterChange(){this.router.events.subscribe(()=>{const t=this.route.snapshot.params.id;t&&(this.productId=t,this.isRouter=!0,this.callApi())}),setTimeout(()=>{this.productId||this.handleLocationPathChange()},500)}handleLocationPathChange(){const o=this.location.path().split("/").pop();o&&(this.productId=o,this.callApi())}callApi(){var t=this;return(0,_.Z)(function*(){try{t.product=yield(0,f.n)(t.productService.getProduct(t.productId)),t.productTemp=(0,A.cloneDeep)(t.product),t.cdr.detectChanges()}catch(o){console.log(o)}})()}handlerNzBack(){this.isRouter?this.router.navigateByUrl("product/voucher"):(this.isAdd?this.backClicked.emit(this.product):this.backClicked.emit(),this.location.replaceState("product/voucher"))}handlerIcomSave(t){this.saveClicked.emit(t)}static#e=this.\u0275fac=function(o){return new(o||i)(e.Y36(H.gz),e.Y36(H.F0))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["icom-libs-product-detail"]],outputs:{backClicked:"backClicked",saveClicked:"saveClicked"},standalone:!0,features:[e.jDz],decls:4,vars:3,consts:[["nzBackIcon","",1,"site-page-header","h-full","w-full","flex","flex-col",2,"position","absolute","top","0","left","250px","width","calc(100% - 250px)","background","#f0f2f5","height","100%",3,"nzBack"],[4,"ngIf"],["class","w-full h-full overflow-auto",4,"ngIf"],["class","loading-container absolute left-1/2","style","top: 50%;",4,"ngIf"],[1,"w-full","h-full","overflow-auto"],[1,"w-full","h-full"],[3,"nzSelectedIndex"],["nzTitle","General"],["nz-tab",""],["nzTitle","Languages"],["nzTitle","Price"],["nzTitle","Properties"],["nzTitle","Media"],["nzTitle","Inventory"],["nzTitle","Inventory Items"],["nzTitle","Discounts"],[3,"product","icomSave"],[3,"product"],[3,"inventoryId","productId"],[1,"loading-container","absolute","left-1/2",2,"top","50%"],["nzSize","large"]],template:function(o,n){1&o&&(e.TgZ(0,"nz-page-header",0),e.NdJ("nzBack",function(){return n.handlerNzBack()}),e.YNc(1,We,2,1,"nz-page-header-title",1),e.YNc(2,lt,19,1,"nz-page-header-content",2),e.qZA(),e.YNc(3,at,2,0,"div",3)),2&o&&(e.xp6(1),e.Q6J("ngIf",n.product&&n.product.id),e.xp6(1),e.Q6J("ngIf",n.product&&n.product.id),e.xp6(1),e.Q6J("ngIf",!n.product||!n.product.id))},dependencies:[S.xD,P.u,p.UX,b.X0,h.sL,v.U5,J.ZJ,N.KJ,N.$O,N.u9,N.u5,Y.zf,k.we,k.xH,k.xw,k.cj,D.PV,R,q,x.O5,te,_e,Je,Fe,Xe,Ke.IcomLibInventoryListItemsComponent,y.j,y.W],encapsulation:2,changeDetection:0})}return i})()},9927:(B,Q,l)=>{l.d(Q,{B:()=>y});var _=l(5861),e=l(5879),p=l(6223),b=l(4729),P=l(5545),S=l(19),h=l(2840),v=l(7398),x=l(7921),J=l(3997),N=l(6328),Y=l(9397),D=l(708),I=l(9717),F=l(6814),z=l(6990),U=l(3599),O=l(3304),Z=l(8111),G=l(855),R=l(1958),L=l(95);function A(u,C){if(1&u){const r=e.EpF();e.TgZ(0,"div",5)(1,"button",6),e.NdJ("click",function(a){e.CHM(r);const m=e.oxw(2);return e.KtG(m.handlerSave(a))}),e._uU(2," Submit "),e.qZA(),e.TgZ(3,"button",7),e.NdJ("click",function(a){e.CHM(r);const m=e.oxw(2);return e.KtG(m.handlerCancel(a))}),e._uU(4,"Cancel"),e.qZA()()}if(2&u){const r=e.oxw(2);e.xp6(1),e.Q6J("nzType","primary")("nzLoading",r.isLoading)}}function M(u,C){if(1&u){const r=e.EpF();e.TgZ(0,"div",5)(1,"button",6),e.NdJ("click",function(){e.CHM(r);const a=e.oxw(2);return e.KtG(a.toggleDisabled())}),e._uU(2," Edit "),e.qZA()()}if(2&u){const r=e.oxw(2);e.xp6(1),e.Q6J("nzType","primary")("nzLoading",r.isLoading)}}function f(u,C){if(1&u&&(e.TgZ(0,"div",3),e.YNc(1,A,5,2,"div",4),e.YNc(2,M,3,2,"div",4),e.qZA()),2&u){const r=e.oxw();e.xp6(1),e.Q6J("ngIf",!(null!=r.options&&null!=r.options.formState&&r.options.formState.disabled)),e.xp6(1),e.Q6J("ngIf",null==r.options||null==r.options.formState?null:r.options.formState.disabled)}}let y=(()=>{class u{constructor(){this.form=new p.cw({}),this.options={formState:{disabled:!0}},this.fields=[],this.icomSave=new e.vpe,this.productService=(0,e.f3M)(b.k),this.iComMessageService=(0,e.f3M)(I.Q),this.destroyRef=(0,e.f3M)(e.ktI),this.changeDetectorRef=(0,e.f3M)(e.sBO),this.model={}}ngOnInit(){this.fields=((u,C)=>[{key:"name",type:"input",props:{label:"Name",placeholder:"Enter Name",type:"string",required:!0},expressions:{"props.disabled":"formState.disabled"}},{key:"gen_code_type",type:"select-custom",className:"w-[500px]",props:{label:"Gen Code Type",placeholder:"Select Gen Code Type",viewValue:"name",labelProp:"name",valueProp:"code",required:!0,options:u.getOptionType("PRODUCT_GENCODE_TYPE").pipe((0,v.U)(r=>r?.data))},expressions:{"props.disabled":"formState.disabled"}},{fieldGroupClassName:"flex row items-center",key:"",fieldGroup:[{key:"code",type:"input",className:"basis-1/2",props:{label:"Code",placeholder:"Enter Code",type:"string",required:!0},expressions:{"props.disabled":r=>"GENCODE_TYPE_FROM_3RD_PARTY"===r.model?.gen_code_type||C.disabled}}]},{key:"unlimit",defaultValue:!0,type:"checkbox",props:{label:"Unlimit"},expressions:{"props.disabled":r=>"GENCODE_TYPE_PRE_GENERATED"===r.model?.gen_code_type||C.disabled},hooks:{onChanges:r=>{const d=r.parent.get("gen_code_type").formControl;d&&d.valueChanges.pipe((0,x.O)(d.value),(0,J.x)(),(0,v.U)(a=>"GENCODE_TYPE_AUTO_ONE_BY_ONE"===a||"GENCODE_TYPE_FROM_3RD_PARTY"===a?(r.props.disabled=!1,void(r.model.unlimit=!0)):(r.props.disabled=!0,void(r.model.unlimit=!1)))).subscribe()}}},{key:"belong_to_merchant",type:"checkbox",props:{label:"Select Merchant"},expressions:{"props.disabled":"formState.disabled"}},{fieldGroupClassName:"flex row items-center",key:"",fieldGroup:[{key:"type",type:"select-custom",className:"basis-1/2",expressions:{"props.disabled":"formState.disabled"},props:{label:"Type",placeholder:"Select Type",viewValue:"name",labelProp:"name",required:!0,valueProp:"code",options:u.getOptionType("PRODUCT_TYPE").pipe((0,v.U)(r=>r?.data))}},{key:"status",type:"select-custom",className:"basis-1/2 ml-4",expressions:{"props.disabled":"formState.disabled"},props:{label:"Status",viewValue:"name",labelProp:"name",search:!0,placeholder:"Select Status",valueProp:"int_value",required:!0,options:u.getOptionType("PRODUCT_STATUS").pipe((0,v.U)(r=>r?.data))}}]},{fieldGroupClassName:"flex row items-center",key:"",fieldGroup:[{key:"start_time",className:"w-[300px]",type:"date",props:{required:!0,label:"Start Time",ShowTime:!0,format:"dd-MM-yyyy HH:mm"},expressions:{"props.disabled":"formState.disabled"}},{key:"end_time",className:"w-[300px]",type:"date",props:{label:"End Time",ShowTime:!0,format:"dd-MM-yyyy HH:mm"},expressions:{"props.disabled":"formState.disabled"}}]},{className:"section-label",template:'<hr class="my-4"/>'},{fieldGroupClassName:"flex row items-center",key:"",fieldGroup:[{key:"category_ids",type:"select-custom",className:"basis-1/2",props:{label:"Category",placeholder:"Select Category",viewValue:"name",labelProp:"name",valueProp:"id",multiple:!0,options:u.getCategoryForSelect().pipe((0,v.U)(r=>r?.data?.items))},expressions:{"props.disabled":"formState.disabled"}},{key:"group_ids",type:"select-custom",className:"basis-1/2 ml-4",props:{label:"Group",placeholder:"Select Group",viewValue:"name",multiple:!0,labelProp:"name",valueProp:"id",required:!0,options:u.getGroupForSelect().pipe((0,v.U)(r=>r?.data?.items))},expressions:{"props.disabled":"formState.disabled"}}]},{fieldGroupClassName:"flex row items-center",key:"",fieldGroup:[{key:"catalog_ids",type:"select-custom",className:"basis-1/2",props:{label:"Catalog",placeholder:"Select Catalog",viewValue:"name",labelProp:"name",valueProp:"id",options:u.getCatalogForSelect().pipe((0,v.U)(r=>r?.data?.items))},expressions:{"props.disabled":"formState.disabled"}},{key:"catalog_show_order",type:"input",defaultValue:0,className:"basis-1/2 ml-4",props:{label:"Catalog show order",placeholder:"Enter Catalog show order",type:"number",min:0,required:!0},expressions:{"props.disabled":"formState.disabled"}},{key:"show_order",type:"input",defaultValue:0,className:"basis-1/2 ml-4",props:{label:"Order",placeholder:"Enter Order",type:"number",min:0,required:!0},expressions:{"props.disabled":"formState.disabled"}}]},{key:"import_mode",type:"select-custom",props:{label:"Import mode",placeholder:"Select Import mode*",viewValue:"name",labelProp:"name",valueProp:"code",required:!0,options:u.getOptionType("IMPORT_MODE").pipe((0,v.U)(r=>r?.data))},expressions:{"props.disabled":"formState.disabled"}},{className:"section-label",template:'<hr class="my-4"/>'},{key:"organization_id",type:"select-custom",props:{label:"Organization",placeholder:"Select Organization*",required:!0,valueProp:"id",labelProp:"name",options:u.getOrg().pipe((0,v.U)(r=>r?.data))},expressions:{"props.disabled":"formState.disabled"}},{key:"brand_id",type:"select-custom",props:{label:"Brand",options:[],required:!0,placeholder:"Select Brand",valueProp:"id",labelProp:"name"},expressions:{"props.disabled":"formState.disabled"},hooks:{onInit:r=>{const d=r.parent.get("organization_id").formControl;r.props.options=d.valueChanges.pipe((0,x.O)(d.value),(0,J.x)(),(0,N.b)(a=>a?u.getBrandByOrg(a).pipe((0,v.U)(m=>{const T=m?.data?.find(w=>r?.model?.brand_id===w.id);return r.parent.model.specific_brands_object=m?.data||[],T||(r.formControl.setValue(null),r.parent.get("store_ids").formControl?.setValue(null)),m?.data||[]})):(r.parent.get("store_ids").formControl?.setValue(null),r.parent.get("brand_id").formControl?.setValue(null),[])))}}},{key:"store_ids",type:"select-custom",props:{label:"Store",placeholder:"Select Store",viewValue:"name",labelProp:"name",valueProp:"id",multiple:!0},expressions:{"props.disabled":"formState.disabled"},hooks:{onInit:r=>{const d=r.parent.get("brand_id").formControl;r.props.options=d.valueChanges.pipe((0,x.O)(d.value),(0,J.x)(),(0,Y.b)(a=>{const m=r.parent?.model?.specific_brands_object?.find(w=>w.id===a);r.parent.model.brand_code=m?m.code:null}),(0,N.b)(a=>{if(!a)return r.formControl.setValue([]),r.parent.model.brand_code="",[];const m=r.parent?.model?.specific_brands_object?.find(w=>w.id===a);return r.parent.model.brand_code=m?m.code:null,u.getStoreByBrand(a).pipe((0,v.U)(w=>(w?.data?.find(q=>r?.model?.store_ids?.includes(q.id))||r.formControl.setValue([]),w?.data||[])))}))}}}])(this.productService,this.options.formState),this.model&&this.model.catalog_ids&&this.model.catalog_ids?.length&&(this.model.catalog_ids=this.model.catalog_ids[0]),this.modelOrigin=(0,z.cloneDeep)(this.model),this.isAdd&&this.toggleDisabled(),setTimeout(()=>{this.form.controls.gen_code_type?.valueChanges.pipe((0,J.x)(),(0,v.U)(()=>{this.form.reset(this.model)})).subscribe()},200)}handlerSave(r,d){var a=this;return(0,_.Z)(function*(){if(r?.stopPropagation(),r?.preventDefault(),a.form.valid)try{if(a.model?.start_time&&a.model?.end_time&&O(a.model?.end_time).isBefore(a.model?.start_time))return void a.iComMessageService.showAlertMessageError("Th\u1eddi gian k\u1ebft th\xfac  kh\xf4ng \u0111\u01b0\u1ee3c nh\u1ecf h\u01a1n th\u1eddi gian b\u1eaft \u0111\u1ea7u.");a.form.markAsTouched(),a.form.submitted=!0,d&&d.isLoading&&d.isLoading();const m=(0,z.cloneDeep)(a.model);if(m&&m.catalog_ids&&(m.catalog_ids=[m.catalog_ids]),a.isLoading=!0,a.model=(0,Z.oS)(a.model,"specific"),a.isAdd){const T=yield(0,D.n)(a.productService.createProduct(m));a.icomSave.emit(T?.data),d&&d.success&&d.success(T?.data?.id),a.iComMessageService.showAlertMessageDone("Create product success")}else{const T=yield(0,D.n)(a.productService.updateProduct(a.model?.id||0,m));d&&d.success&&d.success(),a.icomSave.emit(T?.data),a.iComMessageService.showAlertMessageDone("Edit product success"),a.modelOrigin=(0,z.cloneDeep)(a.model),a.toggleDisabled()}}catch(m){d&&d.loadDone&&d.loadDone(),a.iComMessageService.showAlertMessageError(m?.error?.error_message||"Create product fail")}finally{d&&d.loadDone&&d.loadDone(),a.isLoading=!1,a.changeDetectorRef.detectChanges()}else Object.keys(a.form.controls).forEach(m=>{a.form.controls[m].touched=!0})})()}toggleDisabled(){this.options.formState.disabled=!this.options.formState.disabled}handlerCancel(r){r.stopPropagation(),this.toggleDisabled(),this.model=(0,z.cloneDeep)(this.modelOrigin)}static#e=this.\u0275fac=function(d){return new(d||u)};static#t=this.\u0275cmp=e.Xpm({type:u,selectors:[["icom-libs-product-add_edit"]],inputs:{model:"model",isAdd:"isAdd"},outputs:{icomSave:"icomSave"},standalone:!0,features:[e.jDz],decls:3,vars:7,consts:[["nz-form","",1,"pb-4","bg-white","border","rounded-md","h-full","flex","flex-col",3,"formGroup","nzLayout"],[1,"overflow-auto","px-4","pt-4",3,"model","fields","options","form"],["nz-row","","class","p-4 border",4,"ngIf"],["nz-row","",1,"p-4","border"],["nz-col","","class","search-area flex",4,"ngIf"],["nz-col","",1,"search-area","flex"],["nz-button","",3,"nzType","nzLoading","click"],["nz-button","",1,"ml-4",3,"click"]],template:function(d,a){1&d&&(e.TgZ(0,"form",0),e._UZ(1,"formly-form",1),e.YNc(2,f,3,2,"div",2),e.qZA()),2&d&&(e.Q6J("formGroup",a.form)("nzLayout","vertical"),e.xp6(1),e.Q6J("model",a.model)("fields",a.fields)("options",a.options)("form",a.form),e.xp6(1),e.Q6J("ngIf",a.model&&a.model.id))},dependencies:[S.u,p.UX,p._Y,p.JL,p.sg,P.X0,P.T7,h.sL,h.ix,G.w,R.dQ,F.O5,U.U5,L.t3,L.SK,U.Lr],encapsulation:2,changeDetection:0})}return u})()}}]);