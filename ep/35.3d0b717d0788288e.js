"use strict";(self.webpackChunkicom=self.webpackChunkicom||[]).push([[35],{5035:(de,G,a)=>{a.r(G),a.d(G,{IcomLibsProductCardDetailComponent:()=>It});var g=a(5861),e=a(5879),p=a(6223),z=a(5545),w=a(19),P=a(9364),_=a(2840),D=a(3599),x=a(6814),B=a(8083),Z=a(6254),F=a(2574),H=a(9382),C=a(551),T=a(4729),K=a(8658),L=a(3304);let j=(()=>{class i{constructor(){this.icomSave=new e.vpe,this.productService=(0,e.f3M)(T.k)}ngOnInit(){this.product&&(this.product.date_range=[L(this.product.start_time).toDate(),L(this.product.end_time).toDate()])}handlerSave(t){this.icomSave.emit(t)}static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["icom-libs-product-detail-general"]],inputs:{product:"product"},outputs:{icomSave:"icomSave"},standalone:!0,features:[e.jDz],decls:2,vars:2,consts:[[1,"flex","w-full","h-full","justify-between"],[1,"w-full","mr-4",3,"model","isAdd","icomSave"]],template:function(o,n){1&o&&(e.TgZ(0,"div",0)(1,"icom-libs-product-add_edit",1),e.NdJ("icomSave",function(s){return n.handlerSave(s)}),e.qZA()()),2&o&&(e.xp6(1),e.Q6J("model",n.product)("isAdd",!1))},dependencies:[K.B],encapsulation:2})}return i})();var k=a(9717),A=a(6990),M=a(7398),v=a(708),b=a(2669),E=a(7786),O=a(855),N=a(1958);function q(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"div",8)(1,"button",9),e.NdJ("click",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r.handlerSave(n))}),e._uU(2," L\u01b0u "),e.qZA(),e.TgZ(3,"button",10),e.NdJ("click",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r.handlerCancel(n))}),e._uU(4," \u0110\xf3ng "),e.qZA()()}if(2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("action","edit")("nzLoading",t.isLoading)("nzType","primary"),e.xp6(2),e.Q6J("action","edit")}}function h(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"div",8)(1,"button",11),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.toggleDisabled())}),e._uU(2," S\u1eeda "),e.qZA()()}2&i&&(e.xp6(1),e.Q6J("action","edit")("nzType","primary"))}function R(i,d){if(1&i&&(e.TgZ(0,"div",2)(1,"div",3)(2,"form",4),e._UZ(3,"formly-form",5),e.TgZ(4,"div",6),e.YNc(5,q,5,4,"div",7),e.YNc(6,h,3,2,"div",7),e.qZA()()()()),2&i){const t=e.oxw();e.xp6(2),e.Q6J("formGroup",t.form),e.xp6(1),e.Q6J("model",t.model)("fields",t.fields)("options",t.options)("form",t.form),e.xp6(2),e.Q6J("ngIf",!(null!=t.options&&null!=t.options.formState&&t.options.formState.disabled)),e.xp6(1),e.Q6J("ngIf",null==t.options||null==t.options.formState?null:t.options.formState.disabled)}}function l(i,d){1&i&&e._UZ(0,"nz-spin",12),2&i&&e.Q6J("nzSize","large")}let u=(()=>{class i{constructor(){this.form=new p.cw({}),this.options={formState:{disabled:!0}},this.fields=[],this.productService=(0,e.f3M)(T.k),this.IComMessageService=(0,e.f3M)(k.Q),this.cdr=(0,e.f3M)(e.sBO),this.model={subpool_id:0,pool_id:8},this.fields=[{key:"payment_method",type:"select-custom",props:{label:"Ph\u01b0\u01a1ng th\u1ee9c thanh to\xe1n",classInclude:"w-[300px]",placeholder:"Ph\u01b0\u01a1ng th\u1ee9c thanh to\xe1n",viewValue:"name",labelProp:"name",valueProp:"code",required:!0,options:this.productService.getOptionType("PAYMENT_METHOD?lang=vi").pipe((0,M.U)(t=>t?.data))},expressions:{"props.disabled":"formState.disabled"}},{key:"sale_price",type:"input",className:"",props:{label:"Gi\xe1 b\xe1n",required:!0,type:"number"},validators:["iniMin0"],expressions:{"props.disabled":"formState.disabled"}},{key:"purchase_cost",type:"input",className:"basis-6/12 ml-4",props:{label:"Chi ph\xed nh\u1eadp",required:!0,type:"number"},validators:["iniMin0"],expressions:{"props.disabled":"formState.disabled"}},{key:"pool_id",className:"basis-4/12",type:"select-custom",props:{placeholder:"Select Pool",label:"Pool",viewValue:"name",labelProp:"name",valueProp:"id",classInclude:"w-[300px]",required:!0,options:[{id:8,name:"[MPS] MyPoint Standard Point Pool"}]},expressions:{"props.disabled":"formState.disabled"}},{key:"subpool_id",type:"select-custom",className:"basis-4/12 ml-4",props:{label:"Sub Pool",placeholder:"Select Sub Pool",viewValue:"name",required:!0,classInclude:"w-[300px]",labelProp:"name",valueProp:"id",options:[{id:0,name:"[MPS] MyPoint Standard Point Pool [Not Expiry Date]"}]},expressions:{"props.disabled":"formState.disabled"}}]}ngOnInit(){var t=this;return(0,g.Z)(function*(){try{t.loadingIndicator=!0,t.model=yield(0,v.n)(t.productService.getProductPrice(t.product?.id)),t.modelOrigin=(0,A.cloneDeep)(t.model)}catch(o){t.IComMessageService.showAlertMessageError(o?.error?.error_message)}finally{t.loadingIndicator=!1,t.cdr.detectChanges()}})()}handlerSave(t){var o=this;return(0,g.Z)(function*(){t.stopPropagation(),t.preventDefault();try{if(!o.form.valid)return void Object.keys(o.form.controls).forEach(r=>{o.form.controls[r].touched=!0});o.isLoading=!0,o.cdr.detectChanges(),o.form.markAsTouched(),o.form.submitted=!0;const n={...o.model};if(n.id)return yield(0,v.n)(o.productService.updateProductPrice(n)),o.IComMessageService.showAlertMessageDone("S\u1eeda gi\xe1 s\u1ea3n ph\u1ea9m th\xe0nh c\xf4ng"),o.modelOrigin=(0,A.cloneDeep)(o.model),void o.toggleDisabled();yield(0,v.n)(o.productService.createProductPrice(n)),o.modelOrigin=(0,A.cloneDeep)(o.model),o.IComMessageService.showAlertMessageError("S\u1eeda gi\xe1 s\u1ea3n ph\u1ea9m th\xe0nh c\xf4ng")}catch(n){o.IComMessageService.showAlertMessageError(n?.error?.error_message)}finally{o.isLoading=!1,o.cdr.detectChanges()}})()}handlerCancel(t){t.stopPropagation(),t.preventDefault(),this.toggleDisabled(),this.form.reset(this.modelOrigin)}toggleDisabled(){this.options.formState.disabled=!this.options.formState.disabled}static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["icom-libs-product-detail-price"]],inputs:{product:"product"},standalone:!0,features:[e.jDz],decls:2,vars:2,consts:[["class","w-full h-full flex",4,"ngIf"],["class","w-full h-full flex justify-center items-center","nzSimple","",3,"nzSize",4,"ngIf"],[1,"w-full","h-full","flex"],[1,"flex","w-full","h-full","flex-col","pt-4","bg-white","border","rounded-md"],["nz-form","",3,"formGroup"],[3,"model","fields","options","form"],["nz-row","",1,"p-4","border"],["nz-col","","class","search-area flex",4,"ngIf"],["nz-col","",1,"search-area","flex"],["icomLibsHasPermissionDirective","","nz-button","",3,"action","nzLoading","nzType","click"],["icomLibsHasPermissionDirective","","nz-button","",1,"ml-4",3,"action","click"],["icomLibsHasPermissionDirective","","nz-button","",3,"action","nzType","click"],["nzSimple","",1,"w-full","h-full","flex","justify-center","items-center",3,"nzSize"]],template:function(o,n){1&o&&(e.YNc(0,R,7,7,"div",0),e.YNc(1,l,1,1,"nz-spin",1)),2&o&&(e.Q6J("ngIf",!n.loadingIndicator),e.xp6(1),e.Q6J("ngIf",n.loadingIndicator))},dependencies:[w.u,p.UX,p._Y,p.JL,p.sg,z.X0,z.T7,_.sL,_.ix,O.w,N.dQ,x.O5,b.j,b.W,E.E],encapsulation:2})}return i})();const c=(i,d)=>[{prop:"",cellTemplate:i,sortable:!1,width:40},{prop:"",cellTemplate:d,sortable:!1,width:40},{prop:"language",width:200,sortable:!1,name:"Ng\xf4n ng\u1eef hi\u1ec3n th\u1ecb",pipe:I()},{prop:"name",width:300,sortable:!1,name:"T\xean hi\u1ec3n th\u1ecb"},{prop:"description",width:300,sortable:!1,name:"M\xf4 t\u1ea3"}],I=()=>({transform:i=>[{code:"vi",name:"Ti\u1ebfng vi\u1ec7t"},{code:"en",name:"English"}].find(d=>d.code===i)?.name||""});var y=a(1221),U=a(1394),te=a(3460);const pe=["customFooter"];function me(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"nz-space")(1,"button",5),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.handlerSave())}),e._uU(2," L\u01b0u "),e.qZA(),e.TgZ(3,"button",6),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.handlerCancel())}),e._UZ(4,"i",7),e._uU(5," H\u1ee7y b\u1ecf "),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("nzLoading",t.isLoading)("nzType","primary")("action","edit"),e.xp6(2),e.Q6J("action","edit")}}let oe=(()=>{class i{constructor(t){this.msg=t,this.form=new p.cw({}),this.options={},this.fileList=[],this.nzModalData=(0,e.f3M)(y.uB),this.productService=(0,e.f3M)(T.k),this.cdr=(0,e.f3M)(e.sBO),this.IComMessageService=(0,e.f3M)(k.Q),this.icomSave=new e.vpe}ngOnInit(){this.fields=[{key:"name",type:"input",props:{label:"T\xean hi\u1ec3n th\u1ecb",placeholder:"T\xean hi\u1ec3n th\u1ecb",type:"string",required:!0}},{key:"description",type:"input",props:{label:"M\xf4 t\u1ea3",placeholder:"M\xf4 t\u1ea3",type:"string",required:!0}},{key:"language",type:"select-custom",templateOptions:{label:"Ng\xf4n ng\u1eef hi\u1ec3n th\u1ecb",placeholder:"Ng\xf4n ng\u1eef hi\u1ec3n th\u1ecb",viewValue:"name",labelProp:"name",required:!0,valueProp:"code",options:[{code:"vi",name:"Ti\u1ebfng Vi\u1ec7t"},{code:"en",name:"English"}]}},{key:"detail",type:"quill-editor",props:{label:"Th\xf4ng tin chi ti\u1ebft",placeholder:"Th\xf4ng tin chi ti\u1ebft",type:"string",required:!0}},{key:"term_and_condition",type:"quill-editor",props:{label:"\u0110i\u1ec1u ki\u1ec7n s\u1eed d\u1ee5ng",placeholder:"\u0110i\u1ec1u ki\u1ec7n s\u1eed d\u1ee5ng",type:"string",required:!0}}],this.fileList=this.nzModalData.fileList||[],this.modelForm=this.nzModalData.modelForm,this.rows=this.nzModalData.rows||[],this.product=this.nzModalData.product}ngAfterViewInit(){const t=this.modal;t.updateConfig({nzFooter:this.templateFooter}),t.containerInstance.cdr.detectChanges(),this.cdr.detectChanges()}handlerSave(){var t=this;return(0,g.Z)(function*(){t.form.valid?(t.form.markAsTouched(),t.form.submitted=!0,t.icomSave.emit({})):Object.keys(t.form.controls).forEach(o=>{t.form.controls[o].touched=!0})})()}handlerCancel(){this.icomSave.emit()}static#e=this.\u0275fac=function(o){return new(o||i)(e.Y36(te.dD))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["icom-libs-product-detail-language-modal"]],viewQuery:function(o,n){if(1&o&&e.Gf(pe,5),2&o){let r;e.iGM(r=e.CRH())&&(n.templateFooter=r.first)}},inputs:{modal:"modal"},outputs:{icomSave:"icomSave"},standalone:!0,features:[e.jDz],decls:6,vars:4,consts:[[1,"flex","w-full","h-full","flex-col"],[1,""],[1,"mt-4",3,"formGroup"],[3,"model","fields","form"],["customFooter",""],["nz-button","","icomLibsHasPermissionDirective","",1,"!flex","!items-center",3,"nzLoading","nzType","action","click"],["nz-button","","icomLibsHasPermissionDirective","",1,"ml-4","!flex","!items-center",3,"action","click"],["nz-icon","","nzTheme","outline","nzType","close-circle"]],template:function(o,n){1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"form",2),e._UZ(3,"formly-form",3),e.qZA()()(),e.YNc(4,me,6,4,"ng-template",null,4,e.W1O)),2&o&&(e.xp6(2),e.Q6J("formGroup",n.form),e.xp6(1),e.Q6J("model",n.modelForm)("fields",n.fields)("form",n.form))},dependencies:[w.u,p.UX,p._Y,p.JL,p.sg,z.X0,z.T7,_.sL,_.ix,O.w,N.dQ,P.xD,C.PV,C.Ls,U.cS,b.j,E.E,F.zf,F.NU],encapsulation:2,changeDetection:0})}return i})();var V=a(2787);const ue=["statusRef"],fe=["removeRef"],he=function(){return[]};function ge(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"div",4)(1,"div",5)(2,"div",6)(3,"button",7),e.NdJ("click",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.handlerAdd(n))}),e._uU(4," Th\xeam m\u1edbi "),e.qZA()(),e.TgZ(5,"div",8),e._UZ(6,"ngx-datatable",9),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(3),e.Q6J("nzType","primary")("action","edit"),e.xp6(3),e.Q6J("rows",t.rows)("columns",t.configTable.columns||e.DdM(9,he))("headerHeight",t.configTable.headerHeight||50)("columnMode","standard")("rowHeight",t.configTable.rowHeight||50)("scrollbarH",!0)("loadingIndicator",t.loadingIndicator)}}function _e(i,d){1&i&&e._UZ(0,"nz-spin",10),2&i&&e.Q6J("nzSize","large")}function ve(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"div",11),e.NdJ("click",function(n){const s=e.CHM(t).row,m=e.oxw();return e.KtG(m.handlerEdit(n,s))}),e._UZ(1,"i",12),e.qZA()}2&i&&(e.xp6(1),e.Q6J("action","edit"))}function Ce(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"div",13),e.NdJ("click",function(n){const s=e.CHM(t).row,m=e.oxw();return e.KtG(m.handlerRemove(n,s))}),e._UZ(1,"span",14),e.qZA()}2&i&&e.Q6J("action","edit")}let ze=(()=>{class i{constructor(t){this.router=t,this.form=new p.cw({}),this.options={},this.fields=[],this.productService=(0,e.f3M)(T.k),this.modalService=(0,e.f3M)(y.Sf),this.IComMessageService=(0,e.f3M)(k.Q),this.cdr=(0,e.f3M)(e.sBO),this.viewContainerRef=(0,e.f3M)(e.s_b),this.modelForm={}}ngOnInit(){this.fields=[{key:"name",type:"input",props:{label:"T\xean hi\u1ec3n th\u1ecb",placeholder:"T\xean hi\u1ec3n th\u1ecb",type:"string",required:!0}},{key:"description",type:"input",props:{label:"M\xf4 t\u1ea3",placeholder:"M\xf4 t\u1ea3",type:"string",required:!0}},{key:"language",type:"select-custom",templateOptions:{label:"Ng\xf4n ng\u1eef hi\u1ec3n th\u1ecb",placeholder:"Ng\xf4n ng\u1eef hi\u1ec3n th\u1ecb",viewValue:"name",labelProp:"name",required:!0,valueProp:"code",options:[{code:"vi",name:"Ti\u1ebfng Vi\u1ec7t"},{code:"en",name:"English"}]}},{key:"detail",type:"quill-editor",props:{label:"Th\xf4ng tin chi ti\u1ebft",placeholder:"Th\xf4ng tin chi ti\u1ebft",type:"string",required:!0}},{key:"term_and_condition",type:"quill-editor",props:{label:"\u0110i\u1ec1u ki\u1ec7n s\u1eed d\u1ee5ng",placeholder:"\u0110i\u1ec1u ki\u1ec7n s\u1eed d\u1ee5ng",type:"string",required:!0}}],this.configTable={loadingIndicator:!0,columns:c(this.statusRef,this.removeRef),headerHeight:50,rowHeight:"auto",pageLimit:10},this.loadPage()}loadPage(){var t=this;return(0,g.Z)(function*(){try{t.loadingIndicator=!0;const o=yield(0,v.n)(t.productService.getProductLanguage(t.product?.id||""));if(o&&o.data&&o.data){const n=[...o.data.items||[]];t.rows=n}}catch(o){console.log(o)}finally{t.loadingIndicator=!1,t.cdr.detectChanges()}})()}handlerAdd(t){t.stopPropagation(),t.preventDefault(),this.modelForm={};const o=this.modalService.create({nzTitle:"Th\xeam m\u1edbi",nzContent:oe,nzMaskClosable:!1,nzKeyboard:!1,nzClosable:!0,nzViewContainerRef:this.viewContainerRef,nzData:{form:this.form,modelForm:this.modelForm,rows:this.rows,product:this.product},nzWidth:968,nzFooter:[]}),n=o.getContentComponent();n.icomSave.subscribe(r=>{if(r)return this.handlerSave(),void o.close();o.close(),this.loadPage(),this.cdr.detectChanges()}),n.modal=o,this.cdr.detectChanges()}handlerCancel(){this.isAddNew=!1,this.modelForm={}}handlerSave(t){var o=this;return(0,g.Z)(function*(){t?.stopPropagation(),t?.preventDefault();try{const n={product_id:o.product?.id,...o.modelForm};if(o.isLoading=!0,o.cdr.detectChanges(),!n.id)return delete n.id,o.rows?.some(s=>s.language==n.language)?void o.IComMessageService.showAlertMessageError("B\u1ea3n ghi n\xe0y \u0111\xe3 t\u1ed3n t\u1ea1i"):void o.productService.addLanguageProduct(n).subscribe(()=>{o.IComMessageService.showAlertMessageDone("Th\xeam ng\xf4n ng\u1eef th\xe0nh c\xf4ng"),o.handlerCancel(),o.loadPage()});yield(0,v.n)(o.productService.updateLanguageProduct(o.modelForm)),o.IComMessageService.showAlertMessageDone("S\u1eeda ng\xf4n ng\u1eef th\xe0nh c\xf4ng"),o.handlerCancel(),o.loadPage()}catch(n){o.IComMessageService.showAlertMessageError(n?.error?.error_message)}finally{o.isLoading=!1,o.cdr.detectChanges()}})()}handlerEdit(t,o){t.stopPropagation(),this.modelForm=o;const n=this.modalService.create({nzTitle:"S\u1eeda ng\xf4n ng\u1eef",nzContent:oe,nzMaskClosable:!1,nzKeyboard:!1,nzClosable:!0,nzViewContainerRef:this.viewContainerRef,nzData:{form:this.form,modelForm:this.modelForm,rows:this.rows},nzWidth:968,nzFooter:[]}),r=n.getContentComponent();r.icomSave.subscribe(s=>{if(s)return this.handlerSave(),void n.close();n.close(),this.loadPage(),this.cdr.detectChanges()}),r.modal=n,this.cdr.detectChanges()}handlerRemove(t,o){t.stopPropagation(),this.modalService.confirm({nzTitle:"B\u1ea1n c\xf3 ch\u1eafc ch\u1eafn mu\u1ed1n x\xf3a ng\xf4n ng\u1eef n\xe0y kh\xf4ng?",nzContent:`<b style="color: red;">${o.name}</b>`,nzOkText:"X\xf3a",nzOkType:"primary",nzOkDanger:!0,nzMaskClosable:!1,nzClosable:!1,nzOnOk:this.processDelete.bind(this,o),nzCancelText:"H\u1ee7y"},"error")}processDelete(t){return(0,v.n)(this.productService.deleteProductLanguage(t.id||"")).then(()=>{this.IComMessageService.showAlertMessageDone("X\xf3a ng\xf4n ng\u1eef th\xe0nh c\xf4ng"),this.loadPage()}).catch(o=>{this.IComMessageService.showAlertMessageError(o?.error?.error_message)})}static#e=this.\u0275fac=function(o){return new(o||i)(e.Y36(V.F0))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["icom-libs-product-detail-language"]],viewQuery:function(o,n){if(1&o&&(e.Gf(ue,7),e.Gf(fe,7)),2&o){let r;e.iGM(r=e.CRH())&&(n.statusRef=r.first),e.iGM(r=e.CRH())&&(n.removeRef=r.first)}},inputs:{fields:"fields",rows:"rows",product:"product"},standalone:!0,features:[e.jDz],decls:6,vars:2,consts:[["class","w-full h-full flex",4,"ngIf"],["class","w-full h-full flex justify-center items-center","nzSimple","",3,"nzSize",4,"ngIf"],["statusRef",""],["removeRef",""],[1,"w-full","h-full","flex"],[1,"mb-4","w-full","h-full","flex","flex-col","bg-white","border","rounded-md"],[1,"flex","justify-end","p-4"],["nz-button","","icomLibsHasPermissionDirective","",1,"flex","items-center",3,"nzType","action","click"],[1,"w-full","h-full"],[1,"material","expandable","striped","w-full","h-full",3,"rows","columns","headerHeight","columnMode","rowHeight","scrollbarH","loadingIndicator"],["nzSimple","",1,"w-full","h-full","flex","justify-center","items-center",3,"nzSize"],[1,"name-container","cursor-pointer",3,"click"],["nz-icon","","nzType","edit","nzTheme","twotone","icomLibsHasPermissionDirective","",1,"cursor-pointer",3,"action"],["icomLibsHasPermissionDirective","",1,"name-container","cursor-pointer",3,"action","click"],["nz-icon","","nzType","delete","nzTheme","twotone"]],template:function(o,n){1&o&&(e.YNc(0,ge,7,10,"div",0),e.YNc(1,_e,1,1,"nz-spin",1),e.YNc(2,ve,2,1,"ng-template",null,2,e.W1O),e.YNc(4,Ce,2,1,"ng-template",null,3,e.W1O)),2&o&&(e.Q6J("ngIf",!n.loadingIndicator),e.xp6(1),e.Q6J("ngIf",n.loadingIndicator))},dependencies:[w.u,p.UX,z.X0,_.sL,_.ix,O.w,N.dQ,P.xD,P.nE,x.O5,C.PV,C.Ls,b.j,b.W,E.E],encapsulation:2})}return i})();const be=(i,d,t)=>[{prop:"",cellTemplate:i,sortable:!1,width:40},{prop:"",cellTemplate:d,sortable:!1,width:40},{prop:"banner",sortable:!1,cellTemplate:t,width:200,name:"File upload"},{prop:"name",sortable:!1,width:300,name:"T\xean h\xecnh \u1ea3nh"},{prop:"type",sortable:!1,width:300,name:"Lo\u1ea1i h\xecnh \u1ea3nh"}],ne=i=>[{key:"name",type:"input",props:{label:"T\xean h\xecnh \u1ea3nh",placeholder:"T\xean h\xecnh \u1ea3nh",type:"string",required:!0}},{key:"type",type:"select-custom",templateOptions:{label:"Lo\u1ea1i h\xecnh \u1ea3nh",placeholder:"Lo\u1ea1i h\xecnh \u1ea3nh",viewValue:"name",labelProp:"name",required:!0,valueProp:"code",classInclude:"w-[300px]",options:i.getOptionType("MEDIA_TYPE").pipe((0,M.U)(d=>d?.data))}}];var W=a(5592);const ye=["customFooter"];function xe(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"nz-upload",6),e.NdJ("nzFileListChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.fileList=n)}),e.ynx(1),e.TgZ(2,"p",7),e._UZ(3,"span",8),e.qZA(),e.TgZ(4,"p",9),e._uU(5,"Upload \u1ea3nh"),e.qZA(),e.TgZ(6,"p",10),e._uU(7,"Lo\u1ea1i file h\u1ed7 tr\u1ee3: PNG, JPG"),e.qZA(),e.TgZ(8,"p",10),e._uU(9," K\xedch th\u01b0\u1edbc t\u1ed1i \u0111a: 2 Mb"),e.qZA(),e.BQk(),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("nzMultiple",!1)("nzFileList",t.fileList)("nzBeforeUpload",t.beforeUpload)}}function Te(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"nz-space")(1,"button",11),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.handlerSave())}),e._uU(2," L\u01b0u "),e.qZA(),e.TgZ(3,"button",12),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.handlerCancel())}),e._UZ(4,"i",13),e._uU(5," H\u1ee7y b\u1ecf "),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("nzLoading",t.isLoading)("nzType","primary")("action","edit"),e.xp6(2),e.Q6J("action","edit")}}let ie=(()=>{class i{constructor(t){this.msg=t,this.form=new p.cw({}),this.options={},this.fileList=[],this.nzModalData=(0,e.f3M)(y.uB),this.productService=(0,e.f3M)(T.k),this.cdr=(0,e.f3M)(e.sBO),this.IComMessageService=(0,e.f3M)(k.Q),this.icomSave=new e.vpe,this.beforeUpload=o=>new W.y(n=>{const r="image/jpeg"===o.type||"image/png"===o.type;if(!r)return this.msg.error("You can only upload JPG file!"),void n.complete();const s=(o?.size||1)/1024/1024<2;return s?this.fileList&&this.fileList.length?(this.msg.error("Only Post One File"),void n.complete()):(n.next(r&&s),void n.complete()):(this.msg.error("Image must smaller than 2MB!"),void n.complete())})}ngOnInit(){this.fields=ne(this.productService),this.fileList=this.nzModalData.fileList,this.modelForm=this.nzModalData.modelForm,this.product=this.nzModalData.product}ngAfterViewInit(){const t=this.modal;t.updateConfig({nzFooter:this.templateFooter}),t.containerInstance.cdr.detectChanges(),this.cdr.detectChanges()}handlerSave(){var t=this;return(0,g.Z)(function*(){try{if(!t.form.valid)return void Object.keys(t.form.controls).forEach(o=>{t.form.controls[o].touched=!0});t.form.markAsTouched(),t.form.submitted=!0,t.processUpload()}catch(o){t.IComMessageService.showAlertMessageError(o?.error?.error_message||"Upload Media Failed")}finally{t.isLoading=!1,t.cdr.detectChanges()}})()}processUpload(){var t=this;return(0,g.Z)(function*(){t.icomSave.emit(t.fileList)})()}handlerCancel(){this.icomSave.emit()}static#e=this.\u0275fac=function(o){return new(o||i)(e.Y36(te.dD))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["icom-libs-product-detail-media-modal"]],viewQuery:function(o,n){if(1&o&&e.Gf(ye,5),2&o){let r;e.iGM(r=e.CRH())&&(n.templateFooter=r.first)}},inputs:{modal:"modal"},outputs:{icomSave:"icomSave"},standalone:!0,features:[e.jDz],decls:7,vars:5,consts:[[1,"flex","w-full","h-full","flex-col"],[1,""],[1,"mt-4",3,"formGroup"],[3,"model","fields","form"],["class","ml-4 h-full basis-1/2 upload-list-inline flex flex-col","nzType","drag","nzListType","picture",3,"nzMultiple","nzFileList","nzBeforeUpload","nzFileListChange",4,"ngIf"],["customFooter",""],["nzType","drag","nzListType","picture",1,"ml-4","h-full","basis-1/2","upload-list-inline","flex","flex-col",3,"nzMultiple","nzFileList","nzBeforeUpload","nzFileListChange"],[1,"ant-upload-drag-icon"],["nz-icon","","nzType","inbox"],[1,"ant-upload-text"],[1,"ant-upload-hint"],["nz-button","","icomLibsHasPermissionDirective","",1,"!flex","!items-center",3,"nzLoading","nzType","action","click"],["nz-button","","icomLibsHasPermissionDirective","",1,"ml-4","!flex","!items-center",3,"action","click"],["nz-icon","","nzTheme","outline","nzType","close-circle"]],template:function(o,n){1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"form",2),e._UZ(3,"formly-form",3),e.qZA()(),e.YNc(4,xe,10,3,"nz-upload",4),e.qZA(),e.YNc(5,Te,6,4,"ng-template",null,5,e.W1O)),2&o&&(e.xp6(2),e.Q6J("formGroup",n.form),e.xp6(1),e.Q6J("model",n.modelForm)("fields",n.fields)("form",n.form),e.xp6(1),e.Q6J("ngIf",n.fields))},dependencies:[w.u,p.UX,p._Y,p.JL,p.sg,z.X0,z.T7,_.sL,_.ix,O.w,N.dQ,P.xD,x.O5,C.PV,C.Ls,U.cS,U.FY,b.j,E.E,F.zf,F.NU],encapsulation:2,changeDetection:0})}return i})();const Pe=["statusRef"],Ie=["removeRef"],we=["avatarRef"];function De(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"div",9)(1,"button",10),e.NdJ("click",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r.handlerAdd(n))}),e._uU(2,"Th\xeam m\u1edbi "),e.qZA()()}2&i&&(e.xp6(1),e.Q6J("action","edit")("nzType","primary"))}const Se=function(){return[]};function Me(i,d){if(1&i&&(e.TgZ(0,"div",11),e._UZ(1,"ngx-datatable",12),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("rows",t.rows)("columns",t.configTable.columns||e.DdM(7,Se))("headerHeight",t.configTable.headerHeight||50)("columnMode","standard")("rowHeight","auto")("scrollbarH",!0)("loadingIndicator",t.loadingIndicator)}}function Le(i,d){if(1&i&&(e.TgZ(0,"div",5)(1,"div",6),e.YNc(2,De,3,2,"div",7),e.YNc(3,Me,2,8,"div",8),e.qZA()()),2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",!t.isAddNew),e.xp6(1),e.Q6J("ngIf",!t.isAddNew)}}function ke(i,d){1&i&&e._UZ(0,"nz-spin",13),2&i&&e.Q6J("nzSize","large")}function Ae(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"div",14),e.NdJ("click",function(n){const s=e.CHM(t).row,m=e.oxw();return e.KtG(m.handlerEdit(n,s))}),e._UZ(1,"i",15),e.qZA()}2&i&&e.Q6J("action","edit")}function Oe(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"div",14),e.NdJ("click",function(n){const s=e.CHM(t).row,m=e.oxw();return e.KtG(m.handlerRemove(n,s))}),e._UZ(1,"span",16),e.qZA()}2&i&&e.Q6J("action","edit")}function Ne(i,d){if(1&i&&(e.TgZ(0,"div",17),e._UZ(1,"img",18),e.qZA()),2&i){const t=d.row;e.xp6(1),e.Q6J("src",t.url,e.LSH)}}let Ee=(()=>{class i{constructor(){this.fileList=[],this.fields=[],this.productService=(0,e.f3M)(T.k),this.modalService=(0,e.f3M)(y.Sf),this.IComMessageService=(0,e.f3M)(k.Q),this.cdr=(0,e.f3M)(e.sBO),this.viewContainerRef=(0,e.f3M)(e.s_b),this.modelForm={},this.form={}}ngOnInit(){this.fields=ne(this.productService),this.configTable={loadingIndicator:!0,columns:be(this.statusRef,this.removeRef,this.avatarRef),headerHeight:50,rowHeight:"auto",pageLimit:10},this.loadPage()}loadPage(){var t=this;return(0,g.Z)(function*(){try{t.loadingIndicator=!0;const o=yield(0,v.n)(t.productService.getProductMedia(t.product?.id||""));if(o&&o.data&&o.data){const n=[...o.data.items||[]];t.rows=n;let r=t.rows?.find(s=>"MEDIA_TYPE_BANNER_16_9"===s.type);if(r||(r=t.rows?.find(s=>"MEDIA_TYPE_BANNER_1_1"===s.type)),!r||!t.product)return;t.product.medias=[r]}}catch(o){console.log(o)}finally{t.loadingIndicator=!1,t.cdr.detectChanges()}})()}handlerAdd(t){t.stopPropagation(),t.preventDefault(),this.modelForm={},this.fileList=[];const o=this.modalService.create({nzTitle:"Th\xeam h\xecnh \u1ea3nh",nzContent:ie,nzMaskClosable:!1,nzKeyboard:!1,nzClosable:!0,nzViewContainerRef:this.viewContainerRef,nzData:{form:{},modelForm:this.modelForm,product:this.product,fileList:this.fileList},nzWidth:968,nzFooter:[]}),n=o.getContentComponent();n.icomSave.subscribe(r=>{if(r)return this.handlerSave(r),void o.close();o.close(),this.loadPage(),this.cdr.detectChanges()}),n.modal=o,this.cdr.detectChanges()}handlerCancel(){this.isAddNew=!1,this.cdr.detectChanges()}handlerSave(t){var o=this;return(0,g.Z)(function*(){try{o.processUpload(t)}catch(n){o.IComMessageService.showAlertMessageError(n?.error?.error_message||"Upload Media Failed")}finally{o.isLoading=!1,o.cdr.detectChanges()}})()}processUpload(t){var o=this;return(0,g.Z)(function*(){const n=new FormData;t[0]?.originFileObj&&n.append("image",t[0].originFileObj);const r={product_id:o.product?.id,...o.modelForm};o.isLoading=!0,o.cdr.detectChanges();let s=null;try{if(t[0]?.originFileObj&&(s=yield(0,v.n)(o.productService.uploadMediaProduct(n))),!r.id)return delete r.id,r.url=s?.data?.path||"",yield(0,v.n)(o.productService.addMediaProduct(r)),o.IComMessageService.showAlertMessageDone("Th\xeam h\xecnh \u1ea3nh th\xe0nh c\xf4ng"),o.handlerCancel(),void o.loadPage();r.url=s?.data?.path||r?.url,yield(0,v.n)(o.productService.updateMediaProduct(r)),o.IComMessageService.showAlertMessageDone("S\u1eeda h\xecnh \u1ea3nh th\xe0nh c\xf4ng"),o.modelForm={},o.handlerCancel(),o.loadPage()}catch(m){o.IComMessageService.showAlertMessageError(m?.error?.error_message||"Upload media fail")}})()}handlerEdit(t,o){t.stopPropagation(),this.modelForm=o,this.fileList=[{uid:"-1",name:"Img",status:"done",url:this.modelForm.url,thumbUrl:this.modelForm.url}];const n=this.modalService.create({nzTitle:"S\u1eeda h\xecnh \u1ea3nh",nzContent:ie,nzMaskClosable:!1,nzKeyboard:!1,nzClosable:!0,nzViewContainerRef:this.viewContainerRef,nzData:{form:this.form,modelForm:this.modelForm,fileList:this.fileList},nzWidth:968,nzFooter:[]}),r=n.getContentComponent();r.icomSave.subscribe(s=>{s&&(this.handlerSave(s),n.close()),n.close(),this.loadPage(),this.cdr.detectChanges()}),r.modal=n,this.cdr.detectChanges()}handlerRemove(t,o){t.stopPropagation(),this.modalService.confirm({nzTitle:"B\u1ea1n c\xf3 ch\u1eafc ch\u1eafn mu\u1ed1n x\xf3a h\xecnh \u1ea3nh n\xe0y kh\xf4ng?",nzContent:`<b style="color: red;">${o.name}</b>`,nzOkText:"X\xf3a",nzOkType:"primary",nzOkDanger:!0,nzMaskClosable:!1,nzClosable:!1,nzOnOk:this.processDelete.bind(this,o),nzCancelText:"H\u1ee7y"},"error")}processDelete(t){return(0,v.n)(this.productService.deleteProductMedia(t.id||"")).then(()=>{this.IComMessageService.showAlertMessageDone("X\xf3a h\xecnh \u1ea3nh th\xe0nh c\xf4ng"),this.loadPage()}).catch(o=>{this.IComMessageService.showAlertMessageError(o?.error?.error_message||"X\xf3a th\u1ea5t b\u1ea1i")})}static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["icom-libs-product-detail-media"]],viewQuery:function(o,n){if(1&o&&(e.Gf(Pe,7),e.Gf(Ie,7),e.Gf(we,7)),2&o){let r;e.iGM(r=e.CRH())&&(n.statusRef=r.first),e.iGM(r=e.CRH())&&(n.removeRef=r.first),e.iGM(r=e.CRH())&&(n.avatarRef=r.first)}},inputs:{fields:"fields",rows:"rows",product:"product"},standalone:!0,features:[e.jDz],decls:8,vars:2,consts:[["class","w-full h-full flex",4,"ngIf"],["class","w-full h-full flex justify-center items-center","nzSimple","",3,"nzSize",4,"ngIf"],["statusRef",""],["removeRef",""],["avatarRef",""],[1,"w-full","h-full","flex"],[1,"mb-4","w-full","h-full","flex","flex-col","pr-4","pt-4","bg-white","border","rounded-md","overflow-hidden"],["class","flex flex-end pl-4",4,"ngIf"],["class","w-full h-full mt-4",4,"ngIf"],[1,"flex","flex-end","pl-4"],["icomLibsHasPermissionDirective","","nz-button","",1,"!flex","!items-center",3,"action","nzType","click"],[1,"w-full","h-full","mt-4"],[1,"material","expandable","striped","w-full","h-full",3,"rows","columns","headerHeight","columnMode","rowHeight","scrollbarH","loadingIndicator"],["nzSimple","",1,"w-full","h-full","flex","justify-center","items-center",3,"nzSize"],["icomLibsHasPermissionDirective","",1,"name-container","cursor-pointer",3,"action","click"],["nz-icon","","nzType","edit","nzTheme","twotone",1,"cursor-pointer"],["nz-icon","","nzType","delete","nzTheme","twotone"],[1,"name-container","cursor-pointer"],["width","200","height","100",3,"src"]],template:function(o,n){1&o&&(e.YNc(0,Le,4,2,"div",0),e.YNc(1,ke,1,1,"nz-spin",1),e.YNc(2,Ae,2,1,"ng-template",null,2,e.W1O),e.YNc(4,Oe,2,1,"ng-template",null,3,e.W1O),e.YNc(6,Ne,2,1,"ng-template",null,4,e.W1O)),2&o&&(e.Q6J("ngIf",!n.loadingIndicator),e.xp6(1),e.Q6J("ngIf",n.loadingIndicator))},dependencies:[w.u,p.UX,z.X0,_.sL,_.ix,O.w,N.dQ,P.xD,P.nE,x.O5,C.PV,C.Ls,U.cS,b.j,b.W,E.E],encapsulation:2})}return i})();const Ue=["statusRef"],Je=["removeRef"];function Qe(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"div",6),e._UZ(1,"formly-form",7),e.TgZ(2,"div",8)(3,"div",9)(4,"button",10),e.NdJ("click",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.handlerSave(n))}),e._uU(5," L\u01b0u "),e.qZA()()()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("model",t.model)("fields",t.fields)("options",t.options)("form",t.form),e.xp6(3),e.Q6J("nzType","primary")("nzLoading",t.isLoading)}}const He=function(){return[]};let Re=(()=>{class i{constructor(t){this.router=t,this.form=new p.cw({}),this.options={},this.fields=[],this.productService=(0,e.f3M)(T.k),this.iComLibsServicesInventoryService=(0,e.f3M)(T.NH),this.modalService=(0,e.f3M)(y.Sf),this.IComMessageService=(0,e.f3M)(k.Q),this.cdr=(0,e.f3M)(e.sBO),this.model={}}ngOnInit(){this.fields=(i=>[{key:"inventory_id",type:"select-custom",templateOptions:{label:"Kho",placeholder:"Select Inventory",viewValue:"name",labelProp:"name",required:!0,valueProp:"id",options:this.iComLibsServicesInventoryService.searchInventory().pipe((0,M.U)(d=>d?.data?.items))}}])(),this.configTable={loadingIndicator:!0,columns:[{prop:"name",sortable:!1,name:"T\xean kho"},{prop:"type",sortable:!1,name:"Lo\u1ea1i kho"},{prop:"sold_stock",sortable:!1,name:"T\u1ed5ng \u0111\xe3 b\xe1n"},{prop:"in_stock",sortable:!1,name:"T\u1ed5ng c\xf2n l\u1ea1i"},{prop:"total_stock",sortable:!1,name:"T\u1ed5ng s\u1ed1 s\u1ea3n ph\u1ea9m"}],headerHeight:50,rowHeight:"auto",pageLimit:10},this.loadPage()}loadPage(){var t=this;return(0,g.Z)(function*(){try{t.loadingIndicator=!0;const o=yield(0,v.n)(t.productService.getProductInventories(t.product?.id||""));if(o&&o.data&&o.data){const n=[...o.data.items||[]];t.rows=n}}catch(o){console.log(o)}finally{t.loadingIndicator=!1,t.cdr.detectChanges()}})()}handlerClickAddProductToInventory(){this.isAddNew=!this.isAddNew}handlerCancel(){this.isAddNew=!1,this.model={}}handlerSave(t){var o=this;return(0,g.Z)(function*(){t.stopPropagation();try{if(!o.form.valid)return void Object.keys(o.form.controls).forEach(r=>{o.form.controls[r].touched=!0});o.form.markAsTouched(),o.form.submitted=!0,o.isLoading=!0;const n={...o.model,product_id:o.product?.id};yield(0,v.n)(o.productService.getInventoryProducts(n)),o.IComMessageService.showAlertMessageDone("Add product to inventory success"),o.handlerCancel(),o.loadPage()}catch(n){o.IComMessageService.showAlertMessageError(n?.error?.error_message)}finally{o.isLoading=!1,o.cdr.detectChanges()}})()}static#e=this.\u0275fac=function(o){return new(o||i)(e.Y36(V.F0))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["icom-libs-product-detail-inventory"]],viewQuery:function(o,n){if(1&o&&(e.Gf(Ue,7),e.Gf(Je,7)),2&o){let r;e.iGM(r=e.CRH())&&(n.statusRef=r.first),e.iGM(r=e.CRH())&&(n.removeRef=r.first)}},inputs:{fields:"fields",rows:"rows",product:"product"},standalone:!0,features:[e.jDz],decls:7,vars:10,consts:[[1,"mb-4","w-full","h-full","flex","flex-col","!p-4","bg-white","border","rounded-md"],[1,""],["nz-button","",1,"!flex","!items-center",3,"nzType","click"],["class","w-full mt-4 bg-white ",4,"ngIf"],[1,"w-full","h-full","mt-4"],[1,"material","expandable","striped","w-full","h-full",3,"rows","columns","headerHeight","columnMode","rowHeight","scrollbarH","loadingIndicator"],[1,"w-full","mt-4","bg-white"],[3,"model","fields","options","form"],["nz-row",""],["nz-col","",1,"search-area","flex"],["nz-button","",3,"nzType","nzLoading","click"]],template:function(o,n){1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"button",2),e.NdJ("click",function(){return n.handlerClickAddProductToInventory()}),e._uU(3," Th\xeam s\u1ea3n ph\u1ea9m v\xe0o kho "),e.qZA()(),e.YNc(4,Qe,6,6,"div",3),e.TgZ(5,"div",4),e._UZ(6,"ngx-datatable",5),e.qZA()()),2&o&&(e.xp6(2),e.Q6J("nzType","primary"),e.xp6(2),e.Q6J("ngIf",n.isAddNew),e.xp6(2),e.Q6J("rows",n.rows)("columns",n.configTable.columns||e.DdM(9,He))("headerHeight",n.configTable.headerHeight||50)("columnMode","force")("rowHeight",n.configTable.rowHeight||50)("scrollbarH",!0)("loadingIndicator",n.loadingIndicator))},dependencies:[w.u,p.UX,z.X0,z.T7,_.sL,_.ix,O.w,N.dQ,P.xD,P.nE,x.O5,C.PV],encapsulation:2,changeDetection:0})}return i})();var Be=a(6991),Ge=a(9691),je=a(5024),$=a(6109),Ve=a(331),Ye=a(9388),Xe=a(3651),Ke=a(8324),qe=a(5448),We=a(4300),$e=a(6969);let st=(()=>{class i{static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275mod=e.oAB({type:i});static#o=this.\u0275inj=e.cJS({imports:[Ye.vT,x.ez,_.sL,Xe.U8,$e.YI,C.PV,Ke.T,qe.e4,Ve.g,$.cg,We.rt]})}return i})();var re=a(2962),ae=a(6987);let se=(()=>{class i{ngOnInit(){this.product.created_at&&(this.product.created_at_format=L(this.product.created_at).format("DD/MM/YYYY HH:mm"),this.product.updated_at_format=L(this.product.updated_at).format("DD/MM/YYYY HH:mm"))}static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["icom-libs-product-detail-history"]],inputs:{product:"product"},standalone:!0,features:[e.jDz],decls:20,vars:6,consts:[["nzTitle","L\u1ecbch s\u1eed c\u1eadp nh\u1eadt",2,"width","300px"],[2,"color","#8b8b8b"],["nzType","vertical"]],template:function(o,n){1&o&&(e.TgZ(0,"nz-card",0)(1,"p")(2,"span",1),e._uU(3,"T\xe0i kho\u1ea3n t\u1ea1o:\xa0"),e.qZA(),e._uU(4),e.qZA(),e._UZ(5,"nz-divider",2),e.TgZ(6,"p")(7,"span",1),e._uU(8,"Th\u1eddi gian t\u1ea1o:\xa0"),e.qZA(),e._uU(9),e.qZA(),e._UZ(10,"nz-divider",2),e.TgZ(11,"p")(12,"span",1),e._uU(13,"T\xe0i kho\u1ea3n c\u1eadp nh\u1eadt cu\u1ed1i:\xa0"),e.qZA(),e._uU(14),e.qZA(),e._UZ(15,"nz-divider",2),e.TgZ(16,"p")(17,"span",1),e._uU(18,"Th\u1eddi gian c\u1eadp nh\u1eadt cu\u1ed1i:\xa0"),e.qZA(),e._uU(19),e.qZA()()),2&o&&(e.xp6(4),e.AsE(" [",null==n.product||null==n.product.creator_info?null:n.product.creator_info.customer_id,"] ",null==n.product||null==n.product.creator_info?null:n.product.creator_info.full_name," "),e.xp6(5),e.hij(" ",(null==n.product?null:n.product.created_at_format)||(null==n.product?null:n.product.created_at),""),e.xp6(5),e.AsE(" [",null==n.product||null==n.product.updater_info?null:n.product.updater_info.customer_id,"] ",null==n.product||null==n.product.updater_info?null:n.product.updater_info.full_name,""),e.xp6(5),e.hij(" ",(null==n.product?null:n.product.updated_at_format)||(null==n.product?null:n.product.updated_at),""))},dependencies:[re.vh,re.bd,ae.S,ae.g],encapsulation:2})}return i})();function lt(i,d){if(1&i&&e._UZ(0,"icom-libs-product-detail-history",10),2&i){const t=e.oxw();e.Q6J("product",t.product)}}function ct(i,d){1&i&&(e.TgZ(0,"div",11),e.Hsn(1),e.qZA())}const dt=function(){return{$implicit:"Icon"}},pt=function(){return{"background-color":"#ffffff",color:"black"}},mt=["*"];let ut=(()=>{class i{constructor(t,o){this.viewContainerRef=t,this.componentFactoryResolver=o,this.popupComponentRef=null,this.popupCondition=!0}ngOnInit(){}handlerToggleCollapse(){this.hidden=!this.hidden}loadPopupComponent(){const t=this.componentFactoryResolver.resolveComponentFactory(se);this.popupComponentRef=this.viewContainerRef.createComponent(t),this.popupComponent=this.popupComponentRef.instance}handlePopupConfirm(){console.log("Popup confirmed")}handlePopupCancel(){console.log("Popup canceled")}static#e=this.\u0275fac=function(o){return new(o||i)(e.Y36(e.s_b),e.Y36(e._Vd))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["icom-libs-product-detail-template"]],inputs:{hidden:"hidden",title:"title",product:"product"},standalone:!0,features:[e.jDz],ngContentSelectors:mt,decls:13,vars:10,consts:[[1,"w-full","bg-white","rounded-md","border","p-4"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-semibold","m-0"],[1,"flex","items-center"],["nz-tooltip","",3,"nzTooltipTitle","nzTooltipTitleContext","nzTooltipColor","nzTooltipOverlayStyle"],["nz-icon","","nzType","clock-circle","nzTheme","outline",1,"font-normal"],["titleTemplate",""],[1,"ml-4","items-center","flex",3,"click"],["nz-icon","",1,"ml-2",3,"nzType"],["class","mt-4",4,"ngIf"],[3,"product"],[1,"mt-4"]],template:function(o,n){if(1&o&&(e.F$t(),e.TgZ(0,"div",0)(1,"div",1)(2,"h4",2),e._uU(3),e.qZA(),e.TgZ(4,"div",3)(5,"span",4),e._UZ(6,"span",5),e.qZA(),e.YNc(7,lt,1,1,"ng-template",null,6,e.W1O),e.TgZ(9,"a",7),e.NdJ("click",function(){return n.handlerToggleCollapse()}),e._uU(10),e._UZ(11,"span",8),e.qZA()()(),e.YNc(12,ct,2,0,"div",9),e.qZA()),2&o){const r=e.MAs(8);e.xp6(3),e.hij("",n.title," "),e.xp6(2),e.Q6J("nzTooltipTitle",r)("nzTooltipTitleContext",e.DdM(8,dt))("nzTooltipColor","#ffffff")("nzTooltipOverlayStyle",e.DdM(9,pt)),e.xp6(5),e.hij(" ",n.hidden?"Thu g\u1ecdn":"M\u1edf r\u1ed9ng"," "),e.xp6(1),e.Q6J("nzType",n.hidden?"up":"down"),e.xp6(1),e.Q6J("ngIf",n.hidden)}},dependencies:[C.PV,C.Ls,x.O5,st,$.cg,$.SY,se],encapsulation:2})}return i})();var ft=a(8645),Y=a(7921),X=a(3997),le=a(6328),ht=a(8111),ce=a(95);function gt(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"div",7)(1,"button",8),e.NdJ("click",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r.handlerSave(n))}),e._uU(2," L\u01b0u "),e.qZA(),e.TgZ(3,"button",9),e.NdJ("click",function(n){e.CHM(t);const r=e.oxw(2);return e.KtG(r.handlerCancel(n))}),e._uU(4," \u0110\xf3ng "),e.qZA()()}if(2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("action","edit")("nzLoading",t.isLoading)("nzType","primary"),e.xp6(2),e.Q6J("action","edit")}}function _t(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"div",7)(1,"button",10),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.toggleDisabled())}),e._uU(2," S\u1eeda "),e.qZA()()}2&i&&(e.xp6(1),e.Q6J("action","edit")("nzType","primary"))}function vt(i,d){if(1&i&&(e.TgZ(0,"div",1)(1,"div",2)(2,"form",3),e._UZ(3,"formly-form",4),e.TgZ(4,"div",5),e.YNc(5,gt,5,4,"div",6),e.YNc(6,_t,3,2,"div",6),e.qZA()()()()),2&i){const t=e.oxw();e.xp6(2),e.Q6J("formGroup",t.form)("nzLayout","vertical"),e.xp6(1),e.Q6J("model",t.model)("fields",t.fields)("options",t.options)("form",t.form),e.xp6(2),e.Q6J("ngIf",!(null!=t.options&&null!=t.options.formState&&t.options.formState.disabled)),e.xp6(1),e.Q6J("ngIf",null==t.options||null==t.options.formState?null:t.options.formState.disabled)}}let Ct=(()=>{class i{constructor(){this.form=new p.cw({}),this.options={formState:{disabled:!0}},this.fields=[],this.listFields=[],this.subject=new ft.x,this.campaignService=(0,e.f3M)(T.wb),this.iComLibsServicesProductCardService=(0,e.f3M)(T.Oz),this.IComMessageService=(0,e.f3M)(k.Q),this.cdr=(0,e.f3M)(e.sBO)}ngOnInit(){var t=this;return(0,g.Z)(function*(){t.iComLibsServicesProductCardService.getListField().pipe((0,M.U)(o=>o.data.map(n=>({...n})))).subscribe(o=>{t.listFields=o,t.setField(),t.cdr.detectChanges()});try{t.loadingIndicator=!0;const o=yield(0,v.n)(t.iComLibsServicesProductCardService.getRegisterForm(t.product?.id||""));t.model=o?.data,t.setField();const n=t.model?.form_registration?.input_required?.map(r=>r.id);t.model.form_registration.input_required=n,t.modelOrigin=(0,A.cloneDeep)(t.model)}catch(o){t.IComMessageService.showAlertMessageError(o?.error?.error_message)}finally{t.loadingIndicator=!1,t.cdr.detectChanges()}})()}setField(){var n,t=this;if(this.fields=[{key:"form_registration",type:"",props:{label:"Hi\u1ec3n th\u1ecb form \u0111\u0103ng k\xfd",changeChecked:(n,r)=>{const s=r.fieldGroup.find(m=>"checked"===m.key);this.subject.next(!!n),console.log("vo"),s.model.checked=n},setChecked:n=>n?.fieldGroup?.find(s=>"checked"===s.key)?.model?.checked},expressions:{"props.readonly":"formState.disabled"},wrappers:["collapse"],fieldGroup:[{key:"checked",defaultValue:!1,type:"checkbox",className:"hidden"},{key:"input_required",type:"select-custom",props:{label:"Form input required",placeholder:"Ch\u1ecdn Form input required",viewValue:"title",labelProp:"title",valueProp:"id",multiple:!0,required:!0,options:this.listFields,change:(n=(0,g.Z)(function*(r,s){const m=yield(0,v.n)(t.iComLibsServicesProductCardService.getListField());m&&m.data.find(J=>s?.includes(J.id))}),function(s,m){return n.apply(this,arguments)}),changeCheckbox:function(){var n=(0,g.Z)(function*(r,s){const m=t.listFields;if(m){const S=m.find(J=>"PHONE_NUMBER"===J.code);if(!S)return;S.enable_edit=s}});return function(s,m){return n.apply(this,arguments)}}()},expressions:{"props.disabled":"formState.disabled"}},{key:"click_action_type",type:"select-custom",className:"basis-6/12",props:{label:"\u0110i\u1ec1u h\u01b0\u1edbng call to action",placeholder:"Ch\u1ecdn \u0110i\u1ec1u h\u01b0\u1edbng call to action",viewValue:"title",labelProp:"title",valueProp:"id",required:!0,options:this.campaignService.getListActionType().pipe((0,M.U)(n=>n.data))},expressions:{"props.disabled":"formState.disabled"},hooks:{onInit:n=>{const r=n.formControl?.parent,s=r?.get("click_action_type");s&&s.valueChanges.pipe((0,Y.O)(s.value),(0,X.x)()).subscribe(m=>{n?.props?.options instanceof W.y&&n?.props?.options.subscribe(S=>{const J=S.find(ee=>ee.id===m),Q=r?.get("specific_type_click_action_selected");Q&&Q.setValue("input"===J?.type?"input":"select")})})}}},{key:"specific_type_click_action_selected",defaultValue:"",className:"hidden",type:"input"},{key:"click_action_param",type:"select-custom",className:"basis-6/12",hideExpression:(n,r,s)=>"input"===s?.parent?.model.specific_type_click_action_selected,props:{label:"Tham s\u1ed1 \u0111i\u1ec1u h\u01b0\u1edbng",placeholder:"Ch\u1ecdn Tham s\u1ed1 \u0111i\u1ec1u h\u01b0\u1edbng",options:[],viewValue:"title",labelProp:"title",valueProp:"id"},expressions:{"props.disabled":"formState.disabled"},hooks:{onInit:n=>{const r=n?.form?.get("click_action_type");r&&(n.templateOptions.options=r.valueChanges.pipe((0,Y.O)(r.value),(0,X.x)(),(0,le.b)(s=>this.campaignService.getListActionParam(s).pipe((0,M.U)(m=>(m.data.find(S=>n?.model?.click_action_param===S.id)||n.formControl.setValue(null),m.data))))))}}}]},{key:"form_confirm",type:"",expressions:{"props.readonly":"formState.disabled"},hooks:{onInit:n=>{this.subject.subscribe(r=>{n.props&&(n.props.readonly=!r)})}},props:{label:"Hi\u1ec3n th\u1ecb form x\xe1c nh\u1eadn",changeChecked:(n,r)=>{const s=r.fieldGroup.find(m=>"checked"===m.key);console.log(s),s.model.checked=n},setChecked:n=>n?.fieldGroup?.find(s=>"checked"===s.key)?.model?.checked},wrappers:["collapse"],fieldGroup:[{key:"checked",defaultValue:!1,type:"checkbox",className:"hidden"},{key:"click_action_type",type:"select-custom",className:"basis-6/12",props:{label:"\u0110i\u1ec1u h\u01b0\u1edbng call to action",placeholder:"Ch\u1ecdn \u0110i\u1ec1u h\u01b0\u1edbng call to action",viewValue:"title",labelProp:"title",valueProp:"id",required:!0,options:this.campaignService.getListActionType().pipe((0,M.U)(n=>n.data))},expressions:{"props.disabled":"formState.disabled"},hooks:{onInit:n=>{const r=n.formControl?.parent,s=r?.get("click_action_type");s&&s.valueChanges.pipe((0,Y.O)(s.value),(0,X.x)()).subscribe(m=>{n?.props?.options instanceof W.y&&n?.props?.options.subscribe(S=>{const J=S.find(ee=>ee.id===m),Q=r?.get("specific_type_click_action_selected");Q&&Q.setValue("input"===J?.type?"input":"select")})})}}},{key:"specific_type_click_action_selected",defaultValue:"",className:"hidden",type:"input"},{key:"click_action_param",hideExpression:(n,r,s)=>"input"!==s?.parent?.model.specific_type_click_action_selected,type:"input",className:"basis-6/12",props:{label:"Gi\xe1 tr\u1ecb Tham s\u1ed1 \u0111i\u1ec1u h\u01b0\u1edbng",placeholder:"Nh\u1eadp gi\xe1 tr\u1ecb"},expressions:{"props.disabled":"formState.disabled"}},{key:"click_action_param",type:"select-custom",className:"basis-6/12",hideExpression:(n,r,s)=>"input"===s?.parent?.model.specific_type_click_action_selected,props:{label:"Tham s\u1ed1 \u0111i\u1ec1u h\u01b0\u1edbng",placeholder:"Ch\u1ecdn Tham s\u1ed1 \u0111i\u1ec1u h\u01b0\u1edbng",options:[],viewValue:"title",labelProp:"title",valueProp:"id"},expressions:{"props.disabled":"formState.disabled"},hooks:{onInit:n=>{const r=n?.form?.get("click_action_type");r&&(n.templateOptions.options=r.valueChanges.pipe((0,Y.O)(r.value),(0,X.x)(),(0,le.b)(s=>this.campaignService.getListActionParam(s).pipe((0,M.U)(m=>(m.data.find(S=>n?.model?.click_action_param===S.id)||n.formControl.setValue(null),m.data))))))}}}]}],!this.model?.form_registration?.input_required)return;const o=this.model?.form_registration?.input_required;this.listFields=this.listFields.map(n=>{let r;return console.log(o),o.forEach(s=>{s.code===n?.code&&(r=n,r.enable_edit=s.enable_edit)}),r||n})}handlerSave(t){var o=this;return(0,g.Z)(function*(){t.stopPropagation(),t.preventDefault();try{if(o.form.invalid)return void(0,ht.c2)(o.form);o.isLoading=!0,o.cdr.detectChanges(),o.form.markAsTouched(),o.form.submitted=!0;const n=(0,A.cloneDeep)(o.model);n.form_registration.input_required=o.listFields?.filter(r=>o.model?.form_registration.input_required?.includes(r?.id)),yield(0,v.n)(o.iComLibsServicesProductCardService.updateRegisterForm(o.product?.id||0,n)),o.modelOrigin=(0,A.cloneDeep)(o.model),o.IComMessageService.showAlertMessageDone("S\u1eeda gi\xe1 s\u1ea3n ph\u1ea9m th\xe0nh c\xf4ng."),o.toggleDisabled()}catch(n){o.IComMessageService.showAlertMessageError(n?.error?.error_message)}finally{o.isLoading=!1,o.cdr.detectChanges()}})()}handlerCancel(t){t.stopPropagation(),t.preventDefault(),this.toggleDisabled(),this.form.reset(this.modelOrigin)}toggleDisabled(){this.options.formState.disabled=!this.options.formState.disabled}static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["icom-libs-product-detail-other"]],inputs:{product:"product"},standalone:!0,features:[e.jDz],decls:1,vars:1,consts:[["class","w-full h-full flex",4,"ngIf"],[1,"w-full","h-full","flex"],[1,"flex","w-full","h-full","flex-col","bg-white","border","rounded-md"],["nz-form","",1,"bg-white","rounded-md","h-full","flex","flex-col","!p-4","overflow-y-auto",3,"formGroup","nzLayout"],[3,"model","fields","options","form"],["nz-row","",1,"p-4","border"],["nz-col","","class","search-area flex",4,"ngIf"],["nz-col","",1,"search-area","flex"],["icomLibsHasPermissionDirective","","nz-button","",3,"action","nzLoading","nzType","click"],["icomLibsHasPermissionDirective","","nz-button","",1,"ml-4",3,"action","click"],["icomLibsHasPermissionDirective","","nz-button","",3,"action","nzType","click"]],template:function(o,n){1&o&&e.YNc(0,vt,7,8,"div",0),2&o&&e.Q6J("ngIf",n.listFields&&(null==n.listFields?null:n.listFields.length))},dependencies:[w.u,p.UX,p._Y,p.JL,p.sg,z.X0,z.T7,_.sL,_.ix,O.w,N.dQ,P.xD,x.O5,C.PV,U.cS,b.j,E.E,D.U5,ce.t3,ce.SK,D.Lr],encapsulation:2})}return i})();function zt(i,d){if(1&i&&(e.TgZ(0,"nz-page-header-title"),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Oqu(t.product.name||"")}}function bt(i,d){if(1&i&&e._UZ(0,"icom-libs-product-detail-inventory",15),2&i){const t=e.oxw(2);e.Q6J("product",t.product)}}function yt(i,d){if(1&i&&e._UZ(0,"icom-libs-inventory-items-list",21),2&i){const t=e.oxw(2);e.Q6J("inventoryId",-1)("hiddenImport",!1)("productId",t.product.id||0)}}function xt(i,d){if(1&i&&e._UZ(0,"icom-libs-product-detail-other",15),2&i){const t=e.oxw(2);e.Q6J("product",t.product)}}function Tt(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"nz-page-header-footer",4)(1,"div",5)(2,"nz-tabset",6)(3,"nz-tab",7)(4,"div",8)(5,"div",9)(6,"icom-libs-product-detail-template",10)(7,"icom-libs-product-detail-general",11),e.NdJ("icomSave",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.handlerIcomSave(n))}),e.qZA()()(),e.TgZ(8,"div",9)(9,"div",12)(10,"div",13)(11,"icom-libs-product-detail-template",14),e._UZ(12,"icom-libs-product-detail-language",15),e.qZA()(),e.TgZ(13,"div",16)(14,"icom-libs-product-detail-template",14),e._UZ(15,"icom-libs-product-detail-price",15),e.qZA()()()(),e.TgZ(16,"div",9)(17,"icom-libs-product-detail-template",14),e._UZ(18,"icom-libs-product-detail-media",15),e.qZA()()()(),e.TgZ(19,"nz-tab",17),e.YNc(20,bt,1,1,"ng-template",18),e.qZA(),e.TgZ(21,"nz-tab",19),e.YNc(22,yt,1,3,"ng-template",18),e.qZA(),e.TgZ(23,"nz-tab",20),e.YNc(24,xt,1,1,"ng-template",18),e.qZA()()()()}if(2&i){const t=e.oxw();e.xp6(2),e.Q6J("nzSelectedIndex",0),e.xp6(4),e.Q6J("hidden",!0)("product",t.productTemp)("title","Th\xf4ng tin chung"),e.xp6(1),e.Q6J("product",t.productTemp),e.xp6(4),e.Q6J("product",t.productTemp)("title","Th\xf4ng tin chi ti\u1ebft"),e.xp6(1),e.Q6J("product",t.product),e.xp6(2),e.Q6J("product",t.productTemp)("title","Thanh to\xe1n"),e.xp6(1),e.Q6J("product",t.product),e.xp6(2),e.Q6J("product",t.productTemp)("title","H\xecnh \u1ea3nh"),e.xp6(1),e.Q6J("product",t.product)}}function Pt(i,d){1&i&&(e.TgZ(0,"div",22),e._UZ(1,"nz-spin",23),e.qZA())}let It=(()=>{class i{constructor(t,o){this.route=t,this.router=o,this.productId="",this.productService=(0,e.f3M)(T.k),this.cdr=(0,e.f3M)(e.sBO),this.location=(0,e.f3M)(x.Ye),this.backClicked=new e.vpe,this.saveClicked=new e.vpe,this.options={gridType:"fit",compactType:"compactUp+compactLeft",margin:10,outerMargin:!0,outerMarginTop:null,outerMarginRight:null,outerMarginBottom:null,outerMarginLeft:null,useTransformPositioning:!0,mobileBreakpoint:640,minCols:1,maxCols:4,minRows:1,maxRows:100,maxItemCols:100,minItemCols:1,maxItemRows:100,minItemRows:1,maxItemArea:2500,minItemArea:1,defaultItemCols:1,defaultItemRows:1,fixedColWidth:105,fixedRowHeight:105,keepFixedHeightInMobile:!1,scrollSensitivity:10,scrollSpeed:20,initCallback:void 0,dragEnabled:!0,resizeEnabled:!0,pushItems:!0,swap:!0,pushDirections:{pushOff:!0,enabled:!0},displayGrid:"onDragAndResize",disableWindowResize:!1,disableWarnings:!1,scrollToNewItems:!1},this.itemConfig1={cols:2,rows:2,y:0,x:0},this.itemConfig2={cols:2,rows:2,y:0,x:2},this.itemConfig3={cols:2,rows:1,y:1,x:0},this.itemConfig4={cols:2,rows:2,y:1,x:2},this.handleRouterChange()}handleRouterChange(){this.router.events.subscribe(()=>{const t=this.route.snapshot.params.id;t&&(this.productId=t,this.isRouter=!0,this.callApi())}),setTimeout(()=>{this.productId||this.handleLocationPathChange()},500)}handleLocationPathChange(){const o=this.location.path().split("/").pop();o&&(this.productId=o,this.callApi())}callApi(){var t=this;return(0,g.Z)(function*(){try{t.product=yield(0,v.n)(t.productService.getProduct(t.productId)),t.productTemp=(0,A.cloneDeep)(t.product),t.cdr.detectChanges()}catch(o){console.log(o)}})()}handlerNzBack(){this.isRouter?this.router.navigateByUrl("product/card"):(this.isAdd?this.backClicked.emit(this.product):this.backClicked.emit(),this.location.replaceState("product/card"))}handlerIcomSave(t){this.saveClicked.emit(t)}static#e=this.\u0275fac=function(o){return new(o||i)(e.Y36(V.gz),e.Y36(V.F0))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["icom-libs-product-detail"]],outputs:{backClicked:"backClicked",saveClicked:"saveClicked"},standalone:!0,features:[e.jDz],decls:4,vars:3,consts:[["nzBackIcon","",1,"site-page-header","h-full","w-full","flex","flex-col",2,"position","absolute","top","0","left","250px","width","calc(100% - 250px)","background","#f0f2f5","height","100%","overflow","hidden",3,"nzBack"],[4,"ngIf"],["class","w-full h-full","style","height: calc(100% - 68px) !important",4,"ngIf"],["class","loading-container absolute left-1/2","style","top: 50%;",4,"ngIf"],[1,"w-full","h-full",2,"height","calc(100% - 68px) !important"],[1,"w-full","h-full"],[3,"nzSelectedIndex"],["nzTitle","Th\xf4ng tin chung"],[1,"w-full","flex","flex-col"],[1,"w-full","p-2"],[3,"hidden","product","title"],[3,"product","icomSave"],[1,"flex","w-full","h-full"],[1,"w-50",2,"width","50%"],[3,"product","title"],[3,"product"],[1,"w-50","pl-4",2,"width","50%"],["nzTitle","Kho"],["nz-tab",""],["nzTitle","Danh s\xe1ch item"],["nzTitle","Th\xf4ng tin b\u1ed5 sung"],[3,"inventoryId","hiddenImport","productId"],[1,"loading-container","absolute","left-1/2",2,"top","50%"],["nzSize","large"]],template:function(o,n){1&o&&(e.TgZ(0,"nz-page-header",0),e.NdJ("nzBack",function(){return n.handlerNzBack()}),e.YNc(1,zt,2,1,"nz-page-header-title",1),e.YNc(2,Tt,25,14,"nz-page-header-footer",2),e.qZA(),e.YNc(3,Pt,2,0,"div",3)),2&o&&(e.xp6(1),e.Q6J("ngIf",n.product&&n.product.id),e.xp6(1),e.Q6J("ngIf",n.product&&n.product.id),e.xp6(1),e.Q6J("ngIf",!n.product||!n.product.id))},dependencies:[P.xD,w.u,p.UX,z.X0,_.sL,D.U5,B.ZJ,Z.KJ,Z.$O,Z.u9,Z.$,F.zf,H.we,H.xH,H.xw,H.cj,C.PV,j,u,x.O5,Ct,ze,Ee,Re,Be.IcomLibInventoryListItemsComponent,b.j,b.W,Ge.LV,je.IX,ut],styles:["[_nghost-%COMP%]     nz-tabset .ant-tabs-tabpane{overflow:auto;height:100%}"],changeDetection:0})}return i})()},8658:(de,G,a)=>{a.d(G,{B:()=>q});var g=a(5861),e=a(5879),p=a(6223),z=a(4729),w=a(5545),P=a(19),_=a(2840),D=a(7398),x=a(7921),B=a(3997),Z=a(6328),F=a(9397),C=a(708),T=a(9717),K=a(6814),L=a(6990),j=a(3599),k=a(3304),A=a(8111),M=a(855),v=a(1958),b=a(95);function E(h,R){if(1&h){const l=e.EpF();e.TgZ(0,"div",5)(1,"button",6),e.NdJ("click",function(c){e.CHM(l);const f=e.oxw(2);return e.KtG(f.handlerSave(c))}),e._uU(2," L\u01b0u "),e.qZA(),e.TgZ(3,"button",7),e.NdJ("click",function(c){e.CHM(l);const f=e.oxw(2);return e.KtG(f.handlerCancel(c))}),e._uU(4,"\u0110\xf3ng"),e.qZA()()}if(2&h){const l=e.oxw(2);e.xp6(1),e.Q6J("nzType","primary")("nzLoading",l.isLoading)}}function O(h,R){if(1&h){const l=e.EpF();e.TgZ(0,"div",5)(1,"button",6),e.NdJ("click",function(){e.CHM(l);const c=e.oxw(2);return e.KtG(c.toggleDisabled())}),e._uU(2," S\u1eeda "),e.qZA()()}if(2&h){const l=e.oxw(2);e.xp6(1),e.Q6J("nzType","primary")("nzLoading",l.isLoading)}}function N(h,R){if(1&h&&(e.TgZ(0,"div",3),e.YNc(1,E,5,2,"div",4),e.YNc(2,O,3,2,"div",4),e.qZA()),2&h){const l=e.oxw();e.xp6(1),e.Q6J("ngIf",!(null!=l.options&&null!=l.options.formState&&l.options.formState.disabled)),e.xp6(1),e.Q6J("ngIf",null==l.options||null==l.options.formState?null:l.options.formState.disabled)}}let q=(()=>{class h{constructor(){this.form=new p.cw({}),this.options={formState:{disabled:!0}},this.fields=[],this.icomSave=new e.vpe,this.productService=(0,e.f3M)(z.k),this.cardService=(0,e.f3M)(z.Oz),this.iComMessageService=(0,e.f3M)(T.Q),this.destroyRef=(0,e.f3M)(e.ktI),this.changeDetectorRef=(0,e.f3M)(e.sBO),this.model={}}ngOnInit(){this.fields=((h,R)=>[{fieldGroupClassName:"flex row items-center",key:"",fieldGroup:[{key:"name",type:"input",className:"w-full",props:{label:"T\xean s\u1ea3n ph\u1ea9m",placeholder:"T\xean s\u1ea3n ph\u1ea9m",type:"string",required:!0},expressions:{"props.disabled":"formState.disabled"}},{key:"items",type:"input-custom",className:"w-[200px] ml-4",props:{label:"S\u1ed1 item t\u1ed1i \u0111a/ giao d\u1ecbch",placeholder:"S\u1ed1 item t\u1ed1i \u0111a/ giao d\u1ecbch",type:"string",disabled:!0,readonly:!0},defaultValue:1,expressions:{"props.disabled":"formState.disabled"}}]},{fieldGroupClassName:"flex row items-center",key:"",fieldGroup:[{key:"code",type:"input",className:"basis-1/2",props:{label:"Code",placeholder:"Code",type:"string",required:!0},expressions:{"props.disabled":l=>"GENCODE_TYPE_FROM_3RD_PARTY"===l.model?.gen_code_type||R.disabled}},{key:"status",type:"select-custom",className:"basis-1/2 ml-4",expressions:{"props.disabled":"formState.disabled"},defaultValue:0,props:{label:"Tr\u1ea1ng th\xe1i",viewValue:"name",labelProp:"name",search:!0,placeholder:"Tr\u1ea1ng th\xe1i",valueProp:"int_value",required:!0,options:h.getOptionType("PRODUCT_STATUS").pipe((0,D.U)(l=>l?.data))}}]},{fieldGroupClassName:"flex row items-center",key:"",fieldGroup:[{key:"start_time",className:"w-[300px]",type:"date",props:{required:!0,label:"B\u1eaft \u0111\u1ea7u hi\u1ec3n th\u1ecb",placeholder:"Ch\u1ecdn th\u1eddi gian",ShowTime:!0,format:"dd-MM-yyyy HH:mm"},expressions:{"props.disabled":"formState.disabled"}},{key:"end_time",className:"w-[300px]",type:"date",props:{label:"K\u1ebft th\xfac hi\u1ec3n th\u1ecb",ShowTime:!0,placeholder:"Ch\u1ecdn th\u1eddi gian",format:"dd-MM-yyyy HH:mm"},expressions:{"props.disabled":"formState.disabled"}}]},{className:"section-label",template:'<hr class="my-4"/>'},{fieldGroupClassName:"flex row items-center",key:"",fieldGroup:[{key:"category_ids",type:"select-custom",className:"basis-1/2",props:{label:"Danh m\u1ee5c",placeholder:"Danh m\u1ee5c",viewValue:"name",labelProp:"name",valueProp:"id",multiple:!0,options:h.getCategoryForSelect().pipe((0,D.U)(l=>l?.data?.items))},expressions:{"props.disabled":"formState.disabled"}},{key:"group_ids",type:"select-custom",className:"basis-1/2 ml-4",props:{label:"Hi\u1ec3n th\u1ecb tr\xean app",placeholder:"Hi\u1ec3n th\u1ecb tr\xean app",viewValue:"name",multiple:!0,labelProp:"name",valueProp:"id",required:!0,options:h.getGroupForSelect().pipe((0,D.U)(l=>l?.data?.items))},expressions:{"props.disabled":"formState.disabled"}}]},{key:"organization_id",type:"select-custom",props:{label:"\u0110\u1ed1i t\xe1c",placeholder:"\u0110\u1ed1i t\xe1c",required:!0,valueProp:"id",labelProp:"name",options:h.getOrg().pipe((0,D.U)(l=>l?.data))},expressions:{"props.disabled":"formState.disabled"}},{key:"brand_id",type:"select-custom",props:{label:"Th\u01b0\u01a1ng hi\u1ec7u",options:[],required:!0,placeholder:"Th\u01b0\u01a1ng hi\u1ec7u",valueProp:"id",labelProp:"name"},expressions:{"props.disabled":"formState.disabled"},hooks:{onInit:l=>{const u=l.parent.get("organization_id").formControl;l.props.options=u.valueChanges.pipe((0,x.O)(u.value),(0,B.x)(),(0,Z.b)(c=>c?h.getBrandByOrg(c).pipe((0,D.U)(f=>{const I=f?.data?.find(y=>l?.model?.brand_id===y.id);return l.parent.model.specific_brands_object=f?.data||[],I||(l.formControl.setValue(null),l.parent.get("store_ids").formControl?.setValue(null)),f?.data||[]})):(l.parent.get("store_ids").formControl?.setValue(null),l.parent.get("brand_id").formControl?.setValue(null),[])))}}},{key:"store_ids",type:"select-custom",props:{label:"Chi nh\xe1nh",placeholder:"Chi nh\xe1nh",viewValue:"name",labelProp:"name",valueProp:"id",multiple:!0},expressions:{"props.disabled":"formState.disabled"},hooks:{onInit:l=>{const u=l.parent.get("brand_id").formControl;l.props.options=u.valueChanges.pipe((0,x.O)(u.value),(0,B.x)(),(0,F.b)(c=>{const f=l.parent?.model?.specific_brands_object?.find(y=>y.id===c);l.parent.model.brand_code=f?f.code:null}),(0,Z.b)(c=>{if(!c)return l.formControl.setValue([]),l.parent.model.brand_code="",[];const f=l.parent?.model?.specific_brands_object?.find(y=>y.id===c);return l.parent.model.brand_code=f?f.code:null,h.getStoreByBrand(c).pipe((0,D.U)(y=>(y?.data?.find(U=>l?.model?.store_ids?.includes(U.id))||l.formControl.setValue([]),y?.data||[])))}))}}}])(this.productService,this.options.formState),this.model&&this.model.catalog_ids&&this.model.catalog_ids?.length&&(this.model.catalog_ids=this.model.catalog_ids[0]),this.modelOrigin=(0,L.cloneDeep)(this.model),this.isAdd&&this.toggleDisabled(),setTimeout(()=>{this.form.controls.gen_code_type?.valueChanges.pipe((0,B.x)(),(0,D.U)(()=>{this.form.reset(this.model)})).subscribe()},200)}handlerSave(l,u){var c=this;return(0,g.Z)(function*(){if(l?.stopPropagation(),l?.preventDefault(),c.form.valid)try{if(c.model?.start_time&&c.model?.end_time&&k(c.model?.end_time).isBefore(c.model?.start_time))return void c.iComMessageService.showAlertMessageError("Th\u1eddi gian k\u1ebft th\xfac kh\xf4ng \u0111\u01b0\u1ee3c nh\u1ecf h\u01a1n th\u1eddi gian b\u1eaft \u0111\u1ea7u.");c.form.markAsTouched(),c.form.submitted=!0,u&&u.isLoading&&u.isLoading();const f=(0,L.cloneDeep)(c.model);if(f&&f.catalog_ids&&(f.catalog_ids=[f.catalog_ids]),c.isLoading=!0,c.model=(0,A.oS)(c.model,"specific"),c.isAdd){const I=yield(0,C.n)(c.cardService.createProduct(f));c.icomSave.emit(I?.data),u&&u.success&&u.success(I?.data?.id),c.iComMessageService.showAlertMessageDone("T\u1ea1o s\u1ea3n ph\u1ea9m th\xe0nh c\xf4ng")}else{const I=yield(0,C.n)(c.cardService.updateProduct(c.model?.id||0,f));u&&u.success&&u.success(),c.icomSave.emit(I?.data),c.iComMessageService.showAlertMessageDone("S\u1eeda s\u1ea3n ph\u1ea9m th\xe0nh c\xf4ng"),c.modelOrigin=(0,L.cloneDeep)(c.model),c.toggleDisabled()}}catch(f){u&&u.loadDone&&u.loadDone(),c.iComMessageService.showAlertMessageError(f?.error?.error_message||"T\u1ea1o s\u1ea3n ph\u1ea9m th\u1ea5t b\u1ea1i")}finally{u&&u.loadDone&&u.loadDone(),c.isLoading=!1,c.changeDetectorRef.detectChanges()}else Object.keys(c.form.controls).forEach(f=>{c.form.controls[f].touched=!0})})()}toggleDisabled(){this.options.formState.disabled=!this.options.formState.disabled}handlerCancel(l){l.stopPropagation(),this.toggleDisabled(),this.model=(0,L.cloneDeep)(this.modelOrigin)}static#e=this.\u0275fac=function(u){return new(u||h)};static#t=this.\u0275cmp=e.Xpm({type:h,selectors:[["icom-libs-product-add_edit"]],inputs:{model:"model",isAdd:"isAdd"},outputs:{icomSave:"icomSave"},standalone:!0,features:[e.jDz],decls:3,vars:7,consts:[["nz-form","",1,"pb-4","bg-white","border","rounded-md","h-full","flex","flex-col",3,"formGroup","nzLayout"],[1,"overflow-auto","px-4","pt-4",3,"model","fields","options","form"],["nz-row","","class","p-4 border",4,"ngIf"],["nz-row","",1,"p-4","border"],["nz-col","","class","search-area flex",4,"ngIf"],["nz-col","",1,"search-area","flex"],["nz-button","",3,"nzType","nzLoading","click"],["nz-button","",1,"ml-4",3,"click"]],template:function(u,c){1&u&&(e.TgZ(0,"form",0),e._UZ(1,"formly-form",1),e.YNc(2,N,3,2,"div",2),e.qZA()),2&u&&(e.Q6J("formGroup",c.form)("nzLayout","vertical"),e.xp6(1),e.Q6J("model",c.model)("fields",c.fields)("options",c.options)("form",c.form),e.xp6(1),e.Q6J("ngIf",c.model&&c.model.id))},dependencies:[P.u,p.UX,p._Y,p.JL,p.sg,w.X0,w.T7,_.sL,_.ix,M.w,v.dQ,K.O5,j.U5,b.t3,b.SK,j.Lr],encapsulation:2,changeDetection:0})}return h})()}}]);