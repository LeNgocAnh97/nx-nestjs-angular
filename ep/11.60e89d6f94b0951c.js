"use strict";(self.webpackChunkicom=self.webpackChunkicom||[]).push([[11],{1011:(D,p,o)=>{o.r(p),o.d(p,{IComLibsCampaignStatisticModule:()=>O});var u=o(2962),c=o(6814),T=o(2787),f=o(5861),n=o(5879),r=o(6223),b=o(9717),g=o(4729),R=o(6990),Z=o(5592),I=o(7398),h=o(708),w=o(3460),z=o(5545),C=o(1394),v=o(2840),F=o(855),A=o(1958),y=o(2996),L=o(95),S=o(3599),d=o(6556);function B(i,m){1&i&&n._UZ(0,"span",20)}const M=function(){return{color:"#3F8600"}},P=function(){return{color:"#CF1322"}};function U(i,m){if(1&i&&(n.TgZ(0,"div",14)(1,"nz-row",15)(2,"nz-col",16)(3,"nz-card"),n._UZ(4,"nz-statistic",17),n.YNc(5,B,1,0,"ng-template",null,18,n.W1O),n.qZA()(),n.TgZ(7,"nz-col",16)(8,"nz-card"),n._UZ(9,"nz-statistic",19),n.qZA()()()()),2&i){const a=n.MAs(6),e=n.oxw();n.xp6(1),n.Q6J("nzGutter",16),n.xp6(1),n.Q6J("nzSpan",12),n.xp6(2),n.Q6J("nzValue",(null==e.listReason?null:e.listReason.total_success)||0)("nzTitle","Success")("nzPrefix",a)("nzValueStyle",n.DdM(10,M)),n.xp6(3),n.Q6J("nzSpan",12),n.xp6(2),n.Q6J("nzValue",(null==e.listReason?null:e.listReason.total_fail)||0)("nzTitle","Fail")("nzValueStyle",n.DdM(11,P))}}function J(i,m){if(1&i&&(n.TgZ(0,"nz-list-item")(1,"span",24)(2,"mark"),n._uU(3),n.qZA()(),n._uU(4),n.qZA()),2&i){const a=m.$implicit;n.xp6(3),n.hij("",a.phone_number," "),n.xp6(1),n.hij(" ",null!=a&&null!=a.preview_response&&a.preview_response.has_gift?"Accept":null==a||null==a.preview_response||null==a.preview_response.reason[0]?null:a.preview_response.reason[0].reason," ")}}function x(i,m){if(1&i&&(n.TgZ(0,"nz-list",21)(1,"div",22),n.YNc(2,J,5,2,"nz-list-item",23),n.qZA()()),2&i){const a=n.oxw();n.xp6(2),n.Q6J("ngForOf",null==a.listReason?null:a.listReason.datas)}}const Q=[{path:"",component:(()=>{class i{constructor(a){this.msg=a,this.form=new r.cw({}),this.model={},this.options={formState:{hideQuantity:!0}},this.fileList=[],this.IComLibsServicesProjectCampaignService=(0,n.f3M)(g.zQ),this.inventoryService=(0,n.f3M)(g.NH),this.IComMessageService=(0,n.f3M)(b.Q),this.cdr=(0,n.f3M)(n.sBO),this.beforeUpload=e=>new Z.y(t=>{const s="text/csv"===e.type;if(!s)return this.msg.error("You can only upload CSV file!"),void t.complete();const l=(e.size||1)/1024/1024<2;return l?this.fileList&&this.fileList.length?(this.msg.error("Only Post One File"),void t.complete()):(t.next(s&&l),void t.complete()):(this.msg.error("Image must smaller than 2MB!"),void t.complete())}),this.fields=[]}ngOnInit(){this.fields=[{key:"campaign_id",type:"select-custom",className:"basis-4/12",props:{label:"Campaign",placeholder:"Select Campaign",viewValue:"label",labelProp:"label",required:!0,valueProp:"id",options:this.IComLibsServicesProjectCampaignService.searchCampaign().pipe((0,I.U)(a=>a?.data?.items?.map(e=>({...e,label:`[${e.id}] ${e.campaign_name}`}))||[]))}}]}handlerPreviewFile(a){var e=this;return(0,f.Z)(function*(){if("removed"!==a.type)try{const t=new FormData;t.append("file",a.file.originFileObj);const s=yield(0,h.n)(e.IComLibsServicesProjectCampaignService.batchRewarPreview(t));e.listReason=s.data,e.listReason.formData=a.file.originFileObj,e.cdr.detectChanges()}catch(t){e.IComMessageService.showAlertMessageError(t?.error?.error_message||"Preview fail")}else e.listReason=void 0})()}handlerCancel(a){a?.stopPropagation(),this.form.reset(),this.fileList=[],this.listReason=void 0}handlerSave(a){var e=this;return(0,f.Z)(function*(){if(a?.stopPropagation(),a?.preventDefault(),e.form.valid)try{e.form.markAsTouched(),e.form.submitted=!0;const t=(0,R.cloneDeep)(e.model);e.isLoading=!0;const s=new FormData;s.append("file",e.listReason.formData),s.append("campaign_id",t.campaign_id),yield(0,h.n)(e.IComLibsServicesProjectCampaignService.batchRewardSubmit(s)),e.cdr.detectChanges(),e.handlerCancel(),e.IComMessageService.showAlertMessageDone("Submit success")}catch(t){e.IComMessageService.showAlertMessageError(t?.error?.error_message||"Submit fail")}finally{e.isLoading=!1,e.cdr.detectChanges()}else Object.keys(e.form.controls).forEach(t=>{e.form.controls[t].touched=!0})})()}static#n=this.\u0275fac=function(e){return new(e||i)(n.Y36(w.dD))};static#e=this.\u0275cmp=n.Xpm({type:i,selectors:[["icom-libs-campaign-statistic"]],decls:19,vars:12,consts:[[1,"!p-4","bg-white","border","rounded-md"],["nz-form","",3,"formGroup"],[3,"model","fields","options","form"],["nzName","avatar","nzType","drag",1,"basis-1/2","ml-4","h-full","w-full",3,"nzMultiple","nzFileList","nzBeforeUpload","nzFileListChange","nzChange"],[1,"ant-upload-drag-icon"],["nz-icon","","nzType","inbox"],[1,"ant-upload-text"],[1,"ant-upload-hint"],["style","background: #ECECEC;","class","p-4",4,"ngIf"],["class","w-1/2 mt-4","nzBordered","","nzHeader","Phone Number","nzFooter","Preview",4,"ngIf"],["nz-row","",1,"mt-4"],["nz-col","",1,"search-area","flex","flex"],["nz-button","",3,"nzType","nzLoading","click"],["nz-button","",1,"ml-4",3,"click"],[1,"p-4",2,"background","#ECECEC"],[3,"nzGutter"],[3,"nzSpan"],[3,"nzValue","nzTitle","nzPrefix","nzValueStyle"],["prefixTplOne",""],[3,"nzValue","nzTitle","nzValueStyle"],["nz-icon","","nzType","check","nzTheme","outline"],["nzBordered","","nzHeader","Phone Number","nzFooter","Preview",1,"w-1/2","mt-4"],[1,"h-[200px]","overflow-auto"],[4,"ngFor","ngForOf"],["nz-typography",""]],template:function(e,t){1&e&&(n.TgZ(0,"div",0)(1,"form",1),n._UZ(2,"formly-form",2),n.qZA(),n.TgZ(3,"nz-upload",3),n.NdJ("nzFileListChange",function(l){return t.fileList=l})("nzChange",function(l){return t.handlerPreviewFile(l)}),n.ynx(4),n.TgZ(5,"p",4),n._UZ(6,"span",5),n.qZA(),n.TgZ(7,"p",6),n._uU(8,"Upload file CSV"),n.qZA(),n.TgZ(9,"p",7),n._uU(10,"Size can't exceed 2 MB"),n.qZA(),n.BQk(),n.qZA(),n.YNc(11,U,10,12,"div",8),n.YNc(12,x,3,1,"nz-list",9),n.TgZ(13,"div",10)(14,"div",11)(15,"button",12),n.NdJ("click",function(l){return t.handlerSave(l)}),n._uU(16," Submit "),n.qZA(),n.TgZ(17,"button",13),n.NdJ("click",function(l){return t.handlerCancel(l)}),n._uU(18,"Cancel"),n.qZA()()()()),2&e&&(n.xp6(1),n.Q6J("formGroup",t.form),n.xp6(1),n.Q6J("model",t.model)("fields",t.fields)("options",t.options)("form",t.form),n.xp6(1),n.Q6J("nzMultiple",!1)("nzFileList",t.fileList)("nzBeforeUpload",t.beforeUpload),n.xp6(8),n.Q6J("ngIf",t.listReason),n.xp6(1),n.Q6J("ngIf",(null==t.listReason?null:t.listReason.datas)&&(null==t.listReason||null==t.listReason.datas?null:t.listReason.datas.length)),n.xp6(3),n.Q6J("nzType","primary")("nzLoading",t.isLoading))},dependencies:[c.sg,c.O5,z.T7,r._Y,r.JL,r.sg,C.FY,v.ix,F.w,A.dQ,y.my,u.bd,L.t3,L.SK,S.Lr,d.n_,d.AA],encapsulation:2,changeDetection:0})}return i})()}];let O=(()=>{class i{static#n=this.\u0275fac=function(e){return new(e||i)};static#e=this.\u0275mod=n.oAB({type:i});static#t=this.\u0275inj=n.cJS({imports:[c.ez,T.Bz.forChild(Q),z.X0,r.UX,C.cS,v.sL,y.A2,u.vh,S.U5,d.Ph]})}return i})()}}]);