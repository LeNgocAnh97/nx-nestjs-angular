(self.webpackChunkicom=self.webpackChunkicom||[]).push([[5516],{5516:(k,b,c)=>{c.r(b),c.d(b,{IComLibsCampaignStatisticModule:()=>ht});var T=c(69594),g=c(14817),I=c(60202),_=c(34755),l=c(49671),t=c(36151),p=c(93484),x=c(16283),v=c(32202),E=c(87757),z=c(35329),s=c(17891),m=c(91872),y=c(44729),S=c(53750),f=c(8111),j=c(47809),L=c(54829);const N=function(){return["dd/mm/yyyy","dd/mm/yyyy"]};function w(i,h){if(1&i){const e=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",4)(1,"button",5),t.\u0275\u0275listener("click",function(a){t.\u0275\u0275restoreView(e);const o=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(o.handlerClick(a))}),t.\u0275\u0275element(2,"span",6)(3,"span",7),t.\u0275\u0275elementEnd(),t.\u0275\u0275element(4,"nz-range-picker",8),t.\u0275\u0275elementEnd()}if(2&i){const e=t.\u0275\u0275nextContext();t.\u0275\u0275advance(1),t.\u0275\u0275property("nzSize","default"),t.\u0275\u0275advance(3),t.\u0275\u0275property("nzPlaceHolder",t.\u0275\u0275pureFunction0(4,N))("formControl",e.filter.get("date_range"))("nzRanges",e.ranges)}}let D=(()=>{class i{constructor(){this.ranges={"\u0110\u1ea7u tu\u1ea7n n\xe0y":[this.getStartOfWeek(),new Date],"\u0110\u1ea7u th\xe1ng n\xe0y":[this.getStartOfCurrentMonth(),new Date],"\u0110\u1ea7u th\xe1ng tr\u01b0\u1edbc":[this.getStartOfLastMonth(),new Date]},this.filter=new p.FormGroup({date_range:new p.FormControl([this.getStartOfCurrentMonth(),new Date])}),this.icomFilter=new t.EventEmitter,this.IComMessageService=(0,t.inject)(S.Qi),this.campaignService=(0,t.inject)(y.ce)}ngOnInit(){const[e,n]=this.filter?.get("date_range")?.value;this.icomFilter.emit({start_time:m(e).utc().format(),end_time:m(n).endOf("day").utc().format()}),this.filter.valueChanges.pipe().subscribe(a=>{if(!a.date_range||!a.date_range?.length)return void this.icomFilter.emit({start_time:"",end_time:""});const[o,r]=a.date_range;console.log(r),this.icomFilter.emit({start_time:m(o).utc().format(),end_time:m(r).endOf("day").utc().format()})})}getStartOfWeek(){const e=new Date,n=e.getDay()||7;return 1!==n&&e.setHours(-24*(n-1)),e}getStartOfCurrentMonth(){const e=new Date;return new Date(e.getFullYear(),e.getMonth(),1)}getStartOfLastMonth(){const e=new Date;return new Date(e.getFullYear(),e.getMonth()-1,1)}getEndOfLastMonth(){const e=this.getStartOfCurrentMonth();return new Date(e.getTime()-864e5)}handlerClick(e){var n=this;return(0,l.Z)(function*(){e.stopPropagation(),e.preventDefault();const a=new XMLHttpRequest;a.open("POST",n.campaignService.downloadFileTransactionDetail(),!0),a.responseType="blob";let o=localStorage?.getItem("token");for(;o?.includes('"');)o=o?.replace('"',"");a.setRequestHeader("Authorization",`Bearer ${o}`),a.onload=()=>{if(200===a.status){const r=new Blob([a.response],{type:"application/octet-stream"}),d=URL.createObjectURL(r),C=document.createElement("a"),R=a.getResponseHeader("Content-Disposition");console.log(R);let Z="detail_transaction.xlsx";if(R){const $=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(R);null!=$&&$[1]&&(Z=$[1].replace(/['"]/g,""))}C.href=d,C.download=Z,document.body.appendChild(C),C.click(),URL.revokeObjectURL(d),document.body.removeChild(C),n.IComMessageService.showAlertMessageDone("T\u1ea3i file th\xe0nh c\xf4ng.")}else n.IComMessageService.showAlertMessageDone("T\u1ea3i file th\u1ea5t b\u1ea1i.")},a.onerror=function(){console.error("Request error")},a.setRequestHeader("Content-Type","application/json"),(0,f.xh)(n.filter.value),a.send(JSON.stringify(n.filter.value))})()}static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275cmp=t.\u0275\u0275defineComponent({type:i,selectors:[["icom-libs-campaign-statistic-nav"]],inputs:{label:"label",ignoreFilter:"ignoreFilter"},outputs:{icomFilter:"icomFilter"},standalone:!0,features:[t.\u0275\u0275StandaloneFeature],decls:5,vars:2,consts:[[1,"flex","w-full","h-full","justify-between"],[1,"flex","flex-col"],[1,"text-base"],["class","flex",4,"ngIf"],[1,"flex"],["nz-button","","nzShape","round",1,"mr-2",3,"nzSize","click"],["nz-icon","","nzType","file-excel","nzTheme","outline"],["nz-icon","","nzType","download","nzTheme","outline"],[3,"nzPlaceHolder","formControl","nzRanges"]],template:function(n,a){1&n&&(t.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"span",2),t.\u0275\u0275text(3),t.\u0275\u0275elementEnd()(),t.\u0275\u0275template(4,w,5,5,"div",3),t.\u0275\u0275elementEnd()),2&n&&(t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate(a.label),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",!a.ignoreFilter))},dependencies:[p.FormsModule,p.NgControlStatus,p.ReactiveFormsModule,p.FormControlDirective,v.NzDatePickerModule,v.NzDatePickerComponent,v.NzRangePickerComponent,g.NgIf,x.NzButtonModule,x.NzButtonComponent,j.\u0275NzTransitionPatchDirective,L.NzWaveDirective,E.NzIconModule,E.NzIconDirective,z.NzDividerModule,s.NzSelectModule],encapsulation:2})}return i})();var u=c(33635),B=c(37586);let O=(()=>{class i{constructor(){this.modalService=(0,t.inject)(B.NzModalService),this.viewContainerRef=(0,t.inject)(t.ViewContainerRef),this.campaignService=(0,t.inject)(y.ce)}static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275dir=t.\u0275\u0275defineDirective({type:i,inputs:{filter:"filter",chart:"chart",annotations:"annotations",colors:"colors",dataLabels:"dataLabels",series:"series",stroke:"stroke",labels:"labels",legend:"legend",fill:"fill",tooltip:"tooltip",plotOptions:"plotOptions",responsive:"responsive",xaxis:"xaxis",yaxis:"yaxis",grid:"grid",states:"states",title:"title",subtitle:"subtitle",theme:"theme"}})}return i})(),P=(()=>{class i extends O{constructor(){super(),this.changeDetectorRef=(0,t.inject)(t.ChangeDetectorRef)}ngOnInit(){this.getDataChart()}getDataChart(){var e=this;return(0,l.Z)(function*(){try{const n=yield(0,u.lastValueFrom)(e.fetchDataByType(e.type||""));e.count=n?.data||0,e.changeDetectorRef?.detectChanges()}catch(n){console.log(n)}})()}fetchDataByType(e){let n;switch(e){case"total_campaign_active":n="/count-active";break;case"total_point_30_day":n="/total-rewardpoint";break;case"total_customer_join_30_day":n="/count-user";break;default:throw new Error("Invalid type for API call")}return this.campaignService.getListApiStatisticByPathCampaign(n)}static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275cmp=t.\u0275\u0275defineComponent({type:i,selectors:[["icom-libs-campaign-statistic-total"]],inputs:{ignoreFilter:"ignoreFilter",type:"type"},standalone:!0,features:[t.\u0275\u0275InheritDefinitionFeature,t.\u0275\u0275StandaloneFeature],decls:7,vars:5,consts:[[1,"flex","flex-col","w-full","h-full","p-4",2,"background-color","#875fc0","background-image","linear-gradient(315deg, #875fc0 0%, #5346ba 74%)"],[1,"flex","text-white",3,"ignoreFilter","label"],[1,"flex","flex-col","h-full","w-full","items-center","justify-center"],[1,"mt-4"],[1,"text-white","text-xl"]],template:function(n,a){1&n&&(t.\u0275\u0275elementStart(0,"div",0),t.\u0275\u0275element(1,"icom-libs-campaign-statistic-nav",1),t.\u0275\u0275elementStart(2,"div",2)(3,"div",3)(4,"span",4),t.\u0275\u0275text(5),t.\u0275\u0275pipe(6,"number"),t.\u0275\u0275elementEnd()()()()),2&n&&(t.\u0275\u0275advance(1),t.\u0275\u0275property("ignoreFilter",a.ignoreFilter)("label",a.title||""),t.\u0275\u0275advance(4),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(6,3,a.count||0)," "))},dependencies:[D,g.DecimalPipe],encapsulation:2,changeDetection:0})}return i})();var M=c(6657),Y=c(50944),F=c(926);function V(i,h){if(1&i&&(t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275element(1,"nz-option",8),t.\u0275\u0275elementContainerEnd()),2&i){const e=h.$implicit;t.\u0275\u0275advance(1),t.\u0275\u0275property("nzValue",null==e?null:e.code)("nzLabel",null==e?null:e.name)}}const W=function(){return["dd/mm/yyyy","dd/mm/yyyy"]};function G(i,h){if(1&i&&(t.\u0275\u0275elementStart(0,"div",9),t.\u0275\u0275element(1,"nz-range-picker",10),t.\u0275\u0275elementEnd()),2&i){const e=t.\u0275\u0275nextContext();t.\u0275\u0275advance(1),t.\u0275\u0275property("nzPlaceHolder",t.\u0275\u0275pureFunction0(3,W))("formControl",e.dateRange)("nzPlacement","topRight")}}function J(i,h){1&i&&t.\u0275\u0275element(0,"nz-spin",11),2&i&&t.\u0275\u0275property("nzSize","large")}function X(i,h){if(1&i&&(t.\u0275\u0275elementStart(0,"div",13),t.\u0275\u0275element(1,"nz-divider",14),t.\u0275\u0275elementStart(2,"span",15),t.\u0275\u0275text(3),t.\u0275\u0275elementEnd(),t.\u0275\u0275element(4,"apx-chart",16),t.\u0275\u0275elementEnd()),2&i){const e=h.$implicit;t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate(e.label),t.\u0275\u0275advance(1),t.\u0275\u0275property("series",e.series)("chart",e.chart)("xaxis",e.xaxis)("labels",e.labels)("stroke",e.stroke)("title",e.title)("dataLabels",e.dataLabels)("yaxis",e.yaxis)}}function Q(i,h){if(1&i&&(t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275template(1,X,5,9,"div",12),t.\u0275\u0275elementContainerEnd()),2&i){const e=t.\u0275\u0275nextContext();t.\u0275\u0275advance(1),t.\u0275\u0275property("ngForOf",e.chartConfigs)}}m.extend(Y);let A=(()=>{class i{constructor(){this.nzModalData=(0,t.inject)(B.NZ_MODAL_DATA),this.chartConfigs=[],this.missions=[],this.dateRange=new p.FormControl([this.getStartOfCurrentMonth(),new Date]),this.cdr=(0,t.inject)(t.ChangeDetectorRef),this.campaignService=(0,t.inject)(y.ce)}ngOnInit(){var e=this;return(0,l.Z)(function*(){const n=e.nzModalData.id||"";try{const a=yield(0,u.lastValueFrom)(e.campaignService.getListMissionByByCampaign({campaign_id:n}));e.missions=a?.data}catch{e.missions=[]}e.dateRange.valueChanges.pipe().subscribe(a=>{if(!a||!a?.length)return e.filter={start_time:"",end_time:""},void e.handlerMissionChange();const[o,r]=a;e.filter={start_time:m(o).utc().format(),end_time:m(r).endOf("day").utc().format()},e.handlerMissionChange()})})()}handlerMissionChange(){const e=this.missions.find(o=>o.code===this.selectedMission);this.chartConfigs=[];const a=this.splitStringByComma(e.path).map(o=>this.campaignService.getListApiStatisticByPathCampaign(`/mission-list/${o}`,{campaign_id:this.nzModalData.id,...this.filter}).pipe((0,u.map)(r=>r.data)));switch(this.selectedMission){case"moi_ban_be":this.isLoading=!0,(0,u.combineLatest)(a).subscribe(o=>{const[r]=o;this.chartConfigs.push(this.configureBarChart(r,"S\u1ed1 kh\xe1ch tham gia, S\u1ed1 ng\u01b0\u1eddi \u0111\u01b0\u1ee3c m\u1eddi")),this.isLoading=!1,this.cdr.detectChanges()},o=>{this.isLoading=!1,this.cdr.detectChanges()});break;case"khao_sat":case"doi_uu_dai":case"xem_uu_dai":this.isLoading=!0,(0,u.combineLatest)(a).subscribe(o=>{const[r,d]=o;this.chartConfigs.push(this.configureBarChart(r,"S\u1ed1 kh\xe1ch tham gia")),this.chartConfigs.push(this.configureBarChart(d,"S\u1ed1 \u0111i\u1ec3m ghi nh\u1eadn")),this.isLoading=!1,this.cdr.detectChanges()},o=>{this.isLoading=!1,this.cdr.detectChanges()});break;case"mua_sam":this.isLoading=!0,(0,u.combineLatest)(a).subscribe(o=>{const[r,d]=o;this.chartConfigs.push(this.configureBarChart(r,"S\u1ed1 kh\xe1ch tham gia, S\u1ed1 l\u01b0\u1ee3t order")),this.chartConfigs.push(this.configureBarChart(d,"T\u1ed5ng doanh s\u1ed1 , Doanh s\u1ed1 trung b\xecnh theo kh\xe1ch tham gia")),this.isLoading=!1,this.cdr.detectChanges()},o=>{this.isLoading=!1,this.cdr.detectChanges()});break;case"nap_the":this.isLoading=!0,(0,u.combineLatest)(a).subscribe(o=>{const[r,d]=o;this.chartConfigs.push(this.configureBarChart(r,"S\u1ed1 l\u01b0\u1ee3t n\u1ea1p th\u1ebb, S\u1ed1 kh\xe1ch n\u1ea1p th\u1ebb")),this.chartConfigs.push(this.configureBarChart(d,"Doanh thu n\u1ea1p th\u1ebb")),this.isLoading=!1,this.cdr.detectChanges()},o=>{this.isLoading=!1,this.cdr.detectChanges()});break;case"check_in":this.isLoading=!0,(0,u.combineLatest)(a).subscribe(o=>{const[r,d]=o;this.chartConfigs.push(this.configureBarChart(r,"S\u1ed1 kh\xe1ch tham gia")),this.chartConfigs.push(this.configureBarChart(d,"S\u1ed1 voucher \u0111\xe3 th\u01b0\u1edfng")),this.isLoading=!1,this.cdr.detectChanges()},o=>{this.isLoading=!1,this.cdr.detectChanges()});break;case"mo_hop_qua":this.isLoading=!0,(0,u.combineLatest)(a).subscribe(o=>{const[r]=o;this.chartConfigs.push(this.configureBarChart(r,"M\u1edf h\u1ed9p qu\xe0")),this.isLoading=!1,this.cdr.detectChanges()},o=>{this.isLoading=!1,this.cdr.detectChanges()});break;default:console.log(`Chi\u1ebfn d\u1ecbch ${this.selectedMission} kh\xf4ng \u0111\u01b0\u1ee3c h\u1ed7 tr\u1ee3 ho\u1eb7c kh\xf4ng x\xe1c \u0111\u1ecbnh.`)}}configureBarChart(e=[],n){const a=e;return{series:this.configureSeries(a,"column"),chart:{height:350,type:"bar",stacked:this.determineChartType(a),toolbar:{show:!1}},xaxis:{categories:a.map(o=>o.date)},label:n,dataLabels:{enabled:!1},tooltip:{x:{format:"dd MMM yyyy"}}}}configureLineChart(e=[],n){const a=e;return{series:this.configureSeries(a,"line"),chart:{height:350,type:"line",stacked:this.determineChartType(a)},title:{text:n},xaxis:{categories:a.map(o=>o.date)},dataLabels:{enabled:!1},tooltip:{x:{format:"dd MMM yyyy"}}}}splitStringByComma(e){return e.split(",").map(n=>n.trim())}determineChartType(e){const[n,...a]=e;return!(!n||n?.items?.[0]?.type!==n?.items?.[1]?.type)}configureSeries(e,n){const a={};return e.forEach(r=>{r.items.forEach(d=>{a[d.name]||(a[d.name]=[])})}),e.forEach(r=>{const d=r.date;r.items.forEach(C=>{a[C.name].push({x:d,y:C?.value||C?.count})})}),Object.keys(a).map(r=>({data:a[r],type:n,name:r}))}getStartOfCurrentMonth(){const e=new Date;return new Date(e.getFullYear(),e.getMonth(),1)}static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275cmp=t.\u0275\u0275defineComponent({type:i,selectors:[["app-missions"]],standalone:!0,features:[t.\u0275\u0275StandaloneFeature],decls:8,vars:5,consts:[[1,"flex","flex-col","w-full","h-full"],["nzPlaceHolder","Ch\u1ecdn nhi\u1ec7m v\u1ee5",3,"ngModel","ngModelChange"],[4,"ngFor","ngForOf"],[1,"flex","mt-4","w-full","h-full","justify-between"],[1,"flex","flex-col"],["class","flex",4,"ngIf"],["class","w-full h-full flex justify-center items-center","nzSimple","",3,"nzSize",4,"ngIf"],[4,"ngIf"],[3,"nzValue","nzLabel"],[1,"flex"],[3,"nzPlaceHolder","formControl","nzPlacement"],["nzSimple","",1,"w-full","h-full","flex","justify-center","items-center",3,"nzSize"],["class","w-full h-full mt-4",4,"ngFor","ngForOf"],[1,"w-full","h-full","mt-4"],[1,"my-2"],[1,"text-xs","font-semibold"],[1,"w-full","h-60",3,"series","chart","xaxis","labels","stroke","title","dataLabels","yaxis"]],template:function(n,a){1&n&&(t.\u0275\u0275elementStart(0,"div",0)(1,"nz-select",1),t.\u0275\u0275listener("ngModelChange",function(r){return a.selectedMission=r})("ngModelChange",function(){return a.handlerMissionChange()}),t.\u0275\u0275template(2,V,2,2,"ng-container",2),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(3,"div",3),t.\u0275\u0275element(4,"div",4),t.\u0275\u0275template(5,G,2,4,"div",5),t.\u0275\u0275elementEnd(),t.\u0275\u0275template(6,J,1,1,"nz-spin",6),t.\u0275\u0275template(7,Q,2,1,"ng-container",7),t.\u0275\u0275elementEnd()),2&n&&(t.\u0275\u0275advance(1),t.\u0275\u0275property("ngModel",a.selectedMission),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngForOf",a.missions),t.\u0275\u0275advance(3),t.\u0275\u0275property("ngIf",a.chartConfigs&&(null==a.chartConfigs?null:a.chartConfigs.length)),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",a.isLoading),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",!a.isLoading))},dependencies:[s.NzSelectModule,s.NzOptionComponent,s.NzSelectComponent,p.FormsModule,p.NgControlStatus,p.NgModel,M.NgApexchartsModule,M.ChartComponent,g.NgIf,v.NzDatePickerModule,v.NzDatePickerComponent,v.NzRangePickerComponent,p.ReactiveFormsModule,p.FormControlDirective,x.NzButtonModule,z.NzDividerModule,z.NzDividerComponent,g.NgFor,F.NzSpinModule,F.NzSpinComponent],encapsulation:2,changeDetection:0})}return i})();function K(i,h){1&i&&t.\u0275\u0275element(0,"nz-spin",4),2&i&&t.\u0275\u0275property("nzSize","large")}function q(i,h){if(1&i&&t.\u0275\u0275element(0,"apx-chart",5),2&i){const e=t.\u0275\u0275nextContext();t.\u0275\u0275property("series",e.config.series)("chart",e.config.chart)("labels",e.config.labels)("responsive",e.config.responsive)("title",e.config.title)}}let U=(()=>{class i extends O{constructor(e){super(),this.ngZone=e,this.changeDetectorRef=(0,t.inject)(t.ChangeDetectorRef)}processBuildChart(e){const n=e.map(r=>r.total_reward_point)||[],a=e.map(r=>r.campaign_name)||[],o=e.map(r=>r.campaign_id)||[];this.config={series:n,chart:{type:"pie",width:"100%",height:"100%",events:{dataPointSelection:(r,d,C)=>{r.stopPropagation(),r.preventDefault(),this.handlerDataPointClick(o[C.dataPointIndex])}}},labels:a},this.changeDetectorRef.detectChanges()}getDataChart(){var e=this;return(0,l.Z)(function*(){try{e.isLoading=!0;const n=yield(0,u.lastValueFrom)(e.campaignService.getTotalRewardPointGroup(e.filter));e.processBuildChart(n?.data),e.changeDetectorRef.detectChanges()}catch(n){console.log(n)}finally{e.isLoading=!1,e.changeDetectorRef.detectChanges()}})()}handlerFilter(e){this.filter=e,this.getDataChart()}handlerDataPointClick(e){console.log(this.viewContainerRef);const n=this.modalService.create({nzTitle:"Chi ti\u1ebft b\xe1o c\xe1o chi\u1ebfn d\u1ecbch",nzContent:A,nzMaskClosable:!0,nzClosable:!0,nzWidth:968,nzZIndex:999,nzData:{id:e},nzOnCancel:()=>this.ngZone.run(()=>{n.destroy(),this.changeDetectorRef.detectChanges()}),nzFooter:[{label:"\u0110\xf3ng",onClick:()=>this.ngZone.run(()=>{n.destroy(),this.changeDetectorRef.detectChanges()})}]});setTimeout(()=>{this.changeDetectorRef.detectChanges(),n.containerInstance.cdr.detectChanges()},250)}static#t=this.\u0275fac=function(n){return new(n||i)(t.\u0275\u0275directiveInject(t.NgZone))};static#e=this.\u0275cmp=t.\u0275\u0275defineComponent({type:i,selectors:[["icom-libs-campaign-statistic-point-by-campaign"]],standalone:!0,features:[t.\u0275\u0275InheritDefinitionFeature,t.\u0275\u0275StandaloneFeature],decls:4,vars:3,consts:[[1,"flex","flex-col","w-full","h-full","p-4"],[1,"text-xs","font-semibold",3,"label","icomFilter"],["class","w-full h-full flex justify-center items-center","nzSimple","",3,"nzSize",4,"ngIf"],["class","flex flex-col w-full h-full overflow-hidden",3,"series","chart","labels","responsive","title",4,"ngIf"],["nzSimple","",1,"w-full","h-full","flex","justify-center","items-center",3,"nzSize"],[1,"flex","flex-col","w-full","h-full","overflow-hidden",3,"series","chart","labels","responsive","title"]],template:function(n,a){1&n&&(t.\u0275\u0275elementStart(0,"div",0)(1,"icom-libs-campaign-statistic-nav",1),t.\u0275\u0275listener("icomFilter",function(r){return a.handlerFilter(r)}),t.\u0275\u0275elementEnd(),t.\u0275\u0275template(2,K,1,1,"nz-spin",2),t.\u0275\u0275template(3,q,1,5,"apx-chart",3),t.\u0275\u0275elementEnd()),2&n&&(t.\u0275\u0275advance(1),t.\u0275\u0275property("label","T\u1ed5ng s\u1ed1 \u0111i\u1ec3m th\u01b0\u1edfng theo chi\u1ebfn d\u1ecbch"),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",a.isLoading),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",!a.isLoading&&a.config))},dependencies:[F.NzSpinModule,F.NzSpinComponent,g.NgIf,D,M.NgApexchartsModule,M.ChartComponent],encapsulation:2,changeDetection:0})}return i})();function tt(i,h){1&i&&t.\u0275\u0275element(0,"nz-spin",4),2&i&&t.\u0275\u0275property("nzSize","large")}function et(i,h){if(1&i&&t.\u0275\u0275element(0,"apx-chart",5),2&i){const e=t.\u0275\u0275nextContext();t.\u0275\u0275property("series",e.config.series)("chart",e.config.chart)("xaxis",e.config.xaxis)("title",e.config.title)}}let H=(()=>{class i extends O{constructor(e){super(),this.ngZone=e,this.changeDetectorRef=(0,t.inject)(t.ChangeDetectorRef)}processBuildChart(e){this.config={series:[{name:"Ng\u01b0\u1eddi tham gia",data:e.map(n=>n.count_user),campaign_id:e.map(n=>n.campaign_id)},{name:"Ng\u01b0\u1eddi \u0111\u01b0\u1ee3c th\u01b0\u1edfng",data:e.map(n=>n.count_user_reward),campaign_id:e.map(n=>n.campaign_id)}],chart:{type:"bar",height:"100%",toolbar:{show:!1},fontFamily:"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji",events:{dataPointSelection:(n,a,o)=>{n.stopPropagation(),n.preventDefault(),this.handlerDataPointClick(o.w.config.xaxis.id[o.dataPointIndex])}}},xaxis:{categories:e.map(n=>n.campaign_name),id:e.map(n=>n.campaign_id)},yaxis:{title:{text:"S\u1ed1 l\u01b0\u1ee3ng ng\u01b0\u1eddi d\xf9ng"}},dataLabels:{enabled:!1}}}getDataChart(){var e=this;return(0,l.Z)(function*(){try{e.isLoading=!0;const n=yield(0,u.lastValueFrom)(e.campaignService.getCountCustomerByCampaign(e.filter));e.processBuildChart(n?.data),e.changeDetectorRef.detectChanges()}catch(n){console.log(n)}finally{e.isLoading=!1,e.changeDetectorRef.detectChanges()}})()}handlerFilter(e){this.filter=e,this.getDataChart()}handlerDataPointClick(e){console.log(this.viewContainerRef);const n=this.modalService.create({nzTitle:"Chi ti\u1ebft b\xe1o c\xe1o chi\u1ebfn d\u1ecbch",nzContent:A,nzMaskClosable:!0,nzClosable:!0,nzWidth:968,nzZIndex:999,nzData:{id:e},nzOnCancel:()=>this.ngZone.run(()=>{n.destroy(),this.changeDetectorRef.detectChanges()}),nzFooter:[{label:"\u0110\xf3ng",onClick:()=>this.ngZone.run(()=>{n.destroy(),this.changeDetectorRef.detectChanges()})}]});this.changeDetectorRef.detectChanges(),n.containerInstance.cdr.detectChanges()}static#t=this.\u0275fac=function(n){return new(n||i)(t.\u0275\u0275directiveInject(t.NgZone))};static#e=this.\u0275cmp=t.\u0275\u0275defineComponent({type:i,selectors:[["icom-libs-campaign-statistic-success_campaign"]],standalone:!0,features:[t.\u0275\u0275InheritDefinitionFeature,t.\u0275\u0275StandaloneFeature],decls:4,vars:3,consts:[[1,"flex","flex-col","w-full","h-full","p-4"],[1,"text-xs","font-semibold",3,"label","icomFilter"],["class","w-full h-full flex justify-center items-center","nzSimple","",3,"nzSize",4,"ngIf"],["class","flex flex-col w-full h-full",3,"series","chart","xaxis","title",4,"ngIf"],["nzSimple","",1,"w-full","h-full","flex","justify-center","items-center",3,"nzSize"],[1,"flex","flex-col","w-full","h-full",3,"series","chart","xaxis","title"]],template:function(n,a){1&n&&(t.\u0275\u0275elementStart(0,"div",0)(1,"icom-libs-campaign-statistic-nav",1),t.\u0275\u0275listener("icomFilter",function(r){return a.handlerFilter(r)}),t.\u0275\u0275elementEnd(),t.\u0275\u0275template(2,tt,1,1,"nz-spin",2),t.\u0275\u0275template(3,et,1,4,"apx-chart",3),t.\u0275\u0275elementEnd()),2&n&&(t.\u0275\u0275advance(1),t.\u0275\u0275property("label","Th\u1ed1ng k\xea kh\xe1ch h\xe0ng theo chi\u1ebfn d\u1ecbch"),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",a.isLoading),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",!a.isLoading&&a.config))},dependencies:[F.NzSpinModule,F.NzSpinComponent,g.NgIf,D,M.NgApexchartsModule,M.ChartComponent],encapsulation:2,changeDetection:0})}return i})();function nt(i,h){1&i&&(t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275element(1,"icom-libs-campaign-statistic-total",7),t.\u0275\u0275elementContainerEnd()),2&i&&(t.\u0275\u0275advance(1),t.\u0275\u0275property("type","total_campaign_active")("title","T\u1ed5ng s\u1ed1 chi\u1ebfn d\u1ecbch ho\u1ea1t \u0111\u1ed9ng")("ignoreFilter",!0))}function it(i,h){1&i&&(t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275element(1,"icom-libs-campaign-statistic-total",7),t.\u0275\u0275elementContainerEnd()),2&i&&(t.\u0275\u0275advance(1),t.\u0275\u0275property("type","total_point_30_day")("title","T\u1ed5ng s\u1ed1 \u0111i\u1ec3m th\u01b0\u1edfng 30 ng\xe0y qua")("ignoreFilter",!0))}function at(i,h){1&i&&(t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275element(1,"icom-libs-campaign-statistic-total",7),t.\u0275\u0275elementContainerEnd()),2&i&&(t.\u0275\u0275advance(1),t.\u0275\u0275property("type","total_customer_join_30_day")("title","T\u1ed5ng s\u1ed1 kh\xe1ch tham gia trong 30 ng\xe0y qua")("ignoreFilter",!0))}function ot(i,h){1&i&&(t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275element(1,"icom-libs-campaign-statistic-point-by-campaign",8),t.\u0275\u0275elementContainerEnd())}function st(i,h){1&i&&(t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275element(1,"icom-libs-campaign-statistic-success_campaign",8),t.\u0275\u0275elementContainerEnd())}function rt(i,h){if(1&i&&(t.\u0275\u0275elementStart(0,"gridster-item",3)(1,"div",4),t.\u0275\u0275listener("mousedown",function(n){return n.stopPropagation()})("touchstart",function(n){return n.stopPropagation()}),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementContainerStart(2,5),t.\u0275\u0275template(3,nt,2,3,"ng-container",6),t.\u0275\u0275template(4,it,2,3,"ng-container",6),t.\u0275\u0275template(5,at,2,3,"ng-container",6),t.\u0275\u0275template(6,ot,2,0,"ng-container",6),t.\u0275\u0275template(7,st,2,0,"ng-container",6),t.\u0275\u0275elementContainerEnd(),t.\u0275\u0275elementEnd()),2&i){const e=h.$implicit;t.\u0275\u0275property("item",e),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngSwitch",e.component),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngSwitchCase","total_campaign_active"),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngSwitchCase","total_point_30_day"),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngSwitchCase","total_customer_join_30_day"),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngSwitchCase","point_by_campaign"),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngSwitchCase","customer_by_campaign")}}let ct=(()=>{class i{constructor(){this.dashboard=[],this.options={gridType:"scrollVertical"}}ngOnInit(){this.dashboard=[{cols:4,rows:1,y:0,x:0,component:"total_campaign_active"},{cols:4,rows:1,y:0,x:4,component:"total_point_30_day"},{cols:4,rows:1,y:0,x:8,component:"total_customer_join_30_day"},{cols:12,rows:3,y:1,x:0,component:"customer_by_campaign"},{cols:6,rows:3,y:2,x:0,component:"point_by_campaign"}]}static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275cmp=t.\u0275\u0275defineComponent({type:i,selectors:[["icom-libs-campaign-statistic"]],inputs:{label:"label"},decls:3,vars:2,consts:[[1,"flex","flex-col","h-full","w-full"],[3,"options"],[3,"item",4,"ngFor","ngForOf"],[3,"item"],[3,"mousedown","touchstart"],[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"h-full","w-full",3,"type","title","ignoreFilter"],[1,"h-full","w-full"]],template:function(n,a){1&n&&(t.\u0275\u0275elementStart(0,"div",0)(1,"gridster",1),t.\u0275\u0275template(2,rt,8,7,"gridster-item",2),t.\u0275\u0275elementEnd()()),2&n&&(t.\u0275\u0275advance(1),t.\u0275\u0275property("options",a.options),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngForOf",a.dashboard))},dependencies:[g.NgForOf,g.NgSwitch,g.NgSwitchCase,_.GridsterComponent,_.GridsterItemComponent,P,U,H],styles:["gridster{background-color:#f4f5f7!important}  gridster .gridster-column{border-left:1px solid #e6e8ed!important;border-right:1px solid #e6e8ed!important}  gridster .gridster-row{border-top:1px solid #e6e8ed!important;border-bottom:1px solid #e6e8ed!important}"],changeDetection:0})}return i})();var lt=c(13391);const mt=[{path:"",component:ct,data:{title:"catalog",breadcrumb:{label:"List Campaign Statistic",link:"product-management"}}}];let ht=(()=>{class i{static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275mod=t.\u0275\u0275defineNgModule({type:i});static#n=this.\u0275inj=t.\u0275\u0275defineInjector({providers:[{provide:T.Xj,useClass:T.YJ}],imports:[g.CommonModule,I.RouterModule.forChild(mt),lt.FormlyModule,_.GridsterModule,P,U,D,H,x.NzButtonModule]})}return i})()},50944:function(k){k.exports=function(){"use strict";var b="minute",c=/[+-]\d\d(?::?\d\d)?/g,T=/([+-]|\d\d)/g;return function(g,I,_){var l=I.prototype;_.utc=function(s){return new I({date:s,utc:!0,args:arguments})},l.utc=function(s){var m=_(this.toDate(),{locale:this.$L,utc:!0});return s?m.add(this.utcOffset(),b):m},l.local=function(){return _(this.toDate(),{locale:this.$L,utc:!1})};var t=l.parse;l.parse=function(s){s.utc&&(this.$u=!0),this.$utils().u(s.$offset)||(this.$offset=s.$offset),t.call(this,s)};var p=l.init;l.init=function(){if(this.$u){var s=this.$d;this.$y=s.getUTCFullYear(),this.$M=s.getUTCMonth(),this.$D=s.getUTCDate(),this.$W=s.getUTCDay(),this.$H=s.getUTCHours(),this.$m=s.getUTCMinutes(),this.$s=s.getUTCSeconds(),this.$ms=s.getUTCMilliseconds()}else p.call(this)};var x=l.utcOffset;l.utcOffset=function(s,m){var y=this.$utils().u;if(y(s))return this.$u?0:y(this.$offset)?x.call(this):this.$offset;if("string"==typeof s&&null===(s=function(L){void 0===L&&(L="");var N=L.match(c);if(!N)return null;var w=(""+N[0]).match(T)||["-",0,0],u=60*+w[1]+ +w[2];return 0===u?0:"+"===w[0]?u:-u}(s)))return this;var S=Math.abs(s)<=16?60*s:s,f=this;if(m)return f.$offset=S,f.$u=0===s,f;if(0!==s){var j=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(f=this.local().add(S+j,b)).$offset=S,f.$x.$localOffset=j}else f=this.utc();return f};var v=l.format;l.format=function(s){return v.call(this,s||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":""))},l.valueOf=function(){var s=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*s},l.isUTC=function(){return!!this.$u},l.toISOString=function(){return this.toDate().toISOString()},l.toString=function(){return this.toDate().toUTCString()};var E=l.toDate;l.toDate=function(s){return"s"===s&&this.$offset?_(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():E.call(this)};var z=l.diff;l.diff=function(s,m,y){if(s&&this.$u===s.$u)return z.call(this,s,m,y);var S=this.local(),f=_(s).local();return z.call(S,f,m,y)}}}()}}]);