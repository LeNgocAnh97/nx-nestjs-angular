(self.webpackChunkicom=self.webpackChunkicom||[]).push([[908],{50908:(xt,G,m)=>{m.r(G),m.d(G,{IComLibsCampaignManagementDetailComponent:()=>vt});var N=m(49671),e=m(36151),f=m(14817),k=m(87757),_=m(63801),S=m(38831),K=m(59600),Q=m(47332),U=m(57317),C=m(67056),g=m(16283),l=m(93484),h=m(13391),y=m(62059),b=m(926),L=m(91872),d=m(33635);function j(o){const r=o.parent?.value?.start_time,t=o.parent?.value?.end_time;return r&&t&&L(t).isBefore(r)?{startTimeInvalid:!0}:null}var u=m(15311),x=m(44729);let J=(()=>{class o{constructor(){this.form=new l.FormGroup({}),this.fields=[],this.options={formState:{disabled:!1}},this.icomFunctionControl=new e.EventEmitter,this.campaignService=(0,e.inject)(x.wb),this.fields=((o,r)=>[{key:"name",type:"input",className:"",props:{placeholder:"Nh\u1eadp t\xean chi\u1ebfn d\u1ecbch",label:"T\xean chi\u1ebfn d\u1ecbch",type:"string",required:!0},validators:{validation:[{name:"noWhitespace",options:{errorPath:"value"}}]},expressions:{"props.disabled":"formState.disabled"}},{key:"type_start_time",type:"radio",className:"basis-6/12",defaultValue:"SPECTIME",props:{label:"Th\u1eddi gian b\u1eaft \u0111\u1ea7u",required:!0,viewValue:"title",labelProp:"title",valueProp:"id",options:r.getListTimeStart().pipe((0,d.map)(t=>t.data))},expressions:{"props.disabled":"formState.disabled"}},{key:"start_time",type:"date",className:"basis-6/12",props:{ShowTime:!0,format:"dd-MM-yyyy HH:mm:ss",placeholder:"DD-MM-YYYY hh:mm:ss",required:!0,emitTimeLocal:!0,DisabledDate:t=>{const n=new Date;return n.setHours(0,0,0,0),t<n},change:(t,n)=>{t?.parent?.fieldGroup?.find(a=>"end_time"===a.key)&&o.get("end_time").updateValueAndValidity()}},hideExpression:t=>!t?.type_start_time||"SPECTIME"!==t?.type_start_time,expressions:{"props.disabled":"formState.disabled"},validators:{validation:[j]}},{key:"type_end_time",type:"radio",className:"basis-6/12",defaultValue:"SPECTIME",props:{label:"Th\u1eddi gian k\u1ebft th\xfac",required:!0,viewValue:"title",labelProp:"title",valueProp:"id",options:r.getListTimeEnd().pipe((0,d.map)(t=>t.data))},expressions:{"props.disabled":"formState.disabled"}},{key:"end_time",type:"date",className:"basis-6/12",props:{required:!0,placeholder:"DD-MM-YYYY hh:mm:ss",emitTimeLocal:!0,ShowTime:!0,format:"dd-MM-yyyy HH:mm:ss",DisabledDate:t=>{const n=new Date;return n.setHours(0,0,0,0),t<n},change:(t,n)=>{t?.parent?.fieldGroup?.find(a=>"start_time"===a.key)&&o.get("start_time").updateValueAndValidity()}},hideExpression:t=>!t?.type_end_time||"SPECTIME"!==t?.type_end_time,expressions:{"props.disabled":"formState.disabled"},expressionProperties:{"props.DisabledDate":(t,n,i)=>{const a=n?.model?.start_time;return a?s=>L(s).isBefore(L(a)):s=>!1}},validators:{validation:[j]}},{key:"description",type:"quill-editor",className:"basis-6/12",props:{label:"Th\u1ec3 l\u1ec7 ch\u01b0\u01a1ng tr\xecnh",placeholder:"Nh\u1eadp th\u1ec3 l\u1ec7",required:!0},expressions:{"props.disabled":"formState.disabled"}},{fieldGroupClassName:"w-full items-center mt-4",key:"customer_group",expressions:{"props.disabled":"formState.disabled"},fieldGroup:[{type:"array",key:"config",expressions:{"props.disabled":"formState.disabled"},props:{label:"Kh\xe1ch h\xe0ng",addText:"Th\xeam Kh\xe1ch h\xe0ng"},fieldArray:{wrappers:["group"],hideExpression:t=>"after_specific_day"===t.operator||"before_specific_day"===t.operator,fieldGroup:[{key:"type",type:"select-custom",className:"basis-6/12",props:{label:"Kh\xe1ch h\xe0ng",placeholder:"Ch\u1ecdn \u0111i\u1ec1u ki\u1ec7n",viewValue:"name",labelProp:"name",valueProp:"id",options:[{name:"H\u1ed3 s\u01a1 kh\xe1ch h\xe0ng ",id:"customer_profile"}]}},{key:"attribute",type:"select-custom",props:{placeholder:"Ch\u1ecdn \u0111i\u1ec1u ki\u1ec7n",viewValue:"name",labelProp:"name",valueProp:"id",options:[{name:"Theo th\u1eddi gian \u0111\u0103ng k\xfd m\u1edbi",id:"thoi_gian_dang_ky"},{name:"Theo s\u1ed1 \u0111i\u1ec7n tho\u1ea1i",id:"phone"}],change:t=>{t.model&&"thoi_gian_dang_ky"===t?.model?.attribute&&!t?.model?.operator&&(t.model.operator="before_duration",t.model.group="customer"),t.model&&"phone"===t?.model?.attribute&&!t?.model?.operator&&(t.model.operator="in",t.model.group="customer"),t.formControl.markAsTouched()}},hideExpression:t=>!t?.type||"customer_profile"!==t?.type},{fieldGroupClassName:"flex row items-center mt-4",key:"",hideExpression:t=>!t?.attribute||"thoi_gian_dang_ky"!==t?.attribute,fieldGroup:[{key:"value",type:"nz-input-number",props:{placeholder:"Nh\u1eadp s\u1ed1",type:"number",min:0}},{key:"unit",type:"select-custom",className:" ml-4",defaultValue:"day",props:{viewValue:"name",labelProp:"name",valueProp:"id",required:!0,options:[{id:"day",name:"Ng\xe0y"}]}}]},{key:"value",hideExpression:t=>(console.log(t),!t?.attribute||"phone"!==t?.attribute),type:"tags",props:{}}]}}]}])(this.form,this.campaignService)}ngOnInit(){"view"===this.mode&&(this.options.formState.disabled=!0),this.icomFunctionControl.emit({save:this.handleSave.bind(this)}),this.data.type_click_action_selected=""}handleSave(){return this.form.valid?(this.form.markAsTouched(),this.form.submitted=!0,!0):(Object.keys(this.form.controls).forEach(t=>{this.form.controls[t].touched=!0}),!1)}static#e=this.\u0275fac=function(n){return new(n||o)};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["icom-libs-campaign-management-detail-general"]],inputs:{data:"data",mode:"mode"},outputs:{icomFunctionControl:"icomFunctionControl"},standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:4,vars:6,consts:[[1,"w-full","h-full","flex"],[1,"flex","w-full","h-full","flex-col","bg-white","border","rounded-md"],["nz-form","",1,"bg-white","rounded-md","h-full","flex","flex-col","!p-4","overflow-y-auto",3,"formGroup","nzLayout"],[3,"model","fields","options","form"]],template:function(n,i){1&n&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"form",2),e.\u0275\u0275element(3,"formly-form",3),e.\u0275\u0275elementEnd()()()),2&n&&(e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",i.form)("nzLayout","vertical"),e.\u0275\u0275advance(1),e.\u0275\u0275property("model",i.data)("fields",i.fields)("options",i.options)("form",i.form))},dependencies:[y.FormlyNgZorroAntdModule,l.ReactiveFormsModule,l.\u0275NgNoValidate,l.NgControlStatusGroup,l.FormGroupDirective,h.FormlyModule,h.FormlyForm,g.NzButtonModule,b.NzSpinModule,u.NzFormModule,u.NzFormDirective],encapsulation:2,changeDetection:0})}return o})();var E=m(37586),V=m(8111);function ee(o,r){let t="";return n=>{!n.dirty&&"edit"===r&&(t=n.value);const i=[];return o?.forEach(a=>{i.push(a.name)}),i.filter(a=>n?.value?.trim()===a)?.length&&t!==n?.value?.trim()?{uniqueName:"T\xean n\xe0y \u0111\xe3 \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng."}:null}}let ne=(()=>{class o{constructor(){this.form=new l.FormGroup({}),this.fields=[],this.options={formState:{disabled:!1}},this.icomFunctionControl=new e.EventEmitter,this.nzModalData=(0,e.inject)(E.NZ_MODAL_DATA),this.iComLibsServicesProjectCampaignV3Service=(0,e.inject)(x.wb)}ngOnInit(){this.fields=((o,r,t)=>[{key:"name",type:"input",className:"",props:{placeholder:"Nh\u1eadp t\xean nhi\u1ec7m v\u1ee5",label:"T\xean nhi\u1ec7m v\u1ee5",type:"string",required:!0},validators:{validation:[{name:"noWhitespace",options:{errorPath:"value"}},ee(this.missions,this.modeExtend)]},expressions:{"props.disabled":"formState.disabled"}},{key:"avatar",type:"upload",className:"",props:{label:"Icon \u0111\u1ea1i di\u1ec7n",size:102400,required:!0,labelType:"Image",width:200,height:200},expressions:{"props.disabled":"formState.disabled"}},{key:"type",type:"select-custom",className:"basis-6/12",props:{label:"Lo\u1ea1i nhi\u1ec7m v\u1ee5",placeholder:"Ch\u1ecdn lo\u1ea1i nhi\u1ec7m v\u1ee5",viewValue:"title",labelProp:"title",valueProp:"id",required:!0,options:o.getTypeMissions().pipe((0,d.map)(n=>n.data))},expressions:{"props.disabled":"formState.disabled"}},{key:"info",type:"quill-editor",className:"basis-6/12",props:{label:"Th\xf4ng tin nhi\u1ec7m v\u1ee5",placeholder:"Nh\u1eadp m\xf4 t\u1ea3"},expressions:{"props.disabled":"formState.disabled"}},{key:"description",type:"textarea",className:"basis-6/12",props:{label:"M\xf4 t\u1ea3 nhi\u1ec7m v\u1ee5",placeholder:"Nh\u1eadp th\xf4ng tin"},expressions:{"props.disabled":"formState.disabled"}},{key:"sponsor",props:{required:!0,label:"Nh\xe0 t\xe0i tr\u1ee3",addText:"Th\xeam nh\xe0 t\xe0i tr\u1ee3"},expressions:{"props.disabled":"formState.disabled"},type:"array",fieldArray:{fieldGroupClassName:"flex row items-center",fieldGroup:[{key:"id",type:"select-custom",className:"basis-8/12",props:{label:"Nh\xe0 t\xe0i tr\u1ee3",placeholder:"Ch\u1ecdn nh\xe0 t\xe0i tr\u1ee3",viewValue:"title",labelProp:"title",valueProp:"id",required:!0,options:o.getContributor().pipe((0,d.map)(n=>n.data))}},{key:"value",type:"nz-input-number",className:"basis-4/12 ml-4",props:{placeholder:"Nh\u1eadp t\u1ef7 l\u1ec7 t\xe0i tr\u1ee3",label:"T\u1ef7 l\u1ec7 t\xe0i tr\u1ee3",type:"number",min:0,max:100,required:!0}},{key:"balance",type:"input",className:"basis-4/12 ml-4",props:{label:"T\xe0i kho\u1ea3n k\xfd qu\u1ef9",disabled:!0,required:!0},hooks:{onInit:n=>{(n?.formControl?.parent?.get("id")).valueChanges.subscribe(s=>{const c=n?.parent?.fieldGroup?.find(M=>"id"===M.key)?.props?.options;let z;c instanceof d.Observable?c.subscribe(M=>{z=M.find(zt=>zt.id===s),n?.formControl?.setValue(z?.balance||0)}):Array.isArray(c)&&(z=c.find(M=>M.value===s),n?.formControl?.setValue(z?.balance||0))})}}}]}},{key:"pool",type:"select-custom",props:{label:"Lo\u1ea1i \u0111i\u1ec3m th\u01b0\u1edfng C\u1ea5p 1",type:"text",placeholder:"C\u1ea5p 1 (Pool)",viewValue:"title",labelProp:"title",valueProp:"id",required:!0,options:o.getPool().pipe((0,d.map)(n=>n.data))},expressions:{"props.disabled":"formState.disabled"}},{key:"sub_pool",type:"select-custom",props:{label:"Lo\u1ea1i \u0111i\u1ec3m th\u01b0\u1edfng C\u1ea5p 2",type:"text",placeholder:"C\u1ea5p 2 (Pool)",viewValue:"title",labelProp:"title",valueProp:"id",required:!0,options:[]},expressions:{"props.disabled":"formState.disabled"},hooks:{onInit:n=>{const i=n?.form?.get("pool");i&&(n.templateOptions.options=i.valueChanges.pipe((0,d.startWith)(i.value),(0,d.distinctUntilChanged)(),(0,d.concatMap)(a=>o.getSubPool({pool_id:a}).pipe((0,d.map)(s=>(s?.data?.find(p=>n?.model?.sub_pool===p.id)||n.formControl.setValue(null),s.data))))))}}},{key:"action",type:"select-custom",props:{label:"H\xe0nh \u0111\u1ed9ng th\u1ef1c hi\u1ec7n nhi\u1ec7m v\u1ee5",type:"text",placeholder:" Ch\u1ecdn h\xe0nh \u0111\u1ed9ng",viewValue:"title",labelProp:"title",valueProp:"id",required:!0,options:o.getActionMission().pipe((0,d.map)(n=>n.data))},expressions:{"props.disabled":"formState.disabled"}},{key:"lock",type:"checkbox",props:{label:"Kh\xf3a th\u1ef1c hi\u1ec7n nhi\u1ec7m v\u1ee5 sau khi tham gia ",description:"Kh\xe1ch h\xe0ng ch\u1ec9 c\u1ea7n x\xe1c nh\u1eadn tham gia nhi\u1ec7m v\u1ee5 1 l\u1ea7n  (v\xed d\u1ee5 \u1ea5n button Th\u1ef1c hi\u1ec7n) th\xec c\xf3 th\u1ec3 th\u1ef1c hi\u1ec7n nhi\u1ec7m v\u1ee5 b\u1ea5t k\u1ef3 l\xfac n\xe0o trong th\u1eddi gian di\u1ec5n ra chi\u1ebfn d\u1ecbch m\xe0 kh\xf4ng c\u1ea7n \u1ea5n l\u1ea1i."},expressions:{"props.disabled":"formState.disabled"}},{key:"click_action_type",type:"select-custom",className:"basis-6/12",props:{label:"X\u1eed l\xfd khi \u1ea5n n\xfat th\u1ef1c hi\u1ec7n nhi\u1ec7m v\u1ee5",placeholder:"Ch\u1ecdn x\u1eed l\xfd",viewValue:"title",labelProp:"title",valueProp:"id",options:o.getListActionType().pipe((0,d.map)(n=>n.data))},expressions:{"props.disabled":"formState.disabled"},hooks:{onInit:n=>{const i=n.formControl?.parent,a=i?.get("click_action_type");a&&a.valueChanges.pipe((0,d.startWith)(a.value),(0,d.distinctUntilChanged)()).subscribe(s=>{n?.props?.options instanceof d.Observable&&n?.props?.options.subscribe(p=>{const c=p.find(M=>M.id===s),z=i?.get("specific_type_click_action_selected");z&&z.setValue("input"===c?.type?"input":"select")})})}}},{key:"specific_type_click_action_selected",defaultValue:"",className:"hidden",type:"input"},{key:"click_action_param",hideExpression:(n,i,a)=>"input"!==a?.parent?.model.specific_type_click_action_selected,type:"input",className:"basis-6/12",props:{label:"Gi\xe1 tr\u1ecb tham s\u1ed1",placeholder:"Nh\u1eadp gi\xe1 tr\u1ecb"},expressions:{"props.disabled":"formState.disabled"}},{key:"click_action_param",type:"select-custom",className:"basis-6/12",hideExpression:(n,i,a)=>"input"===a?.parent?.model.specific_type_click_action_selected,props:{label:"Tham s\u1ed1",placeholder:"Ch\u1ecdn tham s\u1ed1",options:[],viewValue:"title",labelProp:"title",valueProp:"id"},expressions:{"props.disabled":"formState.disabled"},hooks:{onInit:n=>{const i=n?.form?.get("click_action_type");i&&(n.templateOptions.options=i.valueChanges.pipe((0,d.startWith)(i.value),(0,d.distinctUntilChanged)(),(0,d.concatMap)(a=>o.getListActionParam(a).pipe((0,d.map)(s=>(s.data.find(p=>n?.model?.click_action_param===p.id)||n.formControl.setValue(null),s.data))))))}}}])(this.iComLibsServicesProjectCampaignV3Service),this.model=this.nzModalData.model,this.icomFunctionControl.emit({save:this.handleSave.bind(this)}),"view"===this.mode&&(this.options.formState.disabled=!0)}handleSave(){if(!this.form.invalid)return!0;(0,V.c2)(this.form)}static#e=this.\u0275fac=function(n){return new(n||o)};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["icom-libs-campaign-management-detail-mission-information"]],inputs:{mode:"mode",modeExtend:"modeExtend",model:"model",isAdd:"isAdd",missions:"missions"},outputs:{icomFunctionControl:"icomFunctionControl"},standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:2,vars:6,consts:[["nz-form","",3,"formGroup","nzLayout"],[3,"model","fields","options","form"]],template:function(n,i){1&n&&(e.\u0275\u0275elementStart(0,"form",0),e.\u0275\u0275element(1,"formly-form",1),e.\u0275\u0275elementEnd()),2&n&&(e.\u0275\u0275property("formGroup",i.form)("nzLayout","vertical"),e.\u0275\u0275advance(1),e.\u0275\u0275property("model",i.model)("fields",i.fields)("options",i.options)("form",i.form))},dependencies:[y.FormlyNgZorroAntdModule,l.ReactiveFormsModule,l.\u0275NgNoValidate,l.NgControlStatusGroup,l.FormGroupDirective,h.FormlyModule,h.FormlyForm,g.NzButtonModule,b.NzSpinModule,u.NzFormModule,u.NzFormDirective,C.NzStepsModule],encapsulation:2,changeDetection:0})}return o})();var A=m(53750);let oe=(()=>{class o{constructor(){this.form=new l.FormGroup({}),this.fields=[],this.campaignService=(0,e.inject)(x.wb),this.productService=(0,e.inject)(x.k),this.icomMessageService=(0,e.inject)(A.Qi),this.icomFunctionControl=new e.EventEmitter}ngOnInit(){this.fields=((o,r,t)=>[{key:"reward",expressions:{"props.disabled":"formState.disabled"},wrappers:["collapse"],props:{label:"Ph\u1ea7n th\u01b0\u1edfng cho ng\u01b0\u1eddi th\u1ef1c hi\u1ec7n h\xe0nh \u0111\u1ed9ng",changeChecked:(n,i)=>{i.fieldGroup.find(s=>"is_active"===s.key).model.is_active=n},setChecked:n=>n?.fieldGroup?.find(a=>"is_active"===a.key)?.model?.is_active},fieldGroup:[{key:"name",type:"input",className:"",props:{placeholder:"Nh\u1eadp t\xean ph\u1ea7n th\u01b0\u1edfng",label:"T\xean ph\u1ea7n th\u01b0\u1edfng",type:"string"},validators:{validation:[{name:"noWhitespace",options:{errorPath:"value"}}]},expressions:{"props.disabled":"formState.disabled","props.required":"model?.is_active"}},{key:"is_active",defaultValue:!1,type:"checkbox",className:"hidden"},{key:"reward_level",type:"select-custom",props:{label:"M\u1ee9c th\u01b0\u1edfng",placeholder:"Ch\u1ecdn m\u1ee9c th\u01b0\u1edfng",viewValue:"title",labelProp:"title",valueProp:"id",options:o.getRewardLevel().pipe((0,d.map)(n=>n.data))},expressions:{"props.disabled":"formState.disabled","props.required":"model?.is_active"}},{key:"type",type:"select-custom",props:{label:"H\xecnh th\u1ee9c th\u01b0\u1edfng",placeholder:"Ch\u1ecdn h\xecnh th\u1ee9c th\u01b0\u1edfng",viewValue:"title",labelProp:"title",valueProp:"id",options:o.getRewardForm().pipe((0,d.map)(n=>n.data))},expressions:{"props.disabled":"formState.disabled","props.required":"model?.is_active"}},{key:"type_value",type:"nz-input-number",props:{label:" Nh\u1eadp s\u1ed1 ph\u1ea7n th\u01b0\u1edfng",placeholder:"Nh\u1eadp gi\xe1 tr\u1ecb",min:0,max:999999,type:"number"},hideExpression:n=>"random"!==n.type,expressions:{"props.disabled":"formState.disabled","props.required":"model?.is_active"}},{key:"items",type:"array",props:{label:"Lo\u1ea1i ph\u1ea7n th\u01b0\u1edfng",addText:"Th\xeam ph\u1ea7n th\u01b0\u1edfng",required:!0},expressions:{"props.disabled":"formState.disabled","props.required":"model?.is_active"},fieldArray:{wrappers:["group"],props:{label:""},expressions:{"props.disabled":"formState.disabled","props.required":n=>n?.options?.formState?.mainModel?.reward?.is_active||!1},fieldGroup:[{key:"type",type:"select-custom",props:{label:"Lo\u1ea1i ph\u1ea7n th\u01b0\u1edfng",placeholder:"Ch\u1ecdn lo\u1ea1i ph\u1ea7n th\u01b0\u1edfng",viewValue:"title",labelProp:"title",valueProp:"id",required:!0,options:o.getTypeReward().pipe((0,d.map)(n=>n.data)),functionCheckExist:(n,i)=>{const a=n.options?.formState.mainModel,s=a&&a?.reward?.items,p=[];s?.forEach(c=>{p.push(c?.type||"")}),i?.length&&i?.forEach(c=>{p.includes(c.id)&&(c.disabled=!0)})}},expressions:{"props.required":n=>n?.options?.formState?.mainModel?.reward?.is_active||!1}},{key:"value",type:"nz-input-number",className:"",props:{placeholder:"Nh\u1eadp \u0110i\u1ec3m th\u01b0\u1edfng",label:"Gi\xe1 tr\u1ecb",type:"number",required:!0,min:0},hideExpression:n=>!n?.type||"point"!==n?.type,expressions:{"props.required":n=>n?.options?.formState?.mainModel?.reward?.is_active||!1}},{key:"id",type:"select-custom",props:{label:"Voucher",placeholder:"Ch\u1ecdn voucher",viewValue:"name",labelProp:"name",valueProp:"id",required:!0,multiple:!0,options:r.getProductFromCampaigns().pipe((0,d.map)(n=>n?.data))},hideExpression:n=>!n?.type||"voucher"!==n?.type,expressions:{"props.required":n=>n?.options?.formState?.mainModel?.reward?.is_active||!1}}]}},{key:"message_template",type:"select-custom",expressions:{"props.disabled":"formState.disabled"},props:{label:"Th\xf4ng b\xe1o",placeholder:"Ch\u1ecdn m\u1eabu th\xf4ng b\xe1o",viewValue:"title",labelProp:"title",valueProp:"id",options:o.getMessageTemplate().pipe((0,d.map)(n=>n.data))}}]},{key:"reward_reference",expressions:{"props.disabled":"formState.disabled","props.required":"model?.is_active"},props:{label:"Ph\u1ea7n th\u01b0\u1edfng cho ng\u01b0\u1eddi gi\u1edbi thi\u1ec7u",changeChecked:(n,i)=>{i.fieldGroup.find(s=>"is_active"===s.key).model.is_active=n},setChecked:n=>n?.fieldGroup?.find(a=>"is_active"===a.key)?.model?.is_active},className:" mt-4",wrappers:["collapse"],fieldGroup:[{key:"name",type:"input",className:"",props:{placeholder:"Nh\u1eadp t\xean ph\u1ea7n th\u01b0\u1edfng",label:"T\xean ph\u1ea7n th\u01b0\u1edfng",type:"string"},validators:{validation:[{name:"noWhitespace",options:{errorPath:"value"}}]},expressions:{"props.disabled":"formState.disabled","props.required":"model?.is_active"}},{key:"is_active",defaultValue:!1,type:"checkbox",hide:!0},{key:"reward_level",type:"select-custom",props:{label:"M\u1ee9c th\u01b0\u1edfng",placeholder:"Ch\u1ecdn m\u1ee9c th\u01b0\u1edfng",viewValue:"title",labelProp:"title",valueProp:"id",options:o.getRewardLevel().pipe((0,d.map)(n=>n.data))},expressions:{"props.disabled":"formState.disabled","props.required":"model?.is_active"}},{key:"type",type:"select-custom",props:{label:"H\xecnh th\u1ee9c th\u01b0\u1edfng",placeholder:"Ch\u1ecdn h\xecnh th\u1ee9c th\u01b0\u1edfng",viewValue:"title",labelProp:"title",valueProp:"id",options:o.getRewardForm().pipe((0,d.map)(n=>n.data))},expressions:{"props.disabled":"formState.disabled","props.required":"model?.is_active"}},{key:"type_value",type:"nz-input-number",props:{label:" Nh\u1eadp s\u1ed1 ph\u1ea7n th\u01b0\u1edfng",placeholder:"Nh\u1eadp gi\xe1 tr\u1ecb",min:0,max:999999,type:"number"},hideExpression:n=>"random"!==n.type,expressions:{"props.disabled":"formState.disabled","props.required":"model?.is_active"}},{key:"items",type:"array",props:{label:"Lo\u1ea1i ph\u1ea7n th\u01b0\u1edfng",addText:"Th\xeam ph\u1ea7n th\u01b0\u1edfng"},expressions:{"props.disabled":"formState.disabled","props.required":n=>n?.options?.formState?.mainModel?.reward_reference?.is_active||!1},fieldArray:{wrappers:["group"],expressions:{"props.disabled":"formState.disabled","props.required":n=>n?.options?.formState?.mainModel?.reward_reference?.is_active||!1},fieldGroup:[{key:"type",type:"select-custom",props:{label:"Lo\u1ea1i ph\u1ea7n th\u01b0\u1edfng",placeholder:"Ch\u1ecdn lo\u1ea1i ph\u1ea7n th\u01b0\u1edfng",viewValue:"title",labelProp:"title",valueProp:"id",functionCheckExist:(n,i)=>{const a=n.options?.formState.mainModel,s=a&&a?.reward_reference?.items,p=[];s?.forEach(c=>{p.push(c?.type||"")}),i?.length&&i?.forEach(c=>{p.includes(c.id)&&(c.disabled=!0)})},options:o.getTypeReward().pipe((0,d.map)(n=>n.data))},expressions:{"props.required":n=>n?.options?.formState?.mainModel?.reward_reference?.is_active||!1}},{key:"value",type:"nz-input-number",className:"",props:{placeholder:"Nh\u1eadp \u0110i\u1ec3m th\u01b0\u1edfng",label:"Gi\xe1 tr\u1ecb",type:"number",min:0},hideExpression:n=>!n?.type||"point"!==n?.type,expressions:{"props.required":n=>n?.options?.formState?.mainModel?.reward_reference?.is_active||!1}},{key:"id",type:"select-custom",props:{label:"Voucher",placeholder:"Ch\u1ecdn voucher",viewValue:"name",labelProp:"name",valueProp:"id",multiple:!0,options:r.getProductFromCampaigns().pipe((0,d.map)(n=>n?.data))},hideExpression:n=>!n?.type||"voucher"!==n?.type,expressions:{"props.required":n=>n?.options?.formState?.mainModel?.reward_reference?.is_active||!1}}]}},{key:"message_template",type:"select-custom",expressions:{"props.disabled":"formState.disabled"},props:{label:"Th\xf4ng b\xe1o",placeholder:"Ch\u1ecdn m\u1eabu th\xf4ng b\xe1o",viewValue:"title",labelProp:"title",valueProp:"id",options:o.getMessageTemplate().pipe((0,d.map)(n=>n.data))}}]}])(this.campaignService,this.productService),this.options={formState:{disabled:!1,required:!1,mainModel:this.model}},this.icomFunctionControl.emit({save:this.handleSave.bind(this)}),"view"===this.mode&&(this.options.formState.disabled=!0)}handleSave(){if(this.form.invalid)return void(0,V.c2)(this.form);const t=this.model?.reward?.items?.find(i=>"voucher"===i.type),n=this.model?.reward_reference?.items?.find(i=>"voucher"===i.type);if("random"===this.model?.reward?.type&&t&&this.model?.reward?.type_value>t?.id?.length)this.icomMessageService.showAlertMessageError("V\u1edbi h\xecnh th\u1ee9c th\u01b0\u1edfng ng\u1eabu nhi\xean, s\u1ed1 ph\u1ea7n th\u01b0\u1edfng cho m\u1ed7i kh\xe1ch h\xe0ng ph\u1ea3i nh\u1ecf h\u01a1n ho\u1eb7c b\u1eb1ng s\u1ed1 voucher \u0111\xe3 ch\u1ecdn.");else if("random"===this.model?.reward?.type&&this.model?.reward?.items?.find(i=>"point"===i.type))this.icomMessageService.showAlertMessageError("H\xecnh th\u1ee9c th\u01b0\u1edfng ng\u1eabu nhi\xean ch\u1ec9 \xe1p d\u1ee5ng cho lo\u1ea1i ph\u1ea7n th\u01b0\u1edfng voucher.");else if("random"===this.model?.reward?.type&&n&&this.model?.reward_reference?.type_value>n?.id?.length)this.icomMessageService.showAlertMessageError("V\u1edbi h\xecnh th\u1ee9c th\u01b0\u1edfng ng\u1eabu nhi\xean, s\u1ed1 ph\u1ea7n th\u01b0\u1edfng cho m\u1ed7i kh\xe1ch h\xe0ng ph\u1ea3i nh\u1ecf h\u01a1n ho\u1eb7c b\u1eb1ng s\u1ed1 voucher \u0111\xe3 ch\u1ecdn.");else{if("random"!==this.model?.reward?.type||"random"!==this.model?.reward_reference?.type||!this.model?.reward_reference?.items?.find(i=>"point"===i.type))return!0;this.icomMessageService.showAlertMessageError("H\xecnh th\u1ee9c th\u01b0\u1edfng ng\u1eabu nhi\xean ch\u1ec9 \xe1p d\u1ee5ng cho lo\u1ea1i ph\u1ea7n th\u01b0\u1edfng voucher.")}}static#e=this.\u0275fac=function(n){return new(n||o)};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["icom-libs-campaign-management-detail-mission-reward"]],inputs:{mode:"mode",isAdd:"isAdd",data:"data",model:"model"},outputs:{icomFunctionControl:"icomFunctionControl"},standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:2,vars:6,consts:[["nz-form","",3,"formGroup","nzLayout"],[3,"model","fields","options","form"]],template:function(n,i){1&n&&(e.\u0275\u0275elementStart(0,"form",0),e.\u0275\u0275element(1,"formly-form",1),e.\u0275\u0275elementEnd()),2&n&&(e.\u0275\u0275property("formGroup",i.form)("nzLayout","vertical"),e.\u0275\u0275advance(1),e.\u0275\u0275property("model",i.model)("fields",i.fields)("options",i.options)("form",i.form))},dependencies:[y.FormlyNgZorroAntdModule,l.ReactiveFormsModule,l.\u0275NgNoValidate,l.NgControlStatusGroup,l.FormGroupDirective,h.FormlyModule,h.FormlyForm,g.NzButtonModule,b.NzSpinModule,u.NzFormModule,u.NzFormDirective,C.NzStepsModule],encapsulation:2,changeDetection:0})}return o})();var P=m(65893),F=m(72871),O=m(17082),I=m(54463);const R=o=>[{fieldGroupClassName:"flex row  mt-4",key:"",fieldGroup:[{key:"value",type:"nz-input-number",className:"basis-2/12 w-36",props:{placeholder:"Nh\u1eadp s\u1ed1",type:"number",min:0,required:!0},expressions:{"props.disabled":"formState.disabled"}},{key:"unit",type:"select-custom",className:"basis-1/12 ml-4",defaultValue:"day",props:{viewValue:"name",labelProp:"name",valueProp:"id",required:!0,options:[{id:"day",name:"Ng\xe0y"}]},expressions:{"props.disabled":"formState.disabled"}},{key:"sub_value",type:"select-custom",className:"basis-8/12 ml-4",props:{label:"T\xednh t\u1eeb th\u1eddi \u0111i\u1ec3m",placeholder:"Ch\u1ecdn h\xe0nh \u0111\u1ed9ng/ s\u1ef1 ki\u1ec7n",viewValue:"title",labelProp:"title",required:!0,valueProp:"id",options:o.getActionMission().pipe((0,d.map)(r=>r.data))},expressions:{"props.disabled":"formState.disabled"}}]}],ae=o=>[{fieldGroupClassName:"flex row items-center mt-4",key:"",fieldGroup:[{key:"sub_value",type:"select-custom",className:"basis-5/12",props:{placeholder:"Ch\u1ecdn h\xe0nh \u0111\u1ed9ng/ s\u1ef1 ki\u1ec7n",viewValue:"title",labelProp:"title",required:!0,valueProp:"id",options:o.getActionMission().pipe((0,d.map)(r=>r.data))},expressions:{"props.disabled":"formState.disabled"}}]}],re=o=>[{key:"sub_value_2",type:"select-custom",className:"basis-5/12 mt-4",props:{placeholder:"Ch\u1ecdn h\xe0nh \u0111\u1ed9ng/ s\u1ef1 ki\u1ec7n",viewValue:"title",label:"Ph\u1ee5 thu\u1ed9c h\xe0nh \u0111\u1ed9ng/ s\u1ef1 ki\u1ec7n ch\u01b0a x\u1ea3y ra",labelProp:"title",valueProp:"id",required:!0,options:o.getActionMission().pipe((0,d.map)(r=>r.data))}},{key:"sub_value",type:"select-custom",className:"basis-5/12 ml-4",props:{placeholder:"Ch\u1ecdn h\xe0nh \u0111\u1ed9ng/ s\u1ef1 ki\u1ec7n",viewValue:"title",label:"Ph\u1ee5 thu\u1ed9c h\xe0nh \u0111\u1ed9ng/ s\u1ef1 ki\u1ec7n \u0111\xe3 x\u1ea3y ra",labelProp:"title",required:!0,valueProp:"id",options:o.getActionMission().pipe((0,d.map)(r=>r.data))}}],q=[{id:"1",name:"Th\u1eddi h\u1ea1n tham gia chi\u1ebfn d\u1ecbch",groupId:"customer",items:[{type:"by_action_by_event",name:"Theo h\xe0nh \u0111\u1ed9ng/ s\u1ef1 ki\u1ec7n",groupId:"customer",items:[]}]},{id:"2",name:"S\u1ed1 l\u1ea7n th\u1ef1c hi\u1ec7n",groupId:"action",items:[{type:"count_task_complete",name:"S\u1ed1 l\u1ea7n t\xednh ho\xe0n th\xe0nh nhi\u1ec7m v\u1ee5",groupId:"customer",items:[]},{type:"max_action_number",name:"S\u1ed1 l\u1ea7n t\u1ed1i \u0111a",groupId:"customer",items:[]}]},{id:"3",name:"Th\u1eddi gian li\xean quan",groupId:"reward",items:[{type:"time_limited_rewards",name:"Th\u1eddi h\u1ea1n x\xe9t th\u01b0\u1edfng",groupId:"reward",items:[]}]},{id:"4",name:"S\u1ed1 ph\u1ea7n th\u01b0\u1edfng",groupId:"reward",items:[{type:"campaign_limits",name:"Gi\u1edbi h\u1ea1n theo chi\u1ebfn d\u1ecbch",groupId:"reward",items:[]}]},{id:"5",name:"H\xe0nh \u0111\u1ed9ng li\xean quan",groupId:"reward",items:[{type:"action_event_record_rewards",name:"H\xe0nh \u0111\u1ed9ng/ s\u1ef1 ki\u1ec7n ghi nh\u1eadn th\u01b0\u1edfng",groupId:"reward",items:[]},{type:"action_event_dependent",name:"H\xe0nh \u0111\u1ed9ng/ s\u1ef1 ki\u1ec7n ph\u1ee5 thu\u1ed9c",groupId:"reward",items:[]}]},{id:"6",name:"H\u1ed3 s\u01a1 kh\xe1ch h\xe0ng",groupId:"customer_reference",items:[{type:"thoi_gian_dang_ky",name:"Theo th\u1eddi gian \u0111\u0103ng k\xfd m\u1edbi",groupId:"customer_reference",items:[{type:"count_task_complete",name:"S\u1ed1 l\u1ea7n t\xednh ho\xe0n th\xe0nh nhi\u1ec7m v\u1ee5",groupId:"customer_reference",items:[]},{type:"max_action_number",name:"S\u1ed1 l\u1ea7n t\u1ed1i \u0111a",groupId:"customer_reference",items:[]}]}]}];function me(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"li",7)(1,"ul",8)(2,"nz-list-item-action")(3,"a",9),e.\u0275\u0275listener("click",function(i){const s=e.\u0275\u0275restoreView(t).$implicit,p=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(p.handlerClick(i,s))}),e.\u0275\u0275text(4,"+"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd()}if(2&o){const t=r.$implicit;e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate1(" ",t.name," ")}}function de(o,r){if(1&o&&(e.\u0275\u0275elementStart(0,"ul",5),e.\u0275\u0275template(1,me,6,1,"li",6),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("nzDataSource",t.listFormula),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.listFormula)}}function pe(o,r){if(1&o&&(e.\u0275\u0275elementStart(0,"nz-tag",10),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&o){const t=r.$implicit;e.\u0275\u0275property("nzMode","closeable"),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.name," ")}}let ce=(()=>{class o{constructor(){this.form=new l.FormGroup({}),this.fields=[],this.options={formState:{disabled:!0}},this.listFormula=[],this.listFormulaSelected=[],this.icomSave=new e.EventEmitter,this.cdr=(0,e.inject)(e.ChangeDetectorRef),this.model={},this.fields=[{key:"group",type:"select-custom",defaultValue:"customer",props:{label:"Ti\xeau ch\xed c\u1ea5p 1",viewValue:"name",labelProp:"name",valueProp:"id",options:[{id:"customer",name:"Kh\xe1ch h\xe0ng"},{id:"action",name:"H\xe0nh \u0111\u1ed9ng/ S\u1ef1 ki\u1ec7n"},{id:"reward",name:"Ph\u1ea7n th\u01b0\u1edfng"},{id:"customer_reference",name:"Ng\u01b0\u1eddi \u0111\u01b0\u1ee3c m\u1eddi"}]}},{key:"sub_group",type:"select-custom",props:{label:"Ti\xeau ch\xed c\u1ea5p 2",viewValue:"name",labelProp:"name",valueProp:"id",options:[]},hooks:{onInit:t=>{const n=q,i=t?.parent?.get?.("group").formControl;t.props.options=i?.valueChanges.pipe((0,P.startWith)(i.value),(0,P.distinctUntilChanged)(),(0,P.map)(()=>{const a=i.value,s=n.filter(c=>c.groupId===a);return s.find(c=>a===c.id)||t.formControl.setValue(null),s&&s&&s.length&&(this.listItemSelected=s||[]),s}))}}}]}ngOnInit(){setTimeout(()=>{this.form.controls.sub_group?.valueChanges.subscribe({next:t=>{let n=[];this.listItemSelected.forEach(i=>{const a=[i].find(s=>s.id===t)?.items;a&&a.length&&(n=a)}),this.listFormula=n,this.cdr.detectChanges()}})},200)}handlerClick(t,n){t.stopPropagation(),t.preventDefault(),!(this.listFormulaSelected&&this.listFormulaSelected.length&&this.listFormulaSelected.find(i=>i.type===n.type))&&(this.listFormulaSelected.push(n),this.cdr.detectChanges())}trackByFn(t,n){return n.id}handlerSave(){this.icomSave.emit(this.listFormulaSelected.map(t=>({...t,id:t.id||(0,I.v4)()})))}static#e=this.\u0275fac=function(n){return new(n||o)};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["icom-libs-campaign-management-detail-mission-condition-modal"]],outputs:{icomSave:"icomSave"},standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:5,vars:9,consts:[["nz-form","",3,"formGroup","nzLayout"],[3,"model","fields","options","form"],["nz-list","","nzBordered","","nzSize","small",3,"nzDataSource",4,"ngIf"],[1,"mt-4","w-full","h-full"],[3,"nzMode",4,"ngFor","ngForOf","ngForTrackBy"],["nz-list","","nzBordered","","nzSize","small",3,"nzDataSource"],["nz-list-item","","nzNoFlex","",4,"ngFor","ngForOf"],["nz-list-item","","nzNoFlex",""],["nz-list-item-actions",""],[3,"click"],[3,"nzMode"]],template:function(n,i){1&n&&(e.\u0275\u0275elementStart(0,"form",0),e.\u0275\u0275element(1,"formly-form",1),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(2,de,2,2,"ul",2),e.\u0275\u0275elementStart(3,"div",3),e.\u0275\u0275template(4,pe,2,2,"nz-tag",4),e.\u0275\u0275elementEnd()),2&n&&(e.\u0275\u0275property("formGroup",i.form)("nzLayout","vertical"),e.\u0275\u0275advance(1),e.\u0275\u0275property("model",i.model)("fields",i.fields)("options",i.options)("form",i.form),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",i.listFormula&&i.listFormula.length),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",i.listFormulaSelected)("ngForTrackBy",i.trackByFn))},dependencies:[y.FormlyNgZorroAntdModule,l.ReactiveFormsModule,l.\u0275NgNoValidate,l.NgControlStatusGroup,l.FormGroupDirective,h.FormlyModule,h.FormlyForm,g.NzButtonModule,f.NgIf,b.NzSpinModule,u.NzFormModule,u.NzFormDirective,C.NzStepsModule,F.NzListModule,F.NzListComponent,F.NzListItemComponent,F.NzListItemActionsComponent,F.NzListItemActionComponent,f.NgFor,O.NzTagModule,O.NzTagComponent],encapsulation:2,changeDetection:0})}return o})();var ue=m(14859),he=m(17891);let ge=(()=>{class o{transform(t){let n="";return t.group&&(n+=[{id:"customer",name:"Kh\xe1ch h\xe0ng"},{id:"action",name:"H\xe0nh \u0111\u1ed9ng/ S\u1ef1 ki\u1ec7n"},{id:"reward",name:"Ph\u1ea7n th\u01b0\u1edfng"},{id:"customer_reference",name:"Ng\u01b0\u1eddi \u0111\u01b0\u1ee3c m\u1eddi"}].find(i=>i.id===t.group)?.name||""),t.type&&(n+=" - ",n+=q.find(i=>i.groupId===t.group)?.name||""),n}static#e=this.\u0275fac=function(n){return new(n||o)};static#t=this.\u0275pipe=e.\u0275\u0275definePipe({name:"icomLibsCampaignConvertTooltipConditionPipe",type:o,pure:!0,standalone:!0})}return o})();var w=m(47809),T=m(54829),$=m(75150);function fe(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",4),e.\u0275\u0275listener("click",function(i){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.handlerAddCondition(i))}),e.\u0275\u0275text(1," Th\xeam \u0111i\u1ec1u ki\u1ec7n "),e.\u0275\u0275elementEnd()}}function _e(o,r){if(1&o&&(e.\u0275\u0275elementStart(0,"form",13),e.\u0275\u0275element(1,"formly-form",14),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext(2).$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("formGroup",t.form),e.\u0275\u0275advance(1),e.\u0275\u0275property("model",t)("fields",t.fields)("options",n.options)("form",t.form)}}function Ce(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",15),e.\u0275\u0275listener("click",function(i){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(2).$implicit,s=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(s.handlerRemove(i,a))}),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()}2&o&&(e.\u0275\u0275property("nzType","default")("nzDanger",!0),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ","X\xf3a"," "))}const be=function(){return{type:"info-circle",theme:"outline"}};function ye(o,r){if(1&o&&(e.\u0275\u0275elementStart(0,"div",7),e.\u0275\u0275elementContainerStart(1),e.\u0275\u0275elementStart(2,"nz-form-label",8),e.\u0275\u0275pipe(3,"icomLibsCampaignConvertTooltipConditionPipe"),e.\u0275\u0275elementStart(4,"span",9),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",10),e.\u0275\u0275template(7,_e,2,5,"form",11),e.\u0275\u0275template(8,Ce,2,3,"button",12),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275property("nzTooltipTitle",e.\u0275\u0275pipeBind1(3,5,t))("nzTooltipIcon",e.\u0275\u0275pureFunction0(7,be)),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",(null==t?null:t.name)||""," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",t.fields),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","edit"===n.mode)}}function ve(o,r){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,ye,9,8,"div",6),e.\u0275\u0275elementContainerEnd()),2&o){const t=r.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t.specific_hidden)}}function ze(o,r){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,ve,2,1,"ng-container",5),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.dataCondition.config)}}let xe=(()=>{class o{constructor(){this.fields=[],this.options={formState:{disabled:!1}},this.modalService=(0,e.inject)(E.NzModalService),this.viewContainerRef=(0,e.inject)(e.ViewContainerRef),this.nzModalData=(0,e.inject)(E.NZ_MODAL_DATA),this.cdr=(0,e.inject)(e.ChangeDetectorRef),this.campaignService=(0,e.inject)(x.wb),this.icomFunctionControl=new e.EventEmitter,this.model={}}ngOnInit(){this.icomFunctionControl.emit({save:this.handleSave.bind(this)}),this.dataCondition&&!this.dataCondition.config&&(this.dataCondition.config=[]),"view"===this.mode&&(this.options.formState.disabled=!0),this.mapFormField()}mapFormField(){const t=(o=>[{type:"by_action_by_event",fields:[...R(o),{key:"operator",type:"select-custom",className:"flex",defaultValue:"&&",props:{viewValue:"name",labelProp:"name",valueProp:"id",required:!0,options:[{id:"&&",name:"V\xe0"},{id:"||",name:"Ho\u1eb7c"}]},expressions:{"props.disabled":"formState.disabled"}}],group:"customer",specific_name_formula:"Theo h\xe0nh \u0111\u1ed9ng/ s\u1ef1 ki\u1ec7n",form:new l.FormGroup({})},{type:"count_task_complete",group:"action",specific_name_formula:"S\u1ed1 l\u1ea7n t\xednh ho\xe0n th\xe0nh nhi\u1ec7m v\u1ee5",fields:[{key:"value",type:"nz-input-number",className:"w-36 flex",props:{placeholder:"Nh\u1eadp s\u1ed1 l\u1ea7n",nzPlaceHolder:"Nh\u1eadp s\u1ed1 l\u1ea7n",type:"number",required:!0,min:0},expressions:{"props.disabled":"formState.disabled"}},{key:"operator",type:"select-custom",className:"flex",defaultValue:"&&",props:{viewValue:"name",labelProp:"name",valueProp:"id",required:!0,options:[{id:"&&",name:"V\xe0"},{id:"||",name:"Ho\u1eb7c"}]},expressions:{"props.disabled":"formState.disabled"}}],form:new l.FormGroup({})},{type:"max_action_number",group:"action",specific_name_formula:"S\u1ed1 l\u1ea7n t\u1ed1i \u0111a",fields:[{key:"value",type:"nz-input-number",className:"w-36 flex",props:{placeholder:"Nh\u1eadp s\u1ed1 l\u1ea7n",nzPlaceHolder:"Nh\u1eadp s\u1ed1 l\u1ea7n",type:"number",required:!0,min:0},expressions:{"props.disabled":"formState.disabled"}},{key:"operator",type:"select-custom",className:"flex",defaultValue:"&&",props:{viewValue:"name",labelProp:"name",valueProp:"id",required:!0,options:[{id:"&&",name:"V\xe0"},{id:"||",name:"Ho\u1eb7c"}]},expressions:{"props.disabled":"formState.disabled"}}],form:new l.FormGroup({})},{type:"time_limited_rewards",group:"reward",specific_name_formula:"Th\u1eddi h\u1ea1n x\xe9t th\u01b0\u1edfng",fields:[...R(o),{key:"operator",type:"select-custom",className:"flex",defaultValue:"&&",props:{viewValue:"name",labelProp:"name",valueProp:"id",required:!0,options:[{id:"&&",name:"V\xe0"},{id:"||",name:"Ho\u1eb7c"}]},expressions:{"props.disabled":"formState.disabled"}}],form:new l.FormGroup({})},{type:"campaign_limits",group:"reward",specific_name_formula:"Gi\u1edbi h\u1ea1n theo chi\u1ebfn d\u1ecbch",fields:[{key:"operator",type:"select-custom",className:"flex",defaultValue:"&&",props:{viewValue:"name",labelProp:"name",valueProp:"id",required:!0,options:[{id:"&&",name:"V\xe0"},{id:"||",name:"Ho\u1eb7c"}]},expressions:{"props.disabled":"formState.disabled"}}],form:new l.FormGroup({})},{type:"action_event_record_rewards",group:"reward",specific_name_formula:"H\xe0nh \u0111\u1ed9ng/ s\u1ef1 ki\u1ec7n ghi nh\u1eadn th\u01b0\u1edfng",fields:[...ae(o),{key:"operator",type:"select-custom",className:"flex",defaultValue:"&&",props:{viewValue:"name",labelProp:"name",valueProp:"id",required:!0,options:[{id:"&&",name:"V\xe0"},{id:"||",name:"Ho\u1eb7c"}]},expressions:{"props.disabled":"formState.disabled"}}],form:new l.FormGroup({})},{type:"action_event_dependent",group:"reward",specific_name_formula:"H\xe0nh \u0111\u1ed9ng/ s\u1ef1 ki\u1ec7n ph\u1ee5 thu\u1ed9c",fields:[...re(o),{key:"operator",type:"select-custom",className:"flex",defaultValue:"&&",props:{viewValue:"name",labelProp:"name",valueProp:"id",required:!0,options:[{id:"&&",name:"V\xe0"},{id:"||",name:"Ho\u1eb7c"}]},expressions:{"props.disabled":"formState.disabled"}}],form:new l.FormGroup({})},{type:"thoi_gian_dang_ky",fields:[{key:"after_specific_day",type:"date",className:"mt-4",props:{className:"mt-4",format:"dd-MM-yyyy",required:!0,nzShowTime:!1,label:"T\u1eeb",placeholder:"DD/MM/YYYY",emitTimeLocal:!0,onlyDay:!0},expressions:{"props.disabled":"formState.disabled"}},{key:"before_specific_day",type:"date",className:"mt-4",props:{label:"\u0110\u1ebfn",className:"mt-4",format:"dd-MM-yyyy",placeholder:"DD/MM/YYYY",required:!0,nzShowTime:!1,emitTimeLocal:!0,onlyDay:!0},expressions:{"props.disabled":"formState.disabled"}},{key:"operator",type:"select-custom",className:"flex",defaultValue:"&&",props:{viewValue:"name",labelProp:"name",valueProp:"id",required:!0,options:[{id:"&&",name:"V\xe0"},{id:"||",name:"Ho\u1eb7c"}]},expressions:{"props.disabled":"formState.disabled"}}],group:"customer_reference",specific_name_formula:"Th\u1eddi h\u1ea1n c\u1ee5 th\u1ec3",form:new l.FormGroup({})}])(this.campaignService);this.dataCondition.config.forEach((n,i)=>{const a=t.find(s=>s.type===n.type);a&&(this.dataCondition.config[i]={...n,...a})})}handlerAddCondition(t){t.stopPropagation(),t.preventDefault();const n=this.modalService.create({nzTitle:"Th\xeam \u0111i\u1ec1u ki\u1ec7n \xe1p d\u1ee5ng",nzContent:ce,nzMaskClosable:!1,nzClosable:!1,nzViewContainerRef:this.viewContainerRef,nzWidth:968,nzFooter:[{label:"\u0110\xf3ng",onClick:()=>n.destroy()},{label:"L\u01b0u",type:"primary",loading:!1,onClick(){n.getContentComponent().handlerSave(),n.destroy()}}]});n.getContentComponent().icomSave.subscribe(a=>{this.dataCondition.config&&this.dataCondition.config.push(...a),this.dataCondition.config=[...this.dataCondition.config],this.mapFormField(),this.cdr.detectChanges()})}handleSave(){let t=!1;return this.dataCondition.config&&this.dataCondition.config.forEach(i=>{if(i?.form){if(i?.form&&!i?.form?.valid)return Object.keys(i.form.controls).forEach(a=>{i.form.controls[a].touched=!0}),void(t=!0);i.form.markAsTouched(),i.form.submitted=!0}}),!t&&(this.dataCondition?.config||this.dataCondition?.config.length?(this.dataCondition.relationship="",this.dataMission&&this.dataMission.click_action_param&&"APP_SCREEN_WORKER_PROFILE"===this.dataMission.click_action_param&&!this.dataCondition.config.find(i=>"uuid2"===i.id)&&this.dataCondition.config?.push({attribute:"full_name",group:"customer",id:"uuid2",operator:"is_not_empty",type:"customer_profile",specific_hidden:!0},{attribute:"email",group:"customer",id:"uuid3",operator:"is_not_empty",type:"customer_profile",specific_hidden:!0},{attribute:"birthdate",group:"customer",id:"uuid4",operator:"is_not_empty",type:"customer_profile",specific_hidden:!0},{attribute:"address_city",group:"customer",id:"uuid5",operator:"is_not_empty",type:"customer_profile",specific_hidden:!0}),this.dataCondition?.config?.find(i=>"thoi_gian_dang_ky"===i.type&&"customer_reference"===i.group)&&(this.dataCondition?.config?.find(i=>"after_specific_day"===i.operator)&&(this.dataCondition.config=this.dataCondition?.config.filter(i=>"after_specific_day"!==i.operator)),this.dataCondition?.config?.find(i=>"before_specific_day"===i.operator)&&(this.dataCondition.config=this.dataCondition?.config.filter(i=>"before_specific_day"!==i.operator)),this.dataCondition.config.push(...this.convertObject(this.dataCondition?.config?.find(i=>"thoi_gian_dang_ky"===i.type)))),console.log(this.dataCondition),this.dataCondition.config.forEach((i,a)=>{this.dataCondition.relationship+=` ${i.id} ${a!==this.dataCondition.config.length-1?"&&":""}`,delete i.fields,delete i.form}),!0):void 0)}convertObject(t){const n=[];return t.after_specific_day&&n.push({operator:"after_specific_day",attribute:"thoi_gian_dang_ky",type:"customer_profile",group:"customer_reference",specific_hidden:!0,value:t.after_specific_day,id:(0,I.v4)()}),t.before_specific_day&&n.push({operator:"before_specific_day",attribute:"thoi_gian_dang_ky",value:t.before_specific_day,group:"customer_reference",type:"customer_profile",id:(0,I.v4)(),specific_hidden:!0}),n}handlerRemove(t,n){t.stopPropagation(),t.preventDefault(),this.dataCondition.config=this.dataCondition.config?.filter(i=>i.id!==n.id),this.dataCondition.relationship="",this.dataCondition?.config?.forEach(i=>{this.dataCondition.relationship+=` ${i.id} ${i.operator} `}),this.cdr.detectChanges()}static#e=this.\u0275fac=function(n){return new(n||o)};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["icom-libs-campaign-management-detail-mission-condition"]],inputs:{dataCondition:"dataCondition",dataMission:"dataMission",isAdd:"isAdd",mode:"mode"},outputs:{icomFunctionControl:"icomFunctionControl"},standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:4,vars:2,consts:[[1,"w-full","h-full"],[1,"flex","justify-end"],["class","flex","nz-button","","nzType","primary",3,"click",4,"ngIf"],[4,"ngIf"],["nz-button","","nzType","primary",1,"flex",3,"click"],[4,"ngFor","ngForOf"],["class","flex flex-col mt-2 border p-2 rounded-sm",4,"ngIf"],[1,"flex","flex-col","mt-2","border","p-2","rounded-sm"],["nzRequired","",1,"!w-full","!text-left",3,"nzTooltipTitle","nzTooltipIcon"],[1,"text-xs","font-semibold"],[1,"flex","items-baseline"],["class","ml-4 w-full","nz-form","",3,"formGroup",4,"ngIf"],["class","ml-4","nz-button","",3,"nzType","nzDanger","click",4,"ngIf"],["nz-form","",1,"ml-4","w-full",3,"formGroup"],[3,"model","fields","options","form"],["nz-button","",1,"ml-4",3,"nzType","nzDanger","click"]],template:function(n,i){1&n&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1),e.\u0275\u0275template(2,fe,2,0,"button",2),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(3,ze,2,1,"ng-container",3),e.\u0275\u0275elementEnd()),2&n&&(e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf","edit"===i.mode),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",(null==i.dataCondition?null:i.dataCondition.config)&&(null==i.dataCondition||null==i.dataCondition.config?null:i.dataCondition.config.length)))},dependencies:[y.FormlyNgZorroAntdModule,l.ReactiveFormsModule,l.\u0275NgNoValidate,l.NgControlStatusGroup,l.FormGroupDirective,h.FormlyModule,h.FormlyForm,g.NzButtonModule,g.NzButtonComponent,w.\u0275NzTransitionPatchDirective,T.NzWaveDirective,f.NgIf,b.NzSpinModule,u.NzFormModule,$.NzColDirective,u.NzFormDirective,u.NzFormLabelComponent,C.NzStepsModule,f.NgFor,ue.NzDropDownModule,he.NzSelectModule,l.FormsModule,ge],encapsulation:2,changeDetection:0})}return o})();const Me=["customFooter"],Se=function(){return[]};function Ee(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"icom-libs-campaign-management-detail-mission-information",9),e.\u0275\u0275listener("icomFunctionControl",function(i){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.handlerFunctionControl(i))}),e.\u0275\u0275elementEnd()}if(2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("model",t.model)("mode",t.nzModalData.mode)("modeExtend",t.nzModalData.modeExtend)("missions",t.nzModalData.missions||e.\u0275\u0275pureFunction0(4,Se))}}function Fe(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"icom-libs-campaign-management-detail-mission-reward",10),e.\u0275\u0275listener("icomFunctionControl",function(i){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.handlerFunctionControl(i))}),e.\u0275\u0275elementEnd()}if(2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("model",t.model)("data",t.model)("mode",t.nzModalData.mode)}}function Ie(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"icom-libs-campaign-management-detail-mission-condition",11),e.\u0275\u0275listener("icomFunctionControl",function(i){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.handlerFunctionControl(i))}),e.\u0275\u0275elementEnd()}if(2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("mode",t.nzModalData.mode)("dataCondition",null==t.model?null:t.model.condition)("dataMission",t.model)}}function we(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",14),e.\u0275\u0275listener("click",function(i){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(a.handlerPrev(i))}),e.\u0275\u0275elementStart(1,"span"),e.\u0275\u0275text(2,"Quay l\u1ea1i"),e.\u0275\u0275elementEnd()()}}function Te(o,r){1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,we,3,0,"button",13),e.\u0275\u0275elementContainerEnd())}function De(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",16),e.\u0275\u0275listener("click",function(i){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(a.handlerNextStep(i))}),e.\u0275\u0275elementStart(1,"span"),e.\u0275\u0275text(2,"Ti\u1ebfp t\u1ee5c"),e.\u0275\u0275elementEnd()()}}function Ne(o,r){1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,De,3,0,"button",15),e.\u0275\u0275elementContainerEnd())}function ke(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",16),e.\u0275\u0275listener("click",function(i){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(a.handlerSave(i))}),e.\u0275\u0275elementStart(1,"span"),e.\u0275\u0275text(2,"L\u01b0u"),e.\u0275\u0275elementEnd()()}}function Le(o,r){1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,ke,3,0,"button",15),e.\u0275\u0275elementContainerEnd())}function Ve(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",14),e.\u0275\u0275listener("click",function(i){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.handlerClose(i))}),e.\u0275\u0275elementStart(1,"span"),e.\u0275\u0275text(2,"\u0110\xf3ng"),e.\u0275\u0275elementEnd()()}}function Ae(o,r){if(1&o&&(e.\u0275\u0275elementStart(0,"nz-space"),e.\u0275\u0275template(1,Te,2,0,"ng-container",12),e.\u0275\u0275template(2,Ne,2,0,"ng-container",12),e.\u0275\u0275template(3,Le,2,0,"ng-container",12),e.\u0275\u0275elementContainerStart(4),e.\u0275\u0275template(5,Ve,3,0,"button",13),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.current>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.current<2),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",2===t.current&&"edit"===t.nzModalData.mode)}}let Pe=(()=>{class o{constructor(){this.nzModalData=(0,e.inject)(E.NZ_MODAL_DATA),this.cdr=(0,e.inject)(e.ChangeDetectorRef),this.icomSave=new e.EventEmitter,this.current=0}ngOnInit(){this.model=this.nzModalData.model,this.model&&!this.model.condition&&(this.model.condition={}),this.model&&!this.model.reward&&(this.model.reward={}),this.model&&!this.model.reward_reference&&(this.model.reward_reference={})}ngAfterViewInit(){const t=this.modal;t.updateConfig({nzFooter:this.templateFooter}),t.containerInstance.cdr.detectChanges(),this.cdr.detectChanges()}handlerNextStep(t){if(t.stopPropagation(),t.preventDefault(),this.eventFunctionControl&&this.eventFunctionControl.save&&this.eventFunctionControl.save())return this.current++,void this.cdr.detectChanges();"view"===this.nzModalData.mode&&(this.current++,this.cdr.detectChanges())}handlerFunctionControl(t){this.eventFunctionControl=t}handlerPrev(t){t.stopPropagation(),t.preventDefault(),this.current--,this.cdr.detectChanges()}handlerSave(t){t.stopPropagation(),t.preventDefault(),this.eventFunctionControl&&this.eventFunctionControl.save&&this.eventFunctionControl.save()&&(this.icomSave.emit(this.model),this.cdr.detectChanges())}handlerClose(t){t.stopPropagation(),t.preventDefault(),this.icomSave.emit(),this.cdr.detectChanges()}handlerIndexChange(t){if(this.current!==t){if("view"===this.nzModalData.mode&&(this.current===t+1||this.current===t-1))return void(this.current=t);"edit"===this.nzModalData.mode&&this.eventFunctionControl&&this.eventFunctionControl.save&&this.eventFunctionControl.save()&&(this.current+=1)}}static#e=this.\u0275fac=function(n){return new(n||o)};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["icom-libs-campaign-management-detail-mission-add_edit"]],viewQuery:function(n,i){if(1&n&&e.\u0275\u0275viewQuery(Me,5),2&n){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(i.templateFooter=a.first)}},inputs:{model:"model",isAdd:"isAdd",modal:"modal"},outputs:{icomSave:"icomSave"},standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:10,vars:4,consts:[["nzProgressDot","",3,"nzCurrent","nzIndexChange"],["nzDescription","1. Th\xf4ng tin chung"],["nzDescription","2. Ph\u1ea7n th\u01b0\u1edfng"],["nzDescription","3. \u0110i\u1ec1u ki\u1ec7n \xe1p d\u1ee5ng"],[1,"steps-content","mt-4","p-4","w-full","border","border-zinc-300"],[3,"model","mode","modeExtend","missions","icomFunctionControl",4,"ngIf"],[3,"model","data","mode","icomFunctionControl",4,"ngIf"],[3,"mode","dataCondition","dataMission","icomFunctionControl",4,"ngIf"],["customFooter",""],[3,"model","mode","modeExtend","missions","icomFunctionControl"],[3,"model","data","mode","icomFunctionControl"],[3,"mode","dataCondition","dataMission","icomFunctionControl"],[4,"ngIf"],["nz-button","","nzType","default",3,"click",4,"nzSpaceItem"],["nz-button","","nzType","default",3,"click"],["nz-button","","nzType","primary",3,"click",4,"nzSpaceItem"],["nz-button","","nzType","primary",3,"click"]],template:function(n,i){1&n&&(e.\u0275\u0275elementStart(0,"nz-steps",0),e.\u0275\u0275listener("nzIndexChange",function(s){return i.handlerIndexChange(s)}),e.\u0275\u0275element(1,"nz-step",1)(2,"nz-step",2)(3,"nz-step",3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",4),e.\u0275\u0275template(5,Ee,1,5,"icom-libs-campaign-management-detail-mission-information",5),e.\u0275\u0275template(6,Fe,1,3,"icom-libs-campaign-management-detail-mission-reward",6),e.\u0275\u0275template(7,Ie,1,3,"icom-libs-campaign-management-detail-mission-condition",7),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(8,Ae,6,3,"ng-template",null,8,e.\u0275\u0275templateRefExtractor)),2&n&&(e.\u0275\u0275property("nzCurrent",i.current),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",0===i.current),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",1===i.current),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",2===i.current))},dependencies:[y.FormlyNgZorroAntdModule,l.ReactiveFormsModule,h.FormlyModule,g.NzButtonModule,g.NzButtonComponent,w.\u0275NzTransitionPatchDirective,T.NzWaveDirective,f.NgIf,b.NzSpinModule,u.NzFormModule,C.NzStepsModule,C.NzStepsComponent,C.NzStepComponent,S.NzSpaceModule,S.NzSpaceComponent,S.NzSpaceItemDirective,oe,ne,xe],encapsulation:2,changeDetection:0})}return o})();var Y=m(4374),je=m(32936),D=m(18019),Oe=m(32530),W=m(87066);function Re(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",9)(1,"button",10),e.\u0275\u0275listener("click",function(i){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.handlerAddNew(i,void 0,"edit"))}),e.\u0275\u0275text(2," Th\xeam nhi\u1ec7m v\u1ee5 "),e.\u0275\u0275elementEnd()()}}function Be(o,r){1&o&&e.\u0275\u0275element(0,"nz-empty",11),2&o&&e.\u0275\u0275property("nzNotFoundContent","Kh\xf4ng t\xecm th\u1ea5y nhi\u1ec7m v\u1ee5.")}function He(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",10),e.\u0275\u0275listener("click",function(i){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext().$implicit,s=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(s.handleEditMission(i,a,"view"))}),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()}2&o&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ","Xem"," "))}function qe(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",27),e.\u0275\u0275listener("click",function(i){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext().$implicit,s=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(s.handlerCopy(i,a))}),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()}2&o&&(e.\u0275\u0275property("nzType","default"),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ","Sao ch\xe9p"," "))}function $e(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",28),e.\u0275\u0275listener("click",function(i){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext().$implicit,s=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(s.handleEditMission(i,a,"edit"))}),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()}2&o&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ","S\u1eeda"," "))}function Ye(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",29),e.\u0275\u0275listener("click",function(i){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext().$implicit,s=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(s.handlerRemove(i,a))}),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()}2&o&&(e.\u0275\u0275property("nzType","default")("nzDanger",!0),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ","X\xf3a"," "))}function We(o,r){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275element(1,"nz-statistic",30),e.\u0275\u0275elementContainerEnd()),2&o){const t=r.ngIf;e.\u0275\u0275advance(1),e.\u0275\u0275property("nzValue",(null==t?null:t.title)||"")}}function Ze(o,r){if(1&o&&(e.\u0275\u0275elementStart(0,"span",33),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"number"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"span",34),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"number"),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext().ngIf,n=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate2("",(null==t?null:t.title)||""," / ",e.\u0275\u0275pipeBind1(2,3,(null==t?null:t.balance)||0),""),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("(",e.\u0275\u0275pipeBind1(5,5,(null==n||null==n.sponsor?null:n.sponsor[0].value)||0),"%)")}}function Ke(o,r){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275element(1,"nz-statistic",31),e.\u0275\u0275template(2,Ze,6,7,"ng-template",null,32,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275reference(3);e.\u0275\u0275advance(1),e.\u0275\u0275property("nzValueTemplate",t)}}function Qe(o,r){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275element(1,"nz-statistic",35),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("nzValue","normal"===t.type?"Nhi\u1ec7m v\u1ee5 th\xf4ng th\u01b0\u1eddng":"Nhi\u1ec7m v\u1ee5 \u0111\u1eb7c bi\u1ec7t")}}function Ue(o,r){1&o&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1,"\xa0\xa0\xa0 "),e.\u0275\u0275elementEnd())}function Xe(o,r){if(1&o&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275element(1,"i",39),e.\u0275\u0275elementStart(2,"span",34),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(4,Ue,2,0,"span",21),e.\u0275\u0275elementEnd()),2&o){const t=r.$implicit,n=r.index,i=e.\u0275\u0275nextContext().ngIf;e.\u0275\u0275advance(1),e.\u0275\u0275property("nzType","point"===(null==t?null:t.type)?"point":"gift"),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate("point"===(null==t?null:t.type)?"\u0110i\u1ec3m th\u01b0\u1edfng":"Voucher"),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n<i.length-1)}}function Je(o,r){if(1&o&&(e.\u0275\u0275elementStart(0,"div",37),e.\u0275\u0275template(1,Xe,5,3,"div",38),e.\u0275\u0275elementEnd()),2&o){const t=r.ngIf;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t)}}function et(o,r){if(1&o&&e.\u0275\u0275template(0,Je,2,1,"div",36),2&o){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275property("ngIf",null==t||null==t.reward?null:t.reward.items)}}function tt(o,r){if(1&o&&(e.\u0275\u0275elementStart(0,"div",14)(1,"nz-page-header")(2,"nz-page-header-title",15),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"nz-page-header-extra")(5,"div",9),e.\u0275\u0275template(6,He,2,1,"button",16),e.\u0275\u0275template(7,qe,2,2,"button",17),e.\u0275\u0275template(8,$e,2,1,"button",18),e.\u0275\u0275template(9,Ye,2,3,"button",19),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(10,"nz-page-header-content")(11,"nz-row",20),e.\u0275\u0275template(12,We,2,1,"ng-container",21),e.\u0275\u0275pipe(13,"icomCampaignDetailMissionParseValue"),e.\u0275\u0275template(14,Ke,4,1,"ng-container",21),e.\u0275\u0275pipe(15,"icomCampaignDetailMissionParseValue"),e.\u0275\u0275element(16,"nz-statistic",22),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"nz-row",23),e.\u0275\u0275template(18,Qe,2,1,"ng-container",21),e.\u0275\u0275elementContainerStart(19),e.\u0275\u0275element(20,"nz-statistic",24),e.\u0275\u0275template(21,et,1,1,"ng-template",null,25,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275element(23,"nz-statistic",26),e.\u0275\u0275elementEnd()()()()),2&o){const t=r.$implicit,n=e.\u0275\u0275reference(22),i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("",(null==t?null:t.name)||""," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf","view"===i.mode),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","edit"===i.mode),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","edit"===i.mode),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","edit"===i.mode),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind2(13,10,t.action,i.listDataActionMission)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind2(15,13,null==t.sponsor||null==t.sponsor[0]?null:t.sponsor[0].id,i.listDataContributor)),e.\u0275\u0275advance(2),e.\u0275\u0275property("nzValue",(null==t||null==t.reward?null:t.reward.name)||""),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",t.type),e.\u0275\u0275advance(2),e.\u0275\u0275property("nzValueTemplate",n)}}function nt(o,r){if(1&o&&(e.\u0275\u0275elementStart(0,"div",12),e.\u0275\u0275template(1,tt,24,16,"div",13),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",null==t.data?null:t.data.missions)}}let it=(()=>{class o{constructor(){this.form=new l.FormGroup({}),this.fields=[],this.options={formState:{disabled:!1}},this.modalService=(0,e.inject)(E.NzModalService),this.viewContainerRef=(0,e.inject)(e.ViewContainerRef),this.cdr=(0,e.inject)(e.ChangeDetectorRef),this.campaignService=(0,e.inject)(x.wb),this.IComMessageService=(0,e.inject)(A.Qi),this.icomFunctionControl=new e.EventEmitter,this.listDataActionMission=[],this.listDataContributor=[],this.fields=(o=>[{fieldGroupClassName:"flex row items-center",key:"",fieldGroup:[{key:"order_type",type:"select-custom",className:"basis-5/12",props:{label:"Th\u1ee9 t\u1ef1 th\u1ef1c hi\u1ec7n",placeholder:"Ch\u1ecdn th\u1ee9 t\u1ef1",viewValue:"title",labelProp:"title",valueProp:"id",required:!0,options:o.getListOrderAction().pipe((0,d.map)(r=>r.data))},expressions:{"props.disabled":"formState.disabled"}},{key:"quantity",type:"nz-input-number",className:"basis-2/12 ml-4",props:{label:"S\u1ed1 nhi\u1ec7m v\u1ee5 t\u1ed1i \u0111a",placeholder:"Nh\u1eadp s\u1ed1",required:!0,type:"number",min:1},expressions:{"props.disabled":"formState.disabled"}},{key:"order_by",type:"select-custom",className:"basis-5/12 ml-4",props:{label:" ",placeholder:"Select Category",viewValue:"title",labelProp:"title",valueProp:"id",required:!0,options:o.getListOrderActionBy().pipe((0,d.map)(r=>r.data))},expressions:{"props.disabled":"formState.disabled"}}]}])(this.campaignService)}ngOnInit(){this.icomFunctionControl.emit({save:this.handleSave.bind(this)}),"view"===this.mode&&(this.options.formState.disabled=!0),(0,d.combineLatest)([this.campaignService.getActionMission(),this.campaignService.getContributor()]).subscribe(t=>{const[n,i]=t;this.listDataActionMission=n?.data,this.listDataContributor=i?.data,this.cdr.detectChanges()})}handlerAddNew(t,n,i){t.stopPropagation(),t.preventDefault();const a=this.modalService.create({nzTitle:n&&"copy"!==i?`S\u1eeda nhi\u1ec7m v\u1ee5: ${n.name}`:"Th\xeam nhi\u1ec7m v\u1ee5",nzContent:Pe,nzMaskClosable:!1,nzKeyboard:!1,nzClosable:!0,nzViewContainerRef:this.viewContainerRef,nzData:{model:(0,D.cloneDeep)(n)||{},isAdd:!0,mode:"copy"===i?"edit":i,missions:this.data.missions||[],modeExtend:i},nzWidth:968,nzFooter:[]}),s=a.getContentComponent();s.icomSave.subscribe(p=>{if(!p)return a.close(),void this.cdr.detectChanges();(!this.data?.missions||!this.data?.missions?.length)&&(this.data.missions=[]),p.id?this.mergeObjects(n,p):this.data.missions?.push({...p,id:(0,I.v4)()}),a.close(),this.cdr.detectChanges()}),s.modal=a}handleEditMission(t,n,i){t.stopPropagation(),t.preventDefault(),this.handlerAddNew(t,n,i)}mergeObjects(t,n){for(const i in n)n.hasOwnProperty(i)&&(t.hasOwnProperty(i),t[i]=n[i])}handlerRemove(t,n){t.stopPropagation(),this.modalService.confirm({nzTitle:`B\u1ea1n c\xf3 ch\u1eafc ch\u1eafn mu\u1ed1n xo\xe1 nhi\u1ec7m v\u1ee5 ${n.name} kh\xf4ng ?`,nzOkText:"C\xf3",nzOkType:"primary",nzOkDanger:!0,nzMaskClosable:!1,nzClosable:!0,nzOnOk:this.processDeleteMission.bind(this,n),nzCancelText:"Kh\xf4ng"},"error")}handlerCopy(t,n){t.stopPropagation(),this.handlerAddNew(t,{...n,id:""},"copy")}handleSave(){return this.form.valid?(this.form.markAsTouched(),this.form.submitted=!0,!!this.data?.missions?.length||(this.IComMessageService.showAlertMessageError("B\u1ea1n ch\u01b0a ch\u1ecdn nhi\u1ec7m v\u1ee5."),!1)):(Object.keys(this.form.controls).forEach(t=>{this.form.controls[t].touched=!0}),!1)}processDeleteMission(t){this.data.missions=this.data?.missions?.filter(n=>n.id!==t.id),this.cdr.detectChanges()}static#e=this.\u0275fac=function(n){return new(n||o)};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["icom-libs-campaign-management-detail-mission"]],inputs:{data:"data",mode:"mode"},outputs:{icomFunctionControl:"icomFunctionControl"},standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:9,vars:9,consts:[[1,"w-full","h-full","flex"],[1,"flex","w-full","h-full","flex-col","bg-white","border","pl-4","pt-4","rounded-md"],["nz-form","",1,"pr-4",3,"formGroup","nzLayout"],[3,"model","fields","options","form"],["class","flex",4,"ngIf"],[1,"w-full","h-full","overflow-auto","pr-4"],["nzNotFoundImage","simple","class","h-full w-full flex justify-center items-center border border-slate-300 flex-col !m-0 pt-2",3,"nzNotFoundContent",4,"ngIf"],["class","!mt-4",4,"ngIf"],[1,"h-3"],[1,"flex"],["nz-button","","nzType","primary",3,"click"],["nzNotFoundImage","simple",1,"h-full","w-full","flex","justify-center","items-center","border","border-slate-300","flex-col","!m-0","pt-2",3,"nzNotFoundContent"],[1,"!mt-4"],["class","border border-slate-300 mt-4",4,"ngFor","ngForOf"],[1,"border","border-slate-300","mt-4"],[1,"!text-sm"],["nz-button","","nzType","primary",3,"click",4,"ngIf"],["class","ml-4","nz-button","",3,"nzType","click",4,"ngIf"],["nz-button","","class","ml-4","nzType","primary",3,"click",4,"ngIf"],["class","ml-4","nz-button","",3,"nzType","nzDanger","click",4,"ngIf"],["nzType","flex","nzJustify","space-between","nzAlign","middle"],[4,"ngIf"],["nzTitle","T\xean ph\u1ea7n th\u01b0\u1edfng",3,"nzValue"],["nzType","flex","nzJustify","space-between","nzAlign","middle",1,"mt-4"],["nzTitle","Lo\u1ea1i ph\u1ea7n th\u01b0\u1edfng ",3,"nzValueTemplate"],["templateTypeReward",""],["nzTitle","H\xe0nh \u0111\u1ed9ng th\u1ef1c hi\u1ec7n b v\u1ee5",2,"visibility","hidden"],["nz-button","",1,"ml-4",3,"nzType","click"],["nz-button","","nzType","primary",1,"ml-4",3,"click"],["nz-button","",1,"ml-4",3,"nzType","nzDanger","click"],["nzTitle","H\xe0nh \u0111\u1ed9ng th\u1ef1c hi\u1ec7n nhi\u1ec7m v\u1ee5",3,"nzValue"],["nzTitle","Nh\xe0 t\xe0i tr\u1ee3 / T\xe0i kho\u1ea3n k\xfd qu\u1ef9 (T\u1ef7 l\u1ec7)",3,"nzValueTemplate"],["templateTime",""],[1,"text-xs"],[1,"text-xs","ml-2"],["nzTitle","Lo\u1ea1i nhi\u1ec7m v\u1ee5",3,"nzValue"],["class","flex items-center",4,"ngIf"],[1,"flex","items-center"],[4,"ngFor","ngForOf"],["nz-icon","",1,"text-xl",3,"nzType"]],template:function(n,i){1&n&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"form",2),e.\u0275\u0275element(3,"formly-form",3),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(4,Re,3,0,"div",4),e.\u0275\u0275elementStart(5,"div",5),e.\u0275\u0275template(6,Be,1,1,"nz-empty",6),e.\u0275\u0275template(7,nt,2,1,"div",7),e.\u0275\u0275element(8,"div",8),e.\u0275\u0275elementEnd()()()),2&n&&(e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",i.form)("nzLayout","vertical"),e.\u0275\u0275advance(1),e.\u0275\u0275property("model",i.data)("fields",i.fields)("options",i.options)("form",i.form),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","edit"===i.mode),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!(null!=i.data&&i.data.missions&&null!=i.data&&i.data.missions.length)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",(null==i.data?null:i.data.missions)&&(null==i.data?null:i.data.missions.length)))},dependencies:[y.FormlyNgZorroAntdModule,l.ReactiveFormsModule,l.\u0275NgNoValidate,l.NgControlStatusGroup,l.FormGroupDirective,h.FormlyModule,h.FormlyForm,g.NzButtonModule,g.NzButtonComponent,w.\u0275NzTransitionPatchDirective,T.NzWaveDirective,f.NgIf,b.NzSpinModule,u.NzFormModule,$.NzRowDirective,u.NzFormDirective,Y.NzEmptyModule,Y.NzEmptyComponent,je.NzDescriptionsModule,f.NgFor,Oe.P,W.NzStatisticModule,W.NzStatisticComponent,_.NzPageHeaderModule,_.NzPageHeaderComponent,_.NzPageHeaderTitleDirective,_.NzPageHeaderContentDirective,_.NzPageHeaderExtraDirective,f.DecimalPipe,k.NzIconModule,k.NzIconDirective],encapsulation:2,changeDetection:0})}return o})();var Z=m(60202),ot=m(66049);let rt=(()=>{class o{constructor(){this.form=new l.FormGroup({}),this.fields=[],this.options={formState:{disabled:!1}},this.icomFunctionControl=new e.EventEmitter,this.cdr=(0,e.inject)(e.ChangeDetectorRef),this.fields=[{fieldGroupClassName:"flex items-center",key:"",wrappers:["group"],props:{label:"C\u1ea5u h\xecnh m\xe0n home c\u1ee7a app"},expressions:{"props.disabled":"formState.disabled"},fieldGroup:[{key:"home_icon",type:"upload",className:"",props:{label:"Icon t\u1ea1i m\xe0n trang ch\u1ee7 nhi\u1ec7m v\u1ee5",size:102400,labelType:"Image",width:400,height:400},expressions:{"props.disabled":"formState.disabled"}}]},{fieldGroupClassName:" items-center",key:"",wrappers:["group"],props:{label:"Trang ch\u1ee7 nhi\u1ec7m v\u1ee5"},expressions:{"props.disabled":"formState.disabled"},fieldGroup:[{key:"main_icon",type:"upload",className:"basis-6/12",props:{label:"Icon t\u1ea1i m\xe0n trang ch\u1ee7 nhi\u1ec7m v\u1ee5",size:102400,required:!0,labelType:"Image",width:400,height:400},expressions:{"props.disabled":"formState.disabled"}},{key:"header_img",type:"upload",className:"basis-6/12",props:{label:"Icon header",size:1048576,required:!0,labelType:"Image",width:1500,height:2e3},expressions:{"props.disabled":"formState.disabled"}},{key:"progress_bar_text",type:"input",props:{placeholder:"Nh\u1eadp n\u1ed9i dung header",label:"N\u1ed9i dung progress bar",type:"string",required:!0,maxLength:40},expressions:{"props.disabled":"formState.disabled"}},{fieldGroupClassName:"flex row",key:"",expressions:{"props.disabled":"formState.disabled"},fieldGroup:[{key:"main_color",type:"color-picker",className:"basis-2/12",templateOptions:{label:"Background color",required:!0},expressions:{"props.disabled":"formState.disabled"}},{key:"main_img_type",type:"select-custom",className:"basis-6/12 ml-4",props:{label:"Lo\u1ea1i \u1ea3nh",required:!0,placeholder:"Ch\u1ecdn lo\u1ea1i \u1ea3nh",viewValue:"name",labelProp:"name",valueProp:"id",options:[{id:"RED",name:"RED"},{id:"ORANGE",name:"ORANGE"}]},expressions:{"props.disabled":"formState.disabled"}}]}]}]}ngOnInit(){this.icomFunctionControl.emit({save:this.handleSave.bind(this)}),"view"===this.mode&&(this.options.formState.disabled=!0)}handleSave(){return this.form.valid?(this.form.markAsTouched(),this.form.submitted=!0,!0):(Object.keys(this.form.controls).forEach(t=>{this.form.controls[t].touched=!0}),!1)}static#e=this.\u0275fac=function(n){return new(n||o)};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["icom-libs-campaign-management-detail-layout"]],inputs:{data:"data",mode:"mode"},outputs:{icomFunctionControl:"icomFunctionControl"},standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:4,vars:6,consts:[[1,"w-full","h-full","flex"],[1,"flex","w-full","h-full","flex-col","bg-white","border","rounded-md"],["nz-form","",1,"bg-white","rounded-md","h-full","flex","flex-col","!p-4","overflow-y-auto",3,"formGroup","nzLayout"],[3,"model","fields","options","form"]],template:function(n,i){1&n&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"form",2),e.\u0275\u0275element(3,"formly-form",3),e.\u0275\u0275elementEnd()()()),2&n&&(e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",i.form)("nzLayout","vertical"),e.\u0275\u0275advance(1),e.\u0275\u0275property("model",i.data)("fields",i.fields)("options",i.options)("form",i.form))},dependencies:[y.FormlyNgZorroAntdModule,l.ReactiveFormsModule,l.\u0275NgNoValidate,l.NgControlStatusGroup,l.FormGroupDirective,h.FormlyModule,h.FormlyForm,g.NzButtonModule,b.NzSpinModule,u.NzFormModule,u.NzFormDirective],encapsulation:2,changeDetection:0})}return o})();function st(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"icom-libs-campaign-management-detail-general",14),e.\u0275\u0275listener("icomFunctionControl",function(i){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.handlerFunctionControl(i))}),e.\u0275\u0275elementEnd()}if(2&o){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("data",t.dataCampaign)("mode",t.mode)}}function lt(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"icom-libs-campaign-management-detail-mission",15),e.\u0275\u0275listener("icomFunctionControl",function(i){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.handlerFunctionControl(i))}),e.\u0275\u0275elementEnd()}if(2&o){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("mode",t.mode)("data",null==t.dataCampaign?null:t.dataCampaign.config_mission)}}function mt(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"icom-libs-campaign-management-detail-layout",15),e.\u0275\u0275listener("icomFunctionControl",function(i){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.handlerFunctionControl(i))}),e.\u0275\u0275elementEnd()}if(2&o){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("mode",t.mode)("data",null==t.dataCampaign?null:t.dataCampaign.config_layout)}}function dt(o,r){if(1&o&&(e.\u0275\u0275elementStart(0,"div",11),e.\u0275\u0275template(1,st,1,2,"icom-libs-campaign-management-detail-general",12),e.\u0275\u0275template(2,lt,1,2,"icom-libs-campaign-management-detail-mission",13),e.\u0275\u0275template(3,mt,1,2,"icom-libs-campaign-management-detail-layout",13),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",0===t.current),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",1===t.current),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",2===t.current)}}function pt(o,r){1&o&&e.\u0275\u0275element(0,"nz-spin",16),2&o&&e.\u0275\u0275property("nzSize","large")}function ct(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",17),e.\u0275\u0275listener("click",function(i){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.handlerCancel(i))}),e.\u0275\u0275elementStart(1,"span"),e.\u0275\u0275text(2,"H\u1ee7y"),e.\u0275\u0275elementEnd()()}}function ut(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",17),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(i.pre())}),e.\u0275\u0275elementStart(1,"span"),e.\u0275\u0275text(2,"Quay l\u1ea1i"),e.\u0275\u0275elementEnd()()}}function ht(o,r){1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,ut,3,0,"button",9),e.\u0275\u0275elementContainerEnd())}function gt(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",19),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(i.next())}),e.\u0275\u0275elementStart(1,"span"),e.\u0275\u0275text(2,"Ti\u1ebfp t\u1ee5c"),e.\u0275\u0275elementEnd()()}}function ft(o,r){1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,gt,3,0,"button",18),e.\u0275\u0275elementContainerEnd())}function _t(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",21),e.\u0275\u0275listener("click",function(i){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.handlerSaveDraft(i))}),e.\u0275\u0275elementStart(1,"span"),e.\u0275\u0275text(2,"L\u01b0u nh\xe1p"),e.\u0275\u0275elementEnd()()}if(2&o){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("nzLoading",t.isLoading)}}function Ct(o,r){1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,_t,3,1,"button",20),e.\u0275\u0275elementContainerEnd())}function bt(o,r){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",23),e.\u0275\u0275listener("click",function(i){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.handlerSave(i))}),e.\u0275\u0275elementStart(1,"span"),e.\u0275\u0275text(2,"L\u01b0u"),e.\u0275\u0275elementEnd()()}if(2&o){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("nzLoading",t.isLoading)}}function yt(o,r){1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,bt,3,1,"button",22),e.\u0275\u0275elementContainerEnd())}let vt=(()=>{class o{constructor(){this.campaignService=(0,e.inject)(x.wb),this.IComMessageService=(0,e.inject)(A.Qi),this.router=(0,e.inject)(Z.Router),this.destroyRef=(0,e.inject)(e.DestroyRef),this.route=(0,e.inject)(Z.ActivatedRoute),this.cdr=(0,e.inject)(e.ChangeDetectorRef),this.modalService=(0,e.inject)(E.NzModalService),this.current=0,this.dataCampaign={config_mission:{},config_layout:{}},this.mode="view",this.isLoadingFirst=!0}ngOnInit(){this.route.queryParams.pipe((0,ot.takeUntilDestroyed)(this.destroyRef)).subscribe(t=>{if(!t)return;const n=t.id;this.mode=t.mode,this.isLoadingFirst=!0,this.cdr.detectChanges(),this.campaignService.detail({id:+n}).subscribe(i=>{this.dataCampaign=i.data,this.dataCampaignOrigin=(0,D.cloneDeep)(this.dataCampaign),this.isLoadingFirst=!1,this.cdr.detectChanges()},i=>{this.isLoadingFirst=!1,this.cdr.detectChanges()})})}pre(){this.current-=1}next(){this.eventFunctionControl&&this.eventFunctionControl.save&&this.eventFunctionControl.save()&&(this.current+=1),"view"===this.mode&&(this.current+=1)}handlerIndexChange(t){if(this.current!==t){if("view"===this.mode&&(this.current===t+1||this.current===t-1))return void(this.current=t);"edit"===this.mode&&this.eventFunctionControl&&this.eventFunctionControl.save&&this.eventFunctionControl.save()&&(this.current+=1)}}handlerFunctionControl(t){this.eventFunctionControl=t}handlerSave(t){var n=this;return(0,N.Z)(function*(){t.stopPropagation(),t.preventDefault(),(!n.eventFunctionControl||!n.eventFunctionControl.save||n.eventFunctionControl.save())&&n.modalService.confirm({nzTitle:"B\u1ea1n c\xf3 mu\u1ed1n l\u01b0u chi\u1ebfn d\u1ecbch?",nzContent:`<b style="color: red;">${n.dataCampaign.name}</b>`,nzOkText:"L\u01b0u",nzOkType:"primary",nzMaskClosable:!1,nzClosable:!0,nzOnOk:n.processSubmit.bind(n),nzCancelText:"\u0110\xf3ng"},"info")})()}trimFormFields(){const t=this.dataCampaign;Object.keys(t).forEach(n=>{"string"==typeof t[n]&&(t[n]=t[n].trim())})}processSubmit(){var t=this;return(0,N.Z)(function*(){try{t.isLoading=!0,t.trimFormFields(),(!t.dataCampaign.status||"DRAFT"===t.dataCampaign.status)&&(t.dataCampaign.status="INACTIVE"),t.eventFunctionControl&&t.eventFunctionControl.save&&t.eventFunctionControl.save()&&(t.addSpecificGeneral(),yield(0,d.lastValueFrom)(t.campaignService.addEditCampaign(t.dataCampaign)),t.IComMessageService.showAlertMessageDone(t.dataCampaign?.id?"S\u1eeda chi\u1ebfn d\u1ecbch th\xe0nh c\xf4ng.":"T\u1ea1o m\u1edbi chi\u1ebfn d\u1ecbch th\xe0nh c\xf4ng."),t.router.navigateByUrl("campaign/management"),t.dataCampaignOrigin=(0,D.cloneDeep)(t.dataCampaign))}catch(n){console.log(n),t.IComMessageService.showAlertMessageError(n?.error?.error_message||"S\u1eeda chi\u1ebfn d\u1ecbch th\u1ea5t b\u1ea1i")}finally{t.isLoading=!1,t.cdr.detectChanges()}})()}handlerSaveDraft(t){var n=this;return(0,N.Z)(function*(){t.stopPropagation(),t.preventDefault();try{if(!n.dataCampaign.name)return void n.IComMessageService.showAlertMessageError("Vui l\xf2ng nh\u1eadp t\xean chi\u1ebfn d\u1ecbch");n.trimFormFields(),n.isLoading=!0,n.dataCampaign.status="DRAFT",n.addSpecificGeneral();const i=yield(0,d.lastValueFrom)(n.campaignService.addEditCampaign(n.dataCampaign));i&&i.data&&(0,V.PM)(i.data,n.dataCampaign),n.IComMessageService.showAlertMessageDone("L\u01b0u nh\xe1p chi\u1ebfn d\u1ecbch th\xe0nh c\xf4ng"),n.dataCampaignOrigin=(0,D.cloneDeep)(n.dataCampaign)}catch(i){console.log(i),n.IComMessageService.showAlertMessageError(i?.error?.error_message||"S\u1eeda chi\u1ebfn d\u1ecbch th\u1ea5t b\u1ea1i")}finally{n.isLoading=!1,n.cdr.detectChanges()}})()}handlerCancel(t){t?.stopPropagation(),t?.preventDefault(),"view"!==this.mode?this.modalService.confirm({nzTitle:this.dataCampaign?.id?"B\u1ea1n c\xf3 h\u1ee7y b\u1ecf thao t\xe1c ?":"B\u1ea1n c\xf3 mu\u1ed1n h\u1ee7y th\xeam m\u1edbi chi\u1ebfn d\u1ecbch kh\xf4ng?",nzOkText:"\u0110\u1ed3ng \xfd",nzOkType:"primary",nzMaskClosable:!1,nzClosable:!0,nzOnOk:()=>this.router.navigateByUrl("campaign/management"),nzCancelText:"\u0110\xf3ng"},"info"):this.router.navigateByUrl("campaign/management")}addSpecificGeneral(){if([{id:"uuid2",group:"customer",type:"customer_profile",value:this.dataCampaign.start_time,attribute:"thoi_gian_dang_ky",operator:"after_specific_day"},{id:"uuid3",group:"customer",type:"customer_profile",value:this.dataCampaign.end_time,attribute:"thoi_gian_dang_ky",operator:"before_specific_day"}].forEach(n=>{const i=this.dataCampaign?.customer_group?.config?.find(a=>a.id===n.id);i?Object.assign(i,n):this.dataCampaign?.customer_group?.config?.push(n)}),this.dataCampaign.customer_group&&(this.dataCampaign.customer_group.relationship=""),this.dataCampaign?.customer_group?.config&&this.dataCampaign?.customer_group?.config?.length){const n=this.dataCampaign?.customer_group?.config;n.forEach(i=>{i.id=i.id||(0,I.v4)()}),n?.forEach((i,a)=>{this.dataCampaign.customer_group.relationship+=` ${i.id} ${a!==n.length-1?"&&":""}`})}this.dataCampaign?.config_mission?.missions&&this.dataCampaign?.config_mission?.missions?.length&&(this.dataCampaign?.config_mission?.missions).forEach((i,a)=>{i.id=a+1})}static#e=this.\u0275fac=function(n){return new(n||o)};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["icom-libs-campaign-management-detail"]],standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:18,vars:8,consts:[["nzBackIcon","",1,"h-full","w-full","flex","flex-col","p-0","!absolute","top-0","left-0","!bg-[#f0f2f5]",3,"nzBack"],[1,"w-full","h-full","flex","overflow-hidden"],["nzProgressDot","","nzDirection","vertical",1,"border-r","border-y-zinc-400","!p-4","bg-white","rounded-lg",2,"flex-basis","content",3,"nzCurrent","nzIndexChange"],["nzTitle","1. Th\xf4ng tin chung","nzDescription","C\u1ea5u h\xecnh c\xe1c th\xf4ng tin chung c\u1ee7a chi\u1ebfn d\u1ecbch"],["nzTitle","2. C\u1ea5u h\xecnh nhi\u1ec7m v\u1ee5"],["nzTitle","3. C\u1ea5u h\xecnh App"],["class","steps-content pl-4 w-full 0",4,"ngIf"],["class","w-full h-full flex justify-center items-center","nzSimple","",3,"nzSize",4,"ngIf"],[1,"flex","justify-end","mb-4"],["nz-button","","nzType","default",3,"click",4,"nzSpaceItem"],[4,"ngIf"],[1,"steps-content","pl-4","w-full","0"],[3,"data","mode","icomFunctionControl",4,"ngIf"],[3,"mode","data","icomFunctionControl",4,"ngIf"],[3,"data","mode","icomFunctionControl"],[3,"mode","data","icomFunctionControl"],["nzSimple","",1,"w-full","h-full","flex","justify-center","items-center",3,"nzSize"],["nz-button","","nzType","default",3,"click"],["nz-button","","nzType","primary",3,"click",4,"nzSpaceItem"],["nz-button","","nzType","primary",3,"click"],["nz-button","","nzType","default",3,"nzLoading","click",4,"nzSpaceItem"],["nz-button","","nzType","default",3,"nzLoading","click"],["nz-button","","nzType","primary",3,"nzLoading","click",4,"nzSpaceItem"],["nz-button","","nzType","primary",3,"nzLoading","click"]],template:function(n,i){1&n&&(e.\u0275\u0275elementStart(0,"nz-page-header",0),e.\u0275\u0275listener("nzBack",function(){return i.handlerCancel()}),e.\u0275\u0275elementStart(1,"nz-page-header-title"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"nz-page-header-content",1)(4,"nz-steps",2),e.\u0275\u0275listener("nzIndexChange",function(s){return i.handlerIndexChange(s)}),e.\u0275\u0275element(5,"nz-step",3)(6,"nz-step",4)(7,"nz-step",5),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(8,dt,4,3,"div",6),e.\u0275\u0275template(9,pt,1,1,"nz-spin",7),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"nz-page-header-footer",8)(11,"nz-space"),e.\u0275\u0275elementContainerStart(12),e.\u0275\u0275template(13,ct,3,0,"button",9),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275template(14,ht,2,0,"ng-container",10),e.\u0275\u0275template(15,ft,2,0,"ng-container",10),e.\u0275\u0275template(16,Ct,2,0,"ng-container",10),e.\u0275\u0275template(17,yt,2,0,"ng-container",10),e.\u0275\u0275elementEnd()()()),2&n&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate((null==i.dataCampaignOrigin?null:i.dataCampaignOrigin.name)||"T\u1ea1o m\u1edbi"),e.\u0275\u0275advance(2),e.\u0275\u0275property("nzCurrent",i.current),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",!i.isLoadingFirst),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",i.isLoadingFirst),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",i.current>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",i.current<2),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","edit"===i.mode),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",2===i.current&&"edit"===i.mode))},dependencies:[f.CommonModule,f.NgIf,Q.NzTypographyModule,_.NzPageHeaderModule,_.NzPageHeaderComponent,_.NzPageHeaderTitleDirective,_.NzPageHeaderContentDirective,_.NzPageHeaderFooterDirective,S.NzSpaceModule,S.NzSpaceComponent,S.NzSpaceItemDirective,K.NzTabsModule,k.NzIconModule,U.NzCardModule,C.NzStepsModule,C.NzStepsComponent,C.NzStepComponent,g.NzButtonModule,g.NzButtonComponent,w.\u0275NzTransitionPatchDirective,T.NzWaveDirective,J,it,rt,b.NzSpinModule,b.NzSpinComponent],encapsulation:2,changeDetection:0})}return o})()}}]);