(self.webpackChunkicom=self.webpackChunkicom||[]).push([[7490],{17490:(B,_,l)=>{l.r(_),l.d(_,{RolePermissionsComponent:()=>L});var f=l(49671),e=l(36151),a=l(93484),g=l(91029),d=l(57129),y=l(87757),h=l(14817),F=l(30424),E=l(8111),v=l(6743),m=l(15311),C=l(16283),b=l(44729),p=l(33635),R=l(66049),z=l(60202),j=l(37586),x=l(75150),A=l(47809),N=l(54829);function P(r,s){1&r&&(e.\u0275\u0275elementStart(0,"div",13),e.\u0275\u0275text(1," Vui l\xf2ng nh\u1eadp t\xean vai tr\xf2 "),e.\u0275\u0275elementEnd())}function M(r,s){1&r&&(e.\u0275\u0275elementStart(0,"div",13),e.\u0275\u0275text(1," T\xean vai tr\xf2 ph\u1ea3i c\xf3 \u0111\u1ed9 d\xe0i t\u1eeb 1 \u0111\u1ebfn 50 k\xfd t\u1ef1 "),e.\u0275\u0275elementEnd())}const S=function(){return{standalone:!0}};function T(r,s){if(1&r){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"label",24),e.\u0275\u0275listener("ngModelChange",function(o){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext().$implicit;return e.\u0275\u0275resetView(i.selected=o)})("click",function(o){return o.stopPropagation()})("ngModelChange",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext().$implicit,i=e.\u0275\u0275nextContext(4);return e.\u0275\u0275resetView(i.updateSubModuleSelection(o))}),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()}if(2&r){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275property("ngModelOptions",e.\u0275\u0275pureFunction0(3,S))("ngModel",t.selected),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.name_vi," ")}}function V(r,s){if(1&r){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"li",25)(1,"label",26),e.\u0275\u0275listener("ngModelChange",function(o){const c=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275resetView(c.selected=o)})("ngModelChange",function(){const i=e.\u0275\u0275restoreView(t).$implicit,c=e.\u0275\u0275nextContext().$implicit,u=e.\u0275\u0275nextContext(4);return e.\u0275\u0275resetView(u.updateActionSelection(c,i))}),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()()}if(2&r){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngModel",t.selected)("ngModelOptions",e.\u0275\u0275pureFunction0(3,S)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.name_vi," ")}}function I(r,s){if(1&r){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"nz-collapse-panel",20),e.\u0275\u0275listener("nzActiveChange",function(o){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext().$implicit,c=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(c.onPanelChange(o,i))}),e.\u0275\u0275template(1,T,2,4,"ng-template",null,21,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementStart(3,"ul",22),e.\u0275\u0275template(4,V,3,4,"li",23),e.\u0275\u0275elementEnd()()}if(2&r){const t=s.$implicit,n=e.\u0275\u0275reference(2);e.\u0275\u0275property("nzShowArrow",!0)("nzActive",!0)("nzHeader",n),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngForOf",t.actions)}}function w(r,s){if(1&r&&(e.\u0275\u0275elementStart(0,"div",16)(1,"h3",17),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"nz-collapse",18),e.\u0275\u0275template(4,I,5,4,"nz-collapse-panel",19),e.\u0275\u0275elementEnd()()),2&r){const t=s.$implicit;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.name_vi),e.\u0275\u0275advance(1),e.\u0275\u0275property("nzBordered",!1),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",null==t?null:t.sub_modules)}}function D(r,s){if(1&r&&(e.\u0275\u0275elementStart(0,"div",14)(1,"h4",1),e.\u0275\u0275text(2,"Ph\xe2n quy\u1ec1n chi ti\u1ebft"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(3,w,5,3,"div",15),e.\u0275\u0275elementEnd()),2&r){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",t.data_group)}}function O(r,s){if(1&r&&(e.\u0275\u0275elementStart(0,"form",5)(1,"nz-form-item")(2,"nz-form-label",6),e.\u0275\u0275text(3,"T\xean Vai Tr\xf2"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"nz-form-control",7),e.\u0275\u0275element(5,"input",8),e.\u0275\u0275template(6,P,2,0,"div",9),e.\u0275\u0275template(7,M,2,0,"div",9),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(8,"nz-form-item")(9,"nz-form-label",10),e.\u0275\u0275text(10,"Ghi Ch\xfa"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"nz-form-control",7),e.\u0275\u0275element(12,"textarea",11),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(13,D,4,1,"div",12),e.\u0275\u0275elementEnd()),2&r){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("formGroup",t.roleForm),e.\u0275\u0275advance(2),e.\u0275\u0275property("nzSpan",4),e.\u0275\u0275advance(2),e.\u0275\u0275property("nzSpan",8),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",t.roleForm.controls.name.dirty&&t.roleForm.controls.name.hasError("required")),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.roleForm.controls.name.dirty&&t.roleForm.controls.name.hasError("maxLength")),e.\u0275\u0275advance(2),e.\u0275\u0275property("nzSpan",4),e.\u0275\u0275advance(2),e.\u0275\u0275property("nzSpan",8),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",t.data_group&&(null==t.data_group?null:t.data_group.length))}}let L=(()=>{class r{constructor(t){var n=this;this.fb=t,this.data_group=[],this.allChecked=!1,this.indeterminate=!0,this.localStorageService=(0,e.inject)(F.n2),this.changeDetectorRef=(0,e.inject)(e.ChangeDetectorRef),this.iComLibsServicesProjectIamRoleService=(0,e.inject)(b.ZJ),this.destroyRef=(0,e.inject)(e.DestroyRef),this.route=(0,e.inject)(z.ActivatedRoute),this.cdr=(0,e.inject)(e.ChangeDetectorRef),this.modalService=(0,e.inject)(j.NzModalService),this.router=(0,e.inject)(z.Router),this.mode="view",this.route.queryParams.pipe((0,R.takeUntilDestroyed)(this.destroyRef)).subscribe(function(){var o=(0,f.Z)(function*(i){if(i){if(n.mode=i.mode,!i.id){const $=yield(0,p.lastValueFrom)(n.iComLibsServicesProjectIamRoleService.listDefaultRole());return n.data_group=$?.data?.permissions||{},n.data_group=n.convertKeysToLowerCase(n.data_group),n.createForm(),void n.cdr?.detectChanges()}const c=i?.id||"",u=yield(0,p.lastValueFrom)(n.iComLibsServicesProjectIamRoleService.detail(c));n.data=u?.data||{},n.roleForm=n.fb.group({name:[n.data?.name,[a.Validators.required,a.Validators.maxLength(50)]],note:[n.data?.description]}),n.data_group=n.convertKeysToLowerCase(n.data.permissions),n.cdr?.detectChanges()}});return function(i){return o.apply(this,arguments)}}())}createForm(){this.roleForm=this.fb.group({name:["",[a.Validators.required,a.Validators.maxLength(50)]],note:[""]})}convertKeysToLowerCase(t){if(Array.isArray(t))return t.map(n=>this.convertKeysToLowerCase(n));if("object"==typeof t&&null!==t){const n={};for(const o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o.replace(/([A-Z])/g,"_$1").toLowerCase()]=this.convertKeysToLowerCase(t[o]));return n}return t}updateModuleSelection(t){t.selected=t.sub_modules?.every(n=>n.selected),this.updateAllCheckedState()}updateSubModuleSelection(t){t.actions?.forEach(n=>{n.selected=t.selected}),this.updateAllCheckedState()}updateActionSelection(t,n){t.selected=!!n.selected&&t.actions?.every(o=>o.selected),this.updateAllCheckedState()}updateAllCheckedState(){const t=this.data_group.filter(o=>o.selected),n=this.data_group?.filter(o=>!o.selected&&o.sub_modules.some(i=>i.selected||i.actions&&i.actions.some(c=>c.selected)));this.allChecked=t.length===this.data_group.length,this.indeterminate=!this.allChecked&&(t.length>0||n.length>0)}ngOnInit(){this.data_group=this.localStorageService.getItem(E.$M.PERMISSIONS),this.updateAllCheckedState(),this.data_group.forEach(t=>{t.sub_modules?.forEach(n=>{n.selected=n.actions?.every(o=>o.selected)})})}onPanelChange(t,n){n.active=t,this.changeDetectorRef.detectChanges()}submitForm(){var t=this;return(0,f.Z)(function*(){if(t.roleForm.valid){const n={...t.roleForm.value,permissions:t.data_group};yield(0,p.lastValueFrom)(t.iComLibsServicesProjectIamRoleService.add(n))}else Object.values(t.roleForm.controls).forEach(n=>{n.invalid&&(n.markAsDirty(),n.updateValueAndValidity({onlySelf:!0}))})})()}static#e=this.\u0275fac=function(n){return new(n||r)(e.\u0275\u0275directiveInject(a.FormBuilder))};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["app-role-permissions"]],inputs:{data:"data",mode:"mode"},standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:7,vars:1,consts:[[1,"flex","flex-col","h-full","py-4","pl-4","bg-white"],[1,"text-lg","font-bold","mb-2"],["class","flex flex-col h-full overflow-hidden","nz-form","",3,"formGroup",4,"ngIf"],[1,"!border","border-gray-200","p-3"],["nz-button","","nzType","primary","type","submit",3,"click"],["nz-form","",1,"flex","flex-col","h-full","overflow-hidden",3,"formGroup"],["nzRequired","","nzFor","roleName",3,"nzSpan"],[3,"nzSpan"],["nz-input","","formControlName","name","placeholder","Nh\u1eadp t\xean vai tr\xf2"],["class","text-red-500",4,"ngIf"],["nzFor","note",3,"nzSpan"],["nz-input","","formControlName","note","placeholder","Nh\u1eadp ghi ch\xfa"],["class","overflow-auto pr-4",4,"ngIf"],[1,"text-red-500"],[1,"overflow-auto","pr-4"],["class","mb-4 !p-2","class","group-container",4,"ngFor","ngForOf"],[1,"group-container"],[1,"text-lg","font-bold","!px-4","pt-3"],["nzExpandIconPosition","right",1,"custom-panel","!bg-white","!p-4",3,"nzBordered"],["class","bg-white !border w-full h-full border-gray-200 mb-2 !rounded !border-b",3,"nzShowArrow","nzActive","nzHeader","nzActiveChange",4,"ngFor","ngForOf"],[1,"bg-white","!border","w-full","h-full","border-gray-200","mb-2","!rounded","!border-b",3,"nzShowArrow","nzActive","nzHeader","nzActiveChange"],["headerTemplate",""],["nz-menu","","nzMode","horizontal",1,"flex"],["nz-menu-item","","class","ml-6",4,"ngFor","ngForOf"],["nz-checkbox","",3,"ngModelOptions","ngModel","ngModelChange","click"],["nz-menu-item","",1,"ml-6"],["nz-checkbox","",3,"ngModel","ngModelOptions","ngModelChange"]],template:function(n,o){1&n&&(e.\u0275\u0275elementStart(0,"div",0)(1,"h4",1),e.\u0275\u0275text(2,"Th\xf4ng tin chung"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(3,O,14,8,"form",2),e.\u0275\u0275elementStart(4,"div",3)(5,"button",4),e.\u0275\u0275listener("click",function(){return o.submitForm()}),e.\u0275\u0275text(6,"L\u01b0u"),e.\u0275\u0275elementEnd()()()),2&n&&(e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",o.roleForm))},dependencies:[a.FormsModule,a.\u0275NgNoValidate,a.DefaultValueAccessor,a.NgControlStatus,a.NgControlStatusGroup,a.NgModel,d.NzCollapseModule,d.NzCollapsePanelComponent,d.NzCollapseComponent,g.NzCheckboxModule,g.NzCheckboxComponent,y.NzIconModule,h.NgFor,h.NgIf,a.ReactiveFormsModule,a.FormGroupDirective,a.FormControlName,v.NzInputModule,v.NzInputDirective,m.NzFormModule,x.NzColDirective,x.NzRowDirective,m.NzFormDirective,m.NzFormItemComponent,m.NzFormLabelComponent,m.NzFormControlComponent,C.NzButtonModule,C.NzButtonComponent,A.\u0275NzTransitionPatchDirective,N.NzWaveDirective],styles:[".group-container[_ngcontent-%COMP%]{border:1px solid #f0f0f0;border-radius:8px;margin-bottom:16px}.custom-panel[_ngcontent-%COMP%]{border-bottom:1px solid #f0f0f0;border-radius:8px}"],changeDetection:0})}return r})()}}]);