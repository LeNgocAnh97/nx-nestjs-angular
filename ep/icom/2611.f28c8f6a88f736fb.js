(self.webpackChunkicom=self.webpackChunkicom||[]).push([[2611],{62611:(q,g,s)=>{s.r(g),s.d(g,{IComLibsOrderTransactionListComponent:()=>W});var C=s(49671),e=s(36151),u=s(14817),m=s(93484),y=s(13391),O=s(62059),f=s(21786),v=s(16283),h=s(14859),c=s(15311),z=s(87757),S=s(37586),_=s(17891),b=s(47332),I=s(60202),P=s(53750),T=s(44729),w=s(8111),x=s(91872),p=s(33635);class M{constructor(){this.size=0,this.totalElements=0,this.totalPages=0,this.pageNumber=0}}var E=s(47809),D=s(54829),L=s(75150),N=s(71579);const j=["statusRef"],F=["selectRef"];function R(r,l){if(1&r){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"li",23),e.\u0275\u0275listener("click",function(o){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext().row,i=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(i.handlerRetry(o,a))}),e.\u0275\u0275text(1," Retry "),e.\u0275\u0275elementEnd()}}function V(r,l){if(1&r){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"li",23),e.\u0275\u0275listener("click",function(o){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext().row,i=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(i.handlerForceStop(o,a))}),e.\u0275\u0275text(1," Force Stop "),e.\u0275\u0275elementEnd()}}function k(r,l){if(1&r){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"li",23),e.\u0275\u0275listener("click",function(o){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext().row,i=e.\u0275\u0275nextContext(),d=e.\u0275\u0275reference(21),J=e.\u0275\u0275reference(23),X=e.\u0275\u0275reference(25);return e.\u0275\u0275resetView(i.handlerUpdate(o,a,d,J,X))}),e.\u0275\u0275text(1," Update "),e.\u0275\u0275elementEnd()}}function A(r,l){if(1&r){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",18)(1,"button",19),e.\u0275\u0275text(2," Action "),e.\u0275\u0275element(3,"span",20),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"nz-dropdown-menu",null,21)(6,"ul",22)(7,"li",23),e.\u0275\u0275listener("click",function(o){const i=e.\u0275\u0275restoreView(t).row,d=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(d.handlerViewDetail(o,i))}),e.\u0275\u0275text(8," View Detail "),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(9,R,2,0,"li",24),e.\u0275\u0275template(10,V,2,0,"li",24),e.\u0275\u0275template(11,k,2,0,"li",24),e.\u0275\u0275elementEnd()()()}if(2&r){const t=l.row,n=e.\u0275\u0275reference(5);e.\u0275\u0275advance(1),e.\u0275\u0275property("nzType","primary")("nzShape","round")("nzDropdownMenu",n),e.\u0275\u0275advance(8),e.\u0275\u0275property("ngIf","failed"===t.transaction_status),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","succeed"!==t.transaction_status&&"failed"!==t.transaction_status&&null!==t.transaction_status),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","failed_pay"===t.status||"failed_topup"===t.status)}}function G(r,l){1&r&&(e.\u0275\u0275elementStart(0,"span",29),e.\u0275\u0275text(1,"Draft"),e.\u0275\u0275elementEnd())}function H(r,l){1&r&&(e.\u0275\u0275elementStart(0,"span",30),e.\u0275\u0275text(1,"Submitted"),e.\u0275\u0275elementEnd())}function U(r,l){1&r&&(e.\u0275\u0275elementStart(0,"span",30),e.\u0275\u0275text(1,"Approved"),e.\u0275\u0275elementEnd())}function Y(r,l){1&r&&(e.\u0275\u0275elementStart(0,"span",31),e.\u0275\u0275text(1,"Rejected"),e.\u0275\u0275elementEnd())}function B(r,l){if(1&r&&(e.\u0275\u0275elementStart(0,"div",18),e.\u0275\u0275elementContainerStart(1,25),e.\u0275\u0275template(2,G,2,0,"span",26),e.\u0275\u0275template(3,H,2,0,"span",27),e.\u0275\u0275template(4,U,2,0,"span",27),e.\u0275\u0275template(5,Y,2,0,"span",28),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()),2&r){const t=l.row;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitch",t.status),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase","0"),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase","1"),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase","2"),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase","3")}}function Q(r,l){1&r&&(e.\u0275\u0275elementStart(0,"span",32),e.\u0275\u0275text(1,"Change Status"),e.\u0275\u0275elementEnd())}function Z(r,l){if(1&r&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275element(1,"nz-option",38),e.\u0275\u0275text(2," - "),e.\u0275\u0275elementContainerEnd()),2&r){const t=l.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("nzLabel",t.value)("nzValue",t.id)}}function $(r,l){if(1&r&&(e.\u0275\u0275elementStart(0,"form",33)(1,"nz-form-item")(2,"nz-form-label",34),e.\u0275\u0275text(3,"Status"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"nz-form-control",35)(5,"nz-select",36),e.\u0275\u0275template(6,Z,3,2,"ng-container",37),e.\u0275\u0275elementEnd()()()()),2&r){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("formGroup",t.validateForm),e.\u0275\u0275advance(2),e.\u0275\u0275property("nzSpan",6),e.\u0275\u0275advance(2),e.\u0275\u0275property("nzSpan",12),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",t.listStatus)}}function K(r,l){if(1&r){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",39),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).modalRef;return e.\u0275\u0275resetView(a.destroy())}),e.\u0275\u0275text(1,"Close"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(2,"button",40),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.submitForm())}),e.\u0275\u0275text(3,"Submit"),e.\u0275\u0275elementEnd()}}let W=(()=>{class r{constructor(t){this.fb=t,this.form=new m.FormGroup({}),this.model={},this.options={},this.fields=[],this.rows=[],this.loadingIndicator=!0,this.ColumnMode=f.ColumnMode,this.headerHeight=50,this.rowHeight=50,this.pageLimit=10,this.pagination=new M,this.IComMessageService=(0,e.inject)(P.Qi),this.productService=(0,e.inject)(T.k),this.IComLibsServicesProjectOrderService=(0,e.inject)(T.VD),this.el=(0,e.inject)(e.ElementRef),this.router=(0,e.inject)(I.Router),this.modalService=(0,e.inject)(S.NzModalService),this.cdr=(0,e.inject)(e.ChangeDetectorRef),this.columns=[],this.listStatus=[],this.validateForm=this.fb.group({status:["",[m.Validators.required]]}),this.options={formState:{hidden:!1}}}ngOnInit(){this.columns=[{prop:"",cellTemplate:this.selectRef,sortable:!1,width:150},{prop:"id",width:200,name:"Id",sortable:!1},{prop:"short_id",width:100,name:"Id tr\xean App",sortable:!1},{prop:"user_customer_id_value",width:150,name:"Phone Number",sortable:!1},{prop:"",width:150,pipe:this.pipeDisplayNameCustomer(),name:"User Name"},{prop:"flow_name",width:200,sortable:!1,name:"Order Type"},{prop:"pay_point",width:100,sortable:!1,name:"Pay Point"},{prop:"pay_cash",width:80,sortable:!1,name:"Pay Cash"},{prop:"subtotal",width:100,sortable:!0,name:"Total Payment"},{prop:"created_at_timestamp",width:150,sortable:!0,name:"Created At",pipe:(0,w.ZR)()},{prop:"updated_at_timestamp",width:150,sortable:!0,name:"Update At",pipe:(0,w.ZR)()},{prop:"status",sortable:!1,width:200}],this.fields=[{fieldGroupClassName:"flex row items-center",fieldGroup:[{key:"username",type:"input",className:"basis-4/12",props:{placeholder:"User Name",label:"User Name",type:"string"}},{key:"phone_number",type:"input",className:"basis-4/12 ml-4",props:{placeholder:"Phone Number",label:"Phone Number",type:"string"},expressions:{hide:"!formState.hidden"}},{key:"flow",type:"select-custom",className:"basis-4/12 ml-4",props:{label:"Order Type",type:"text",placeholder:"Select Order Type",viewValue:"value",labelProp:"value",valueProp:"id",options:this.IComLibsServicesProjectOrderService.getStatusTransactionTypes().pipe((0,p.map)(t=>t?.data))},expressions:{hide:"!formState.hidden"}}]},{fieldGroupClassName:"flex row items-center",fieldGroup:[{key:"status",type:"select-custom",className:"basis-3/12",props:{label:"Status",type:"text",placeholder:"Select Status",viewValue:"value",labelProp:"value",valueProp:"id",options:this.IComLibsServicesProjectOrderService.getStatusTransactionOrder().pipe((0,p.map)(t=>t?.data))},expressions:{hide:"!formState.hidden"}},{key:"id",type:"input",className:"basis-3/12 ml-4",props:{placeholder:"Enter ID",label:"ID",type:"string"},expressions:{hide:"!formState.hidden"}},{key:"short_id",type:"input",className:"basis-3/12 ml-4",props:{placeholder:"Enter Id tr\xean App",label:"Id tr\xean App",type:"string"},expressions:{hide:"!formState.hidden"}},{key:"start_date",type:"date",className:"basis-2/12 ml-4",props:{label:"Start Time",placeholder:"Select Start Time"},expressions:{hide:"!formState.hidden"}},{key:"end_date",type:"date",className:"basis-2/12 ml-4",props:{label:"End Time",placeholder:"Select End Time"},expressions:{hide:"!formState.hidden"}}]},{fieldGroupClassName:"flex row items-center",fieldGroup:[{key:"payment_method",type:"select-custom",className:"basis-4/12",templateOptions:{label:"Payment Method",placeholder:"Filter by Payment Method",viewValue:"value",labelProp:"value",valueProp:"id",options:this.IComLibsServicesProjectOrderService.getPaymentMethod().pipe((0,p.map)(t=>t?.data))},expressions:{hide:"!formState.hidden"}},{key:"product_type",type:"select-custom",className:"basis-4/12  ml-4",templateOptions:{label:"Product Type",viewValue:"name",labelProp:"name",valueProp:"code",options:this.productService.getOptionType("PRODUCT_TYPE").pipe((0,p.map)(t=>t?.data))},expressions:{hide:"!formState.hidden"}},{key:"target_phone_number",type:"input",className:"basis-4/12  ml-4",hideExpression:(t,n)=>"PRODUCT_TYPE_TOPUP_MOBILE"!==t.product_type||!n.hidden,templateOptions:{label:"Target Phone Number",placeholder:"Filter by Target Phone Number"}}]}],(0,p.combineLatest)([this.IComLibsServicesProjectOrderService.getStatusTransactionOrder()]).subscribe(t=>{const[n]=t;this.listStatus=n?.data;const o=this.columns.find(a=>"status"===a.prop);o&&(o.pipe=this.pipeParseStatus(n)),this.columns=[...this.columns],this.cdr.detectChanges()}),this.loadPage({offset:0})}pipeParseStatus(t){const n=t.data;return{transform:o=>{const a=n?.find(i=>i.id===o);return a?a?.value:"-"}}}loadPage(t){var n=this;return(0,C.Z)(function*(){try{n.pagination.pageNumber=t.offset,n.loadingIndicator=!0;const a={...{...n.model},start_date:n.model.start_date?x(n.model.start_date).format("YYYY-MM-DD"):"",end_date:n.model.end_date?x(n.model.end_date).format("YYYY-MM-DD"):""};n.sort&&(a.sort=n.sort);const i=yield(0,p.lastValueFrom)(n.IComLibsServicesProjectOrderService.listTransaction({...a,page:n.pagination.pageNumber+1,limit:n.model.limit||15}));if(i&&i.data&&i.data.items)return n.rows=i.data.items||[],void(n.pagination.totalElements=i.data.pagination.total_rows);n.rows=[],n.pagination.totalElements=i.data.pagination.total_rows}catch(o){console.log(o)}finally{n.loadingIndicator=!1,n.cdr.detectChanges()}})()}handlerViewDetail(t,n){t.stopPropagation(),this.router.navigateByUrl(`/order/list/detail?id=${n.id}`)}handlerSearch(){this.loadPage({offset:0})}handlerReset(){this.form.reset({}),this.loadPage({offset:0})}handlerRetry(t,n){t.stopPropagation(),this.modalService.confirm({nzTitle:"Are you sure retry transaction?",nzOkText:"Submit",nzOkType:"primary",nzMaskClosable:!1,nzClosable:!1,nzOnOk:this.processDeleteProduct.bind(this,n),nzCancelText:"Cancel"},"success")}pipeDisplayNameCustomer(){return{transform:t=>t?.user_full_name||t?.user_short_name||"-"}}processDeleteProduct(t){return(0,p.lastValueFrom)(this.IComLibsServicesProjectOrderService.retryTransaction(t.id||"")).then(()=>{this.IComMessageService.showAlertMessageDone("Retry Transaction success")}).catch(n=>{this.IComMessageService.showAlertMessageError(n?.error?.error_message)})}handlerForceStop(t,n){t.stopPropagation(),this.modalService.confirm({nzTitle:"Are you sure force stop transaction?",nzOkText:"Submit",nzOkType:"primary",nzMaskClosable:!1,nzClosable:!1,nzOnOk:this.processForceStop.bind(this,n),nzCancelText:"Cancel"},"warning")}processForceStop(t){return(0,p.lastValueFrom)(this.IComLibsServicesProjectOrderService.forceStopTransaction(t.id||"")).then(()=>{this.IComMessageService.showAlertMessageDone("Retry Transaction success")}).catch(n=>{this.IComMessageService.showAlertMessageError(n?.error?.error_message)})}handlerUpdate(t,n,o,a,i){t.stopPropagation(),this.modalService.create({nzTitle:o,nzContent:a,nzFooter:i,nzMaskClosable:!1,nzClosable:!1,nzOnOk:()=>console.log("Click ok")})}submitForm(){var t=this;return(0,C.Z)(function*(){try{if(!t.validateForm.valid)return void Object.values(t.validateForm.controls).forEach(n=>{n.invalid&&(n.markAsDirty(),n.updateValueAndValidity({onlySelf:!0}))})}catch{}})()}handlerSort(t){const n=t.sorts[0];let o=t?.column?.prop?t?.column?.prop:"user_name";"desc"===n.dir&&(o=`-${o}`),this.sort=o,this.loadPage({offset:0})}handlerToggleCollapse(){this.options.formState.hidden=!this.options.formState.hidden}static#e=this.\u0275fac=function(n){return new(n||r)(e.\u0275\u0275directiveInject(m.NonNullableFormBuilder))};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["icom-libs-order"]],viewQuery:function(n,o){if(1&n&&(e.\u0275\u0275viewQuery(j,7),e.\u0275\u0275viewQuery(F,7)),2&n){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.statusRef=a.first),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(o.selectRef=a.first)}},standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:26,vars:23,consts:[[1,"flex","w-full","h-full","flex-col"],["nz-form","",1,"!p-4","bg-white","border","rounded-md",3,"formGroup","nzLayout"],[3,"model","fields","options","form"],["nz-row","",1,"flex","justify-between"],["nz-col","",1,"search-area","flex","items-center"],["nz-button","",1,"!flex","!items-center",3,"nzType","click"],["nz-icon","","nzType","search","nzTheme","outline"],["nz-button","",1,"ml-4","!flex","!items-center",3,"click"],["nz-icon","","nzTheme","outline","nzType","close-circle"],[1,"ml-4","items-center","flex",3,"click"],["nz-icon","",1,"ml-2",3,"nzType"],[1,"w-full","h-full","mt-4","overflow-hidden"],[1,"material","expandable","striped","w-full","h-full",3,"rows","columns","headerHeight","columnMode","footerHeight","virtualization","rowHeight","scrollbarH","loadingIndicator","count","offset","externalPaging","selectAllRowsOnPage","limit","page","sort"],["selectRef",""],["statusRef",""],["tplTitle",""],["tplContent",""],["tplFooter",""],[1,"name-container"],["nz-button","","nz-button","","nz-dropdown","",3,"nzType","nzShape","nzDropdownMenu"],["nz-icon","","nzType","down"],["menu4","nzDropdownMenu"],["nz-menu",""],["nz-menu-item","",3,"click"],["nz-menu-item","",3,"click",4,"ngIf"],[3,"ngSwitch"],["nz-typography","",4,"ngSwitchCase"],["nz-typography","","nzType","success",4,"ngSwitchCase"],["nz-typography","","nzType","danger",4,"ngSwitchCase"],["nz-typography",""],["nz-typography","","nzType","success"],["nz-typography","","nzType","danger"],[1,"text-lg"],["nz-form","",3,"formGroup"],["nzFor","email",3,"nzSpan"],[3,"nzSpan"],["formControlName","status"],[4,"ngFor","ngForOf"],[3,"nzLabel","nzValue"],["nz-button","",3,"click"],["nz-button","","nzType","primary",3,"click"]],template:function(n,o){1&n&&(e.\u0275\u0275elementStart(0,"div",0)(1,"form",1),e.\u0275\u0275element(2,"formly-form",2),e.\u0275\u0275elementStart(3,"div",3)(4,"div",4)(5,"button",5),e.\u0275\u0275listener("click",function(){return o.handlerSearch()}),e.\u0275\u0275element(6,"i",6),e.\u0275\u0275text(7," Search "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"button",7),e.\u0275\u0275listener("click",function(){return o.handlerReset()}),e.\u0275\u0275element(9,"i",8),e.\u0275\u0275text(10," Reset "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"a",9),e.\u0275\u0275listener("click",function(){return o.handlerToggleCollapse()}),e.\u0275\u0275text(12),e.\u0275\u0275element(13,"span",10),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(14,"div",11)(15,"ngx-datatable",12),e.\u0275\u0275listener("page",function(i){return o.loadPage(i)})("sort",function(i){return o.handlerSort(i)}),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(16,A,12,6,"ng-template",null,13,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(18,B,6,5,"ng-template",null,14,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(20,Q,2,0,"ng-template",null,15,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(22,$,7,4,"ng-template",null,16,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(24,K,4,0,"ng-template",null,17,e.\u0275\u0275templateRefExtractor)),2&n&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("formGroup",o.form)("nzLayout","vertical"),e.\u0275\u0275advance(1),e.\u0275\u0275property("model",o.model)("fields",o.fields)("options",o.options)("form",o.form),e.\u0275\u0275advance(3),e.\u0275\u0275property("nzType","primary"),e.\u0275\u0275advance(7),e.\u0275\u0275textInterpolate1(" ",o.options.formState.hidden?"Collapse":"Expand"," "),e.\u0275\u0275advance(1),e.\u0275\u0275property("nzType",o.options.formState.hidden?"up":"down"),e.\u0275\u0275advance(2),e.\u0275\u0275property("rows",o.rows)("columns",o.columns)("headerHeight",o.headerHeight)("columnMode",o.ColumnMode.force)("footerHeight",50)("virtualization",!1)("rowHeight",50)("scrollbarH",!0)("loadingIndicator",o.loadingIndicator)("count",o.pagination.totalElements)("offset",o.pagination.pageNumber)("externalPaging",!0)("selectAllRowsOnPage",!0)("limit",(null==o.model?null:o.model.limit)||15))},dependencies:[f.NgxDatatableModule,f.DatatableComponent,O.FormlyNgZorroAntdModule,m.ReactiveFormsModule,m.\u0275NgNoValidate,m.NgControlStatus,m.NgControlStatusGroup,m.FormGroupDirective,m.FormControlName,y.FormlyModule,y.FormlyForm,v.NzButtonModule,v.NzButtonComponent,E.\u0275NzTransitionPatchDirective,D.NzWaveDirective,c.NzFormModule,L.NzColDirective,L.NzRowDirective,c.NzFormDirective,c.NzFormItemComponent,c.NzFormLabelComponent,c.NzFormControlComponent,u.NgForOf,u.NgSwitch,u.NgSwitchCase,b.NzTypographyModule,b.NzTypographyComponent,z.NzIconModule,z.NzIconDirective,S.NzModalModule,_.NzSelectModule,_.NzOptionComponent,_.NzSelectComponent,m.FormsModule,h.NzDropDownModule,N.NzMenuDirective,N.NzMenuItemComponent,h.NzDropDownDirective,h.NzDropdownMenuComponent,h.NzDropdownButtonDirective,u.NgIf],encapsulation:2,changeDetection:0})}return r})()}}]);