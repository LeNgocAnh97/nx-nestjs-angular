(self.webpackChunkicom=self.webpackChunkicom||[]).push([[9736],{58658:(A,C,i)=>{i.d(C,{B:()=>O});var P=i(49671),e=i(36151),m=i(93484),v=i(44729),y=i(13391),j=i(62059),b=i(16283),d=i(33635),D=i(53750),L=i(14817),p=i(18019),u=i(15311),N=i(91872),F=i(8111),z=i(47809),_=i(54829),T=i(75150);function x(l,h){if(1&l){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",5)(1,"button",6),e.\u0275\u0275listener("click",function(n){e.\u0275\u0275restoreView(o);const t=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(t.handlerSave(n))}),e.\u0275\u0275text(2," L\u01b0u "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"button",7),e.\u0275\u0275listener("click",function(n){e.\u0275\u0275restoreView(o);const t=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(t.handlerCancel(n))}),e.\u0275\u0275text(4,"\u0110\xf3ng"),e.\u0275\u0275elementEnd()()}if(2&l){const o=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("nzType","primary")("nzLoading",o.isLoading)}}function M(l,h){if(1&l){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",5)(1,"button",6),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(o);const n=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(n.toggleDisabled())}),e.\u0275\u0275text(2," S\u1eeda "),e.\u0275\u0275elementEnd()()}if(2&l){const o=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("nzType","primary")("nzLoading",o.isLoading)}}function g(l,h){if(1&l&&(e.\u0275\u0275elementStart(0,"div",3),e.\u0275\u0275template(1,x,5,2,"div",4),e.\u0275\u0275template(2,M,3,2,"div",4),e.\u0275\u0275elementEnd()),2&l){const o=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null!=o.options&&null!=o.options.formState&&o.options.formState.disabled)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",null==o.options||null==o.options.formState?null:o.options.formState.disabled)}}let O=(()=>{class l{constructor(){this.form=new m.FormGroup({}),this.options={formState:{disabled:!0}},this.fields=[],this.icomSave=new e.EventEmitter,this.productService=(0,e.inject)(v.k),this.cardService=(0,e.inject)(v.Oz),this.iComMessageService=(0,e.inject)(D.Qi),this.destroyRef=(0,e.inject)(e.DestroyRef),this.changeDetectorRef=(0,e.inject)(e.ChangeDetectorRef),this.model={}}ngOnInit(){this.fields=((l,h)=>[{fieldGroupClassName:"flex row items-center",key:"",fieldGroup:[{key:"name",type:"input",className:"w-full",props:{label:"T\xean s\u1ea3n ph\u1ea9m",placeholder:"T\xean s\u1ea3n ph\u1ea9m",type:"string",required:!0},expressions:{"props.disabled":"formState.disabled"}},{key:"items",type:"input-custom",className:"w-[200px] ml-4",props:{label:"S\u1ed1 item t\u1ed1i \u0111a/ giao d\u1ecbch",placeholder:"S\u1ed1 item t\u1ed1i \u0111a/ giao d\u1ecbch",type:"string",disabled:!0,readonly:!0},defaultValue:1,expressions:{"props.disabled":"formState.disabled"}}]},{fieldGroupClassName:"flex row items-center",key:"",fieldGroup:[{key:"code",type:"input",className:"basis-1/2",props:{label:"Code",placeholder:"Code",type:"string",required:!0},expressions:{"props.disabled":o=>"GENCODE_TYPE_FROM_3RD_PARTY"===o.model?.gen_code_type||h.disabled}},{key:"status",type:"select-custom",className:"basis-1/2 ml-4",expressions:{"props.disabled":"formState.disabled"},defaultValue:0,props:{label:"Tr\u1ea1ng th\xe1i",viewValue:"name",labelProp:"name",search:!0,placeholder:"Tr\u1ea1ng th\xe1i",valueProp:"int_value",required:!0,options:l.getOptionType("PRODUCT_STATUS").pipe((0,d.map)(o=>o?.data))}}]},{fieldGroupClassName:"flex row items-center",key:"",fieldGroup:[{key:"start_time",className:"w-[300px]",type:"date",props:{required:!0,label:"B\u1eaft \u0111\u1ea7u hi\u1ec3n th\u1ecb",placeholder:"Ch\u1ecdn th\u1eddi gian",ShowTime:!0,format:"dd-MM-yyyy HH:mm"},expressions:{"props.disabled":"formState.disabled"}},{key:"end_time",className:"w-[300px]",type:"date",props:{label:"K\u1ebft th\xfac hi\u1ec3n th\u1ecb",ShowTime:!0,placeholder:"Ch\u1ecdn th\u1eddi gian",format:"dd-MM-yyyy HH:mm"},expressions:{"props.disabled":"formState.disabled"}}]},{className:"section-label",template:'<hr class="my-4"/>'},{fieldGroupClassName:"flex row items-center",key:"",fieldGroup:[{key:"category_ids",type:"select-custom",className:"basis-1/2",props:{label:"Danh m\u1ee5c",placeholder:"Danh m\u1ee5c",viewValue:"name",labelProp:"name",valueProp:"id",multiple:!0,options:l.getCategoryForSelect().pipe((0,d.map)(o=>o?.data?.items))},expressions:{"props.disabled":"formState.disabled"}},{key:"group_ids",type:"select-custom",className:"basis-1/2 ml-4",props:{label:"Hi\u1ec3n th\u1ecb tr\xean app",placeholder:"Hi\u1ec3n th\u1ecb tr\xean app",viewValue:"name",multiple:!0,labelProp:"name",valueProp:"id",required:!0,options:l.getGroupForSelect().pipe((0,d.map)(o=>o?.data?.items))},expressions:{"props.disabled":"formState.disabled"}}]},{key:"organization_id",type:"select-custom",props:{label:"\u0110\u1ed1i t\xe1c",placeholder:"\u0110\u1ed1i t\xe1c",required:!0,valueProp:"id",labelProp:"name",options:l.getOrg().pipe((0,d.map)(o=>o?.data))},expressions:{"props.disabled":"formState.disabled"}},{key:"brand_id",type:"select-custom",props:{label:"Th\u01b0\u01a1ng hi\u1ec7u",options:[],required:!0,placeholder:"Th\u01b0\u01a1ng hi\u1ec7u",valueProp:"id",labelProp:"name"},expressions:{"props.disabled":"formState.disabled"},hooks:{onInit:o=>{const r=o.parent.get("organization_id").formControl;o.props.options=r.valueChanges.pipe((0,d.startWith)(r.value),(0,d.distinctUntilChanged)(),(0,d.concatMap)(n=>n?l.getBrandByOrg(n).pipe((0,d.map)(t=>{const s=t?.data?.find(a=>o?.model?.brand_id===a.id);return o.parent.model.specific_brands_object=t?.data||[],s||(o.formControl.setValue(null),o.parent.get("store_ids").formControl?.setValue(null)),t?.data||[]})):(o.parent.get("store_ids").formControl?.setValue(null),o.parent.get("brand_id").formControl?.setValue(null),[])))}}},{key:"store_ids",type:"select-custom",props:{label:"Chi nh\xe1nh",placeholder:"Chi nh\xe1nh",viewValue:"name",labelProp:"name",valueProp:"id",multiple:!0},expressions:{"props.disabled":"formState.disabled"},hooks:{onInit:o=>{const r=o.parent.get("brand_id").formControl;o.props.options=r.valueChanges.pipe((0,d.startWith)(r.value),(0,d.distinctUntilChanged)(),(0,d.tap)(n=>{const t=o.parent?.model?.specific_brands_object?.find(a=>a.id===n);o.parent.model.brand_code=t?t.code:null}),(0,d.concatMap)(n=>{if(!n)return o.formControl.setValue([]),o.parent.model.brand_code="",[];const t=o.parent?.model?.specific_brands_object?.find(a=>a.id===n);return o.parent.model.brand_code=t?t.code:null,l.getStoreByBrand(n).pipe((0,d.map)(a=>(a?.data?.find(c=>o?.model?.store_ids?.includes(c.id))||o.formControl.setValue([]),a?.data||[])))}))}}}])(this.productService,this.options.formState),this.model&&this.model.catalog_ids&&this.model.catalog_ids?.length&&(this.model.catalog_ids=this.model.catalog_ids[0]),this.modelOrigin=(0,p.cloneDeep)(this.model),this.isAdd&&this.toggleDisabled(),setTimeout(()=>{this.form.controls.gen_code_type?.valueChanges.pipe((0,d.distinctUntilChanged)(),(0,d.map)(()=>{this.form.reset(this.model)})).subscribe()},200)}handlerSave(o,r){var n=this;return(0,P.Z)(function*(){if(o?.stopPropagation(),o?.preventDefault(),n.form.valid)try{if(n.model?.start_time&&n.model?.end_time&&N(n.model?.end_time).isBefore(n.model?.start_time))return void n.iComMessageService.showAlertMessageError("Th\u1eddi gian k\u1ebft th\xfac kh\xf4ng \u0111\u01b0\u1ee3c nh\u1ecf h\u01a1n th\u1eddi gian b\u1eaft \u0111\u1ea7u.");n.form.markAsTouched(),n.form.submitted=!0,r&&r.isLoading&&r.isLoading();const t=(0,p.cloneDeep)(n.model);if(t&&t.catalog_ids&&(t.catalog_ids=[t.catalog_ids]),n.isLoading=!0,n.model=(0,F.oS)(n.model,"specific"),n.isAdd){const s=yield(0,d.lastValueFrom)(n.cardService.createProduct(t));n.icomSave.emit(s?.data),r&&r.success&&r.success(s?.data?.id),n.iComMessageService.showAlertMessageDone("T\u1ea1o s\u1ea3n ph\u1ea9m th\xe0nh c\xf4ng")}else{const s=yield(0,d.lastValueFrom)(n.cardService.updateProduct(n.model?.id||0,t));r&&r.success&&r.success(),n.icomSave.emit(s?.data),n.iComMessageService.showAlertMessageDone("S\u1eeda s\u1ea3n ph\u1ea9m th\xe0nh c\xf4ng"),n.modelOrigin=(0,p.cloneDeep)(n.model),n.toggleDisabled()}}catch(t){r&&r.loadDone&&r.loadDone(),n.iComMessageService.showAlertMessageError(t?.error?.error_message||"T\u1ea1o s\u1ea3n ph\u1ea9m th\u1ea5t b\u1ea1i")}finally{r&&r.loadDone&&r.loadDone(),n.isLoading=!1,n.changeDetectorRef.detectChanges()}else Object.keys(n.form.controls).forEach(t=>{n.form.controls[t].touched=!0})})()}toggleDisabled(){this.options.formState.disabled=!this.options.formState.disabled}handlerCancel(o){o.stopPropagation(),this.toggleDisabled(),this.model=(0,p.cloneDeep)(this.modelOrigin)}static#e=this.\u0275fac=function(r){return new(r||l)};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:l,selectors:[["icom-libs-product-add_edit"]],inputs:{model:"model",isAdd:"isAdd"},outputs:{icomSave:"icomSave"},standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:3,vars:7,consts:[["nz-form","",1,"pb-4","bg-white","border","rounded-md","h-full","flex","flex-col",3,"formGroup","nzLayout"],[1,"overflow-auto","px-4","pt-4",3,"model","fields","options","form"],["nz-row","","class","p-4 border",4,"ngIf"],["nz-row","",1,"p-4","border"],["nz-col","","class","search-area flex",4,"ngIf"],["nz-col","",1,"search-area","flex"],["nz-button","",3,"nzType","nzLoading","click"],["nz-button","",1,"ml-4",3,"click"]],template:function(r,n){1&r&&(e.\u0275\u0275elementStart(0,"form",0),e.\u0275\u0275element(1,"formly-form",1),e.\u0275\u0275template(2,g,3,2,"div",2),e.\u0275\u0275elementEnd()),2&r&&(e.\u0275\u0275property("formGroup",n.form)("nzLayout","vertical"),e.\u0275\u0275advance(1),e.\u0275\u0275property("model",n.model)("fields",n.fields)("options",n.options)("form",n.form),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n.model&&n.model.id))},dependencies:[j.FormlyNgZorroAntdModule,m.ReactiveFormsModule,m.\u0275NgNoValidate,m.NgControlStatusGroup,m.FormGroupDirective,y.FormlyModule,y.FormlyForm,b.NzButtonModule,b.NzButtonComponent,z.\u0275NzTransitionPatchDirective,_.NzWaveDirective,L.NgIf,u.NzFormModule,T.NzColDirective,T.NzRowDirective,u.NzFormDirective],encapsulation:2,changeDetection:0})}return l})()},59736:(A,C,i)=>{i.r(C),i.d(C,{IcomLibsProductAddEditComponent:()=>g.B,IcomLibsProductCardListComponent:()=>o});var P=i(49671),e=i(36151),m=i(93484),v=i(13391),y=i(62059),j=i(16283),b=i(15311),d=i(44729),S=i(33635),D=i(14817),L=i(47332),p=i(87757),u=i(37586),N=i(14859),F=i(17891),z=i(60202),_=i(53750),T=i(74843),x=i(30424),M=i(28391),g=i(58658),O=i(18019),l=i(75150);function h(r,n){1&r&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275element(1,"icom-libs-product-add_edit",6),e.\u0275\u0275elementContainerEnd()),2&r&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("isAdd",!0))}let o=(()=>{class r{constructor(){this.form=new m.FormGroup({}),this.model={},this.inventoryService=(0,e.inject)(d.k),this.productService=(0,e.inject)(d.k),this.IComMessageService=(0,e.inject)(_.Qi),this.icomLibsDynamicComponentService=(0,e.inject)(_.Gj),this.localStorageService=(0,e.inject)(x.n2),this.location=(0,e.inject)(D.Location),this.fields=[{fieldGroupClassName:"flex flex-col",className:"basis-1/2",fieldGroup:[{key:"sku",type:"input",className:"basis-4/12",props:{label:"M\xe3 Code",placeholder:"M\xe3 Code",type:"string"},expressions:{hide:"!formState.hidden"}}]},{fieldGroupClassName:"flex flex-col",className:"basis-1/2",fieldGroup:[{key:"status",type:"select-custom",className:"basis-4/12 ",props:{label:"Tr\u1ea1ng th\xe1i",viewValue:"name",labelProp:"name",placeholder:"Tr\u1ea1ng th\xe1i",valueProp:"int_value",options:this.productService.getOptionType("PRODUCT_STATUS").pipe((0,S.map)(t=>t?.data))},expressions:{hide:"!formState.hidden"}}]}],this.router=(0,e.inject)(z.Router),this.permissionService=(0,e.inject)(x.$A),this.cdr=(0,e.inject)(e.ChangeDetectorRef),this.viewContainerRef=(0,e.inject)(e.ViewContainerRef),this.componentFactoryResolver=(0,e.inject)(e.ComponentFactoryResolver),this.loadData=t=>{t.type||(t.type="PRODUCT_TYPE_CARD");const s=(0,O.cloneDeep)(t);return delete s.page,delete s.per_page,this.localStorageService.setItem("productCardParams",s),this.inventoryService.searchProduct(t)},this.functionParse=t=>t?.map(s=>({...s,...s.creator_info})),this.columns=[],this.model=this.localStorageService.getItem("productCardParams")||{}}ngOnInit(){var t=this;return(0,P.Z)(function*(){t.columns=[{title:"STT",type:"index",width:"80px"},{title:"T\xean th\u1ebb",key:"name",type:"text",width:"250px"},{title:"Code",key:"sku",type:"text",width:"250px"},{title:"S\u1ed1 item t\u1ed1i \u0111a/ giao d\u1ecbch",key:"max_item_per_transaction",type:"text",width:"180px"},{title:"Hi\u1ec3n th\u1ecb tr\xean App",key:"app",type:"text"},{title:"B\u1eaft \u0111\u1ea7u hi\u1ec3n th\u1ecb",key:"start_time",type:"text",pipe:"time"},{title:"K\u1ebft th\xfac hi\u1ec3n th\u1ecb",key:"end_time",type:"text",pipe:"time"},{title:"Tr\u1ea1ng th\xe1i",key:"status",pipe:"array",type:"text",pipeArgs:[{value:"Draft",id:0,class:"text-gray-500"},{value:"Submitted",id:1,class:"text-green-500"},{value:"Approved",id:2,class:"text-green-500"},{value:"Rejected",id:3,class:"text-red-500"}]},{title:"Th\u1eddi gian t\u1ea1o",key:"created_at",type:"text",pipe:"time"},{key:"action",type:"button",buttonText:"Xem chi ti\u1ebft",buttonType:"primary",callback:t.viewItem.bind(t)}],(0,S.combineLatest)([t.productService.getOptionType("PRODUCT_TYPE"),t.productService.getOptionType("PRODUCT_GENCODE_TYPE")]).subscribe(s=>{const[a,c]=s,f=t.columns.find(I=>"type"===I.key);f&&(f.pipeArgs=t.pipeParseStatus(a)),t.columns=[...t.columns];const R=t.columns.find(I=>"gen_code_type"===I.key);R&&(R.pipeArgs=t.pipeParseStatus(c)),t.columns=[...t.columns],t.cdr.detectChanges()}),t.router.events.subscribe(s=>{s instanceof z.NavigationSkipped&&(t.childComponentRef&&t.removeComponentFromComponent(t,t.childComponentRef),t.childComponentRef=null)})})()}pipeParseStatus(t){return t.data.map(s=>({...s,id:s.code,value:s.name||s.string_value}))}viewItem(t,s){this.childComponentRef&&this.removeComponentFromComponent(this,this.childComponentRef),this.childComponentRef=this.icomLibsDynamicComponentService.appendComponentToComponent(this,M.IcomLibsProductCardDetailComponent),this.childComponentRef.instance.isAdd=s||!1,this.childComponentRef.instance.backClicked.subscribe(a=>{a&&this.eventFunctionControl.mergeItem&&this.eventFunctionControl.mergeItem("id",a),this.location.replaceState("product/card"),this.childComponentRef&&this.removeComponentFromComponent(this,this.childComponentRef),this.childComponentRef=null}),this.childComponentRef.instance.saveClicked.subscribe(a=>{this.eventFunctionControl.mergeItem&&this.eventFunctionControl.mergeItem("id",a)}),this.location.replaceState(`product/card/detail/${t.id}`),this.cdr.detectChanges()}removeComponentFromComponent(t,s){const a=t.viewContainerRef,c=a.indexOf(s.hostView);-1!==c&&a.detach(c),s.destroy()}handlerFunctionControl(t){this.eventFunctionControl=t}showModal(){this.isVisible=!0}handleOk(){this.addEditComp.handlerSave(void 0,{success:s=>{this.isVisible=!1,this.viewItem({id:s},!0)},isLoading:()=>{this.isOkLoading=!0},loadDone:()=>{this.isOkLoading=!1}})}handleCancel(){this.isVisible=!1}handlerViewDetail(t,s){t.stopPropagation();const a=this.router.serializeUrl(this.router.createUrlTree([`/product/card/detail/${s.id}`]));window.open(a,"_blank")}static#e=this.\u0275fac=function(s){return new(s||r)};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["icom-libs-product-list"]],viewQuery:function(s,a){if(1&s&&e.\u0275\u0275viewQuery(g.B,5),2&s){let c;e.\u0275\u0275queryRefresh(c=e.\u0275\u0275loadQuery())&&(a.addEditComp=c.first)}},standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:7,vars:13,consts:[[1,"flex","w-full","h-full","flex-col"],["nz-row","",1,"w-full","pr-4","h-full",2,"justify-content","end","padding-right","8px"],[1,"w-full","h-full",3,"columns","loadFn","fields","model","form","functionParse","icomAdd","icomFunctionControl"],["container",""],["nzTitle","T\u1ea1o th\u1ebb m\u1edbi",3,"nzWidth","nzOkLoading","nzClosable","nzMaskClosable","nzOkText","nzCancelText","nzVisible","nzVisibleChange","nzOnCancel","nzOnOk"],[4,"nzModalContent"],[3,"isAdd"]],template:function(s,a){1&s&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"icom-libs-core-components-table",2),e.\u0275\u0275listener("icomAdd",function(){return a.showModal()})("icomFunctionControl",function(f){return a.handlerFunctionControl(f)}),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275element(3,"div",null,3),e.\u0275\u0275elementStart(5,"nz-modal",4),e.\u0275\u0275listener("nzVisibleChange",function(f){return a.isVisible=f})("nzOnCancel",function(){return a.handleCancel()})("nzOnOk",function(){return a.handleOk()}),e.\u0275\u0275template(6,h,2,1,"ng-container",5),e.\u0275\u0275elementEnd()),2&s&&(e.\u0275\u0275advance(2),e.\u0275\u0275property("columns",a.columns)("loadFn",a.loadData)("fields",a.fields)("model",a.model)("form",a.form)("functionParse",a.functionParse),e.\u0275\u0275advance(3),e.\u0275\u0275property("nzWidth",960)("nzOkLoading",a.isOkLoading)("nzClosable",!1)("nzMaskClosable",!1)("nzOkText","L\u01b0u")("nzCancelText","\u0110\xf3ng")("nzVisible",a.isVisible))},dependencies:[y.FormlyNgZorroAntdModule,m.ReactiveFormsModule,v.FormlyModule,j.NzButtonModule,b.NzFormModule,l.NzRowDirective,L.NzTypographyModule,p.NzIconModule,u.NzModalModule,u.NzModalComponent,u.NzModalContentDirective,F.NzSelectModule,m.FormsModule,N.NzDropDownModule,g.B,T.d],encapsulation:2,changeDetection:0})}return r})()}}]);