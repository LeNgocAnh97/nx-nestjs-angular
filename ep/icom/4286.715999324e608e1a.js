(self.webpackChunkicom=self.webpackChunkicom||[]).push([[4286],{84286:(T,c,n)=>{n.r(c),n.d(c,{IcomLibCustomeDeviceComponent:()=>S});var p=n(49671),e=n(36151),f=n(93484),v=n(44729),y=n(74843),a=n(14817),g=n(60202),x=n(33635),C=n(37586),b=n(53750),m=n(8111),d=n(8581),u=n(91872);function D(s,j){if(1&s){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"icom-libs-core-components-table",3),e.\u0275\u0275listener("icomFunctionControl",function(r){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(i.handlerFunctionControl(r))}),e.\u0275\u0275elementEnd()}if(2&s){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("columns",t.columns)("loadFn",t.loadData)("fields",t.fields)("model",t.model)("form",t.form)("ignoreButtonAdd",!0)("functionParse",t.functionParse)}}let S=(()=>{class s{constructor(t,o){var r=this;this.datePipe=t,this.modalService=o,this.form=new f.FormGroup({}),this.iComLibsServicesProjectAdminUserService=(0,e.inject)(v.lF),this.iComMessageService=(0,e.inject)(b.Qi),this.router=(0,e.inject)(g.Router),this.loadData=i=>((0,m.xh)(i,"last_login_start,last_login_end"),this.iComLibsServicesProjectAdminUserService.getListDevices(i)),this.functionParse=i=>i?.map(l=>({...l,...l.creator_info})),this.functionExportFile=function(){var i=(0,p.Z)(function*(l,h){(0,m.cT)(`${d.N.apiGatewayUrl}${d.N.suffixAdmin}/v2.0/export/activity_logs`,"MauFileExportLichSuThaoTac",r.iComMessageService,l,!1,!0,h)});return function(l,h){return i.apply(this,arguments)}}(),this.columns=[],this.fields=[]}ngOnInit(){const t=u().format("YYYY-MM-DD"),o=u(t).subtract(3,"month").format("YYYY-MM-DD");this.model={last_login_start:o,last_login_end:t},this.fields=[{className:"flex flex-col",fieldGroupClassName:"flex w-full justify-between",fieldGroup:[{key:"search",type:"search-input",className:"basis-6/12",props:{type:"text",placeholder:"T\xecm ki\u1ebfm theo s\u1ed1 \u0111i\u1ec7n tho\u1ea1i, t\xean thi\u1ebft b\u1ecb, hardware model, IP"}},{key:"date_range",className:"basis-6/12",type:"icom-range-picker",props:{label:"Th\u1eddi gian \u0111\u0103ng nh\u1eadp",nzShowTime:!0,format:"dd-MM-yyyy HH:mm"}}]}],this.columns=[{title:"STT",type:"index",width:"80px"},{title:"S\u1ed1 \u0111i\u1ec7n tho\u1ea1i",key:"username",type:"text"},{title:"T\xean Thi\u1ebft b\u1ecb",key:"app_name",type:"text"},{title:"Hardware Model",key:"model",type:"text"},{title:"UUID",key:"device_key",type:"text"},{title:"IP",key:"ip_address",type:"text"},{title:"Ph\u01b0\u01a1ng th\u1ee9c \u0111\u0103ng nh\u1eadp",key:"login_method",type:"text"},{title:"Ho\u1ea1t \u0111\u1ed9ng l\u1ea7n cu\u1ed1i",key:"last_login",type:"text"},{title:"\u0110\u1ecba \u0111i\u1ec3m",key:"location",type:"text"},{title:"Lo\u1ea1i thi\u1ebft b\u1ecb",key:"is_current",pipe:"array",type:"text",pipeArgs:[{value:"Thi\u1ebft b\u1ecb hi\u1ec7n t\u1ea1i",id:!0,class:"text-green-500"},{value:"-",id:!1}]},{key:"action",type:"button",buttonText:"Xo\xe1",buttonType:"danger",callback:this.deleteItem.bind(this)}]}deleteItem(t){this.modalService.confirm({nzTitle:`B\u1ea1n c\xf3 ch\u1eafc ch\u1eafn mu\u1ed1n xo\xe1 thi\u1ebft b\u1ecb ${t?.app_name} ?`,nzOkText:"\u0110\u1ed3ng \xfd",nzOkType:"primary",nzOkDanger:!0,nzMaskClosable:!1,nzClosable:!1,nzOnOk:this.processDeleteSection.bind(this,t),nzCancelText:"H\u1ee7y b\u1ecf"},"error")}processDeleteSection(t){return(0,x.lastValueFrom)(this.iComLibsServicesProjectAdminUserService.removeDevice(t.device_key||"")).then(()=>{this.iComMessageService.showAlertMessageDone("X\xf3a thi\u1ebft b\u1ecb th\xe0nh c\xf4ng."),this.eventFunctionControl.reset()}).catch(o=>{this.iComMessageService.showAlertMessageError(o?.error?.error_message)})}handlerFunctionControl(t){this.eventFunctionControl=t}static#e=this.\u0275fac=function(o){return new(o||s)(e.\u0275\u0275directiveInject(a.DatePipe),e.\u0275\u0275directiveInject(C.NzModalService))};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:s,selectors:[["icom-libs-admin-user-history"]],standalone:!0,features:[e.\u0275\u0275ProvidersFeature([a.DecimalPipe,a.DatePipe]),e.\u0275\u0275StandaloneFeature],decls:3,vars:1,consts:[[1,"flex","w-full","h-full","flex-col"],["nz-row","",1,"w-full","pr-4","h-full",2,"justify-content","end","padding-right","8px"],[3,"columns","loadFn","fields","model","form","ignoreButtonAdd","functionParse","icomFunctionControl",4,"ngIf"],[3,"columns","loadFn","fields","model","form","ignoreButtonAdd","functionParse","icomFunctionControl"]],template:function(o,r){1&o&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1),e.\u0275\u0275template(2,D,1,7,"icom-libs-core-components-table",2),e.\u0275\u0275elementEnd()()),2&o&&(e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",r.loadData))},dependencies:[y.d,a.NgIf],encapsulation:2,changeDetection:0})}return s})()}}]);