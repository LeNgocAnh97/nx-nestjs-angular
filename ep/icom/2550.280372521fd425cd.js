(self.webpackChunkicom=self.webpackChunkicom||[]).push([[2550],{62550:(ut,N,s)=>{s.r(N),s.d(N,{IcomLibsProductDetailComponent:()=>pt});var m=s(49671),e=s(36151),d=s(93484),u=s(13391),y=s(62059),b=s(21786),f=s(16283),E=s(15311),g=s(14817),j=s(47332),D=s(63801),O=s(38831),T=s(59600),I=s(87757),h=s(44729),L=s(60202),l=s(33635),C=s(53750),v=s(18019),x=s(91872),k=s(8111),S=s(47809),z=s(54829),F=s(75150);function G(n,a){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",5)(1,"button",6),e.\u0275\u0275listener("click",function(r){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(i.handlerSave(r))}),e.\u0275\u0275text(2," Submit "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"button",7),e.\u0275\u0275listener("click",function(r){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(i.handlerCancel(r))}),e.\u0275\u0275text(4,"Cancel"),e.\u0275\u0275elementEnd()()}if(2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("nzType","primary")("nzLoading",t.isLoading)}}function B(n,a){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",5)(1,"button",6),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(r.toggleDisabled())}),e.\u0275\u0275text(2," Edit "),e.\u0275\u0275elementEnd()()}if(2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("nzType","primary")("nzLoading",t.isLoading)}}function U(n,a){if(1&n&&(e.\u0275\u0275elementStart(0,"div",3),e.\u0275\u0275template(1,G,5,2,"div",4),e.\u0275\u0275template(2,B,3,2,"div",4),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null!=t.options&&null!=t.options.formState&&t.options.formState.disabled)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",null==t.options||null==t.options.formState?null:t.options.formState.disabled)}}let Y=(()=>{class n{constructor(){this.form=new d.FormGroup({}),this.options={formState:{disabled:!0}},this.fields=[],this.icomSave=new e.EventEmitter,this.productService=(0,e.inject)(h.k),this.iComMessageService=(0,e.inject)(C.Qi),this.destroyRef=(0,e.inject)(e.DestroyRef),this.changeDetectorRef=(0,e.inject)(e.ChangeDetectorRef),this.model={}}ngOnInit(){this.fields=((n,a)=>[{key:"name",type:"input",props:{label:"Name",placeholder:"Enter Name",type:"string",required:!0},expressions:{"props.disabled":"formState.disabled"}},{key:"gen_code_type",type:"select-custom",className:"w-[500px]",props:{label:"Gen Code Type",placeholder:"Select Gen Code Type",viewValue:"name",labelProp:"name",valueProp:"code",required:!0,options:n.getOptionType("PRODUCT_GENCODE_TYPE").pipe((0,l.map)(t=>t?.data))},expressions:{"props.disabled":"formState.disabled"}},{fieldGroupClassName:"flex row items-center",key:"",fieldGroup:[{key:"code",type:"input",className:"basis-1/2",props:{label:"Code",placeholder:"Enter Code",type:"string",required:!0},expressions:{"props.disabled":t=>"GENCODE_TYPE_FROM_3RD_PARTY"===t.model?.gen_code_type||a.disabled}}]},{key:"unlimit",defaultValue:!0,type:"checkbox",props:{label:"Unlimit"},expressions:{"props.disabled":t=>"GENCODE_TYPE_PRE_GENERATED"===t.model?.gen_code_type||a.disabled},hooks:{onChanges:t=>{const o=t.parent.get("gen_code_type").formControl;o&&o.valueChanges.pipe((0,l.startWith)(o.value),(0,l.distinctUntilChanged)(),(0,l.map)(r=>"GENCODE_TYPE_AUTO_ONE_BY_ONE"===r||"GENCODE_TYPE_FROM_3RD_PARTY"===r?(t.props.disabled=!1,void(t.model.unlimit=!0)):(t.props.disabled=!0,void(t.model.unlimit=!1)))).subscribe()}}},{key:"belong_to_merchant",type:"checkbox",props:{label:"Select Merchant"},expressions:{"props.disabled":"formState.disabled"}},{fieldGroupClassName:"flex row items-center",key:"",fieldGroup:[{key:"type",type:"select-custom",className:"basis-1/2",expressions:{"props.disabled":"formState.disabled"},props:{label:"Type",placeholder:"Select Type",viewValue:"name",labelProp:"name",required:!0,valueProp:"code",options:n.getOptionType("PRODUCT_TYPE").pipe((0,l.map)(t=>t?.data))}},{key:"status",type:"select-custom",className:"basis-1/2 ml-4",expressions:{"props.disabled":"formState.disabled"},props:{label:"Status",viewValue:"name",labelProp:"name",search:!0,placeholder:"Select Status",valueProp:"int_value",required:!0,options:n.getOptionType("PRODUCT_STATUS").pipe((0,l.map)(t=>t?.data))}}]},{fieldGroupClassName:"flex row items-center",key:"",fieldGroup:[{key:"start_time",className:"w-[300px]",type:"date",props:{required:!0,label:"Start Time",ShowTime:!0,format:"dd-MM-yyyy HH:mm"},expressions:{"props.disabled":"formState.disabled"}},{key:"end_time",className:"w-[300px]",type:"date",props:{label:"End Time",ShowTime:!0,format:"dd-MM-yyyy HH:mm"},expressions:{"props.disabled":"formState.disabled"}}]},{className:"section-label",template:'<hr class="my-4"/>'},{fieldGroupClassName:"flex row items-center",key:"",fieldGroup:[{key:"category_ids",type:"select-custom",className:"basis-1/2",props:{label:"Category",placeholder:"Select Category",viewValue:"name",labelProp:"name",valueProp:"id",multiple:!0,options:n.getCategoryForSelect().pipe((0,l.map)(t=>t?.data?.items))},expressions:{"props.disabled":"formState.disabled"}},{key:"group_ids",type:"select-custom",className:"basis-1/2 ml-4",props:{label:"Group",placeholder:"Select Group",viewValue:"name",multiple:!0,labelProp:"name",valueProp:"id",required:!0,options:n.getGroupForSelect().pipe((0,l.map)(t=>t?.data?.items))},expressions:{"props.disabled":"formState.disabled"}}]},{fieldGroupClassName:"flex row items-center",key:"",fieldGroup:[{key:"catalog_ids",type:"select-custom",className:"basis-1/2",props:{label:"Catalog",placeholder:"Select Catalog",viewValue:"name",labelProp:"name",valueProp:"id",options:n.getCatalogForSelect().pipe((0,l.map)(t=>t?.data?.items))},expressions:{"props.disabled":"formState.disabled"}},{key:"catalog_show_order",type:"input",defaultValue:0,className:"basis-1/2 ml-4",props:{label:"Catalog show order",placeholder:"Enter Catalog show order",type:"number",min:0,required:!0},expressions:{"props.disabled":"formState.disabled"}},{key:"show_order",type:"input",defaultValue:0,className:"basis-1/2 ml-4",props:{label:"Order",placeholder:"Enter Order",type:"number",min:0,required:!0},expressions:{"props.disabled":"formState.disabled"}}]},{key:"import_mode",type:"select-custom",props:{label:"Import mode",placeholder:"Select Import mode*",viewValue:"name",labelProp:"name",valueProp:"code",required:!0,options:n.getOptionType("IMPORT_MODE").pipe((0,l.map)(t=>t?.data))},expressions:{"props.disabled":"formState.disabled"}},{className:"section-label",template:'<hr class="my-4"/>'},{key:"organization_id",type:"select-custom",props:{label:"Organization",placeholder:"Select Organization*",required:!0,valueProp:"id",labelProp:"name",options:n.getOrg().pipe((0,l.map)(t=>t?.data))},expressions:{"props.disabled":"formState.disabled"}},{key:"brand_id",type:"select-custom",props:{label:"Brand",options:[],required:!0,placeholder:"Select Brand",valueProp:"id",labelProp:"name"},expressions:{"props.disabled":"formState.disabled"},hooks:{onInit:t=>{const o=t.parent.get("organization_id").formControl;t.props.options=o.valueChanges.pipe((0,l.startWith)(o.value),(0,l.distinctUntilChanged)(),(0,l.concatMap)(r=>r?n.getBrandByOrg(r).pipe((0,l.map)(i=>{const c=i?.data?.find(p=>t?.model?.brand_id===p.id);return t.parent.model.specific_brands_object=i?.data||[],c||(t.formControl.setValue(null),t.parent.get("store_ids").formControl?.setValue(null)),i?.data||[]})):(t.parent.get("store_ids").formControl?.setValue(null),t.parent.get("brand_id").formControl?.setValue(null),[])))}}},{key:"store_ids",type:"select-custom",props:{label:"Store",placeholder:"Select Store",viewValue:"name",labelProp:"name",valueProp:"id",multiple:!0},expressions:{"props.disabled":"formState.disabled"},hooks:{onInit:t=>{const o=t.parent.get("brand_id").formControl;t.props.options=o.valueChanges.pipe((0,l.startWith)(o.value),(0,l.distinctUntilChanged)(),(0,l.tap)(r=>{const i=t.parent?.model?.specific_brands_object?.find(p=>p.id===r);t.parent.model.brand_code=i?i.code:null}),(0,l.concatMap)(r=>{if(!r)return t.formControl.setValue([]),t.parent.model.brand_code="",[];const i=t.parent?.model?.specific_brands_object?.find(p=>p.id===r);return t.parent.model.brand_code=i?i.code:null,n.getStoreByBrand(r).pipe((0,l.map)(p=>(p?.data?.find(mt=>t?.model?.store_ids?.includes(mt.id))||t.formControl.setValue([]),p?.data||[])))}))}}}])(this.productService,this.options.formState),this.model&&this.model.catalog_ids&&this.model.catalog_ids?.length&&(this.model.catalog_ids=this.model.catalog_ids[0]),this.modelOrigin=(0,v.cloneDeep)(this.model),this.isAdd&&this.toggleDisabled(),setTimeout(()=>{this.form.controls.gen_code_type?.valueChanges.pipe((0,l.distinctUntilChanged)(),(0,l.map)(()=>{this.form.reset(this.model)})).subscribe()},200)}handlerSave(t,o){var r=this;return(0,m.Z)(function*(){if(t?.stopPropagation(),t?.preventDefault(),r.form.valid)try{if(r.model?.start_time&&r.model?.end_time&&x(r.model?.end_time).isBefore(r.model?.start_time))return void r.iComMessageService.showAlertMessageError("Th\u1eddi gian k\u1ebft th\xfac  kh\xf4ng \u0111\u01b0\u1ee3c nh\u1ecf h\u01a1n th\u1eddi gian b\u1eaft \u0111\u1ea7u.");r.form.markAsTouched(),r.form.submitted=!0,o&&o.isLoading&&o.isLoading();const i=(0,v.cloneDeep)(r.model);if(i&&i.catalog_ids&&(i.catalog_ids=[i.catalog_ids]),r.isLoading=!0,r.model=(0,k.oS)(r.model,"specific"),r.isAdd){const c=yield(0,l.lastValueFrom)(r.productService.createProduct(i));r.icomSave.emit(c?.data),o&&o.success&&o.success(c?.data?.id),r.iComMessageService.showAlertMessageDone("Create product success")}else{const c=yield(0,l.lastValueFrom)(r.productService.updateProduct(r.model?.id||0,i));o&&o.success&&o.success(),r.icomSave.emit(c?.data),r.iComMessageService.showAlertMessageDone("Edit product success"),r.modelOrigin=(0,v.cloneDeep)(r.model),r.toggleDisabled()}}catch(i){o&&o.loadDone&&o.loadDone(),r.iComMessageService.showAlertMessageError(i?.error?.error_message||"Create product fail")}finally{o&&o.loadDone&&o.loadDone(),r.isLoading=!1,r.changeDetectorRef.detectChanges()}else Object.keys(r.form.controls).forEach(i=>{r.form.controls[i].touched=!0})})()}toggleDisabled(){this.options.formState.disabled=!this.options.formState.disabled}handlerCancel(t){t.stopPropagation(),this.toggleDisabled(),this.model=(0,v.cloneDeep)(this.modelOrigin)}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["icom-libs-product-add_edit"]],inputs:{model:"model",isAdd:"isAdd"},outputs:{icomSave:"icomSave"},standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:3,vars:7,consts:[["nz-form","",1,"pb-4","bg-white","border","rounded-md","h-full","flex","flex-col",3,"formGroup","nzLayout"],[1,"overflow-auto","px-4","pt-4",3,"model","fields","options","form"],["nz-row","","class","p-4 border",4,"ngIf"],["nz-row","",1,"p-4","border"],["nz-col","","class","search-area flex",4,"ngIf"],["nz-col","",1,"search-area","flex"],["nz-button","",3,"nzType","nzLoading","click"],["nz-button","",1,"ml-4",3,"click"]],template:function(o,r){1&o&&(e.\u0275\u0275elementStart(0,"form",0),e.\u0275\u0275element(1,"formly-form",1),e.\u0275\u0275template(2,U,3,2,"div",2),e.\u0275\u0275elementEnd()),2&o&&(e.\u0275\u0275property("formGroup",r.form)("nzLayout","vertical"),e.\u0275\u0275advance(1),e.\u0275\u0275property("model",r.model)("fields",r.fields)("options",r.options)("form",r.form),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",r.model&&r.model.id))},dependencies:[y.FormlyNgZorroAntdModule,d.ReactiveFormsModule,d.\u0275NgNoValidate,d.NgControlStatusGroup,d.FormGroupDirective,u.FormlyModule,u.FormlyForm,f.NzButtonModule,f.NzButtonComponent,S.\u0275NzTransitionPatchDirective,z.NzWaveDirective,g.NgIf,E.NzFormModule,F.NzColDirective,F.NzRowDirective,E.NzFormDirective],encapsulation:2,changeDetection:0})}return n})();var V=s(57317),A=s(35329);let P=(()=>{class n{ngOnInit(){console.log(this.product),this.product.created_at&&(this.product.created_at_format=x(this.product.created_at).format("DD/MM/YYYY HH:mm"),this.product.updated_at_format=x(this.product.updated_at).format("DD/MM/YYYY HH:mm"))}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["icom-libs-product-detail-history"]],inputs:{product:"product"},standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:20,vars:6,consts:[["nzTitle","History",2,"width","300px"],[2,"color","#8b8b8b"],["nzType","vertical"]],template:function(o,r){1&o&&(e.\u0275\u0275elementStart(0,"nz-card",0)(1,"p")(2,"span",1),e.\u0275\u0275text(3,"Creator:\xa0"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(5,"nz-divider",2),e.\u0275\u0275elementStart(6,"p")(7,"span",1),e.\u0275\u0275text(8,"Create Time:\xa0"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(9),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(10,"nz-divider",2),e.\u0275\u0275elementStart(11,"p")(12,"span",1),e.\u0275\u0275text(13,"Updater:\xa0"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(14),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(15,"nz-divider",2),e.\u0275\u0275elementStart(16,"p")(17,"span",1),e.\u0275\u0275text(18,"Update Time:\xa0"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(19),e.\u0275\u0275elementEnd()()),2&o&&(e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate2(" [",null==r.product||null==r.product.creator_info?null:r.product.creator_info.customer_id,"] ",null==r.product||null==r.product.creator_info?null:r.product.creator_info.full_name," "),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate1(" ",(null==r.product?null:r.product.created_at_format)||(null==r.product?null:r.product.created_at),""),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate2(" [",null==r.product||null==r.product.updater_info?null:r.product.updater_info.customer_id,"] ",null==r.product||null==r.product.updater_info?null:r.product.updater_info.full_name,""),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate1(" ",(null==r.product?null:r.product.updated_at_format)||(null==r.product?null:r.product.updated_at),""))},dependencies:[V.NzCardModule,V.NzCardComponent,A.NzDividerModule,A.NzDividerComponent],encapsulation:2})}return n})();function Q(n,a){if(1&n&&e.\u0275\u0275element(0,"icom-libs-product-detail-history",3),2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("product",t.product)}}let Z=(()=>{class n{constructor(){this.icomSave=new e.EventEmitter,this.productService=(0,e.inject)(h.k)}ngOnInit(){this.product&&(this.product.date_range=[x(this.product.start_time).toDate(),x(this.product.end_time).toDate()])}handlerSave(t){this.icomSave.emit(t)}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["icom-libs-product-detail-general"]],inputs:{product:"product"},outputs:{icomSave:"icomSave"},standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:3,vars:2,consts:[[1,"flex","w-full","h-full","justify-between"],[1,"w-full","mr-4",3,"model","icomSave"],[3,"product",4,"ngIf"],[3,"product"]],template:function(o,r){1&o&&(e.\u0275\u0275elementStart(0,"div",0)(1,"icom-libs-product-add_edit",1),e.\u0275\u0275listener("icomSave",function(c){return r.handlerSave(c)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(2,Q,1,1,"icom-libs-product-detail-history",2),e.\u0275\u0275elementEnd()),2&o&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("model",r.product),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",r.product))},dependencies:[Y,P,g.NgIf],encapsulation:2})}return n})();var _=s(926),w=s(67786);function q(n,a){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",9)(1,"button",10),e.\u0275\u0275listener("click",function(r){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(i.handlerSave(r))}),e.\u0275\u0275text(2," Submit "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"button",11),e.\u0275\u0275listener("click",function(r){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(i.handlerCancel(r))}),e.\u0275\u0275text(4," Cancel "),e.\u0275\u0275elementEnd()()}if(2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("action","edit")("nzLoading",t.isLoading)("nzType","primary"),e.\u0275\u0275advance(2),e.\u0275\u0275property("action","edit")}}function W(n,a){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",9)(1,"button",12),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(r.toggleDisabled())}),e.\u0275\u0275text(2," Edit "),e.\u0275\u0275elementEnd()()}2&n&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("action","edit")("nzType","primary"))}function X(n,a){if(1&n&&e.\u0275\u0275element(0,"icom-libs-product-detail-history",13),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("product",t.model)}}function J(n,a){if(1&n&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"form",4),e.\u0275\u0275element(3,"formly-form",5),e.\u0275\u0275elementStart(4,"div",6),e.\u0275\u0275template(5,q,5,4,"div",7),e.\u0275\u0275template(6,W,3,2,"div",7),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(7,X,1,1,"icom-libs-product-detail-history",8),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",t.form),e.\u0275\u0275advance(1),e.\u0275\u0275property("model",t.model)("fields",t.fields)("options",t.options)("form",t.form),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!(null!=t.options&&null!=t.options.formState&&t.options.formState.disabled)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",null==t.options||null==t.options.formState?null:t.options.formState.disabled),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",null==t.model?null:t.model.id)}}function $(n,a){1&n&&e.\u0275\u0275element(0,"nz-spin",14),2&n&&e.\u0275\u0275property("nzSize","large")}let K=(()=>{class n{constructor(){this.form=new d.FormGroup({}),this.options={formState:{disabled:!0}},this.fields=[],this.productService=(0,e.inject)(h.k),this.IComMessageService=(0,e.inject)(C.Qi),this.cdr=(0,e.inject)(e.ChangeDetectorRef),this.model={subpool_id:0,pool_id:8},this.fields=[{key:"payment_method",type:"select-custom",props:{label:"Payment Method",classInclude:"w-[300px]",placeholder:"Select Payment Method",viewValue:"name",labelProp:"name",valueProp:"code",required:!0,options:this.productService.getOptionType("PAYMENT_METHOD").pipe((0,l.map)(t=>t?.data))},expressions:{"props.disabled":"formState.disabled"}},{key:"sale_price",type:"input",className:"",props:{label:"Sale price",required:!0,type:"number"},validators:["iniMin0"],expressions:{"props.disabled":"formState.disabled"}},{key:"purchase_cost",type:"input",className:"basis-6/12 ml-4",props:{label:"Purchase cost",required:!0,type:"number"},validators:["iniMin0"],expressions:{"props.disabled":"formState.disabled"}},{key:"pool_id",className:"basis-4/12",type:"select-custom",props:{placeholder:"Select Pool",label:"Pool",viewValue:"id",labelProp:"id",valueProp:"id",classInclude:"w-[300px]",required:!0,options:[{id:8,name:"Pool"}]},expressions:{"props.disabled":"formState.disabled"}},{key:"subpool_id",type:"select-custom",className:"basis-4/12 ml-4",props:{label:"Sub Pool",placeholder:"Select Sub Pool",viewValue:"id",required:!0,classInclude:"w-[300px]",labelProp:"id",valueProp:"id",options:[{id:0,name:"Sub Pool"}]},expressions:{"props.disabled":"formState.disabled"}}]}ngOnInit(){var t=this;return(0,m.Z)(function*(){try{t.loadingIndicator=!0,t.model=yield(0,l.lastValueFrom)(t.productService.getProductPrice(t.product?.id)),t.modelOrigin=(0,v.cloneDeep)(t.model)}catch(o){t.IComMessageService.showAlertMessageError(o?.error?.error_message)}finally{t.loadingIndicator=!1,t.cdr.detectChanges()}})()}handlerSave(t){var o=this;return(0,m.Z)(function*(){t.stopPropagation(),t.preventDefault();try{if(!o.form.valid)return void Object.keys(o.form.controls).forEach(i=>{o.form.controls[i].touched=!0});o.isLoading=!0,o.cdr.detectChanges(),o.form.markAsTouched(),o.form.submitted=!0;const r={...o.model};if(r.id)return yield(0,l.lastValueFrom)(o.productService.updateProductPrice(r)),o.IComMessageService.showAlertMessageDone("Edit product price success"),o.modelOrigin=(0,v.cloneDeep)(o.model),void o.toggleDisabled();yield(0,l.lastValueFrom)(o.productService.createProductPrice(r)),o.modelOrigin=(0,v.cloneDeep)(o.model),o.IComMessageService.showAlertMessageError("Edit product price success")}catch(r){o.IComMessageService.showAlertMessageError(r?.error?.error_message)}finally{o.isLoading=!1,o.cdr.detectChanges()}})()}handlerCancel(t){t.stopPropagation(),t.preventDefault(),this.toggleDisabled(),this.form.reset(this.modelOrigin)}toggleDisabled(){this.options.formState.disabled=!this.options.formState.disabled}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["icom-libs-product-detail-price"]],inputs:{product:"product"},standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:2,vars:2,consts:[["class","w-full h-full flex",4,"ngIf"],["class","w-full h-full flex justify-center items-center","nzSimple","",3,"nzSize",4,"ngIf"],[1,"w-full","h-full","flex"],[1,"flex","w-full","h-full","flex-col","pt-4","bg-white","border","rounded-md"],["nz-form","",3,"formGroup"],[3,"model","fields","options","form"],["nz-row","",1,"p-4","border"],["nz-col","","class","search-area flex",4,"ngIf"],["class","ml-4",3,"product",4,"ngIf"],["nz-col","",1,"search-area","flex"],["icomLibsHasPermissionDirective","","nz-button","",3,"action","nzLoading","nzType","click"],["icomLibsHasPermissionDirective","","nz-button","",1,"ml-4",3,"action","click"],["icomLibsHasPermissionDirective","","nz-button","",3,"action","nzType","click"],[1,"ml-4",3,"product"],["nzSimple","",1,"w-full","h-full","flex","justify-center","items-center",3,"nzSize"]],template:function(o,r){1&o&&(e.\u0275\u0275template(0,J,8,8,"div",0),e.\u0275\u0275template(1,$,1,1,"nz-spin",1)),2&o&&(e.\u0275\u0275property("ngIf",!r.loadingIndicator),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",r.loadingIndicator))},dependencies:[y.FormlyNgZorroAntdModule,d.ReactiveFormsModule,d.\u0275NgNoValidate,d.NgControlStatusGroup,d.FormGroupDirective,u.FormlyModule,u.FormlyForm,f.NzButtonModule,f.NzButtonComponent,S.\u0275NzTransitionPatchDirective,z.NzWaveDirective,g.NgIf,P,_.NzSpinModule,_.NzSpinComponent,w.E],encapsulation:2})}return n})();function ee(n,a){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",9)(1,"button",10),e.\u0275\u0275listener("click",function(r){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(i.handlerSave(r))}),e.\u0275\u0275text(2," Submit "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"button",11),e.\u0275\u0275listener("click",function(r){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(i.handlerCancel(r))}),e.\u0275\u0275text(4," Cancel "),e.\u0275\u0275elementEnd()()}if(2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("action","edit")("nzLoading",t.isLoading)("nzType","primary"),e.\u0275\u0275advance(2),e.\u0275\u0275property("action","edit")}}function te(n,a){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",9)(1,"button",12),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(r.toggleDisabled())}),e.\u0275\u0275text(2," Edit "),e.\u0275\u0275elementEnd()()}2&n&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("action","edit")("nzType","primary"))}function oe(n,a){if(1&n&&e.\u0275\u0275element(0,"icom-libs-product-detail-history",13),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("product",t.model)}}function ne(n,a){if(1&n&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"form",4),e.\u0275\u0275element(3,"formly-form",5),e.\u0275\u0275elementStart(4,"div",6),e.\u0275\u0275template(5,ee,5,4,"div",7),e.\u0275\u0275template(6,te,3,2,"div",7),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(7,oe,1,1,"icom-libs-product-detail-history",8),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",t.form),e.\u0275\u0275advance(1),e.\u0275\u0275property("model",t.model)("fields",t.fields)("options",t.options)("form",t.form),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!(null!=t.options&&null!=t.options.formState&&t.options.formState.disabled)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",null==t.options||null==t.options.formState?null:t.options.formState.disabled),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",null==t.model?null:t.model.id)}}function re(n,a){1&n&&e.\u0275\u0275element(0,"nz-spin",14),2&n&&e.\u0275\u0275property("nzSize","large")}let ie=(()=>{class n{constructor(){this.form=new d.FormGroup({}),this.fields=[],this.options={formState:{disabled:!0}},this.productService=(0,e.inject)(h.k),this.IComMessageService=(0,e.inject)(C.Qi),this.changeDetectorRef=(0,e.inject)(e.ChangeDetectorRef),this.model={},this.fields=[{key:"voucher_type",type:"select-custom",templateOptions:{label:"Voucher Type",placeholder:"Select Voucher Type",classInclude:"w-[300px]",viewValue:"name",labelProp:"name",valueProp:"code",required:!0,options:this.productService.getOptionType("VOUCHER_TYPE").pipe((0,l.map)(t=>t?.data))},expressions:{"props.disabled":"formState.disabled"}},{key:"voucher_value",type:"input",className:"",expressions:{"props.disabled":"formState.disabled"},props:{label:"Voucher Value",type:"number",min:0}},{key:"expiry_policy",className:"basis-4/12",type:"select-custom",props:{placeholder:"Select Expiry policy",label:"Expiry policy",viewValue:"name",classInclude:"w-[300px]",labelProp:"name",valueProp:"code",required:!0,options:this.productService.getOptionType("VOUCHER_PROPERTY_EXPIRY_POLICY").pipe((0,l.map)(t=>t?.data))},expressions:{"props.disabled":"formState.disabled"}},{key:"expiry_date",type:"date",props:{label:"Expiry date",ShowTime:!0,required:!0,format:"dd-MM-yyyy HH:mm"},expressions:{"props.disabled":"formState.disabled"},hideExpression:t=>!t?.expiry_policy||"EXPIRY_DATE_FP"!==t?.expiry_policy},{key:"expiry_param",type:"input",className:"basis-6/12 ml-4",props:{label:"Expiry param",required:!0,type:"number"},hideExpression:t=>!t?.expiry_policy||"EXPIRY_DATE_NE"===t?.expiry_policy||"EXPIRY_DATE_SDED"===t?.expiry_policy||"EXPIRY_DATE_FP"===t?.expiry_policy,expressions:{"props.disabled":"formState.disabled"}}]}ngOnInit(){var t=this;return(0,m.Z)(function*(){try{t.loadingIndicator=!0,t.model=yield(0,l.lastValueFrom)(t.productService.getProductProperties(t.product?.id)),t.modelOrigin=(0,v.cloneDeep)(t.model)}catch(o){t.IComMessageService.showAlertMessageError(o?.error?.error_message)}finally{t.loadingIndicator=!1,t.changeDetectorRef.detectChanges()}})()}handlerSave(t){var o=this;return(0,m.Z)(function*(){t.stopPropagation(),t.preventDefault();try{if(!o.form.valid)return void Object.keys(o.form.controls).forEach(i=>{o.form.controls[i].touched=!0});o.form.markAsTouched(),o.form.submitted=!0;const r={...o.model};if(o.isLoading=!0,o.changeDetectorRef.detectChanges(),r.id)return yield(0,l.lastValueFrom)(o.productService.updateProductProperties(r)),o.toggleDisabled(),o.IComMessageService.showAlertMessageDone("Edit product properties success"),o.isLoading=!1,void o.changeDetectorRef.detectChanges();delete r.id,yield(0,l.lastValueFrom)(o.productService.createProductProperties(r)),o.isLoading=!1,o.changeDetectorRef.detectChanges(),o.IComMessageService.showAlertMessageDone("Add product properties success")}catch(r){o.IComMessageService.showAlertMessageError(r?.error?.error_message)}finally{o.isLoading=!1,o.changeDetectorRef.detectChanges()}})()}handlerCancel(t){t.stopPropagation(),t.preventDefault(),this.toggleDisabled(),this.form.reset(this.modelOrigin)}toggleDisabled(){this.options.formState.disabled=!this.options.formState.disabled}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["icom-libs-product-detail-properties"]],inputs:{product:"product"},standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:2,vars:2,consts:[["class","w-full h-full flex",4,"ngIf"],["class","w-full h-full flex justify-center items-center","nzSimple","",3,"nzSize",4,"ngIf"],[1,"w-full","h-full","flex"],[1,"flex","w-full","h-full","flex-col","pt-4","bg-white","border","rounded-md"],["nz-form","",3,"formGroup"],[3,"model","fields","options","form"],["nz-row","",1,"p-4","border"],["nz-col","","class","search-area flex",4,"ngIf"],["class","ml-4",3,"product",4,"ngIf"],["nz-col","",1,"search-area","flex"],["icomLibsHasPermissionDirective","","nz-button","",3,"action","nzLoading","nzType","click"],["icomLibsHasPermissionDirective","","nz-button","",1,"ml-4",3,"action","click"],["icomLibsHasPermissionDirective","","nz-button","",3,"action","nzType","click"],[1,"ml-4",3,"product"],["nzSimple","",1,"w-full","h-full","flex","justify-center","items-center",3,"nzSize"]],template:function(o,r){1&o&&(e.\u0275\u0275template(0,ne,8,8,"div",0),e.\u0275\u0275template(1,re,1,1,"nz-spin",1)),2&o&&(e.\u0275\u0275property("ngIf",!r.loadingIndicator),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",r.loadingIndicator))},dependencies:[y.FormlyNgZorroAntdModule,d.ReactiveFormsModule,d.\u0275NgNoValidate,d.NgControlStatusGroup,d.FormGroupDirective,u.FormlyModule,u.FormlyForm,f.NzButtonModule,f.NzButtonComponent,S.\u0275NzTransitionPatchDirective,z.NzWaveDirective,g.NgIf,P,_.NzSpinModule,_.NzSpinComponent,w.E],encapsulation:2})}return n})();const ae=(n,a)=>[{prop:"",cellTemplate:n,sortable:!1,width:40},{prop:"",cellTemplate:a,sortable:!1,width:40},{prop:"language",width:200,sortable:!1},{prop:"name",width:300,sortable:!1},{prop:"description",width:300,sortable:!1}];var M=s(37586);const se=["statusRef"],de=["removeRef"];function ce(n,a){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",10)(1,"button",11),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(r.handlerAdd())}),e.\u0275\u0275text(2," Add New "),e.\u0275\u0275elementEnd()()}2&n&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("nzType","primary")("action","edit"))}function pe(n,a){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",17)(1,"button",18),e.\u0275\u0275listener("click",function(r){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(i.handlerSave(r))}),e.\u0275\u0275text(2," Save "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"button",19),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(r.handlerCancel())}),e.\u0275\u0275text(4," Cancel "),e.\u0275\u0275elementEnd()()}if(2&n){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(1),e.\u0275\u0275property("nzType","primary")("nzLoading",t.isLoading)("action","edit"),e.\u0275\u0275advance(2),e.\u0275\u0275property("action","edit")}}function me(n,a){if(1&n&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"form",12,13),e.\u0275\u0275element(3,"formly-form",14),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",15),e.\u0275\u0275template(5,pe,5,4,"div",16),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("formGroup",t.form),e.\u0275\u0275advance(2),e.\u0275\u0275property("model",t.modelForm)("fields",t.fields)("form",t.form),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!(null!=t.options&&null!=t.options.formState&&t.options.formState.disabled))}}const ue=function(){return[]};function fe(n,a){if(1&n&&(e.\u0275\u0275elementStart(0,"div",20),e.\u0275\u0275element(1,"ngx-datatable",21),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("rows",t.rows)("columns",t.configTable.columns||e.\u0275\u0275pureFunction0(7,ue))("headerHeight",t.configTable.headerHeight||50)("columnMode","standard")("rowHeight",t.configTable.rowHeight||50)("scrollbarH",!0)("loadingIndicator",t.loadingIndicator)}}function _e(n,a){if(1&n&&e.\u0275\u0275element(0,"icom-libs-product-detail-history",22),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("product",t.modelForm)}}function ge(n,a){if(1&n&&(e.\u0275\u0275elementStart(0,"div",4)(1,"div",5),e.\u0275\u0275template(2,ce,3,2,"div",6),e.\u0275\u0275template(3,me,6,5,"ng-container",7),e.\u0275\u0275template(4,fe,2,8,"div",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(5,_e,1,1,"icom-libs-product-detail-history",9),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!t.isAddNew),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.isAddNew),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t.isAddNew),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",null==t.modelForm?null:t.modelForm.id)}}function he(n,a){1&n&&e.\u0275\u0275element(0,"nz-spin",23),2&n&&e.\u0275\u0275property("nzSize","large")}function ve(n,a){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",24),e.\u0275\u0275listener("click",function(r){const c=e.\u0275\u0275restoreView(t).row,p=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(p.handlerEdit(r,c))}),e.\u0275\u0275element(1,"i",25),e.\u0275\u0275elementEnd()}2&n&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("action","edit"))}function ye(n,a){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",26),e.\u0275\u0275listener("click",function(r){const c=e.\u0275\u0275restoreView(t).row,p=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(p.handlerRemove(r,c))}),e.\u0275\u0275element(1,"span",27),e.\u0275\u0275elementEnd()}2&n&&e.\u0275\u0275property("action","edit")}let be=(()=>{class n{constructor(t){this.router=t,this.form=new d.FormGroup({}),this.options={},this.fields=[],this.productService=(0,e.inject)(h.k),this.modalService=(0,e.inject)(M.NzModalService),this.IComMessageService=(0,e.inject)(C.Qi),this.cdr=(0,e.inject)(e.ChangeDetectorRef),this.modelForm={}}ngOnInit(){this.fields=[{key:"name",type:"input",props:{label:"Name",placeholder:"Enter Name",type:"string",required:!0}},{key:"description",type:"input",props:{label:"Description",placeholder:"Enter Description",type:"string",required:!0}},{key:"language",type:"select-custom",templateOptions:{label:"Language",placeholder:"Select Language",viewValue:"name",labelProp:"name",required:!0,valueProp:"code",options:[{code:"vi",name:"Vietnamese"},{code:"en",name:"English"}]}},{key:"detail",type:"quill-editor",props:{label:"Detail",placeholder:"Enter Content",type:"string",required:!0}},{key:"term_and_condition",type:"quill-editor",props:{label:"Term and condition",placeholder:"Enter Content",type:"string",required:!0}}],this.configTable={loadingIndicator:!0,columns:ae(this.statusRef,this.removeRef),headerHeight:50,rowHeight:"auto",pageLimit:10},this.loadPage()}loadPage(){var t=this;return(0,m.Z)(function*(){try{t.loadingIndicator=!0;const o=yield(0,l.lastValueFrom)(t.productService.getProductLanguage(t.product?.id||""));if(o&&o.data&&o.data){const r=[...o.data.items||[]];t.rows=r}}catch(o){console.log(o)}finally{t.loadingIndicator=!1,t.cdr.detectChanges()}})()}handlerAdd(){this.isAddNew=!this.isAddNew}handlerCancel(){this.isAddNew=!1,this.modelForm={}}handlerSave(t){var o=this;return(0,m.Z)(function*(){t.stopPropagation(),t.preventDefault();try{if(!o.form.valid)return void Object.keys(o.form.controls).forEach(i=>{o.form.controls[i].touched=!0});o.form.markAsTouched(),o.form.submitted=!0;const r={product_id:o.product?.id,...o.modelForm};if(o.isLoading=!0,o.cdr.detectChanges(),!r.id)return delete r.id,o.rows?.some(c=>c.language==r.language)?void o.IComMessageService.showAlertMessageError("Record exist in table"):void o.productService.addLanguageProduct(r).subscribe(()=>{o.IComMessageService.showAlertMessageDone("Add language success"),o.handlerCancel(),o.loadPage()});yield(0,l.lastValueFrom)(o.productService.updateLanguageProduct(o.modelForm)),o.IComMessageService.showAlertMessageDone("Edit language success"),o.handlerCancel(),o.loadPage()}catch(r){o.IComMessageService.showAlertMessageError(r?.error?.error_message)}finally{o.isLoading=!1,o.cdr.detectChanges()}})()}handlerEdit(t,o){t.stopPropagation(),this.modelForm=o,this.isAddNew=!0}handlerRemove(t,o){t.stopPropagation(),this.modalService.confirm({nzTitle:"Are you sure delete this product?",nzContent:`<b style="color: red;">${o.name}</b>`,nzOkText:"Delete",nzOkType:"primary",nzOkDanger:!0,nzMaskClosable:!1,nzClosable:!1,nzOnOk:this.processDelete.bind(this,o),nzCancelText:"Cancel"},"error")}processDelete(t){return(0,l.lastValueFrom)(this.productService.deleteProductLanguage(t.id||"")).then(()=>{this.IComMessageService.showAlertMessageDone("Delete language success"),this.loadPage()}).catch(o=>{this.IComMessageService.showAlertMessageError(o?.error?.error_message)})}static#e=this.\u0275fac=function(o){return new(o||n)(e.\u0275\u0275directiveInject(L.Router))};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["icom-libs-product-detail-language"]],viewQuery:function(o,r){if(1&o&&(e.\u0275\u0275viewQuery(se,7),e.\u0275\u0275viewQuery(de,7)),2&o){let i;e.\u0275\u0275queryRefresh(i=e.\u0275\u0275loadQuery())&&(r.statusRef=i.first),e.\u0275\u0275queryRefresh(i=e.\u0275\u0275loadQuery())&&(r.removeRef=i.first)}},inputs:{fields:"fields",rows:"rows",product:"product"},standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:6,vars:2,consts:[["class","w-full h-full flex",4,"ngIf"],["class","w-full h-full flex justify-center items-center","nzSimple","",3,"nzSize",4,"ngIf"],["statusRef",""],["removeRef",""],[1,"w-full","h-full","flex"],[1,"mb-4","w-full","h-full","flex","flex-col","bg-white","border","rounded-md"],["class","flex justify-end p-4",4,"ngIf"],[4,"ngIf"],["class","w-full h-full",4,"ngIf"],["class","ml-4",3,"product",4,"ngIf"],[1,"flex","justify-end","p-4"],["nz-button","","icomLibsHasPermissionDirective","",1,"flex","items-center",3,"nzType","action","click"],[1,"overflow-auto","px-4","pt-4",3,"formGroup"],["myForm",""],[3,"model","fields","form"],["nz-row","",1,"p-4","border"],["nz-col","","class","search-area flex",4,"ngIf"],["nz-col","",1,"search-area","flex"],["nz-button","","icomLibsHasPermissionDirective","",3,"nzType","nzLoading","action","click"],["nz-button","","icomLibsHasPermissionDirective","",1,"ml-4",3,"action","click"],[1,"w-full","h-full"],[1,"material","expandable","striped","w-full","h-full",3,"rows","columns","headerHeight","columnMode","rowHeight","scrollbarH","loadingIndicator"],[1,"ml-4",3,"product"],["nzSimple","",1,"w-full","h-full","flex","justify-center","items-center",3,"nzSize"],[1,"name-container","cursor-pointer",3,"click"],["nz-icon","","nzType","edit","nzTheme","twotone","icomLibsHasPermissionDirective","",1,"cursor-pointer",3,"action"],["icomLibsHasPermissionDirective","",1,"name-container","cursor-pointer",3,"action","click"],["nz-icon","","nzType","delete","nzTheme","twotone"]],template:function(o,r){1&o&&(e.\u0275\u0275template(0,ge,6,4,"div",0),e.\u0275\u0275template(1,he,1,1,"nz-spin",1),e.\u0275\u0275template(2,ve,2,1,"ng-template",null,2,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(4,ye,2,1,"ng-template",null,3,e.\u0275\u0275templateRefExtractor)),2&o&&(e.\u0275\u0275property("ngIf",!r.loadingIndicator),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",r.loadingIndicator))},dependencies:[y.FormlyNgZorroAntdModule,d.ReactiveFormsModule,d.\u0275NgNoValidate,d.NgControlStatusGroup,d.FormGroupDirective,u.FormlyModule,u.FormlyForm,f.NzButtonModule,f.NzButtonComponent,S.\u0275NzTransitionPatchDirective,z.NzWaveDirective,b.NgxDatatableModule,b.DatatableComponent,g.NgIf,I.NzIconModule,I.NzIconDirective,P,_.NzSpinModule,_.NzSpinComponent,w.E],encapsulation:2})}return n})();const Ce=(n,a,t)=>[{prop:"",cellTemplate:n,sortable:!1,width:40},{prop:"",cellTemplate:a,sortable:!1,width:40},{prop:"banner",sortable:!1,cellTemplate:t,width:200},{prop:"name",sortable:!1,width:300},{prop:"type",sortable:!1,width:300}];var R=s(99595),Se=s(71684);const ze=["statusRef"],Ie=["removeRef"],Pe=["avatarRef"];function we(n,a){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",11)(1,"button",12),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(r.handlerAdd())}),e.\u0275\u0275text(2,"Add New "),e.\u0275\u0275elementEnd()()}2&n&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("action","edit")("nzType","primary"))}function De(n,a){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"nz-upload",21),e.\u0275\u0275listener("nzFileListChange",function(r){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(i.fileList=r)}),e.\u0275\u0275elementContainerStart(1),e.\u0275\u0275elementStart(2,"p",22),e.\u0275\u0275element(3,"span",23),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"p",24),e.\u0275\u0275text(5,"Upload Image"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"p",25),e.\u0275\u0275text(7,"Size can't exceed 2 MB"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()}if(2&n){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("nzMultiple",!1)("nzFileList",t.fileList)("nzBeforeUpload",t.beforeUpload)}}function Te(n,a){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",26)(1,"button",27),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(r.handlerSave())}),e.\u0275\u0275text(2," Save "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"button",28),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(r.handlerCancel())}),e.\u0275\u0275element(4,"i",29),e.\u0275\u0275text(5," Cancel "),e.\u0275\u0275elementEnd()()}if(2&n){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(1),e.\u0275\u0275property("nzLoading",t.isLoading)("nzType","primary")("action","edit"),e.\u0275\u0275advance(2),e.\u0275\u0275property("action","edit")}}function Le(n,a){if(1&n&&(e.\u0275\u0275elementStart(0,"div",13)(1,"div",14)(2,"form",15,16),e.\u0275\u0275element(4,"formly-form",17),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(5,De,8,3,"nz-upload",18),e.\u0275\u0275elementStart(6,"div",19),e.\u0275\u0275template(7,Te,6,4,"div",20),e.\u0275\u0275elementEnd()()),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",t.form),e.\u0275\u0275advance(2),e.\u0275\u0275property("model",t.modelForm)("fields",t.fields)("form",t.form),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.isAddNew),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!(null!=t.options&&null!=t.options.formState&&t.options.formState.disabled))}}const Ee=function(){return[]};function Me(n,a){if(1&n&&(e.\u0275\u0275elementStart(0,"div",30),e.\u0275\u0275element(1,"ngx-datatable",31),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("rows",t.rows)("columns",t.configTable.columns||e.\u0275\u0275pureFunction0(7,Ee))("headerHeight",t.configTable.headerHeight||50)("columnMode","standard")("rowHeight","auto")("scrollbarH",!0)("loadingIndicator",t.loadingIndicator)}}function Ne(n,a){if(1&n&&e.\u0275\u0275element(0,"icom-libs-product-detail-history",32),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("product",t.modelForm)}}function ke(n,a){if(1&n&&(e.\u0275\u0275elementStart(0,"div",5)(1,"div",6),e.\u0275\u0275template(2,we,3,2,"div",7),e.\u0275\u0275template(3,Le,8,6,"div",8),e.\u0275\u0275template(4,Me,2,8,"div",9),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(5,Ne,1,1,"icom-libs-product-detail-history",10),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!t.isAddNew),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.isAddNew),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t.isAddNew),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",null==t.modelForm?null:t.modelForm.id)}}function Fe(n,a){1&n&&e.\u0275\u0275element(0,"nz-spin",33),2&n&&e.\u0275\u0275property("nzSize","large")}function Ve(n,a){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",34),e.\u0275\u0275listener("click",function(r){const c=e.\u0275\u0275restoreView(t).row,p=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(p.handlerEdit(r,c))}),e.\u0275\u0275element(1,"i",35),e.\u0275\u0275elementEnd()}2&n&&e.\u0275\u0275property("action","edit")}function Ae(n,a){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",34),e.\u0275\u0275listener("click",function(r){const c=e.\u0275\u0275restoreView(t).row,p=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(p.handlerRemove(r,c))}),e.\u0275\u0275element(1,"span",36),e.\u0275\u0275elementEnd()}2&n&&e.\u0275\u0275property("action","edit")}function Re(n,a){if(1&n&&(e.\u0275\u0275elementStart(0,"div",37),e.\u0275\u0275element(1,"img",38),e.\u0275\u0275elementEnd()),2&n){const t=a.row;e.\u0275\u0275advance(1),e.\u0275\u0275property("src",t.url,e.\u0275\u0275sanitizeUrl)}}let je=(()=>{class n{constructor(t){this.msg=t,this.form=new d.FormGroup({}),this.options={},this.fileList=[],this.fields=[],this.productService=(0,e.inject)(h.k),this.modalService=(0,e.inject)(M.NzModalService),this.IComMessageService=(0,e.inject)(C.Qi),this.cdr=(0,e.inject)(e.ChangeDetectorRef),this.beforeUpload=o=>new l.Observable(r=>{const i="image/jpeg"===o.type||"image/png"===o.type;if(!i)return this.msg.error("You can only upload JPG file!"),void r.complete();const c=(o?.size||1)/1024/1024<2;return c?this.fileList&&this.fileList.length?(this.msg.error("Only Post One File"),void r.complete()):(r.next(i&&c),void r.complete()):(this.msg.error("Image must smaller than 2MB!"),void r.complete())}),this.modelForm={}}ngOnInit(){this.fields=(n=>[{key:"name",type:"input",props:{label:"Name",placeholder:"Enter Name",type:"string",required:!0}},{key:"type",type:"select-custom",templateOptions:{label:"Type",placeholder:"Select Type",viewValue:"name",labelProp:"name",required:!0,valueProp:"code",classInclude:"w-[300px]",options:this.productService.getOptionType("MEDIA_TYPE").pipe((0,l.map)(a=>a?.data))}}])(),this.configTable={loadingIndicator:!0,columns:Ce(this.statusRef,this.removeRef,this.avatarRef),headerHeight:50,rowHeight:"auto",pageLimit:10},this.loadPage()}loadPage(){var t=this;return(0,m.Z)(function*(){try{t.loadingIndicator=!0;const o=yield(0,l.lastValueFrom)(t.productService.getProductMedia(t.product?.id||""));if(o&&o.data&&o.data){const r=[...o.data.items||[]];t.rows=r,console.log(t.rows);let i=t.rows?.find(c=>"MEDIA_TYPE_BANNER_16_9"===c.type);if(i||(i=t.rows?.find(c=>"MEDIA_TYPE_BANNER_1_1"===c.type)),!i||!t.product)return;t.product.medias=[i]}}catch(o){console.log(o)}finally{t.loadingIndicator=!1,t.cdr.detectChanges()}})()}handlerAdd(){this.isAddNew=!this.isAddNew,this.modelForm={},this.cdr.detectChanges()}handlerCancel(){this.isAddNew=!1,this.modelForm={},this.fileList=[],this.cdr.detectChanges()}handlerSave(){var t=this;return(0,m.Z)(function*(){try{if(!t.form.valid)return void Object.keys(t.form.controls).forEach(o=>{t.form.controls[o].touched=!0});t.form.markAsTouched(),t.form.submitted=!0,t.processUpload()}catch(o){t.IComMessageService.showAlertMessageError(o?.error?.error_message||"Upload Media Failed")}finally{t.isLoading=!1,t.cdr.detectChanges()}})()}processUpload(){var t=this;return(0,m.Z)(function*(){const o=new FormData;t.fileList[0]?.originFileObj&&o.append("image",t.fileList[0].originFileObj);const r={product_id:t.product?.id,...t.modelForm};t.isLoading=!0,t.cdr.detectChanges();let i=null;try{if(t.fileList[0]?.originFileObj&&(i=yield(0,l.lastValueFrom)(t.productService.uploadMediaProduct(o))),!r.id)return delete r.id,r.url=i.data?.path||"",yield(0,l.lastValueFrom)(t.productService.addMediaProduct(r)),t.IComMessageService.showAlertMessageDone("Add media success"),t.handlerCancel(),void t.loadPage();r.url=i?.data?.path||r?.url,yield(0,l.lastValueFrom)(t.productService.updateMediaProduct(r)),t.IComMessageService.showAlertMessageDone("Edit media success"),t.handlerCancel(),t.loadPage()}catch(c){t.IComMessageService.showAlertMessageError(c?.error?.error_message||"Upload media fail")}})()}handlerEdit(t,o){t.stopPropagation(),this.modelForm=o,this.fileList=[{uid:"-1",name:"Img",status:"done",url:this.modelForm.url,thumbUrl:this.modelForm.url}],this.isAddNew=!0,this.cdr.detectChanges()}handlerRemove(t,o){t.stopPropagation(),this.modalService.confirm({nzTitle:"Are you sure delete this media?",nzContent:`<b style="color: red;">${o.name}</b>`,nzOkText:"Delete",nzOkType:"primary",nzOkDanger:!0,nzMaskClosable:!1,nzClosable:!1,nzOnOk:this.processDelete.bind(this,o),nzCancelText:"Cancel"},"error")}processDelete(t){return(0,l.lastValueFrom)(this.productService.deleteProductMedia(t.id||"")).then(()=>{this.IComMessageService.showAlertMessageDone("Delete media success"),this.loadPage()}).catch(o=>{this.IComMessageService.showAlertMessageError(o?.error?.error_message||"Delete Fail")})}static#e=this.\u0275fac=function(o){return new(o||n)(e.\u0275\u0275directiveInject(Se.NzMessageService))};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["icom-libs-product-detail-media"]],viewQuery:function(o,r){if(1&o&&(e.\u0275\u0275viewQuery(ze,7),e.\u0275\u0275viewQuery(Ie,7),e.\u0275\u0275viewQuery(Pe,7)),2&o){let i;e.\u0275\u0275queryRefresh(i=e.\u0275\u0275loadQuery())&&(r.statusRef=i.first),e.\u0275\u0275queryRefresh(i=e.\u0275\u0275loadQuery())&&(r.removeRef=i.first),e.\u0275\u0275queryRefresh(i=e.\u0275\u0275loadQuery())&&(r.avatarRef=i.first)}},inputs:{fields:"fields",rows:"rows",product:"product"},standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:8,vars:2,consts:[["class","w-full h-full flex",4,"ngIf"],["class","w-full h-full flex justify-center items-center","nzSimple","",3,"nzSize",4,"ngIf"],["statusRef",""],["removeRef",""],["avatarRef",""],[1,"w-full","h-full","flex"],[1,"mb-4","w-full","h-full","flex","flex-col","pr-4","pt-4","bg-white","border","rounded-md","overflow-hidden"],["class","flex flex-end pl-4",4,"ngIf"],["class","flex w-full h-full flex-col",4,"ngIf"],["class","w-full h-full mt-4",4,"ngIf"],["class","ml-4",3,"product",4,"ngIf"],[1,"flex","flex-end","pl-4"],["icomLibsHasPermissionDirective","","nz-button","",1,"!flex","!items-center",3,"action","nzType","click"],[1,"flex","w-full","h-full","flex-col"],[1,""],[1,"mt-4",3,"formGroup"],["myForm",""],[3,"model","fields","form"],["class","ml-4 h-full basis-1/2 upload-list-inline flex flex-col","nzType","drag","nzListType","picture",3,"nzMultiple","nzFileList","nzBeforeUpload","nzFileListChange",4,"ngIf"],["nz-row","",1,"p-4","border"],["nz-col","","class","search-area flex",4,"ngIf"],["nzType","drag","nzListType","picture",1,"ml-4","h-full","basis-1/2","upload-list-inline","flex","flex-col",3,"nzMultiple","nzFileList","nzBeforeUpload","nzFileListChange"],[1,"ant-upload-drag-icon"],["nz-icon","","nzType","inbox"],[1,"ant-upload-text"],[1,"ant-upload-hint"],["nz-col","",1,"search-area","flex"],["nz-button","","icomLibsHasPermissionDirective","",1,"!flex","!items-center",3,"nzLoading","nzType","action","click"],["nz-button","","icomLibsHasPermissionDirective","",1,"ml-4","!flex","!items-center",3,"action","click"],["nz-icon","","nzTheme","outline","nzType","close-circle"],[1,"w-full","h-full","mt-4"],[1,"material","expandable","striped","w-full","h-full",3,"rows","columns","headerHeight","columnMode","rowHeight","scrollbarH","loadingIndicator"],[1,"ml-4",3,"product"],["nzSimple","",1,"w-full","h-full","flex","justify-center","items-center",3,"nzSize"],["icomLibsHasPermissionDirective","",1,"name-container","cursor-pointer",3,"action","click"],["nz-icon","","nzType","edit","nzTheme","twotone",1,"cursor-pointer"],["nz-icon","","nzType","delete","nzTheme","twotone"],[1,"name-container","cursor-pointer"],["width","200","height","100",3,"src"]],template:function(o,r){1&o&&(e.\u0275\u0275template(0,ke,6,4,"div",0),e.\u0275\u0275template(1,Fe,1,1,"nz-spin",1),e.\u0275\u0275template(2,Ve,2,1,"ng-template",null,2,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(4,Ae,2,1,"ng-template",null,3,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(6,Re,2,1,"ng-template",null,4,e.\u0275\u0275templateRefExtractor)),2&o&&(e.\u0275\u0275property("ngIf",!r.loadingIndicator),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",r.loadingIndicator))},dependencies:[y.FormlyNgZorroAntdModule,d.ReactiveFormsModule,d.\u0275NgNoValidate,d.NgControlStatusGroup,d.FormGroupDirective,u.FormlyModule,u.FormlyForm,f.NzButtonModule,f.NzButtonComponent,S.\u0275NzTransitionPatchDirective,z.NzWaveDirective,b.NgxDatatableModule,b.DatatableComponent,g.NgIf,I.NzIconModule,I.NzIconDirective,R.NzUploadModule,R.NzUploadComponent,P,_.NzSpinModule,_.NzSpinComponent,w.E],encapsulation:2})}return n})();const Ge=["statusRef"],Be=["removeRef"];function Ue(n,a){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",6),e.\u0275\u0275element(1,"formly-form",7),e.\u0275\u0275elementStart(2,"div",8)(3,"div",9)(4,"button",10),e.\u0275\u0275listener("click",function(r){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(i.handlerSave(r))}),e.\u0275\u0275text(5," Submit "),e.\u0275\u0275elementEnd()()()()}if(2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("model",t.model)("fields",t.fields)("options",t.options)("form",t.form),e.\u0275\u0275advance(3),e.\u0275\u0275property("nzType","primary")("nzLoading",t.isLoading)}}const Ye=function(){return[]};let Qe=(()=>{class n{constructor(t){this.router=t,this.form=new d.FormGroup({}),this.options={},this.fields=[],this.productService=(0,e.inject)(h.k),this.iComLibsServicesInventoryService=(0,e.inject)(h.NH),this.modalService=(0,e.inject)(M.NzModalService),this.IComMessageService=(0,e.inject)(C.Qi),this.cdr=(0,e.inject)(e.ChangeDetectorRef),this.model={}}ngOnInit(){this.fields=(n=>[{key:"inventory_id",type:"select-custom",templateOptions:{label:"Inventory",placeholder:"Select Inventory",viewValue:"name",labelProp:"name",required:!0,valueProp:"id",options:this.iComLibsServicesInventoryService.searchInventory().pipe((0,l.map)(a=>a?.data?.items))}}])(),this.configTable={loadingIndicator:!0,columns:[{prop:"name",sortable:!1},{prop:"type",sortable:!1},{prop:"sold_stock",sortable:!1,name:"Quantity Sold"},{prop:"in_stock",sortable:!1,name:"Quantity Available"},{prop:"total_stock",sortable:!1,name:"Quantity Total"}],headerHeight:50,rowHeight:"auto",pageLimit:10},this.loadPage()}loadPage(){var t=this;return(0,m.Z)(function*(){try{t.loadingIndicator=!0;const o=yield(0,l.lastValueFrom)(t.productService.getProductInventories(t.product?.id||""));if(o&&o.data&&o.data){const r=[...o.data.items||[]];t.rows=r}}catch(o){console.log(o)}finally{t.loadingIndicator=!1,t.cdr.detectChanges()}})()}handlerClickAddProductToInventory(){this.isAddNew=!this.isAddNew}handlerCancel(){this.isAddNew=!1,this.model={}}handlerSave(t){var o=this;return(0,m.Z)(function*(){t.stopPropagation();try{if(!o.form.valid)return void Object.keys(o.form.controls).forEach(i=>{o.form.controls[i].touched=!0});o.form.markAsTouched(),o.form.submitted=!0,o.isLoading=!0;const r={...o.model,product_id:o.product?.id};yield(0,l.lastValueFrom)(o.productService.getInventoryProducts(r)),o.IComMessageService.showAlertMessageDone("Add product to inventory success"),o.handlerCancel(),o.loadPage()}catch(r){o.IComMessageService.showAlertMessageError(r?.error?.error_message)}finally{o.isLoading=!1,o.cdr.detectChanges()}})()}static#e=this.\u0275fac=function(o){return new(o||n)(e.\u0275\u0275directiveInject(L.Router))};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["icom-libs-product-detail-inventory"]],viewQuery:function(o,r){if(1&o&&(e.\u0275\u0275viewQuery(Ge,7),e.\u0275\u0275viewQuery(Be,7)),2&o){let i;e.\u0275\u0275queryRefresh(i=e.\u0275\u0275loadQuery())&&(r.statusRef=i.first),e.\u0275\u0275queryRefresh(i=e.\u0275\u0275loadQuery())&&(r.removeRef=i.first)}},inputs:{fields:"fields",rows:"rows",product:"product"},standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:7,vars:10,consts:[[1,"mb-4","w-full","h-full","flex","flex-col","!p-4","bg-white","border","rounded-md"],[1,""],["nz-button","",1,"!flex","!items-center",3,"nzType","click"],["class","w-full mt-4 bg-white ",4,"ngIf"],[1,"w-full","h-full","mt-4"],[1,"material","expandable","striped","w-full","h-full",3,"rows","columns","headerHeight","columnMode","rowHeight","scrollbarH","loadingIndicator"],[1,"w-full","mt-4","bg-white"],[3,"model","fields","options","form"],["nz-row",""],["nz-col","",1,"search-area","flex"],["nz-button","",3,"nzType","nzLoading","click"]],template:function(o,r){1&o&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"button",2),e.\u0275\u0275listener("click",function(){return r.handlerClickAddProductToInventory()}),e.\u0275\u0275text(3," Add Product To Inventory "),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(4,Ue,6,6,"div",3),e.\u0275\u0275elementStart(5,"div",4),e.\u0275\u0275element(6,"ngx-datatable",5),e.\u0275\u0275elementEnd()()),2&o&&(e.\u0275\u0275advance(2),e.\u0275\u0275property("nzType","primary"),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",r.isAddNew),e.\u0275\u0275advance(2),e.\u0275\u0275property("rows",r.rows)("columns",r.configTable.columns||e.\u0275\u0275pureFunction0(9,Ye))("headerHeight",r.configTable.headerHeight||50)("columnMode","force")("rowHeight",r.configTable.rowHeight||50)("scrollbarH",!0)("loadingIndicator",r.loadingIndicator))},dependencies:[y.FormlyNgZorroAntdModule,d.ReactiveFormsModule,u.FormlyModule,u.FormlyForm,f.NzButtonModule,f.NzButtonComponent,S.\u0275NzTransitionPatchDirective,z.NzWaveDirective,b.NgxDatatableModule,b.DatatableComponent,g.NgIf,I.NzIconModule],encapsulation:2,changeDetection:0})}return n})();function Ze(n,a){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",9)(1,"button",10),e.\u0275\u0275listener("click",function(r){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(i.handlerSave(r))}),e.\u0275\u0275text(2," Submit "),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"button",11),e.\u0275\u0275listener("click",function(r){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(i.handlerCancel(r))}),e.\u0275\u0275text(4," Cancel "),e.\u0275\u0275elementEnd()()}if(2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("nzType","primary")("nzLoading",t.isLoading)("action","edit"),e.\u0275\u0275advance(2),e.\u0275\u0275property("action","edit")}}function qe(n,a){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",9)(1,"button",12),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(r.toggleDisabled())}),e.\u0275\u0275text(2," Edit "),e.\u0275\u0275elementEnd()()}2&n&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("nzType","primary")("action","edit"))}function We(n,a){if(1&n&&e.\u0275\u0275element(0,"icom-libs-product-detail-history",13),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("product",t.model)}}function Xe(n,a){if(1&n&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"form",4),e.\u0275\u0275element(3,"formly-form",5),e.\u0275\u0275elementStart(4,"div",6),e.\u0275\u0275template(5,Ze,5,4,"div",7),e.\u0275\u0275template(6,qe,3,2,"div",7),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(7,We,1,1,"icom-libs-product-detail-history",8),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",t.form),e.\u0275\u0275advance(1),e.\u0275\u0275property("model",t.model)("fields",t.fields)("options",t.options)("form",t.form),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!(null!=t.options&&null!=t.options.formState&&t.options.formState.disabled)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",null==t.options||null==t.options.formState?null:t.options.formState.disabled),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",null==t.model?null:t.model.id)}}function Je(n,a){1&n&&e.\u0275\u0275element(0,"nz-spin",14),2&n&&e.\u0275\u0275property("nzSize","large")}let $e=(()=>{class n{constructor(){this.form=new d.FormGroup({}),this.options={formState:{disabled:!0}},this.fields=[],this.productService=(0,e.inject)(h.k),this.IComMessageService=(0,e.inject)(C.Qi),this.cdr=(0,e.inject)(e.ChangeDetectorRef),this.model={},this.fields=[{validators:{validation:[{name:"fieldMatch",options:{errorPath:"value"}}]},fieldGroup:[{key:"type",type:"select-custom",props:{label:"Payment Type",placeholder:"Select Type",viewValue:"name",classInclude:"w-[300px]",labelProp:"name",valueProp:"code",required:!0,options:this.productService.getOptionType("PRODUCT_DISCOUNT_TYPE").pipe((0,l.map)(t=>t?.data))},expressions:{"props.disabled":"formState.disabled"}}]},{key:"value",type:"input",className:"",props:{label:"Value",required:!0,type:"number"},expressions:{"props.disabled":"formState.disabled"}},{key:"status",className:"basis-4/12",type:"Status",props:{placeholder:"Select Status",label:"Pool",viewValue:"name",labelProp:"name",valueProp:"id",required:!0,options:this.productService.getOptionType("PRODUCT_DISCOUNT_STATUS").pipe((0,l.map)(t=>t?.data))},expressions:{"props.disabled":"formState.disabled"}},{key:"date_range",type:"icom-range-picker",props:{required:!0,className:"mt-4",label:"Valid",nzShowTime:!0,format:"dd-MM-yyyy HH:mm"},expressions:{"props.disabled":"formState.disabled"}},{key:"minimum_order_value",type:"input",className:"",props:{label:"Minimum order value",required:!0,type:"number"},expressions:{"props.disabled":"formState.disabled"}},{key:"maximum_discount_amount",type:"input",className:"",props:{label:"Maximum discount amount",required:!0,type:"number"},expressions:{"props.disabled":"formState.disabled"}}]}ngOnInit(){var t=this;return(0,m.Z)(function*(){try{if(t.loadingIndicator=!0,t.cdr.detectChanges(),t.model=yield(0,l.lastValueFrom)(t.productService.getProductDiscount(t.product?.id)),t.modelOrigin=(0,v.cloneDeep)(t.model),!t.model.valid_from||!t.model.valid_until)return;t.model.date_range=[x(t.model.valid_from).toDate(),x(t.model.valid_until).toDate()]}catch(o){t.IComMessageService.showAlertMessageError(o?.error?.error_message)}finally{t.loadingIndicator=!1,t.cdr.detectChanges()}})()}handlerSave(t){var o=this;return(0,m.Z)(function*(){if(t.stopPropagation(),t.preventDefault(),o.form.valid)try{o.form.markAsTouched(),o.form.submitted=!0;const r={...o.model};if(o.isLoading=!0,o.cdr.detectChanges(),(0,k.NT)(r,"valid_from,valid_until"),r.id)return yield(0,l.lastValueFrom)(o.productService.updateProductDiscount(r)),o.IComMessageService.showAlertMessageDone("Edit product discount success"),void o.toggleDisabled();delete r.id,yield(0,l.lastValueFrom)(o.productService.createProductDiscount(r)),o.IComMessageService.showAlertMessageError("Edit product discount success")}catch(r){o.IComMessageService.showAlertMessageError(r?.error?.error_message)}finally{o.isLoading=!1,o.cdr.detectChanges()}else Object.keys(o.form.controls).forEach(r=>{o.form.controls[r].touched=!0})})()}handlerCancel(t){t.stopPropagation(),t.preventDefault(),this.toggleDisabled(),this.form.reset(this.modelOrigin)}toggleDisabled(){this.options.formState.disabled=!this.options.formState.disabled}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["icom-libs-product-detail-discount"]],inputs:{product:"product"},standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:2,vars:2,consts:[["class","w-full h-full flex",4,"ngIf"],["class","w-full h-full flex justify-center items-center","nzSimple","",3,"nzSize",4,"ngIf"],[1,"w-full","h-full","flex"],[1,"flex","w-full","h-full","flex-col","pt-4","bg-white","border","rounded-md"],["nz-form","",3,"formGroup"],[3,"model","fields","options","form"],["nz-row","",1,"p-4","border"],["nz-col","","class","search-area flex",4,"ngIf"],["class","ml-4",3,"product",4,"ngIf"],["nz-col","",1,"search-area","flex"],["nz-button","","icomLibsHasPermissionDirective","",3,"nzType","nzLoading","action","click"],["nz-button","","icomLibsHasPermissionDirective","",1,"ml-4",3,"action","click"],["nz-button","","icomLibsHasPermissionDirective","",3,"nzType","action","click"],[1,"ml-4",3,"product"],["nzSimple","",1,"w-full","h-full","flex","justify-center","items-center",3,"nzSize"]],template:function(o,r){1&o&&(e.\u0275\u0275template(0,Xe,8,8,"div",0),e.\u0275\u0275template(1,Je,1,1,"nz-spin",1)),2&o&&(e.\u0275\u0275property("ngIf",!r.loadingIndicator),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",r.loadingIndicator))},dependencies:[y.FormlyNgZorroAntdModule,d.ReactiveFormsModule,d.\u0275NgNoValidate,d.NgControlStatusGroup,d.FormGroupDirective,u.FormlyModule,u.FormlyForm,f.NzButtonModule,f.NzButtonComponent,S.\u0275NzTransitionPatchDirective,z.NzWaveDirective,g.NgIf,P,_.NzSpinModule,_.NzSpinComponent,w.E],encapsulation:2})}return n})();var Ke=s(86991);function et(n,a){if(1&n&&(e.\u0275\u0275elementStart(0,"nz-page-header-title"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.product.name||"")}}function tt(n,a){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"icom-libs-product-detail-general",16),e.\u0275\u0275listener("icomSave",function(r){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(i.handlerIcomSave(r))}),e.\u0275\u0275elementEnd()}if(2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("product",t.productTemp)}}function ot(n,a){if(1&n&&e.\u0275\u0275element(0,"icom-libs-product-detail-language",17),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("product",t.product)}}function nt(n,a){if(1&n&&e.\u0275\u0275element(0,"icom-libs-product-detail-price",17),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("product",t.product)}}function rt(n,a){if(1&n&&e.\u0275\u0275element(0,"icom-libs-product-detail-properties",17),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("product",t.product)}}function it(n,a){if(1&n&&e.\u0275\u0275element(0,"icom-libs-product-detail-media",17),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("product",t.product)}}function at(n,a){if(1&n&&e.\u0275\u0275element(0,"icom-libs-product-detail-inventory",17),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("product",t.product)}}function lt(n,a){if(1&n&&e.\u0275\u0275element(0,"icom-libs-inventory-items-list",18),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("inventoryId",-1)("productId",t.product.id||0)}}function st(n,a){if(1&n&&e.\u0275\u0275element(0,"icom-libs-product-detail-discount",17),2&n){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("product",t.product)}}function dt(n,a){1&n&&(e.\u0275\u0275elementStart(0,"nz-page-header-content",4)(1,"div",5)(2,"nz-tabset",6)(3,"nz-tab",7),e.\u0275\u0275template(4,tt,1,1,"ng-template",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"nz-tab",9),e.\u0275\u0275template(6,ot,1,1,"ng-template",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"nz-tab",10),e.\u0275\u0275template(8,nt,1,1,"ng-template",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"nz-tab",11),e.\u0275\u0275template(10,rt,1,1,"ng-template",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"nz-tab",12),e.\u0275\u0275template(12,it,1,1,"ng-template",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"nz-tab",13),e.\u0275\u0275template(14,at,1,1,"ng-template",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"nz-tab",14),e.\u0275\u0275template(16,lt,1,2,"ng-template",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"nz-tab",15),e.\u0275\u0275template(18,st,1,1,"ng-template",8),e.\u0275\u0275elementEnd()()()()),2&n&&(e.\u0275\u0275advance(2),e.\u0275\u0275property("nzSelectedIndex",0))}function ct(n,a){1&n&&(e.\u0275\u0275elementStart(0,"div",19),e.\u0275\u0275element(1,"nz-spin",20),e.\u0275\u0275elementEnd())}let pt=(()=>{class n{constructor(t,o){this.route=t,this.router=o,this.productId="",this.productService=(0,e.inject)(h.k),this.cdr=(0,e.inject)(e.ChangeDetectorRef),this.location=(0,e.inject)(g.Location),this.backClicked=new e.EventEmitter,this.saveClicked=new e.EventEmitter,this.handleRouterChange()}handleRouterChange(){this.router.events.subscribe(()=>{const t=this.route.snapshot.params.id;t&&(this.productId=t,this.isRouter=!0,this.callApi())}),setTimeout(()=>{this.productId||this.handleLocationPathChange()},500)}handleLocationPathChange(){const o=this.location.path().split("/").pop();o&&(this.productId=o,this.callApi())}callApi(){var t=this;return(0,m.Z)(function*(){try{t.product=yield(0,l.lastValueFrom)(t.productService.getProduct(t.productId)),t.productTemp=(0,v.cloneDeep)(t.product),t.cdr.detectChanges()}catch(o){console.log(o)}})()}handlerNzBack(){this.isRouter?this.router.navigateByUrl("product/voucher"):(this.isAdd?this.backClicked.emit(this.product):this.backClicked.emit(),this.location.replaceState("product/voucher"))}handlerIcomSave(t){this.saveClicked.emit(t)}static#e=this.\u0275fac=function(o){return new(o||n)(e.\u0275\u0275directiveInject(L.ActivatedRoute),e.\u0275\u0275directiveInject(L.Router))};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["icom-libs-product-detail"]],outputs:{backClicked:"backClicked",saveClicked:"saveClicked"},standalone:!0,features:[e.\u0275\u0275StandaloneFeature],decls:4,vars:3,consts:[["nzBackIcon","",1,"site-page-header","h-full","w-full","flex","flex-col",2,"position","absolute","top","0","left","250px","width","calc(100% - 250px)","background","#f0f2f5","height","100%",3,"nzBack"],[4,"ngIf"],["class","w-full h-full overflow-auto",4,"ngIf"],["class","loading-container absolute left-1/2","style","top: 50%;",4,"ngIf"],[1,"w-full","h-full","overflow-auto"],[1,"w-full","h-full"],[3,"nzSelectedIndex"],["nzTitle","General"],["nz-tab",""],["nzTitle","Languages"],["nzTitle","Price"],["nzTitle","Properties"],["nzTitle","Media"],["nzTitle","Inventory"],["nzTitle","Inventory Items"],["nzTitle","Discounts"],[3,"product","icomSave"],[3,"product"],[3,"inventoryId","productId"],[1,"loading-container","absolute","left-1/2",2,"top","50%"],["nzSize","large"]],template:function(o,r){1&o&&(e.\u0275\u0275elementStart(0,"nz-page-header",0),e.\u0275\u0275listener("nzBack",function(){return r.handlerNzBack()}),e.\u0275\u0275template(1,et,2,1,"nz-page-header-title",1),e.\u0275\u0275template(2,dt,19,1,"nz-page-header-content",2),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(3,ct,2,0,"div",3)),2&o&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",r.product&&r.product.id),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",r.product&&r.product.id),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!r.product||!r.product.id))},dependencies:[b.NgxDatatableModule,y.FormlyNgZorroAntdModule,d.ReactiveFormsModule,u.FormlyModule,f.NzButtonModule,E.NzFormModule,j.NzTypographyModule,D.NzPageHeaderModule,D.NzPageHeaderComponent,D.NzPageHeaderTitleDirective,D.NzPageHeaderContentDirective,O.NzSpaceModule,T.NzTabsModule,T.NzTabSetComponent,T.NzTabComponent,T.NzTabDirective,I.NzIconModule,Z,K,g.NgIf,ie,be,je,Qe,$e,Ke.IcomLibInventoryListItemsComponent,_.NzSpinModule,_.NzSpinComponent],encapsulation:2,changeDetection:0})}return n})()}}]);