{"version":3,"file":"libs_flash-sale_src_index_ts.js","mappings":"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","names":["IcomLibsHasPermissionDirective","constructor","el","permissionService","this","ngOnInit","getPermission","action","nativeElement","style","setProperty","static","t","i0","i1","core","lG2","selectors","inputs","standalone","$event","data_r5","_r9","$implicit","ctx_r8","handlerView","ctx_r10","handlerEdit","ctx_r2","pagination","page","limit","i_r6","code","name","start_time","end_time","flash_sale_config","products","length","_c0","status","ListStatus","created_at","created_by_name","_r7","ctx_r4","total_rows","IcomLibsFlashSaleListComponent","listOfData","form","FormGroup","model","rows","options","formState","hidden","fields","className","fieldGroupClassName","fieldGroup","key","type","props","placeholder","nzPrefixIcon","valueProp","labelProp","label","viewValue","expressions","hide","id","value","modalService","inject","NzModalService","viewContainerRef","ViewContainerRef","icomLibsDynamicComponentService","IcomLibsDynamicComponentService","cdr","ChangeDetectorRef","router","Router","iComLibsServicesProjectDynamicHomeService","IComLibsServicesProjectDynamicHomeService","iComLibsServicesProjectFlashSaleService","IComLibsServicesProjectFlashSaleService","IComMessageService","loadPage","drop","event","moveItemInArray","previousIndex","currentIndex","handlerSearch","e","stopPropagation","preventDefault","handlerReset","reset","_this","_asyncToGenerator","loading","dataBody","size","result","lastValueFrom","list","data","items","err","console","log","detectChanges","handlerToggleCollapse","navigateByUrl","_id","_this2","detail","is_transaction_exists","showAlertMessageError","errorMessage","error","error_message","handlerActivate","showModal","handlerOpenGroupSale","onPageChange","onPageSizeChange","Xpm","features","decls","vars","consts","template","rf","ctx","IcomLibsFlashSaleListComponent_tr_48_Template","IcomLibsFlashSaleListComponent_ng_template_49_Template","_c1","_c2","_r3","_r0","DragDropModule","NzTableModule","i2","DatePipe","NgFor","FormlyNgZorroAntdModule","ReactiveFormsModule","i3","FormlyModule","i4","NzButtonModule","i5","i6","i7","NzIconModule","i8","NzDropDownModule","i9","i10","NzModalModule","FindValueByIdPipe","NgClass","NzToolTipModule","i11","encapsulation","changeDetection"],"sourceRoot":"webpack:///","sources":["./libs/core/directives/permission.directive.ts","./libs/flash-sale/src/list/list.component.html","./libs/flash-sale/src/list/list.component.ts"],"sourcesContent":["import { Directive, ElementRef, Input, OnInit, TemplateRef, ViewContainerRef } from '@angular/core';\nimport { PermissionService} from '../services/authenticate/permission.service';\n\n@Directive({\n  selector: '[icomLibsHasPermissionDirective]',\n  standalone: true\n})\nexport class IcomLibsHasPermissionDirective implements OnInit {\n  @Input() action!: string;\n\n  constructor(\n    private el: ElementRef, \n    private permissionService: PermissionService\n  ) {}\n\n  ngOnInit() {\n    if (!this.permissionService.getPermission(this.action)) {\n      this.el.nativeElement.style.setProperty('display', 'none', 'important');\n    }\n  }\n}\n\n","<div class=\"flex w-full h-full flex-col\">\n\n  <div class=\"w-full !p-2 bg-white border rounded-md\">\n    <button \n      icomLibsHasPermissionDirective\n      [action]=\"'view'\"\n      nz-button \n      [nzType]=\"'link'\" \n      (click)=\"handlerOpenGroupSale($event)\"\n    >\n      Quản lý nhóm flash sale\n    </button>\n  </div>\n  \n  <form\n    [formGroup]=\"form\"\n    nz-form\n    class=\"!p-4 bg-white border rounded-md  mt-4 \"\n    (keydown.enter)=\"handlerSearch($event)\"\n  >\n    <div class=\"w-full items-center\">\n      <formly-form\n        [model]=\"model\"\n        [fields]=\"fields\"\n        [options]=\"options\"\n        [form]=\"form\"\n      ></formly-form>\n    </div>\n\n    <div nz-row class=\"flex justify-between\">\n      <div class=\"\">\n        <button\n          icomLibsHasPermissionDirective\n          [action]=\"'add'\"\n          nz-button \n          [nzType]=\"'primary'\" \n          (click)=\"showModal($event)\"\n        >\n          <span nz-icon nzType=\"plus\" nzTheme=\"outline\"></span>\n            Thêm mới\n        </button>\n      </div>\n      <div nz-col class=\"search-area flex items-center\">\n        <button\n          icomLibsHasPermissionDirective\n          [action]=\"'view'\"\n          class=\"!flex !items-center\"\n          nz-button\n          [nzType]=\"'primary'\"\n          (click)=\"handlerSearch($event)\"\n        >\n          <i nz-icon nzType=\"search\" nzTheme=\"outline\"></i>\n          Lọc\n        </button>\n        <button\n          icomLibsHasPermissionDirective\n          [action]=\"'view'\"\n          class=\"ml-4 !flex !items-center\"\n          nz-button\n          (click)=\"handlerReset()\"\n        >\n          <i nz-icon nzTheme=\"outline\" nzType=\"close-circle\"></i>\n          Làm mới\n        </button>\n\n        <a \n          icomLibsHasPermissionDirective\n          [action]=\"'view'\"\n          class=\"ml-4 items-center flex\" \n          (click)=\"handlerToggleCollapse($event)\"\n        >\n          {{ !options.formState.hidden ? 'Mở rộng' : 'Thu gọn' }}\n          <span\n            class=\"ml-2\"\n            nz-icon\n            [nzType]=\"!options.formState.hidden ? 'down' : 'up'\"\n          ></span>\n        </a>\n      </div>\n    </div>\n  </form>\n\n  <div class=\"w-full d-flex h-full mt-4 overflow-hidden\">\n    <nz-table\n      #flashSaleTable\n      [nzScroll]=\"{ y: 'calc(100vh - 430px)' }\"\n      #sectionTable\n      [nzData]=\"rows\"\n      [nzLoading]=\"loading\"\n      [nzTotal]=\"pagination?.total_rows\"\n      [nzPageSize]=\"10\"\n      [nzNoResult]=\"'Không có dữ liệu.'\"\n      [nzPageIndex]=\"pagination?.page\"\n      (nzPageIndexChange)=\"onPageChange($event)\"\n      [nzFrontPagination]=\"false\"\n      (nzPageSizeChange)=\"onPageSizeChange($event)\"\n      nzShowSizeChanger\n      [nzPageSizeOptions]=\"[10, 15, 20, 30, 40, 50]\"\n      class=\"h-full\"\n      [nzData]=\"rows\"\n      cdkDropList\n      [nzFooter]=\"footerTemplate\"\n      (cdkDropListDropped)=\"drop($event)\"\n    >\n    <thead>\n      <tr>\n        <th class=\"text-xs\" nzWidth=\"10%\">STT</th>\n        <th class=\"text-xs\" nzWidth=\"10%\">Mã</th>\n        <th class=\"text-xs\" nzWidth=\"10%\">Tên</th>\n        <th class=\"text-xs\" nzWidth=\"10%\">Từ ngày</th>\n        <th class=\"text-xs\" nzWidth=\"10%\">Đến ngày</th>\n        <th class=\"text-xs\" nzWidth=\"10%\">Số lượng sản phẩm</th>\n        <th class=\"text-xs\" nzWidth=\"10%\">Trạng thái</th>\n        <th class=\"text-xs\" nzWidth=\"10%\">Thời gian tạo</th>\n        <th class=\"text-xs\" nzWidth=\"10%\">Người tạo</th>\n        <th class=\"text-xs\" nzWidth=\"10%\"></th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr *ngFor=\"let data of flashSaleTable.data; let i = index\">\n        <td class=\"text-xs !p-2\">\n          {{ (pagination?.page - 1) * pagination?.limit + i + 1 }}\n        </td>\n        <td class=\"text-xs !p-2\">{{ data.code }}</td>\n        <td class=\"text-xs !p-2\">\n          <div class=\"overflow-hidden text-ellipsis whitespace-nowrap\" appShowTooltipOnOverflow nz-tooltip [nzTooltipTitle]=\"data.name\">\n            {{ data.name || '-' }}\n          </div>\n        </td>\n        <td class=\"text-xs !p-2\">{{ data.start_time | date: 'dd/MM/yyyy HH:mm' }}</td>\n        <td class=\"text-xs !p-2\">{{ data.end_time | date: 'dd/MM/yyyy HH:mm' }}</td>\n        <td class=\"text-xs !p-2\">{{ data.flash_sale_config?.products?.length || 0 }}</td>\n        <td class=\"text-xs !p-2\" [ngClass]=\"{\n          'text-green-500': data.status === 'ACTIVE',\n          'text-red-500': data.status === 'INACTIVE'\n        }\">\n          {{ (data.status | findValueById : ListStatus) || '-' }}\n        </td>\n        <td class=\"text-xs !p-2\">{{ data.created_at | date: 'dd/MM/yyyy HH:mm' }}</td>\n        <td class=\"text-xs !p-2\">{{ data.created_by_name }}</td>\n        <td>\n          <div class=\"name-container\">\n            <button \n              nz-button \n              [nzType]=\"'primary'\" \n              [nzShape]=\"'round'\" \n              nz-button \n              nz-dropdown \n              [nzDropdownMenu]=\"menu4\"\n            >\n              Hành động\n              <span nz-icon nzType=\"down\"></span>\n            </button>\n            <nz-dropdown-menu #menu4=\"nzDropdownMenu\">\n              <ul nz-menu>\n                <li \n                  icomLibsHasPermissionDirective\n                  [action]=\"'view'\"\n                  nz-menu-item \n                  (click)=\"handlerView($event, data)\"\n                >\n                  Xem\n                </li>\n                <li \n                  icomLibsHasPermissionDirective\n                  [action]=\"'edit'\"\n                  nz-menu-item \n                  (click)=\"handlerEdit($event, data)\"\n                >\n                  Sửa\n                </li>\n              </ul>\n            </nz-dropdown-menu>\n          </div>\n        </td>\n      </tr>\n    </tbody>\n    \n    </nz-table>\n  </div>\n</div>\n\n<ng-template #footerTemplate>\n  <div class=\"footer-content\">\n    Tổng số bản ghi: {{ pagination?.total_rows || 0 }}\n  </div>\n</ng-template>","import { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\nimport { Component, ChangeDetectionStrategy, OnInit, inject, ViewContainerRef, ChangeDetectorRef } from '@angular/core';\nimport { DragDropModule } from '@angular/cdk/drag-drop';\nimport { NzTableModule } from 'ng-zorro-antd/table';\nimport { DatePipe, NgClass, NgFor } from '@angular/common';\nimport { FormGroup, ReactiveFormsModule } from '@angular/forms';\nimport { FormlyNgZorroAntdModule } from '@ngx-formly/ng-zorro-antd';\nimport { FormlyFormOptions, FormlyFieldConfig, FormlyModule } from '@ngx-formly/core';\nimport { NzButtonModule } from 'ng-zorro-antd/button';\nimport { NzIconModule } from 'ng-zorro-antd/icon';\nimport { NzDropDownModule } from 'ng-zorro-antd/dropdown';\nimport { NzModalModule, NzModalService } from 'ng-zorro-antd/modal';\nimport { IComMessageService, IcomLibsDynamicComponentService } from '@icom/services/common'\nimport { Router } from '@angular/router';\nimport { IComLibsServicesProjectDynamicHomeService, IComLibsServicesProjectFlashSaleService } from '@icom/services/projects';\nimport { lastValueFrom } from 'rxjs';\nimport { ListStatus } from 'libs/flash-sale/detail/src/defines/code.define';\nimport { FindValueByIdPipe } from 'libs/section/src/list/pipe/ find-value-by-id.pipe';\nimport { NzToolTipModule } from 'ng-zorro-antd/tooltip';\nimport { HttpErrorResponse } from '@angular/common/http';\nimport { IcomLibsHasPermissionDirective } from '@icom/directive';\n@Component({\n  selector: 'icom-libs-flash-sale-list',\n  templateUrl: './list.component.html',\n  standalone: true,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  imports: [\n    DragDropModule,\n    NzTableModule,\n    DatePipe,\n    NgFor,\n    FormlyNgZorroAntdModule,\n    ReactiveFormsModule,\n    FormlyModule,\n    NzButtonModule,\n    NzIconModule,\n    NzDropDownModule,\n    NzModalModule,\n    FindValueByIdPipe,\n    NgClass,\n    NzToolTipModule,\n    IcomLibsHasPermissionDirective\n  ],\n\n})\nexport class IcomLibsFlashSaleListComponent implements OnInit {\n  listOfData: any[] = []; // Khởi tạo mảng dữ liệu của bạn\n\n  protected form = new FormGroup({});\n  protected model: any = {};\n  protected pagination: any;\n  ListStatus = ListStatus();\n  protected rows: any[] = [];\n  protected options: FormlyFormOptions = {\n    formState: {\n      hidden: false\n    },\n  };\n  \n  protected fields: FormlyFieldConfig[] = [\n    {\n      className: 'flex flex-col',\n      fieldGroupClassName: 'flex w-full justify-center',\n      fieldGroup: [\n        {\n          key: 'name',\n          type: 'search-input',\n          className: 'basis-6/12',\n          props: {\n            placeholder: 'Tìm kiếm theo mã, tên flash sale',\n            nzPrefixIcon: 'search',\n          },\n        }\n      ]\n    },\n    {\n      className: 'flex flex-row flex-wrap', // Sử dụng flex row để chia thành các cột\n      fieldGroupClassName: 'flex w-full',\n      fieldGroup: [\n        {\n          key: 'status',\n          type: 'select-custom',\n          className: 'basis-6/12',\n          props: {\n            placeholder: 'Trạng thái',\n            valueProp: 'id',\n            labelProp: 'value',\n            label: 'Trạng thái',\n            viewValue: 'value',\n            options: ListStatus()\n          },\n          expressions: {\n            hide: '!formState.hidden'\n          },\n        },\n        {\n          key: 'effect',\n          type: 'select-custom',\n          className: 'basis-6/12',\n          props: {\n            placeholder: 'Hiệu lực',\n            valueProp: 'id',\n            labelProp: 'value',\n            viewValue: 'value',\n            label: 'Hiệu lực',\n            options: [\n              { id: 'non expired', value: 'Còn hiệu lực' },\n              { id: 'expired', value: 'Hết hiệu lực' },\n            ],\n          },\n          expressions: {\n            hide: '!formState.hidden'\n          },\n        }\n      ],\n    }\n  ];\n\n  protected modalService = inject(NzModalService);\n  protected viewContainerRef = inject(ViewContainerRef);\n  protected icomLibsDynamicComponentService = inject(IcomLibsDynamicComponentService);\n  protected cdr = inject(ChangeDetectorRef);\n  protected router = inject(Router);\n  protected iComLibsServicesProjectDynamicHomeService = inject(\n    IComLibsServicesProjectDynamicHomeService\n  );\n  protected iComLibsServicesProjectFlashSaleService = inject(\n    IComLibsServicesProjectFlashSaleService\n  );\n  protected IComMessageService = inject(IComMessageService);\n\n  ngOnInit() {\n    this.loadPage(1);\n  }\n\n\n  protected drop(event: CdkDragDrop<string[]>): void {\n    const prevIndex = event.previousIndex;\n    const newIndex = event.currentIndex;\n    moveItemInArray(this.listOfData, prevIndex, newIndex);\n  }\n\n  protected handlerSearch(e: Event) {\n    e.stopPropagation();\n    e.preventDefault();\n    this.loadPage(1);\n  }\n\n  protected handlerReset() {\n    this.form.reset();\n    this.loadPage(1);\n  }\n  loading!: boolean;\n  protected async loadPage(page: number = 1, limit: number = 10) {\n    try {\n      this.loading = true;\n      const model = { ...this.model };\n      const dataBody = {\n        ...model,\n        size: limit,\n        page: page,\n      };\n      const result = await lastValueFrom(\n        this.iComLibsServicesProjectFlashSaleService.list({\n          ...dataBody,\n        })\n      );\n\n      if (result && result.data && result.data.items) {\n        const rows = result.data.items || [];\n        this.rows = rows;\n        this.pagination = result.data.pagination;\n        return;\n      }\n\n      this.rows = [];\n      this.pagination = result.data.pagination;\n    } catch (err) {\n      console.log(err);\n    } finally {\n      this.loading = false;\n      this.cdr.detectChanges();\n    }\n  }\n\n\n  protected handlerToggleCollapse(e: Event) {\n    e.stopPropagation();\n    e.preventDefault();\n    this.options.formState.hidden = !this.options.formState.hidden;\n  }\n\n  protected handlerView(e: Event, data: any) {\n    e.stopPropagation();\n    e.preventDefault();\n    this.router.navigateByUrl(`flash-sale/list/detail?id=${data._id}&mode=view`);\n  }\n\n  protected async handlerEdit(e: Event, data: any) {\n    e.stopPropagation();\n    e.preventDefault();\n    try {\n      const id = (data as any)?._id || '';\n      const result = await lastValueFrom(\n        this.iComLibsServicesProjectFlashSaleService.detail(+id)\n      );\n      if(result?.data?.is_transaction_exists) {\n        this.IComMessageService.showAlertMessageError(\n          'Flash sale đã có giao dịch thành công. Bạn không được phép sửa.'\n        );\n        return;\n      }\n      this.router.navigateByUrl(`flash-sale/list/detail?id=${data._id}&mode=edit`);\n\n    } catch (err) {\n      const error = err as HttpErrorResponse;\n      const errorMessage = error?.error?.error_message;\n      this.IComMessageService.showAlertMessageError(errorMessage)\n    }\n  }\n\n  protected handlerActivate(e: Event) {\n    e.stopPropagation();\n    e.preventDefault();\n  }\n\n  protected showModal(e: Event) {\n    e.stopPropagation();\n    e.preventDefault();\n    this.router.navigateByUrl(`flash-sale/list/detail?mode=add`);\n  }\n\n  protected handlerOpenGroupSale(e: Event) {\n    e.stopPropagation();\n    e.preventDefault();\n    this.router.navigateByUrl(`flash-sale/list/group`);\n  }\n\n  onPageChange(page: number): void {\n    this.loadPage(page, this.pagination.limit);\n  }\n\n  onPageSizeChange(page: number): void {\n    this.loadPage(1, page);\n  }\n}\n"],"x_google_ignoreList":[]}