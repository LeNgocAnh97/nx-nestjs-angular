"use strict";(self.webpackChunkapps_flash_sale=self.webpackChunkapps_flash_sale||[]).push([[216],{8213:(R,S,i)=>{i.d(S,{E2:()=>I,ZR:()=>g,c2:()=>C,PM:()=>w,xh:()=>k,NT:()=>A,cT:()=>D});var v=i(95),e=i(3304);const g=()=>({transform:s=>s?e(s).format("DD/MM/YYYY HH:mm"):"-"}),I=()=>({transform:s=>s||"-"}),A=(s,c,d)=>{let m=["start_time","end_time"];c&&(m=c.split(","));const[u,a]=m;if(!s.date_range||!s.date_range.length)return;const f=s.date_range,[y,h]=f;if(y instanceof String&&h instanceof String)return;const p={[u]:e(y),[a]:e(h)};s[u]=p[u],s[a]=p[a],delete s.date_range},k=(s,c,d)=>{let m=["start_time","end_time"];c&&(m=c.split(","));const[u,a]=m;if(!s.date_range||!s.date_range.length)return;const f=s.date_range,[y,h]=f;if(y instanceof String&&h instanceof String)return;const p={[u]:e(y).format("YYYY-MM-DDT00:00:00")+"Z",[a]:e(h).format("YYYY-MM-DDT00:00:00")+"Z"};s[u]=p[u],s[a]=p[a],delete s.date_range},w=(s,c)=>{for(const d in s)c[d]=s[d]},C=s=>{Object.values(s.controls).forEach(c=>{c.markAsTouched(),c instanceof v.cw?C(c):c instanceof v.Oe&&c.controls.forEach(d=>{d instanceof v.cw?C(d):d instanceof v.NI&&d.markAsTouched()})})},D=(s,c,d,m,u)=>{const a=new XMLHttpRequest;a.open("POST",s,!0),a.responseType="blob";let f=localStorage?.getItem("token");for(;f?.includes('"');)f=f?.replace('"',"");a.setRequestHeader("Authorization",`Bearer ${f}`),a.onload=()=>{if(200===a.status){const y=new Blob([a.response],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),h=URL.createObjectURL(y),p=document.createElement("a"),x=a.getResponseHeader("Content-Disposition");let b="";if(!u){const z=new Date;b=`${z.getDate()}_${z.getMonth()+1}_${z.getFullYear()}`}let M=`${c}_${b}`;if(x){const O=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(x);null!=O&&O[1]&&(M=O[1].replace(/['"]/g,""))}p.href=h,p.download=M,document.body.appendChild(p),p.click(),URL.revokeObjectURL(h),document.body.removeChild(p),d.showAlertMessageDone("T\u1ea3i file th\xe0nh c\xf4ng.")}else d.showAlertMessageDone("T\u1ea3i file th\u1ea5t b\u1ea1i.")},a.onerror=function(){console.error("Request error")},a.setRequestHeader("Content-Type","application/json"),m&&k(m),a.send(JSON.stringify(m))}},216:(R,S,i)=>{i.r(S),i.d(S,{IcomLibInventoryListComponent:()=>Y,IcomLibsInventoryAddEditComponent:()=>E});var v=i(5861),e=i(5879),g=i(95),I=i(5545),A=i(3802),k=i(9364),L=i(2840),w=i(3599),C=i(1659),D=i(708),s=i(6814),c=i(8083),d=i(2595),m=i(1221),u=i(9691),a=i(2787),f=i(9717),y=i(1567),h=i(7398),x=i(8213),b=i(6990),M=i(855),z=i(1958);function O(r,T){if(1&r){const n=e.EpF();e.TgZ(0,"div",3)(1,"div",4)(2,"button",5),e.NdJ("click",function(t){e.CHM(n);const l=e.oxw();return e.KtG(l.handlerSave(t))}),e._uU(3," Submit "),e.qZA(),e.TgZ(4,"button",6),e.NdJ("click",function(t){e.CHM(n);const l=e.oxw();return e.KtG(l.handlerCancel(t))}),e._uU(5,"Cancel"),e.qZA()()()}if(2&r){const n=e.oxw();e.xp6(2),e.Q6J("nzType","primary")("nzLoading",n.isLoading)}}let E=(()=>{class r{constructor(){this.form=new g.cw({}),this.options={},this.fields=[],this.iComMessageService=(0,e.f3M)(f.Q),this.iComLibsServicesInventoryService=(0,e.f3M)(C.NH),this.productService=(0,e.f3M)(C.k),this.changeDetectorRef=(0,e.f3M)(e.sBO),this.model={}}ngOnInit(){this.fields=(r=>[{key:"code",type:"input",props:{label:"Code",placeholder:"Enter Code",type:"string",required:!0}},{key:"name",type:"input",props:{label:"Name",placeholder:"Enter Name",type:"string",required:!0}},{key:"date_range",className:"w-[300px]",type:"icom-range-picker",props:{required:!0,label:"Rent",nzShowTime:!0,format:"dd-MM-yyyy HH:mm"}},{key:"type",type:"select-custom",templateOptions:{label:"Type",placeholder:"Select Type",viewValue:"name",required:!0,labelProp:"name",valueProp:"code",options:r.getOptionType("INVENTORY_TYPE").pipe((0,h.U)(T=>T?.data))}},{key:"status",type:"select-custom",templateOptions:{label:"Status",placeholder:"Select Status",viewValue:"name",required:!0,labelProp:"name",valueProp:"int_value",options:r.getOptionType("INVENTORY_STATUS").pipe((0,h.U)(T=>T?.data))}},{key:"description",type:"quill-editor",props:{label:"Description",placeholder:"Enter description",type:"string",required:!0}}])(this.productService),this.modelOrigin=(0,b.cloneDeep)(this.model)}handlerSave(n,o){var t=this;return(0,v.Z)(function*(){if(n?.stopPropagation(),n?.preventDefault(),t.form.valid)try{t.form.markAsTouched(),t.form.submitted=!0,o&&o.isLoading&&o.isLoading();const l=(0,b.cloneDeep)(t.model);t.isLoading=!0,t.isAdd?((0,x.NT)(l,"rent_from,rent_to"),yield(0,D.n)(t.iComLibsServicesInventoryService.createInventory(l)),o?.success&&o?.success(),t.iComMessageService.showAlertMessageDone("Create inventory success")):(yield(0,D.n)(t.iComLibsServicesInventoryService.updateInventory(t.model?.id,l)),o&&o.success&&o.success(),t.iComMessageService.showAlertMessageDone("Edit inventory success"),t.modelOrigin=(0,b.cloneDeep)(t.model))}catch(l){o&&o.loadDone&&o.loadDone(),t.iComMessageService.showAlertMessageError(l?.error?.error_message||"Create inventory fail")}finally{o&&o.loadDone&&o.loadDone(),t.isLoading=!1,t.changeDetectorRef.detectChanges()}else Object.keys(t.form.controls).forEach(l=>{t.form.controls[l].touched=!0})})()}handlerCancel(n){n.stopPropagation(),this.model=(0,b.cloneDeep)(this.modelOrigin)}static#e=this.\u0275fac=function(o){return new(o||r)};static#t=this.\u0275cmp=e.Xpm({type:r,selectors:[["icom-libs-inventory-add_edit"]],inputs:{model:"model",isAdd:"isAdd"},standalone:!0,features:[e.jDz],decls:3,vars:6,consts:[["nz-form","",1,"!p-4","bg-white","border","rounded-md",3,"formGroup"],[3,"model","fields","options","form"],["nz-row","",4,"ngIf"],["nz-row",""],["nz-col","",1,"search-area","flex"],["nz-button","",3,"nzType","nzLoading","click"],["nz-button","",1,"ml-4",3,"click"]],template:function(o,t){1&o&&(e.TgZ(0,"form",0),e._UZ(1,"formly-form",1),e.YNc(2,O,6,2,"div",2),e.qZA()),2&o&&(e.Q6J("formGroup",t.form),e.xp6(1),e.Q6J("model",t.model)("fields",t.fields)("options",t.options)("form",t.form),e.xp6(1),e.Q6J("ngIf",t.model&&t.model.id))},dependencies:[A.u,g.UX,g._Y,g.JL,g.sg,I.X0,I.T7,L.sL,L.ix,M.w,z.dQ,s.O5],encapsulation:2,changeDetection:0})}return r})();var _=i(4843),N=i(2920);function Z(r,T){1&r&&(e.ynx(0),e._UZ(1,"icom-libs-inventory-add_edit",9),e.BQk()),2&r&&(e.xp6(1),e.Q6J("isAdd",!0))}function F(r,T){if(1&r){const n=e.EpF();e.TgZ(0,"icom-libs-core-components-table",10),e.NdJ("icomFunctionControl",function(t){e.CHM(n);const l=e.oxw();return e.KtG(l.handlerFunctionControl(t))}),e.qZA()}if(2&r){const n=e.oxw();e.Q6J("columns",n.columns)("limit",15)("loadFn",n.loadData)}}let Y=(()=>{class r{constructor(){this.form=new g.cw({}),this.model={},this.options={},this.rows=[],this.loadingIndicator=!0,this.ColumnMode=k.hq,this.headerHeight=50,this.rowHeight=50,this.pageLimit=10,this.inventoryService=(0,e.f3M)(C.NH),this.el=(0,e.f3M)(e.SBq),this.modalService=(0,e.f3M)(m.Sf),this.IComMessageService=(0,e.f3M)(f.Q),this.router=(0,e.f3M)(y.F0),this.cdr=(0,e.f3M)(e.sBO),this.loadData=n=>this.inventoryService.listInventory(n),this.columns=[]}ngOnInit(){var n=this;return(0,v.Z)(function*(){n.columns=[{title:"Name",key:"name",type:"text"},{title:"Type",key:"type",type:"text"},{title:"Rent Start",key:"start_time",type:"text",pipe:"time"},{title:"Rent End",key:"end_time",type:"text",pipe:"time"},{title:"Status",key:"status",pipe:"array",type:"text",pipeArgs:[{value:"Closed",id:0,class:"text-gray-500"},{value:"Opened",id:1,class:"text-green-500"}]},{title:"Action",key:"actions",type:"action",actions:[{name:"Edit",callback:n.handlerViewDetail.bind(n),condition:()=>!0},{name:"Remove",callback:n.handlerRemove.bind(n),condition:()=>!0}]}]})()}showModal(){this.isVisible=!0}handleOk(){this.addEditComp.handlerSave(void 0,{success:()=>{this.isVisible=!1},isLoading:()=>{this.isOkLoading=!0},loadDone:()=>{this.isOkLoading=!1,this.eventFunctionControl.reset()}})}handleCancel(){this.isVisible=!1}handlerRemove(n){this.modalService.confirm({nzTitle:"Are you sure delete this inventory?",nzContent:`<b style="color: red;">${n.name}</b>`,nzOkText:"Delete",nzOkType:"primary",nzOkDanger:!0,nzMaskClosable:!1,nzClosable:!1,nzOnOk:this.processDeleteInventory.bind(this,n),nzCancelText:"Cancel"},"error")}handlerViewDetail(n){this.router.navigate(["/inventory/detail",n.id])}processDeleteInventory(n){return(0,D.n)(this.inventoryService.deleteInventory(n.id||"")).then(()=>{this.IComMessageService.showAlertMessageDone("Delete inventory success"),this.eventFunctionControl.reset()}).catch(o=>{this.IComMessageService.showAlertMessageError(o?.error?.error_message)})}handlerFunctionControl(n){this.eventFunctionControl=n}static#e=this.\u0275fac=function(o){return new(o||r)};static#t=this.\u0275cmp=e.Xpm({type:r,selectors:[["icom-libs-product-list"]],viewQuery:function(o,t){if(1&o&&e.Gf(E,5),2&o){let l;e.iGM(l=e.CRH())&&(t.addEditComp=l.first)}},standalone:!0,features:[e.jDz],decls:10,vars:7,consts:[[1,"flex","w-full","h-full","flex-col"],["nz-row","",1,"flex","justify-end","w-full","pr-4","h-full",2,"justify-content","end","padding-right","8px"],[1,""],["nz-button","",3,"nzType","click"],["nz-icon","","nzType","plus","nzTheme","outline"],["nzTitle","Add New Inventory",3,"nzWidth","nzOkLoading","nzClosable","nzMaskClosable","nzVisible","nzVisibleChange","nzOnCancel","nzOnOk"],[4,"nzModalContent"],[1,"w-full","h-full","mt-4"],["class","w-full h-full",3,"columns","limit","loadFn","icomFunctionControl",4,"ngIf"],[3,"isAdd"],[1,"w-full","h-full",3,"columns","limit","loadFn","icomFunctionControl"]],template:function(o,t){1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),e.NdJ("click",function(){return t.showModal()}),e._UZ(4,"span",4),e._uU(5," Add "),e.qZA(),e.TgZ(6,"nz-modal",5),e.NdJ("nzVisibleChange",function(V){return t.isVisible=V})("nzOnCancel",function(){return t.handleCancel()})("nzOnOk",function(){return t.handleOk()}),e.YNc(7,Z,2,1,"ng-container",6),e.qZA()()(),e.TgZ(8,"div",7),e.YNc(9,F,1,3,"icom-libs-core-components-table",8),e.qZA()()),2&o&&(e.xp6(3),e.Q6J("nzType","primary"),e.xp6(3),e.Q6J("nzWidth",960)("nzOkLoading",t.isOkLoading)("nzClosable",!1)("nzMaskClosable",!1)("nzVisible",t.isVisible),e.xp6(3),e.Q6J("ngIf",t.loadData))},dependencies:[A.u,g.UX,I.X0,L.sL,L.ix,M.w,z.dQ,w.U5,N.SK,c.ZJ,d.PV,d.Ls,m.Qp,m.du,m.Hf,u.LV,g.u5,a.b1,E,s.O5,_.d],encapsulation:2,changeDetection:0})}return r})()}}]);